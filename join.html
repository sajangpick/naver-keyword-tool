<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://*.supabase.co; img-src 'self' data: https:; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; font-src 'self' data:; frame-ancestors 'self'; base-uri 'self'; form-action 'self'" />
    <meta name="referrer" content="no-referrer" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <title>íšŒì›ê°€ì… - ì‚¬ì¥í”½</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%23ff7b54'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-size='28' font-family='Arial' fill='white'%3ESP%3C/text%3E%3C/svg%3E" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"
    />
    <style>
      :root {
        --brand-primary: #ff7b54;
        --brand-primary-dark: #ff5c2e;
        --brand-ink: #201a17;
        --brand-muted: #7a6a60;
        --brand-cream: #fff7f0;
        --brand-line: rgba(255, 123, 84, 0.25);
        --brand-soft: #ffe3d5;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Pretendard Variable", Pretendard, "Noto Sans KR", Arial,
          sans-serif;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background: radial-gradient(
              circle at 20% 20%,
              rgba(255, 123, 84, 0.12),
              transparent 50%
            ),
          radial-gradient(
              circle at 80% 0%,
              rgba(255, 208, 188, 0.35),
              transparent 42%
            )
            var(--brand-cream);
        align-items: center;
        justify-content: center;
        padding: 40px 16px;
        color: var(--brand-ink);
      }

      .signup-shell {
        width: 100%;
        max-width: 540px;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .signup-container {
        background: #fff;
        border-radius: 32px;
        border: 1px solid var(--brand-line);
        box-shadow: 0 45px 80px rgba(32, 26, 23, 0.08);
        padding: 52px 44px 40px;
        width: 100%;
        position: relative;
        overflow: hidden;
      }

      .signup-container::after {
        content: "";
        position: absolute;
        inset: 30px -180px auto auto;
        width: 320px;
        height: 320px;
        background: radial-gradient(
          circle at 40% 40%,
          rgba(255, 123, 84, 0.22),
          transparent 65%
        );
        transform: rotate(18deg);
      }

      .signup-container > * {
        position: relative;
        z-index: 1;
      }

      .back-btn {
        position: absolute;
        top: 22px;
        left: 22px;
        border: none;
        background: rgba(255, 123, 84, 0.08);
        color: var(--brand-primary);
        width: 42px;
        height: 42px;
        border-radius: 14px;
        font-size: 18px;
        cursor: pointer;
        transition: transform 0.2s ease, background 0.2s ease;
      }

      .back-btn:hover {
        transform: translateX(-3px);
        background: rgba(255, 123, 84, 0.15);
      }

      .brand-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        border-radius: 999px;
        background: rgba(255, 123, 84, 0.1);
        color: var(--brand-primary);
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        margin-bottom: 18px;
        margin-left: 64px; /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼(left: 22px + width: 42px)ê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì—¬ë°± ì¶”ê°€ */
      }

      .logo {
        text-align: left;
        font-size: 38px;
        font-weight: 900;
        color: var(--brand-ink);
        margin-bottom: 10px;
        letter-spacing: -0.02em;
      }

      .subtitle {
        color: var(--brand-muted);
        margin-bottom: 30px;
        font-size: 16px;
        line-height: 1.6;
      }

      .brand-hero {
        display: flex;
        gap: 16px;
        padding: 20px;
        border-radius: 26px;
        background: var(--brand-cream);
        border: 1px solid var(--brand-line);
        margin-bottom: 22px;
      }

      .brand-icon {
        width: 60px;
        height: 60px;
        border-radius: 20px;
        background: var(--brand-primary);
        color: #fff;
        font-weight: 800;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 18px 30px rgba(255, 123, 84, 0.35);
      }

      .brand-hero__title {
        font-size: 19px;
        font-weight: 700;
        margin-bottom: 6px;
      }

      .brand-hero__desc {
        font-size: 14px;
        color: var(--brand-muted);
        line-height: 1.6;
      }

      .brand-benefits {
        list-style: none;
        margin-bottom: 28px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .brand-benefits li {
        display: flex;
        gap: 12px;
        padding: 14px 16px;
        border-radius: 20px;
        border: 1px solid rgba(32, 26, 23, 0.06);
        background: #fff;
        box-shadow: inset 0 0 0 1px rgba(255, 123, 84, 0.05);
      }

      .brand-benefits span {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        background: rgba(255, 123, 84, 0.12);
        color: var(--brand-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .benefit-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 2px;
      }

      .benefit-desc {
        font-size: 13px;
        color: var(--brand-muted);
        line-height: 1.4;
      }

      .social-login {
        display: flex;
        flex-direction: column;
        gap: 14px;
        position: relative;
        z-index: 100;
        pointer-events: auto;
        isolation: isolate;
      }
      
      .kakao-btn .kakao-emoji {
        pointer-events: none;
      }

      .kakao-btn {
        width: 100%;
        padding: 16px;
        border-radius: 20px;
        border: 1px solid rgba(0, 0, 0, 0.08);
        background: linear-gradient(
          135deg,
          #fee500 0%,
          #fde768 55%,
          #fee500 100%
        );
        color: #3c1e1e;
        font-size: 16px;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        cursor: pointer !important;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        position: relative;
        z-index: 100;
        pointer-events: auto !important;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      .kakao-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 14px 24px rgba(253, 231, 104, 0.45);
      }

      .kakao-emoji {
        font-size: 18px;
      }

      .terms-note {
        margin-top: 18px;
        font-size: 13px;
        color: var(--brand-muted);
        line-height: 1.6;
        text-align: center;
        background: rgba(255, 123, 84, 0.05);
        border-radius: 18px;
        padding: 14px 18px;
        border: 1px dashed var(--brand-line);
      }

      .terms-note a {
        color: var(--brand-primary);
        text-decoration: none;
        font-weight: 700;
      }

      .terms-note a:hover {
        text-decoration: underline;
      }

      .login-link {
        text-align: center;
        margin-top: 34px;
        padding-top: 22px;
        border-top: 1px dashed var(--brand-line);
        color: var(--brand-muted);
        font-size: 14px;
      }

      .login-link a {
        color: var(--brand-primary);
        text-decoration: none;
        font-weight: 700;
        margin-left: 6px;
      }

      .login-link a:hover {
        text-decoration: underline;
      }

      .error-message,
      .success-message {
        padding: 12px 14px;
        border-radius: 14px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
      }

      .error-message {
        background: rgba(255, 107, 107, 0.12);
        border: 1px solid rgba(255, 107, 107, 0.4);
        color: #b42318;
      }

      .success-message {
        background: rgba(34, 197, 94, 0.12);
        border: 1px solid rgba(34, 197, 94, 0.4);
        color: #047857;
      }

      @media (max-width: 768px) {
        body {
          padding: 28px 12px;
        }

        .signup-container {
          padding: 38px 26px 28px;
          border-radius: 26px;
        }

        .brand-pill {
          margin-left: 60px; /* ëª¨ë°”ì¼ì—ì„œë„ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡ */
        }

        .brand-hero {
          flex-direction: column;
        }
      }

      @media (max-width: 480px) {
        .signup-container {
          padding: 32px 22px 24px;
        }

        .logo {
          font-size: 30px;
        }

        .brand-icon {
          width: 48px;
          height: 48px;
        }

        .brand-benefits li {
          flex-direction: column;
        }
      }

      @media (max-width: 360px) {
        body {
          padding: 18px 10px;
        }

        .signup-container {
          padding: 24px 18px 20px;
          border-radius: 20px;
        }

        .brand-pill {
          font-size: 11px;
          margin-left: 58px; /* ëª¨ë°”ì¼ì—ì„œë„ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡ */
        }

        .login-link {
          font-size: 12px;
        }
      }

      /* í‘¸í„° ìŠ¤íƒ€ì¼ */
      .site-footer {
        background: rgba(255, 255, 255, 0.95);
        border-top: 1px solid rgba(0, 0, 0, 0.08);
        padding: 40px 20px;
        margin-top: auto;
        color: var(--text-secondary);
        width: 100%;
      }

      .footer-content {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        gap: 24px;
        font-size: 14px;
        line-height: 1.8;
        align-items: center;
      }

      .footer-item {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 12px;
      }

      .footer-label {
        font-weight: 700;
        color: var(--text-primary);
        font-size: 13px;
        margin-bottom: 4px;
      }

      .footer-value {
        color: var(--text-secondary);
        font-size: 13px;
      }

      .footer-value a {
        color: var(--accent-color);
        text-decoration: none;
        transition: opacity 0.2s ease;
      }

      .footer-value a:hover {
        opacity: 0.8;
        text-decoration: underline;
      }

      @media (max-width: 768px) {
        .site-footer {
          padding: 10px 8px;
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          z-index: 30;
          margin-top: 0;
        }

        .footer-content {
          gap: 5px;
          font-size: 8px;
          flex-direction: row;
          flex-wrap: wrap;
          line-height: 1.4;
        }

        .footer-item {
          flex-direction: row;
          align-items: center;
          gap: 3px;
        }

        .footer-label {
          font-size: 8px;
        }

        .footer-value {
          font-size: 8px;
        }
      }
    </style>
    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '823098897158597');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=823098897158597&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
  </head>
  <body>
    <div class="signup-shell">
      <div class="signup-container">
        <button class="back-btn" onclick="location.href='index.html'">â†</button>

        <div class="brand-pill">SAJANGPICK MEMBERS</div>
        <div class="logo">ì‚¬ì¥í”½</div>
        <div class="subtitle">
          ì‚¬ì¥ë‹˜ì˜ ë¸Œëœë“œë¥¼ ì§€í‚¤ëŠ” AI ìš´ì˜ íŒŒíŠ¸ë„ˆ, ì§€ê¸ˆ í•¨ê»˜í•˜ì„¸ìš”.
        </div>

        <div class="brand-hero" aria-hidden="true">
          <div class="brand-icon">SP</div>
          <div>
            <p class="brand-hero__title">ì‚¬ì¥ë‹˜ ì»¤ë®¤ë‹ˆí‹° ì „ìš© í˜œíƒ</p>
            <p class="brand-hero__desc">
              ë§¤ì¼ ìŒ“ì´ëŠ” ë¸”ë¡œê·¸Â·ë¦¬ë·°Â·ì •ì±…ì§€ì›ê¸ˆ ì •ë³´ë¥¼ í•œ ê³„ì •ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”.
            </p>
          </div>
        </div>

        <ul class="brand-benefits">
          <li>
            <span>ğŸ§‘â€ğŸ³</span>
            <div>
              <p class="benefit-title">ì—…ì¢…ë³„ ë§ì¶¤ ë°ì´í„°</p>
              <p class="benefit-desc">
                ì—…ì¢…, ì§€ì—­, ë¦¬ë·° íŒ¨í„´ì— ë§ì¶˜ AI ì¶”ì²œê°’ì„ ìë™ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.
              </p>
            </div>
          </li>
          <li>
            <span>ğŸ¤</span>
            <div>
              <p class="benefit-title">íŒ€ ê³µìœ  ë¡œê·¸ì¸</p>
              <p class="benefit-desc">
                í•œ ê³„ì •ìœ¼ë¡œ ì§ì›ê³¼ í•¨ê»˜ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒí•˜ë©° ì‹¤ì‹œê°„ìœ¼ë¡œ ê¸°ë¡ì„ ë‚¨ê¹ë‹ˆë‹¤.
              </p>
            </div>
          </li>
          <li>
            <span>ğŸ›¡ï¸</span>
            <div>
              <p class="benefit-title">ì•ˆì „í•œ ì¹´ì¹´ì˜¤ ì¸ì¦</p>
              <p class="benefit-desc">
                ë³„ë„ ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ë§Œìœ¼ë¡œ ê°€ì…ê³¼ ë¡œê·¸ì•„ì›ƒì„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
              </p>
            </div>
          </li>
        </ul>

        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <div class="social-login">
          <button type="button" class="kakao-btn" id="kakaoSignup" onclick="handleKakaoSignupClick(event)">
            <span class="kakao-emoji">ğŸ’¬</span>
            ì¹´ì¹´ì˜¤í†¡ ì•„ì´ë””ë¡œ íšŒì›ê°€ì…
          </button>
        </div>

        <div class="terms-note">
          ê³„ì† ì§„í–‰í•˜ë©´
          <a href="https://www.sajangpick.co.kr/terms" target="_blank">ì´ìš©ì•½ê´€</a>
          ê³¼
          <a href="https://www.sajangpick.co.kr/privacy" target="_blank"
            >ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a
          >
          ë° ì¹´ì¹´ì˜¤ ê³„ì • ì •ë³´ ì œê³µì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
        </div>

        <div class="login-link">
          ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?
          <a href="login.html" id="loginLink">ì‚¬ì¥í”½ ë¡œê·¸ì¸</a>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js" integrity="sha384-GFr3yTh5lJznCbZfpTtXnwboFsxqtTQoeTZCRHhE0579KrRmlCzen5AA8ohaB5ug" crossorigin="anonymous"></script>
    <script src="/assets/auth-state.js?v=202410" defer></script>
    <script>
      const params = new URLSearchParams(window.location.search);
      let redirectTarget = params.get("redirect");
      
      // redirect íŒŒë¼ë¯¸í„°ë¥¼ sessionStorageì— ì €ì¥ (OAuth ì½œë°± í›„ì—ë„ ì‚¬ìš©í•˜ê¸° ìœ„í•´)
      if (redirectTarget) {
        sessionStorage.setItem('joinRedirect', redirectTarget);
      } else {
        // sessionStorageì—ì„œ redirect ê°€ì ¸ì˜¤ê¸° (OAuth ì½œë°± í›„)
        redirectTarget = sessionStorage.getItem('joinRedirect');
      }

      function resolveRedirectTarget() {
        // sessionStorageì—ì„œ redirect ë‹¤ì‹œ í™•ì¸
        let target = redirectTarget || sessionStorage.getItem('joinRedirect');
        
        if (!target) {
          console.log("[íšŒì›ê°€ì…] redirect íŒŒë¼ë¯¸í„° ì—†ìŒ, index.htmlë¡œ ì´ë™");
          return "index.html";
        }
        
        // URL ë””ì½”ë”© (encodeURIComponentë¡œ ì¸ì½”ë”©ëœ ê²½ìš°)
        let decodedTarget = decodeURIComponent(target);
        console.log("[íšŒì›ê°€ì…] redirect ëŒ€ìƒ:", decodedTarget);
        
        // ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ íšŒì›ê°€ì…í•œ ê²½ìš° ê´€ë¦¬ì í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        if (decodedTarget.startsWith("/admin/")) {
          console.log("[íšŒì›ê°€ì…] ê´€ë¦¬ì í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸:", decodedTarget);
          sessionStorage.removeItem('joinRedirect'); // ì‚¬ìš© í›„ ì œê±°
          return decodedTarget;
        }
        
        if (!decodedTarget.startsWith("/")) {
          console.log("[íšŒì›ê°€ì…] ì˜ëª»ëœ ê²½ë¡œ, index.htmlë¡œ ì´ë™");
          sessionStorage.removeItem('joinRedirect');
          return "index.html";
        }
        if (decodedTarget === "/join.html") {
          console.log("[íšŒì›ê°€ì…] join.html ìì²´, index.htmlë¡œ ì´ë™");
          sessionStorage.removeItem('joinRedirect');
          return "index.html";
        }
        console.log("[íšŒì›ê°€ì…] ì¼ë°˜ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸:", decodedTarget);
        sessionStorage.removeItem('joinRedirect'); // ì‚¬ìš© í›„ ì œê±°
        return decodedTarget;
      }

      // ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš° ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (Supabase ì„¸ì…˜ ê¸°ë°˜)
      (async function checkAlreadyLoggedIn() {
        // Supabase ì´ˆê¸°í™” ëŒ€ê¸°
        while (!window.authState?.supabase) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        try {
          const { data: { session } } = await window.authState.supabase.auth.getSession();
          if (session) {
            window.location.replace(resolveRedirectTarget());
          }
        } catch (error) {
          console.error("ì„¸ì…˜ í™•ì¸ ì˜¤ë¥˜:", error);
        }
      })();

      // Supabase ê°ì²´ ì°¸ì¡° (ì„œë²„ì—ì„œ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¨ auth-state.jsì—ì„œ ì´ˆê¸°í™”)
      let supabase = null;
      (async function initSupabase() {
        while (!window.authState?.supabase) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        supabase = window.authState.supabase;
      })();

      function setLoggedInFromSession(session) {
        if (!session) return;
        const user = session.user || {};
        const userData = {
          id: user.id || "",
          email: user.email || "",
          displayName: user.user_metadata?.full_name || user.user_metadata?.name || "",
          photoURL: user.user_metadata?.avatar_url || "",
          provider: (user.app_metadata?.provider || "kakao"),
          loginTime: new Date().toISOString(),
        };
        localStorage.setItem("userData", JSON.stringify(userData));
        localStorage.setItem("isLoggedIn", "true");
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ Supabase ì„¸ì…˜ í™•ì¸ ë° ìƒíƒœ ë³€í™” ê°ì§€
      (async () => {
        while (!window.authState?.supabase) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        const supabaseClient = window.authState.supabase;
        
        // URL í•´ì‹œë‚˜ ì¿¼ë¦¬ì— OAuth ê´€ë ¨ íŒŒë¼ë¯¸í„° í™•ì¸
        const hasOAuthParams = window.location.hash.includes('access_token') || 
                               window.location.search.includes('code=');
        
        console.log('[íšŒì›ê°€ì…] OAuth íŒŒë¼ë¯¸í„° í™•ì¸:', hasOAuthParams);
        console.log('[íšŒì›ê°€ì…] íšŒì›ê°€ì… í”Œë˜ê·¸:', sessionStorage.getItem('isSignupFlow'));
        
        // OAuth ì½œë°±ì¸ ê²½ìš° onAuthStateChangeì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ìŠ¤í‚µ
        if (hasOAuthParams) {
          console.log('[íšŒì›ê°€ì…] OAuth ì½œë°± ê°ì§€ - onAuthStateChangeì—ì„œ ì²˜ë¦¬');
          // íšŒì›ê°€ì… í”Œë˜ê·¸ê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ìœ ì§€ (onAuthStateChangeì—ì„œ ì‚¬ìš©)
          return;
        }
        
        // íšŒì›ê°€ì… í˜ì´ì§€ì— ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœë¡œ ì ‘ê·¼í•œ ê²½ìš°
        // (íšŒì›ê°€ì…ì´ ì•„ë‹Œ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ íšŒì›ê°€ì… í˜ì´ì§€ì— ì ‘ê·¼)
        if (!hasOAuthParams) {
          try {
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (session) {
              console.log('[íšŒì›ê°€ì…] ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœ - í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸');
              
              // íšŒì›ê°€ì… í˜ì´ì§€ê°€ ì•„ë‹Œ ë©”ì¸ í˜ì´ì§€ë¡œ ì•ˆë‚´
              // (ì´ë¯¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ íšŒì›ê°€ì… í˜ì´ì§€ì— ì ‘ê·¼í•˜ëŠ” ê²½ìš°)
              const currentPath = window.location.pathname;
              if (currentPath.includes('join.html')) {
                // ë¡œê·¸ì¸ ë§í¬ë¡œ ì•ˆë‚´í•˜ê±°ë‚˜ ë©”ì¸ìœ¼ë¡œ ì´ë™
                window.location.replace(resolveRedirectTarget() || "index.html");
              }
            }
          } catch (error) {
            console.error("ì„¸ì…˜ í™•ì¸ ì˜¤ë¥˜:", error);
          }
        }
        
        // ë¡œê·¸ì¸ ìƒíƒœ ë³€í™” ê°ì§€
        supabaseClient.auth.onAuthStateChange(async (event, session) => {
          if (event === "SIGNED_IN") {
            console.log('[íšŒì›ê°€ì…] SIGNED_IN ì´ë²¤íŠ¸ ë°œìƒ');
            
            // íšŒì›ê°€ì… í”Œë˜ê·¸ í™•ì¸ (íšŒì›ê°€ì… í˜ì´ì§€ì—ì„œ ì„¤ì •ë¨)
            const isSignupFlow = sessionStorage.getItem('isSignupFlow') === 'true';
            console.log('[íšŒì›ê°€ì…] íšŒì›ê°€ì… í”Œë˜ê·¸:', isSignupFlow);
            
            setLoggedInFromSession(session);
            
            // íšŒì›ê°€ì… í”Œë¡œìš°ì¸ ê²½ìš° ë¬´ì¡°ê±´ í”„ë¡œí•„ ì„¤ì •ìœ¼ë¡œ ì´ë™
            if (isSignupFlow) {
              console.log('[íšŒì›ê°€ì…] íšŒì›ê°€ì… í”Œë¡œìš° - í”„ë¡œí•„ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™');
              sessionStorage.removeItem('isSignupFlow'); // í”Œë˜ê·¸ ì œê±°
              
              // redirect ì •ë³´ë¥¼ í”„ë¡œí•„ ì„¤ì • í˜ì´ì§€ë¡œ ì „ë‹¬
              const redirectInfo = redirectTarget || sessionStorage.getItem('joinRedirect');
              if (redirectInfo) {
                sessionStorage.setItem('signupRedirect', redirectInfo);
                sessionStorage.removeItem('joinRedirect');
              }
              
              window.location.replace("setup-profile.html");
              return;
            }
            
            // ê¸°ì¡´ ë¡œê·¸ì¸ í”Œë¡œìš°ì¸ ê²½ìš° í”„ë¡œí•„ í™•ì¸
            try {
              const { data: profile, error } = await supabaseClient
                .from('profiles')
                .select('name')
                .eq('id', session.user.id)
                .single();
              
              console.log('[íšŒì›ê°€ì…] í”„ë¡œí•„ í™•ì¸:', { profile, error });
              
              // í”„ë¡œí•„ì´ ì—†ê±°ë‚˜ ì´ë¦„ì´ ì—†ìœ¼ë©´ ì •ë³´ ì…ë ¥ í˜ì´ì§€ë¡œ ì´ë™
              if (error || !profile || !profile.name) {
                console.log('[íšŒì›ê°€ì…] í”„ë¡œí•„ ì—†ìŒ - í”„ë¡œí•„ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™');
                window.location.replace("setup-profile.html");
              } else {
                console.log('[íšŒì›ê°€ì…] í”„ë¡œí•„ ìˆìŒ - ë¦¬ë‹¤ì´ë ‰íŠ¸ ëŒ€ìƒìœ¼ë¡œ ì´ë™');
                window.location.replace(resolveRedirectTarget());
              }
            } catch (error) {
              console.error("í”„ë¡œí•„ í™•ì¸ ì˜¤ë¥˜:", error);
              // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ì •ë³´ ì…ë ¥ í˜ì´ì§€ë¡œ ì´ë™ (ì•ˆì „)
              window.location.replace("setup-profile.html");
            }
          }
        });
      })();

      // DOM elements
      const kakaoSignupBtn = document.getElementById("kakaoSignup");
      const errorMessage = document.getElementById("errorMessage");
      const successMessage = document.getElementById("successMessage");

      // Show error message
      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = "block";
        successMessage.style.display = "none";
      }

      // Show success message
      function showSuccess(message) {
        successMessage.textContent = message;
        successMessage.style.display = "block";
        errorMessage.style.display = "none";
      }

      // Hide messages
      function hideMessages() {
        errorMessage.style.display = "none";
        successMessage.style.display = "none";
      }

      // ì „ì—­ í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì„œ inline onclickì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ (ì¦‰ì‹œ ì •ì˜)
      window.handleKakaoSignupClick = async function(event) {
        console.log('[íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­] ì‹œì‘');
        if (event) {
          event.preventDefault();
          event.stopPropagation();
        }
        
        try {
          hideMessages();
          
          // Supabase ê°ì²´ ëŒ€ê¸° (window.authState.supabase ì§ì ‘ ì‚¬ìš©)
          let supabaseClient = null;
          let retryCount = 0;
          const maxRetries = 50; // ìµœëŒ€ 5ì´ˆ ëŒ€ê¸°
          
          while (!supabaseClient && retryCount < maxRetries) {
            if (window.authState?.supabase) {
              supabaseClient = window.authState.supabase;
              break;
            }
            await new Promise(resolve => setTimeout(resolve, 100));
            retryCount++;
          }
          
          if (!supabaseClient) {
            // fallback: supabase ë³€ìˆ˜ í™•ì¸
            if (supabase) {
              supabaseClient = supabase;
            } else {
              throw new Error('Supabase í´ë¼ì´ì–¸íŠ¸ë¥¼ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
          }
          
          console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] Supabase í´ë¼ì´ì–¸íŠ¸ ì¤€ë¹„ ì™„ë£Œ');
          
          // ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœì¸ì§€ í™•ì¸ (íšŒì›ê°€ì… í˜ì´ì§€ì—ì„œ ìƒˆ ê³„ì •ìœ¼ë¡œ ê°€ì…í•˜ë ¤ëŠ” ê²½ìš°)
          const { data: { session } } = await supabaseClient.auth.getSession();
          if (session) {
            console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœ - ë¡œê·¸ì•„ì›ƒ í›„ íšŒì›ê°€ì… ì§„í–‰');
            // ê¸°ì¡´ ì„¸ì…˜ ë¡œê·¸ì•„ì›ƒ (ìƒˆ ê³„ì •ìœ¼ë¡œ ê°€ì…í•˜ê¸° ìœ„í•´)
            await supabaseClient.auth.signOut();
            console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] ê¸°ì¡´ ì„¸ì…˜ ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
          }
          
          // íšŒì›ê°€ì… í”Œë˜ê·¸ ì„¤ì • (OAuth ì½œë°± í›„ í”„ë¡œí•„ ì„¤ì •ìœ¼ë¡œ ë³´ë‚´ê¸° ìœ„í•´)
          sessionStorage.setItem('isSignupFlow', 'true');
          console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] íšŒì›ê°€ì… í”Œë˜ê·¸ ì„¤ì •');
          
          // redirect íŒŒë¼ë¯¸í„°ë¥¼ sessionStorageì— ì €ì¥
          const currentRedirect = redirectTarget || sessionStorage.getItem('joinRedirect');
          if (currentRedirect) {
            sessionStorage.setItem('joinRedirect', currentRedirect);
            console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] redirect íŒŒë¼ë¯¸í„° ì €ì¥:', currentRedirect);
          }
          
          // redirect íŒŒë¼ë¯¸í„°ë¥¼ í¬í•¨í•œ ë¦¬ë‹¤ì´ë ‰íŠ¸ URL ìƒì„±
          let redirectUrl = window.location.origin + '/join.html';
          const savedRedirect = redirectTarget || sessionStorage.getItem('joinRedirect');
          if (savedRedirect) {
            redirectUrl += '?redirect=' + encodeURIComponent(savedRedirect);
            console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] redirect íŒŒë¼ë¯¸í„° í¬í•¨:', savedRedirect);
          } else {
            console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] redirect íŒŒë¼ë¯¸í„° ì—†ìŒ');
          }
          
          console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...');
          console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] ë¦¬ë‹¤ì´ë ‰íŠ¸ URL:', redirectUrl);
          
          // Supabase OAuthë¥¼ ì‚¬ìš©í•œ ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…
          console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] OAuth ìš”ì²­ ì‹œì‘...');
          const { data, error } = await supabaseClient.auth.signInWithOAuth({
            provider: 'kakao',
            options: {
              redirectTo: redirectUrl
            }
          });

          console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] OAuth ì‘ë‹µ:', { data, error });
          
          if (error) {
            showError('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + error.message);
            console.error('ì¹´ì¹´ì˜¤ íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
            return;
          }
          
          // ì„±ê³µ ì‹œ data.urlë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í˜ì´ì§€)
          if (data?.url) {
            console.log('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] âœ… ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™:', data.url);
            window.location.href = data.url;
          } else {
            showError('íšŒì›ê°€ì… URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            console.error('[ì¹´ì¹´ì˜¤ íšŒì›ê°€ì…] data.urlì´ ì—†ìŠµë‹ˆë‹¤. data:', data);
          }
        } catch (err) {
          showError('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
          console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', err);
        }
      };

      // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • (DOMContentLoadedë¡œ ì•ˆì „í•˜ê²Œ ì‹¤í–‰)
      function setupSignupButton() {
        const kakaoSignupBtn = document.getElementById("kakaoSignup");
        if (kakaoSignupBtn) {
          console.log('[íšŒì›ê°€ì… ë²„íŠ¼] ë²„íŠ¼ ì°¾ìŒ');
          
          // ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ ì´ë²¤íŠ¸ ë°”ì¸ë”© (ìº¡ì²˜ ë‹¨ê³„ í¬í•¨)
          kakaoSignupBtn.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('[íšŒì›ê°€ì… ë²„íŠ¼] í´ë¦­ë¨ (addEventListener)');
            window.handleKakaoSignupClick(e);
          }, true); // ìº¡ì²˜ ë‹¨ê³„ì—ì„œë„ ì²˜ë¦¬
          
          kakaoSignupBtn.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('[íšŒì›ê°€ì… ë²„íŠ¼] í´ë¦­ë¨ (addEventListener bubble)');
            window.handleKakaoSignupClick(e);
          }, false); // ë²„ë¸”ë§ ë‹¨ê³„ì—ì„œë„ ì²˜ë¦¬
          
          // ë²„íŠ¼ì´ í´ë¦­ ê°€ëŠ¥í•œì§€ í™•ì¸
          kakaoSignupBtn.style.pointerEvents = 'auto';
          kakaoSignupBtn.style.cursor = 'pointer';
          kakaoSignupBtn.disabled = false;
          kakaoSignupBtn.setAttribute('tabindex', '0');
        } else {
          console.error('[íšŒì›ê°€ì… ë²„íŠ¼] ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
        }
      }

      // DOMì´ ë¡œë“œëœ í›„ ë²„íŠ¼ ì„¤ì • (ì—¬ëŸ¬ ì‹œì ì—ì„œ ì‹œë„)
      function initSignupButton() {
        setupSignupButton();
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSignupButton);
      } else {
        // DOMì´ ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì¦‰ì‹œ ì‹¤í–‰
        setTimeout(initSignupButton, 0);
      }
      
      // window.onloadì—ì„œë„ í•œ ë²ˆ ë” ì‹œë„
      window.addEventListener('load', function() {
        setTimeout(setupSignupButton, 100);
      });

      // ë¡œê·¸ì¸ ë§í¬ì— redirect íŒŒë¼ë¯¸í„° ì¶”ê°€
      const loginLink = document.getElementById("loginLink");
      if (loginLink && redirectTarget) {
        loginLink.href = `login.html?redirect=${encodeURIComponent(redirectTarget)}`;
      }
    </script>

    <!-- ì¶”ì  ë° ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/assets/analytics.js"></script>
    <script src="/assets/error-logger.js"></script>
    <script src="/assets/performance-tracker.js"></script>

    <!-- í‘¸í„° -->
    <footer class="site-footer">
      <div class="footer-content">
        <div class="footer-item">
          <div class="footer-label">ìƒí˜¸ëª…</div>
          <div class="footer-value">ì‚¬ì¥í”½</div>
        </div>
        <div class="footer-item">
          <div class="footer-label">ëŒ€í‘œìëª…</div>
          <div class="footer-value">ì˜¤ëŒ€ì¤€</div>
        </div>
        <div class="footer-item">
          <div class="footer-label">ì‚¬ì—…ì¥ ì£¼ì†Œì§€</div>
          <div class="footer-value">ë¶€ì‚°ê´‘ì—­ì‹œ ë¶êµ¬ ë°±ì–‘ëŒ€ë¡œ 1003 5ë™307í˜¸</div>
        </div>
        <div class="footer-item">
          <div class="footer-label">ì‚¬ì—…ì ë²ˆí˜¸</div>
          <div class="footer-value">441-31-01878</div>
        </div>
        <div class="footer-item">
          <div class="footer-label">ì´ë©”ì¼ ì£¼ì†Œ</div>
          <div class="footer-value">
            <a href="mailto:ohdaejun@naver.com">ohdaejun@naver.com</a>
          </div>
        </div>
        <div class="footer-item">
          <div class="footer-label">ì „í™”ë²ˆí˜¸</div>
          <div class="footer-value">
            <a href="tel:010-6664-3744">010-6664-3744</a>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
