<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://*.supabase.co https://naver-keyword-tool.onrender.com wss://*.supabase.co; img-src 'self' data: https:; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; font-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com data:; frame-ancestors 'self'; base-uri 'self'; form-action 'self'" />
  <meta name="referrer" content="no-referrer" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <title>AI ë¦¬ë·° ê´€ë¦¬ - ì‚¬ì¥í”½</title>
  <link
    rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%2303c75a'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-size='28' font-family='Arial' fill='white'%3ESP%3C/text%3E%3C/svg%3E"
  />
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    rel="stylesheet"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous"
  />
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
  <style>
      :root {
        --accent-color: #ff7b54;
        --bg-color: #fff7f0;
        --text-primary: #201a17;
        --text-secondary: #7a6a60;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
        background: var(--bg-color);
        color: var(--text-primary);
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      .is-hidden {
        display: none !important;
      }

      @media (max-width: 992px) {
        .header {
          display: none;
        }
      }

      .header.header-hidden {
        transform: translateY(-100%);
      }

      .header-inner {
        max-width: 100%;
        margin: 0;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        position: relative;
      }

      .logo-container {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 800;
        font-size: 12px;
        color: var(--text-primary);
        cursor: pointer;
        flex: 0 0 auto;
      }

      .logo-icon {
        width: 28px;
        height: 28px;
        border-radius: 12px;
        background: var(--accent-color);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
      }

      .logo-text {
        letter-spacing: -0.03em;
        text-transform: lowercase;
        font-size: 12px;
      }

      .header-slogan {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-secondary);
        margin: 0;
        white-space: nowrap;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1;
      }

      .header-auth {
        display: flex;
        align-items: center;
        flex: 0 0 auto;
      }

      @media (max-width: 768px) {
        .header-inner {
          padding: 12px 16px;
          flex-wrap: wrap;
        }
        
        .header-slogan {
          font-size: 12px;
          position: static;
          transform: none;
          order: 3;
          width: 100%;
          text-align: center;
          margin-top: 8px;
        }
        
        .logo-container {
          order: 1;
          gap: 8px;
        }
        
        .header-auth {
          order: 2;
        }

        .logo-icon {
          width: 26px;
          height: 26px;
          font-size: 13px;
        }

        .logo-text {
          font-size: 12px;
        }
      }

      @media (max-width: 480px) {
        .header-inner {
          padding: 10px 12px;
          gap: 12px;
        }
        
        .header-slogan {
          display: none;
        }

        .logo-container {
          gap: 6px;
        }
      }

      @media (max-width: 360px) {
        .header-inner {
          padding: 8px 6px 8px 8px;
          gap: 0;
          min-height: auto;
          flex-wrap: nowrap;
          justify-content: space-between;
          align-items: center;
        }

        .logo-container {
          gap: 4px;
          flex: 0 1 auto;
          min-width: 0;
          margin-right: auto;
        }

        .logo-icon {
          width: 19px;
          height: 19px;
          font-size: 10px;
          flex-shrink: 0;
        }

        .logo-text {
          font-size: 11px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          max-width: 120px;
        }

        .header-slogan {
          display: none;
        }

        .header-auth {
          flex-shrink: 0;
          margin-left: auto;
          margin-right: 0;
        }

        .auth-buttons {
          gap: 2px;
          flex-wrap: nowrap;
          justify-content: flex-end;
        }

        .auth-btn {
          height: 28px;
          padding: 0 6px;
          font-size: 9px;
          min-width: auto;
          flex-shrink: 0;
        }

        .auth-btn i {
          font-size: 9px;
          margin-right: 2px;
        }

        .auth-btn span {
          font-size: 9px;
          white-space: nowrap;
        }

        .auth-btn--ghost {
          display: none;
        }
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .header-menu-btn {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        border: none;
        background: rgba(255, 126, 70, 0.15);
        color: var(--accent-color);
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.2s ease, background 0.2s ease;
      }

      .header-menu-btn:hover {
        transform: translateY(-2px);
        background: rgba(255, 126, 70, 0.25);
      }

      .logo-container {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 800;
        font-size: 12px;
        color: var(--text-primary);
        cursor: pointer;
      }

      .logo-icon {
        width: 28px;
        height: 28px;
        border-radius: 12px;
        background: var(--accent-color);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
      }

      .logo-text {
        letter-spacing: -0.03em;
        text-transform: lowercase;
        font-size: 12px;
      }

      @media (max-width: 768px) {
        .logo-icon {
          width: 26px;
          height: 26px;
          font-size: 13px;
        }

        .logo-text {
          font-size: 12px;
        }
      }

      /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ - ìƒˆë¡œìš´ ë””ìì¸ */
      .side-nav {
        background: #ffe8d9;
        border-radius: 18px;
        padding: 18px 11px;
        display: flex;
        flex-direction: column;
        gap: 14px;
        align-items: center;
        position: fixed;
        left: 20px;
        top: 120px;
        width: 66px;
        height: auto;
        max-height: calc(100vh - 160px);
        overflow-y: auto;
        z-index: 40;
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
      }

      .side-nav .menu-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 3px;
        padding: 9px 6px;
        color: #5a5a5a;
        text-decoration: none;
        font-weight: 500;
        font-size: 9px;
        border-radius: 11px;
        transition: all 0.3s ease;
        width: 43px;
        position: relative;
        background: transparent;
      }
      
      .side-nav .menu-item:hover {
        background: #ffffff;
        color: #ff7e46;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 126, 70, 0.3);
      }
      
      .side-nav .menu-item:hover .ico {
        color: #ff7e46;
        background: rgba(255, 126, 70, 0.1);
      }

      .side-nav .menu-item.active {
        background: #ffffff;
        color: #ff7e46;
      }

      .side-nav .menu-item.active .ico {
        color: #ff7e46;
        background: rgba(255, 126, 70, 0.1);
      }

      .side-nav .ico {
        width: 29px;
        height: 29px;
        border-radius: 7px;
        display: grid;
        place-items: center;
        background: transparent;
        color: #5a5a5a;
        font-size: 13px;
        transition: all 0.3s ease;
      }

      /* ê¸°ì¡´ ì‚¬ì´ë“œë°” ìˆ¨ê¹€ */
      .sidebar {
        display: none;
      }

      .sidebar-header {
        padding: 20px 16px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      }

      .sidebar-logo {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .sidebar-logo-icon {
        width: 36px;
        height: 36px;
        background: var(--accent-color);
        color: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .sidebar-logo-text {
        font-size: 18px;
        font-weight: 800;
        color: var(--text-primary);
      }

      .sidebar-menu {
        padding: 16px 0;
      }

      .sidebar-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 20px;
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
      }

      .sidebar-item:hover {
        background: rgba(255, 126, 70, 0.1);
        color: var(--accent-color);
        border-left-color: var(--accent-color);
      }

      .sidebar-item.active {
        background: rgba(255, 126, 70, 0.15);
        color: var(--accent-color);
        border-left-color: var(--accent-color);
        font-weight: 700;
      }

      .sidebar-item i {
        font-size: 16px;
        width: 20px;
        text-align: center;
      }

      /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
      .main-content {
        margin-left: 0;
        padding-left: 100px;
        min-height: 100vh;
      }

      @media (max-width: 768px) {
        .container {
          padding: 16px 12px;
        }
      }

      @media (max-width: 360px) {
        .container {
          padding: 16px 12px;
        }
      }

      @media (max-width: 992px) {
        .side-nav {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          top: auto;
          flex-direction: row;
          width: auto;
          max-width: calc(100vw - 40px);
          padding: 12px 16px;
          overflow-x: hidden;
          overflow-y: hidden;
          gap: 8px;
          border-radius: 24px;
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
          z-index: 100;
          justify-content: space-between;
        }

        .side-nav .menu-item {
          flex-direction: column;
          min-width: 0;
          padding: 8px 6px;
          font-size: 8px;
          flex: 1 1 auto;
        }

        .side-nav .menu-item .ico {
          width: 32px;
          height: 32px;
          font-size: 14px;
        }

        .side-nav .menu-item.active {
          background: #ffffff;
          color: #ff7e46;
        }

        .side-nav .menu-item.active .ico {
          color: #ff7e46;
          background: rgba(255, 126, 70, 0.1);
        }

        .main-content {
          padding-left: 0;
          padding-bottom: 90px;
        }
      }

      @media (max-width: 360px) {
        .side-nav {
          bottom: 12px;
          max-width: calc(100vw - 16px);
          padding: 8px 4px;
          gap: 2px;
          border-radius: 18px;
          overflow-x: hidden;
          justify-content: space-between;
        }

        .side-nav .menu-item {
          min-width: 0;
          padding: 4px 1px;
          font-size: 6px;
          flex: 1 1 calc((100% - 12px) / 7);
          max-width: calc((100% - 12px) / 7);
          gap: 2px;
        }

        .side-nav .menu-item .ico {
          width: 22px;
          height: 22px;
          font-size: 10px;
        }

        .side-nav .menu-item span:not(.ico) {
          font-size: 6px;
          word-break: keep-all;
          line-height: 1.2;
          text-align: center;
        }

        .side-nav .menu-item:hover .ico {
          background: #ffffff;
        }

        .side-nav .menu-item.active {
          background: #ffffff;
          color: #ff7e46;
        }

        .side-nav .menu-item.active .ico {
          color: #ff7e46;
          background: rgba(255, 126, 70, 0.1);
        }

        .main-content {
          padding-bottom: 70px;
        }
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .header-auth {
        display: flex;
        align-items: center;
      }

      .auth-buttons {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .auth-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 44px;
        padding: 0 22px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 14px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        background: #fff;
        color: var(--text-primary);
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease, border 0.2s ease;
      }

      .auth-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
      }

      .auth-btn--primary {
        background: transparent;
        color: var(--accent-color);
        border: 1px solid var(--accent-color);
      }

      .auth-btn--primary:hover {
        background: var(--accent-color);
        color: #fff;
        box-shadow: 0 8px 18px rgba(255, 126, 70, 0.3);
        transform: translateY(-1px);
      }

      .auth-btn--ghost {
        background: transparent;
        color: var(--text-secondary);
      }

      .auth-btn--ghost:hover {
        border-color: var(--accent-color);
        color: var(--accent-color);
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 32px;
        background: transparent;
      }

      @media (max-width: 768px) {
        .main-content {
          margin-left: 0;
        }

        .container {
          padding: 16px 12px;
        }

        .sidebar {
          display: none;
        }
      }

      @media (max-width: 360px) {
        .container {
          padding: 16px 12px;
        }
      }

      /* í˜ì´ì§€ í—¤ë” ì„¹ì…˜ - í†µì¼ëœ ìŠ¤íƒ€ì¼ */
      .header-section {
        background: #ffe8d9;
        border-radius: 20px 20px 0 0;
        padding: 8px 20px 8px 20px;
        margin-bottom: 0;
        min-height: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .page-header {
        margin-bottom: 0;
        text-align: center;
        width: 100%;
      }

      .page-header h1 {
        font-size: 12pt;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 2px;
        line-height: 1.2;
      }

      .page-header p {
        font-size: 8pt;
        color: var(--text-secondary);
        line-height: 1.3;
        margin: 0;
      }

      @media (max-width: 768px) {
        .header-section {
          padding: 8px 12px 8px 12px;
          border-radius: 16px 16px 0 0;
          min-height: 56px;
        }

        .page-header {
          margin-bottom: 0;
        }

        .page-header h1 {
          font-size: 12pt;
          margin-bottom: 2px;
          line-height: 1.2;
        }

        .page-header p {
          font-size: 8pt;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          line-height: 1.3;
        }
      }

      @media (max-width: 360px) {
        .header-section {
          padding: 8px 8px 8px 8px;
          border-radius: 12px 12px 0 0;
          min-height: 56px;
        }

        .page-header {
          margin-bottom: 0;
        }

        .page-header h1 {
          font-size: 12pt;
          margin-bottom: 2px;
          line-height: 1.2;
        }

        .page-header p {
          font-size: 8pt;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          line-height: 1.3;
        }
      }

      /* AI ë¦¬ë·° í¼ ìŠ¤íƒ€ì¼ */
      .review-container {
        background: white;
        border-radius: 0 0 20px 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        margin-bottom: 40px;
        margin-top: 0;
      }

      .review-content {
        padding: 36px;
      }

      @media (max-width: 768px) {
        .review-content {
          padding: 24px 16px;
        }
      }

      @media (max-width: 360px) {
        .review-content {
          padding: 20px 12px;
        }
      }

      .form-group {
        margin-bottom: 24px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-primary);
        font-weight: 600;
        font-size: 14px;
      }

      .form-group label i {
        margin-right: 8px;
        color: var(--accent-color);
      }

      .input-field,
      .form-group input[type="text"],
      .form-group textarea {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 14px;
        transition: all 0.3s ease;
        font-family: inherit;
        background: #fff;
      }

      .input-field:focus,
      .form-group input[type="text"]:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(255, 126, 70, 0.15);
      }

      .textarea-field {
        min-height: 120px;
        resize: vertical;
      }

      /* ë²„íŠ¼ ê·¸ë£¹ */
      .button-group {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 24px;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        border: 2px solid var(--accent-color);
        background: white;
        color: var(--accent-color);
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      .btn:hover {
        background: var(--accent-color);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 126, 70, 0.25);
      }

      .btn.btn-primary {
        background: var(--accent-color);
        color: white;
      }

      .btn.btn-primary:hover {
        background: #e66a42;
        box-shadow: 0 8px 20px rgba(255, 126, 70, 0.35);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn.loading {
        position: relative;
        color: transparent;
      }

      .btn.loading::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 16px;
        height: 16px;
        margin: -8px 0 0 -8px;
        border: 2px solid currentColor;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* ê²°ê³¼ ì˜ì—­ */
      .result-section {
        background: #f8fafc;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        min-height: 200px;
      }

      .result-section h3 {
        color: var(--text-primary);
        margin-bottom: 16px;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .result-content {
        background: white;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        white-space: pre-wrap;
        line-height: 1.6;
        color: var(--text-primary);
        font-size: 14px;
      }

      .result-content:empty::before {
        content: "ìƒì„±ëœ ë‹µê¸€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...";
        color: var(--text-secondary);
        font-style: italic;
      }

      /* í”Œë ˆì´ìŠ¤ ì •ë³´ ìƒíƒœ í´ë˜ìŠ¤ë“¤ */
      .place-info-status {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        border-radius: 8px;
        margin: 15px 0;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .place-info-status.hidden {
        display: none !important;
      }

      .place-info-status.loading {
        background: #fef3c7;
        border: 1px solid #f59e0b;
        color: #92400e;
      }

      .place-info-status.warning {
        background: #fef2f2;
        border: 1px solid #ef4444;
        color: #dc2626;
      }

      .result-content.error {
        background: #fef2f2;
        border-color: #ef4444;
        color: #dc2626;
      }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="/" class="logo-container">
        <div class="logo-icon">
          <i class="fa-solid fa-thumbtack"></i>
        </div>
        <span class="logo-text">sajang pick</span>
      </a>
      
      <h1 class="header-slogan">ì„¼ìŠ¤ìˆëŠ” ì‚¬ì¥ë‹˜ë“¤ì˜ ì„ íƒ</h1>
      
      <div class="header-auth">
        <div class="auth-buttons" id="authButtons">
          <div class="auth-user" id="authUser" style="display: none;">
            <div class="auth-user__avatar" id="userAvatar">U</div>
            <div class="auth-user__meta">
              <a href="/mypage.html" class="auth-user__label" style="cursor: pointer; text-decoration: none;">ë‚˜ì˜ í˜ì´ì§€</a>
              <a href="/mypage.html" class="auth-user__email" id="userEmail" style="cursor: pointer; text-decoration: none;"></a>
            </div>
            <button class="auth-user__logout" id="logoutBtn" type="button">
              ë¡œê·¸ì•„ì›ƒ
            </button>
          </div>
          <a href="/login.html" class="auth-btn auth-btn--primary" id="loginBtn">
            <i class="fa-solid fa-sign-in-alt" style="margin-right: 8px;"></i>
            <span>ë¡œê·¸ì¸</span>
          </a>
          <a href="/join.html" class="auth-btn auth-btn--ghost" id="signupBtn">
            <i class="fa-solid fa-user-plus" style="margin-right: 8px;"></i>
            <span>íšŒì›ê°€ì…</span>
          </a>
        </div>
      </div>
    </div>
  </header>

  <aside class="side-nav" aria-label="ì‚¬ì´ë“œ ë„¤ë¹„ê²Œì´ì…˜">
    <a class="menu-item" href="/">
      <span class="ico"><i class="fa-solid fa-house"></i></span>
      <span>í™ˆ</span>
    </a>
    <a class="menu-item" href="/naver_search.html">
      <span class="ico"><i class="fa-solid fa-key"></i></span>
      <span>í‚¤ì›Œë“œ</span>
    </a>
    <a class="menu-item active" href="/AI-Review.html">
      <span class="ico"><i class="fa-solid fa-pen-nib"></i></span>
      <span>ë¦¬ë·°</span>
    </a>
    <a class="menu-item" href="/Blog-Editor.html">
      <span class="ico"><i class="fa-solid fa-blog"></i></span>
      <span>ë¸”ë¡œê·¸</span>
    </a>
    <a class="menu-item" href="/recipe-manager.html">
      <span class="ico"><i class="fa-solid fa-utensils"></i></span>
      <span>ë ˆì‹œí”¼</span>
    </a>
    <a class="menu-item" href="/news-board.html">
      <span class="ico"><i class="fa-solid fa-newspaper"></i></span>
      <span>ì •ë³´</span>
    </a>
    <a class="menu-item" href="/policy-support.html">
      <span class="ico"><i class="fa-solid fa-coins"></i></span>
      <span>ì •ì±…</span>
    </a>
  </aside>

  <!-- ë©”ì¸ ì»¨í…ì¸  -->
  <div class="main-content">

    <div class="container">
      <!-- í—¤ë” ì„¹ì…˜ -->
      <div class="header-section">
        <div class="page-header">
          <h1>AI ë¦¬ë·° ê´€ë¦¬</h1>
          <p>AIë¥¼ í™œìš©í•˜ì—¬ ê³ ê° ë¦¬ë·°ì— ëŒ€í•œ ìŠ¤ë§ˆíŠ¸í•œ ë‹µê¸€ì„ ìƒì„±í•´ë³´ì„¸ìš”.</p>
        </div>
      </div>

      <div class="review-container">
        <div class="review-content">
          <div class="form-group">
            <label for="reviewText">
              <i class="fas fa-comment"></i>
              ê³ ê° ë¦¬ë·° ë‚´ìš©
            </label>
            <textarea 
              id="reviewText" 
              class="textarea-field" 
              placeholder="ê³ ê°ì´ ì‘ì„±í•œ ë¦¬ë·° ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
            ></textarea>
          </div>

          <div class="form-group">
            <label for="placeUrl">
              <i class="fas fa-link"></i>
              ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ URL (ì„ íƒì‚¬í•­)
            </label>
            <input 
              type="text" 
              id="placeUrl" 
              class="input-field"
              placeholder="https://place.map.naver.com/restaurant/..."
            />
          </div>

          <!-- ê°€ê²Œ ì •ë³´ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ì•ˆë‚´ -->
          <div style="background: var(--accent-color); border-radius: 10px; padding: 15px; margin-bottom: 20px; color: white;">
            <p style="margin: 0; font-size: 14px; margin-bottom: 10px;">
              ğŸ’¡ <strong>ì•Œë¦¼:</strong> ê°€ê²Œ ì •ë³´ë¥¼ í•œë²ˆ ì €ì¥í•˜ë©´ ë‹¤ìŒë¶€í„° ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì§‘ë‹ˆë‹¤!
            </p>
            <div style="display: flex; gap: 10px;">
              <button type="button" id="loadStoreInfoBtn" class="btn" style="flex: 1; background: white; color: var(--accent-color); border: 2px solid white; font-size: 12px;">
                ğŸ“¥ ì €ì¥ëœ ì •ë³´<br>ë¶ˆëŸ¬ì˜¤ê¸°
              </button>
              <button type="button" id="saveStoreInfoBtn" class="btn" style="flex: 1; background: transparent; color: white; border: 2px solid white; font-size: 12px;">
                ğŸ“Œ ê°€ê²Œ ì •ë³´<br>ì €ì¥í•˜ê¸°
              </button>
            </div>
          </div>

          <div class="form-group">
            <label for="ownerTips">
              <i class="fas fa-lightbulb"></i>
              ì‚¬ì¥ë‹˜ ì¶”ì²œ í¬ì¸íŠ¸ (ì„ íƒì‚¬í•­)
            </label>
            <textarea 
              id="ownerTips" 
              class="textarea-field" 
              placeholder="ê°•ì¡°í•˜ê³  ì‹¶ì€ ë©”ë‰´, ë¶„ìœ„ê¸°, íŠ¹ì§• ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.&#10;&#10;ì˜ˆì‹œ:&#10;- ì‹œê·¸ë‹ˆì²˜ ë©”ë‰´: ëƒ‰ë©´, ê°ˆë¹„íƒ•&#10;- ë¶„ìœ„ê¸°: ê°€ì¡± ëª¨ì„ì— ì¢‹ì€ ë„“ì€ í™€&#10;- íŠ¹ì§•: ì§ì ‘ ë§Œë“  ìœ¡ìˆ˜, ì£¼ì°¨ ê°€ëŠ¥&#10;- ì¶”ì²œ: ê³ ê¸°ì™€ ëƒ‰ë©´ì˜ ì¡°í•©ì´ ì¼í’ˆ"
            ></textarea>
            <button type="button" id="aiPromoBtn" class="btn" style="margin-top: 10px; background: var(--accent-color); color: white; border: 2px solid var(--accent-color);">

               AI í™ë³´ í¬ì¸íŠ¸ ìë™ ì¶”ì²œ
            </button>
            <small style="color: var(--text-secondary); display: block; margin-top: 8px;">

              <strong>ğŸ’¡ Tip:</strong> AIê°€ ë¦¬ë·°ë¥¼ ë¶„ì„í•´ì„œ ë‹µê¸€ì— ì¶”ê°€í•˜ë©´ ì¢‹ì„ í™ë³´ í¬ì¸íŠ¸ë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤!
            </small>

            <!-- AI ì¶”ì²œ í™ë³´ í¬ì¸íŠ¸ ì˜ì—­ -->
            <div id="aiPromoArea" style="display: none; margin-top: 15px;">
              <div style="background: white; border: 2px solid var(--accent-color); border-radius: 10px; padding: 15px;">
                <p style="margin: 0 0 10px 0; color: var(--accent-color); font-weight: 600;">
                  ğŸ¯ AI ì¶”ì²œ í™ë³´ í¬ì¸íŠ¸ (í´ë¦­í•´ì„œ ì„ íƒ/í•´ì œ)
                </p>
                <div id="aiPromoTags" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
              </div>
            </div>
          </div>

          <!-- ë‹µê¸€ ìŠ¤íƒ€ì¼ ì„ íƒ ì•ˆë‚´ -->
          <div style="background: white; border: 2px solid var(--accent-color); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
            <p style="margin: 0 0 10px 0; color: var(--accent-color); font-weight: 600;">
              <i class="fas fa-palette"></i> ë‹µê¸€ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•˜ì„¸ìš” (ì ì¬ ê³ ê°ì—ê²Œ ë³´ì´ëŠ” í™ë³´ íš¨ê³¼ë¥¼ ê³ ë ¤)
            </p>
            <p style="margin: 0; color: var(--accent-color); font-size: 14px; opacity: 0.8;">
              ğŸ’¡ ë¦¬ë·° ë‹µê¸€ì€ ì²˜ìŒ ë°©ë¬¸ì„ ê³ ë ¤í•˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ì½ìŠµë‹ˆë‹¤!
            </p>
          </div>

          <div class="button-group" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <button class="btn btn-primary" id="replyPromoBtn">

               í™ë³´í˜• (ì¶”ì²œ)
            </button>
            <button class="btn" id="replyProfessionalBtn">

               ì „ë¬¸ê°€í˜•
            </button>
            <button class="btn" id="replyFriendlyBtn">

               ì¹œê·¼í˜•
            </button>
          </div>

          <div style="background: white; border: 2px solid var(--accent-color); border-radius: 8px; padding: 12px; margin-top: 15px; margin-bottom: 30px;">
            <p style="margin: 0; color: var(--accent-color); font-size: 13px; line-height: 1.6;">
              <strong> í™ë³´í˜•:</strong> ë‹¤ë¥¸ ë©”ë‰´, ì£¼ì°¨, ì˜ˆì•½ ë“± ì¶”ê°€ ì •ë³´ë¥¼ ì ê·¹ ì–¸ê¸‰ (ë°©ë¬¸ ìœ ë„ ìµœëŒ€í™”)<br>
              <strong> ì „ë¬¸ê°€í˜•:</strong> ì¬ë£Œ, ì¡°ë¦¬ë²• ì„¤ëª…ìœ¼ë¡œ ì „ë¬¸ì„±ê³¼ ì‹ ë¢°ê° ê°•ì¡°<br>
              <strong> ì¹œê·¼í˜•:</strong> ë”°ëœ»í•˜ê³  ë¶€ë“œëŸ¬ìš´ í†¤ìœ¼ë¡œ ë‹¨ê³¨ ê³ ê° ë§Œë“¤ê¸°
            </p>
          </div>

          <!-- ì‹ë‹¹ ì •ë³´ ìƒíƒœ í‘œì‹œ ì˜ì—­ -->
          <div id="placeInfoStatus" class="place-info-status hidden" style="display: none; background: #f0fdf4; border: 1px solid #22c55e; border-radius: 8px; padding: 12px; margin: 15px 0; color: #15803d;">
            <i class="fas fa-check-circle"></i>
            <span id="placeInfoText">ì‹ë‹¹ ì •ë³´ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>
          </div>

          <div class="result-section">
            <h3>
              <i class="fas fa-comment-dots"></i>
              ìƒì„±ëœ ë‹µê¸€
            </h3>
            <div id="reviewOutput" class="result-content"></div>
          </div>

          <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; margin-top: 24px;">
            <h4 style="color: var(--text-primary); margin-bottom: 12px;">
              <i class="fas fa-info-circle"></i>
              ê¸°ëŠ¥ ì•ˆë‚´
            </h4>
            <ul style="color: var(--text-secondary); font-size: 14px; line-height: 1.6; padding-left: 24px; list-style-position: outside;">
              <li style="margin-bottom: 8px;">
                <strong>ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ URL (ì„ íƒ):</strong> ì‹ë‹¹ì˜ í”Œë ˆì´ìŠ¤ URLì„ ì…ë ¥í•˜ë©´, 
                ì‹ë‹¹ ì´ë¦„, ì—…ì¢…, ìœ„ì¹˜, ë©”ë‰´ ë“±ì„ ìë™ìœ¼ë¡œ íŒŒì•…í•˜ì—¬ ë”ìš± ë§ì¶¤í™”ëœ ë‹µê¸€ì„ ìƒì„±í•©ë‹ˆë‹¤.
              </li>
              <li style="margin-bottom: 8px;">
                <strong> ì‚¬ì¥ë‹˜ ì¶”ì²œ í¬ì¸íŠ¸ (ì„ íƒ):</strong> ê°•ì¡°í•˜ê³  ì‹¶ì€ ë©”ë‰´, ë¶„ìœ„ê¸°, íŠ¹ì§•ì„ ì§ì ‘ ì…ë ¥í•˜ë©´
                AIê°€ ì´ë¥¼ ìš°ì„  ë°˜ì˜í•˜ì—¬ ë‹µê¸€ì„ ì‘ì„±í•©ë‹ˆë‹¤. í¬ë¡¤ë§ ì •ë³´ë³´ë‹¤ ì‚¬ì¥ë‹˜ì˜ ì˜ê²¬ì´ ìš°ì„ ë©ë‹ˆë‹¤!
              </li>
              <li style="margin-bottom: 8px;">
                <strong> ë‹µê¸€ ìƒì„±í•˜ê¸°:</strong> ì‹ë‹¹ ì •ë³´ì™€ ì‚¬ì¥ë‹˜ ì¶”ì²œ ì •ë³´ë¥¼ ë°˜ì˜í•˜ì—¬ ì „ë¬¸ì ì´ê³ 
                ê³µì†í•œ ë‹µê¸€ì„ ìë™ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤. ìƒˆë¡œìš´ ê³ ê°ë“¤ì´ ë³´ëŠ” ë‹µê¸€ì´ë¯€ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ í™ë³´ íš¨ê³¼ë„ ìˆìŠµë‹ˆë‹¤!
              </li>
              <li style="margin-bottom: 8px;">
                 <strong>Tip:</strong> ë¦¬ë·°ì—ì„œ ê³ ê°ì´ ê¶ê¸ˆí•´í•˜ëŠ” ë‹¤ë¥¸ ë©”ë‰´ê°€ ìˆë‹¤ë©´, 
                AIê°€ ì‹ë‹¹ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìë™ìœ¼ë¡œ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.
              </li>
              <li>ìƒì„±ëœ ë‹µê¸€ì€ ììœ ë¡­ê²Œ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- ê³µí†µ ì¸ì¦ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="/assets/auth-state.js?v=202410" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js" integrity="sha384-GFr3yTh5lJznCbZfpTtXnwboFsxqtTQoeTZCRHhE0579KrRmlCzen5AA8ohaB5ug" crossorigin="anonymous"></script>

  <script>
      // ë°±ì—”ë“œ ì„œë²„ ì„¤ì •: ìƒëŒ€ ê²½ë¡œ(`/api`) ì‚¬ìš©
      console.log("Using backend URL:", "/api");

      // DOM ìš”ì†Œ
      const placeUrl = document.getElementById("placeUrl");
      const ownerTips = document.getElementById("ownerTips");
      const reviewText = document.getElementById("reviewText");
      const replyPromoBtn = document.getElementById("replyPromoBtn");
      const replyProfessionalBtn = document.getElementById("replyProfessionalBtn");
      const replyFriendlyBtn = document.getElementById("replyFriendlyBtn");
      const reviewOutput = document.getElementById("reviewOutput");
      const placeInfoStatus = document.getElementById("placeInfoStatus");
      const placeInfoText = document.getElementById("placeInfoText");
      const loadStoreInfoBtn = document.getElementById("loadStoreInfoBtn");
      const saveStoreInfoBtn = document.getElementById("saveStoreInfoBtn");
      const aiPromoBtn = document.getElementById("aiPromoBtn");
      const aiPromoArea = document.getElementById("aiPromoArea");
      const aiPromoTags = document.getElementById("aiPromoTags");

      // í¬ë¡¤ë§ëœ ì‹ë‹¹ ì •ë³´ë¥¼ ì €ì¥í•  ë³€ìˆ˜
      let placeInfo = null;
      
      // ì„ íƒëœ í™ë³´ í¬ì¸íŠ¸ë¥¼ ì €ì¥í•  ë³€ìˆ˜
      let selectedPromoPoints = [];

      // í”„ë¡œëª¨ì…˜ ë°ì´í„° ì „ì—­ ë³€ìˆ˜
      let globalPromotionData = null;
      let globalHasPromotion = false;

      // ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
      function setLoading(el, isLoading, textWhenLoading = "ì²˜ë¦¬ ì¤‘...") {
        if (!el) return;
        el.dataset._originalText = el.dataset._originalText || el.textContent;
        el.disabled = !!isLoading;
        if (isLoading) {
          el.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${textWhenLoading}`;
        } else {
          el.textContent = el.dataset._originalText;
        }
      }

      // ì‹ë‹¹ ì •ë³´ ìƒíƒœ í‘œì‹œ í•¨ìˆ˜
      function showPlaceInfoStatus(message, status = "success") {
        // status: "loading", "success", "warning"
        placeInfoStatus.classList.remove("hidden", "loading", "warning");
        placeInfoStatus.style.display = "block";
        placeInfoText.textContent = message;
        
        const icon = placeInfoStatus.querySelector("i");
        
        if (status === "loading") {
          placeInfoStatus.classList.add("loading");
          placeInfoStatus.style.background = "#fef3c7";
          placeInfoStatus.style.borderColor = "#f59e0b";
          placeInfoStatus.style.color = "#92400e";
          icon.className = "fas fa-spinner fa-spin";
        } else if (status === "warning") {
          placeInfoStatus.classList.add("warning");
          placeInfoStatus.style.background = "#fef2f2";
          placeInfoStatus.style.borderColor = "#ef4444";
          placeInfoStatus.style.color = "#dc2626";
          icon.className = "fas fa-exclamation-triangle";
        } else {
          placeInfoStatus.style.background = "#f0fdf4";
          placeInfoStatus.style.borderColor = "#22c55e";
          placeInfoStatus.style.color = "#15803d";
          icon.className = "fas fa-check-circle";
        }
      }

      function hidePlaceInfoStatus() {
        placeInfoStatus.style.display = "none";
      }

      // URLì—ì„œ place_id ì¶”ì¶œ í•¨ìˆ˜
      function extractPlaceId(url) {
        // URL í˜•ì‹: https://m.place.naver.com/restaurant/1390003666
        //          https://pcmap.place.naver.com/restaurant/1390003666
        //          https://place.map.naver.com/restaurant/1390003666
        const match = url.match(/\/restaurant\/(\d+)/);
        if (match && match[1]) {
          return match[1];
        }
        
        // ìˆ«ìë§Œ ì…ë ¥í•œ ê²½ìš°
        if (/^\d+$/.test(url.trim())) {
          return url.trim();
        }
        
        return null;
      }

      // í”Œë ˆì´ìŠ¤ URL í¬ë¡¤ë§ í•¨ìˆ˜
      async function crawlPlaceUrl(url) {
        try {
          // URLì—ì„œ place_id ì¶”ì¶œ
          const placeId = extractPlaceId(url);
          
          if (!placeId) {
            throw new Error("ì˜¬ë°”ë¥¸ ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ URLì´ ì•„ë‹™ë‹ˆë‹¤. URLì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
          }

          // íƒ€ì„ì•„ì›ƒ ì„¤ì • (15ì´ˆ)
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 15000);

          try {
            const res = await fetch(`/api/place-detail-crawl`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ place_id: placeId }),
              signal: controller.signal
            });

            clearTimeout(timeoutId);

            const data = await readJsonSafely(res);

            if (!res.ok || data.success === false) {
              throw new Error(data.error || "í¬ë¡¤ë§ ì‹¤íŒ¨");
            }

            return data.data || data;
          } catch (fetchError) {
            clearTimeout(timeoutId);
            if (fetchError.name === 'AbortError') {
              throw new Error("í¬ë¡¤ë§ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. URL ì—†ì´ ì§„í–‰í•©ë‹ˆë‹¤.");
            }
            throw fetchError;
          }
        } catch (e) {
          console.error("í¬ë¡¤ë§ ì˜¤ë¥˜:", e);
          throw e;
        }
      }

      async function readJsonSafely(res) {
        const contentType = res.headers.get("content-type") || "";
        if (contentType.includes("application/json")) {
          try {
            return await res.json();
          } catch (_) {
            return { error: "JSON íŒŒì‹± ì‹¤íŒ¨", status: res.status };
          }
        }
        try {
          const text = await res.text();
          return text
            ? { error: text, status: res.status }
            : { status: res.status };
        } catch (_) {
          return { error: "ì‘ë‹µ ë³¸ë¬¸ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", status: res.status };
        }
      }

      function showOutput(data) {
        reviewOutput.classList.remove("error");
        try {
          if (typeof data === "string") {
            reviewOutput.textContent = data.trim();
          } else {
            reviewOutput.textContent = JSON.stringify(data, null, 2);
          }
        } catch (e) {
          reviewOutput.textContent = String(data);
        }
      }

      function showError(err) {
        reviewOutput.classList.add("error");
        
        // ì—ëŸ¬ ìƒì„¸ ì •ë³´ë¥¼ ì½˜ì†”ì— ì¶œë ¥
        console.error("ìƒì„¸ ì—ëŸ¬ ì •ë³´:", err);
        
        let errorMessage = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        
        // ë‹¤ì–‘í•œ ì—ëŸ¬ í˜•ì‹ì—ì„œ ë©”ì‹œì§€ ì¶”ì¶œ
        if (err?.error) {
          errorMessage = err.error;
        } else if (err?.message) {
          errorMessage = err.message;
        } else if (err?.raw) {
          errorMessage = err.raw;
        } else if (err?.errorText) {
          errorMessage = err.errorText;
        } else if (typeof err === 'string') {
          errorMessage = err;
        }
        
        // TypeError: Failed to fetch ë“±ì˜ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì²˜ë¦¬
        if (errorMessage.includes("Failed to fetch") || errorMessage.includes("NetworkError")) {
          errorMessage = "ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
        }
        
        reviewOutput.textContent = errorMessage;
      }

      // ê°€ê²Œ ì •ë³´ ì €ì¥ ê¸°ëŠ¥
      async function saveStoreInfo() {
        try {
          const userData = JSON.parse(localStorage.getItem('userData') || '{}');
          // if (!userData.id) {
          //   alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
          //   return;
          // } // ë¡œê·¸ì¸ ì²´í¬ ë¹„í™œì„±í™”

          const storeInfo = {
            placeUrl: placeUrl.value.trim(),
            companyName: '', // review.htmlì—ëŠ” ì—…ì²´ëª… í•„ë“œê°€ ì—†ìœ¼ë¯€ë¡œ ë¹ˆ ê°’
            companyAddress: '',
            businessHours: '',
            phoneNumber: '',
            mainMenu: '',
            landmarks: '',
            keywords: ownerTips.value.trim() // ì‚¬ì¥ë‹˜ ì¶”ì²œ í¬ì¸íŠ¸ë¥¼ keywordsë¡œ ì €ì¥
          };

          const response = await fetch('/api/store-info', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId: userData.id, storeInfo })
          });

          if (!response.ok) {
            throw new Error('ì €ì¥ ì‹¤íŒ¨');
          }

          const result = await response.json();
          if (result.success) {
            alert('âœ… ê°€ê²Œ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
          } else {
            throw new Error(result.error || 'ì €ì¥ ì‹¤íŒ¨');
          }
        } catch (error) {
          console.error('ê°€ê²Œ ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', error);
          alert('âŒ ê°€ê²Œ ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n' + error.message);
        }
      }

      // ê°€ê²Œ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥
      async function loadStoreInfo() {
        try {
          const userData = JSON.parse(localStorage.getItem('userData') || '{}');
          // if (!userData.id) {
          //   alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
          //   return;
          // } // ë¡œê·¸ì¸ ì²´í¬ ë¹„í™œì„±í™”

          // í†µí•© ì •ë³´ API í˜¸ì¶œ
          const response = await fetch(`/api/store-info-all?userId=${userData.id}`);
          if (!response.ok) {
            throw new Error('ì¡°íšŒ ì‹¤íŒ¨');
          }

          const result = await response.json();
          if (result.success && result.data) {
            const data = result.data;
            
            // ê¸°ë³¸ ì •ë³´ê°€ ìˆìœ¼ë©´ ì„¤ì •
            if (data.basic) {
              if (data.basic.place_url) placeUrl.value = data.basic.place_url;
              if (data.basic.keywords) ownerTips.value = data.basic.keywords;
            }
            
            alert('âœ… ì €ì¥ëœ ê°€ê²Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
          } else {
            alert('ì €ì¥ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
          }
        } catch (error) {
          console.error('ê°€ê²Œ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
          alert('âŒ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n' + error.message);
        }
      }

      // AI í™ë³´ í¬ì¸íŠ¸ ì¶”ì²œ ê¸°ëŠ¥
      async function generateAIPromoPoints() {
        const reviewContent = reviewText.value.trim();
        const placeUrlContent = placeUrl.value.trim();
        
        if (!reviewContent) {
          alert('ë¨¼ì € ê³ ê° ë¦¬ë·°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        setLoading(aiPromoBtn, true, "AI ë¶„ì„ ì¤‘...");

        try {
          const requestBody = {
            reviewText: reviewContent
          };

          if (placeUrlContent) {
            requestBody.placeUrl = placeUrlContent;
          }

          const res = await fetch('/api/ai-news-recommend', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(requestBody)
          });

          const data = await readJsonSafely(res);

          if (!res.ok || data.success === false) {
            throw new Error(data.error || 'AI ì¶”ì²œ ì‹¤íŒ¨');
          }

          // ì¶”ì²œ í¬ì¸íŠ¸ í‘œì‹œ
          const recommendations = data.data?.recommendations || data.recommendations || [];
          
          if (recommendations.length > 0) {
            displayAIPromoPoints(recommendations);
            aiPromoArea.style.display = 'block';
          } else {
            alert('ì¶”ì²œí•  í™ë³´ í¬ì¸íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }

        } catch (error) {
          console.error('AI í™ë³´ í¬ì¸íŠ¸ ìƒì„± ì˜¤ë¥˜:', error);
          alert('âŒ AI ì¶”ì²œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n' + error.message);
        } finally {
          setLoading(aiPromoBtn, false);
        }
      }

      // AI ì¶”ì²œ í™ë³´ í¬ì¸íŠ¸ í‘œì‹œ
      function displayAIPromoPoints(points) {
        aiPromoTags.innerHTML = '';
        selectedPromoPoints = [];

        points.forEach((point, index) => {
          const tag = document.createElement('div');
          tag.style.cssText = `
            display: inline-block;
            padding: 8px 12px;
            margin: 4px;
            background: white;
            border: 2px solid var(--accent-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            color: var(--accent-color);
          `;
          tag.textContent = point;
          tag.dataset.index = index;

          tag.addEventListener('click', function() {
            const isSelected = selectedPromoPoints.includes(point);
            
            if (isSelected) {
              // ì„ íƒ í•´ì œ
              selectedPromoPoints = selectedPromoPoints.filter(p => p !== point);
              tag.style.background = 'white';
              tag.style.color = 'var(--accent-color)';
            } else {
              // ì„ íƒ
              selectedPromoPoints.push(point);
              tag.style.background = 'var(--accent-color)';
              tag.style.color = 'white';
            }
          });

          aiPromoTags.appendChild(tag);
        });
      }

      // ë‹µê¸€ ìƒì„± ê³µí†µ í•¨ìˆ˜ (ìŠ¤íƒ€ì¼ë³„)
      async function generateReply(style, buttonElement) {
        const text = reviewText.value.trim();
        const url = placeUrl.value.trim();
        const tips = ownerTips.value.trim();

        if (!text) {
          showError({ message: "ë¦¬ë·° ì›ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”." });
          return;
        }

        setLoading(buttonElement, true, "ìƒì„± ì¤‘...");
        reviewOutput.textContent = "";
        hidePlaceInfoStatus();

        try {
          // 1ë‹¨ê³„: URLì´ ìˆê³  ì•„ì§ í¬ë¡¤ë§ ì•ˆí–ˆìœ¼ë©´ ë¨¼ì € í¬ë¡¤ë§
          if (url && !placeInfo) {
            showPlaceInfoStatus("ğŸ” ì‹ë‹¹ ì •ë³´ ìˆ˜ì§‘ ì¤‘ (ì•½ 10~15ì´ˆ ì†Œìš”)", "loading");
            try {
              placeInfo = await crawlPlaceUrl(url);
              showPlaceInfoStatus("âœ… ì‹ë‹¹ ì •ë³´ ìˆ˜ì§‘ ì™„ë£Œ! ë‹µê¸€ ìƒì„± ì¤‘", "success");
            } catch (crawlError) {
              console.error("í¬ë¡¤ë§ ì‹¤íŒ¨:", crawlError);
              if (crawlError.message.includes("ì‹œê°„ì´ ì´ˆê³¼")) {
                showPlaceInfoStatus("â±ï¸ ì‹œê°„ ì´ˆê³¼! ì…ë ¥í•˜ì‹  ì •ë³´ë¡œ ë‹µê¸€ ìƒì„± ì¤‘", "warning");
              } else {
                showPlaceInfoStatus("âš ï¸ ì‹ë‹¹ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì…ë ¥í•˜ì‹  ì •ë³´ë¡œ ë‹µê¸€ ìƒì„± ì¤‘", "warning");
              }
              placeInfo = null;
            }
          } else if (!url && !placeInfo) {
            showPlaceInfoStatus("ğŸ’­ ë‹µê¸€ ìƒì„± ì¤‘", "loading");
          }

          // 2ë‹¨ê³„: ë‹µê¸€ ìƒì„± (ìŠ¤íƒ€ì¼ í¬í•¨)
          const requestBody = {
            reviewText: text,
            replyStyle: style // 'promo', 'professional', 'friendly'
          };

          if (placeInfo) {
            requestBody.placeInfo = placeInfo;
          }

          if (tips) {
            requestBody.ownerTips = tips;
          }

          // ì„ íƒëœ í™ë³´ í¬ì¸íŠ¸ê°€ ìˆìœ¼ë©´ í•¨ê»˜ ì „ë‹¬
          if (selectedPromoPoints.length > 0) {
            requestBody.selectedPromoPoints = selectedPromoPoints;
          }

          // í”„ë¡œëª¨ì…˜ ì •ë³´ ì¶”ê°€
          if (globalHasPromotion && globalPromotionData) {
            requestBody.promotionData = globalPromotionData;
            requestBody.hasPromotion = true;
          }

          const replyController = new AbortController();
          const replyTimeoutId = setTimeout(() => replyController.abort(), 15000);
          
          let res;
          try {
            res = await fetch(`/api/generate-reply`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(requestBody),
              signal: replyController.signal
            });
            clearTimeout(replyTimeoutId);
          } catch (fetchError) {
            clearTimeout(replyTimeoutId);
            
            if (fetchError.name === 'AbortError') {
              throw new Error("ë‹µê¸€ ìƒì„± ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
            
            throw new Error("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
          }

          const data = await readJsonSafely(res);

          if (!res.ok || data.success === false) {
            if (res.status === 405) {
              throw new Error("ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            } else if (res.status === 500) {
              throw new Error(data.error || "ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            } else if (res.status === 400) {
              throw new Error(data.error || "ì…ë ¥ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            } else {
              throw new Error(data.error || data.message || `ì„œë²„ ì˜¤ë¥˜ (${res.status})`);
            }
          }

          showOutput(data.data?.reply || data.reply || data);
          
          // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
          const styleNames = {
            'promo': 'í™ë³´í˜•',
            'professional': 'ì „ë¬¸ê°€í˜•',
            'friendly': 'ì¹œê·¼í˜•'
          };
          const styleName = styleNames[style] || style;
          
          let successMessage = `âœ… ${styleName} ë‹µê¸€ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`;
          if (selectedPromoPoints.length > 0) {
            successMessage += ` (í™ë³´ í¬ì¸íŠ¸ ${selectedPromoPoints.length}ê°œ ë°˜ì˜)`;
          }
          
          showPlaceInfoStatus(successMessage, "success");
          setTimeout(() => hidePlaceInfoStatus(), 5000);
          
        } catch (e) {
          console.error("ë‹µê¸€ ìƒì„± ì˜¤ë¥˜:", e);
          showError(e);
          hidePlaceInfoStatus();
        } finally {
          setLoading(buttonElement, false);
        }
      }

      // 3ê°œì˜ ë‹µê¸€ ìŠ¤íƒ€ì¼ ë²„íŠ¼ ì´ë²¤íŠ¸
      replyPromoBtn.addEventListener("click", async () => {
        await generateReply('promo', replyPromoBtn);
      });

      replyProfessionalBtn.addEventListener("click", async () => {
        await generateReply('professional', replyProfessionalBtn);
      });

      replyFriendlyBtn.addEventListener("click", async () => {
        await generateReply('friendly', replyFriendlyBtn);
      });

      // ê°€ê²Œ ì •ë³´ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
      saveStoreInfoBtn.addEventListener("click", saveStoreInfo);
      loadStoreInfoBtn.addEventListener("click", loadStoreInfo);

      // AI í™ë³´ í¬ì¸íŠ¸ ì¶”ì²œ ë²„íŠ¼ ì´ë²¤íŠ¸
      aiPromoBtn.addEventListener("click", generateAIPromoPoints);

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      window.addEventListener("load", function () {
        reviewText.focus();
        // ensureAuthenticated(); // ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ ì²´í¬ ë¹„í™œì„±í™”
      });

    </script>
  </div>

  <!-- ê³µí†µ ì¸ì¦ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="/assets/auth-state.js?v=202410" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js" integrity="sha384-GFr3yTh5lJznCbZfpTtXnwboFsxqtTQoeTZCRHhE0579KrRmlCzen5AA8ohaB5ug" crossorigin="anonymous"></script>
</body>
</html>
