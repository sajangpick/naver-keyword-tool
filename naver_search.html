<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' http://localhost:* http://127.0.0.1:* https://*.supabase.co https://naver-keyword-tool.onrender.com https://connect.facebook.net https://www.facebook.com wss://*.supabase.co; img-src 'self' data: https://www.facebook.com https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://connect.facebook.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; font-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net data:; frame-ancestors 'self'; base-uri 'self'; form-action 'self'" />
    <meta name="referrer" content="no-referrer" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <!-- 사이트 설명 (SEO) -->
    <meta name="description" content="네이버 검색 순위를 실시간으로 분석하고 경쟁사와 비교하세요. 월간 검색량, 키워드 순위 추적, 경쟁 분석까지 한 번에!" />
    <meta name="keywords" content="네이버 검색 순위, 키워드 도구, 검색량 분석, 경쟁사 분석, SEO 도구" />
    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="네이버 키워드 도구 - 사장픽" />
    <meta property="og:description" content="네이버 검색 순위 실시간 분석, 월간 검색량, 경쟁사 비교 기능 제공" />
    <meta property="og:site_name" content="사장픽" />
    <title>사장픽(sajang pick) - 네이버 키워드 도구</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%2303c75a'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-size='28' font-family='Arial' fill='white'%3ESP%3C/text%3E%3C/svg%3E" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" crossorigin="anonymous"></script>
    <!-- common-header.js 제거 (파일이 없음) -->
    <style>
      :root {
        --accent-color: #ff7b54;
        --bg-color: #fff7f0;
        --text-primary: #201a17;
        --text-secondary: #7a6a60;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
        background: var(--bg-color);
        color: var(--text-primary);
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      .is-hidden {
        display: none !important;
      }

      .header {
        position: sticky;
        top: 0;
        z-index: 50;
        background: var(--bg-color);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        box-shadow: none;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      @media (max-width: 992px) {
        .header {
          display: none;
        }
      }

      .header.header-hidden {
        transform: translateY(-100%);
      }

      .header-inner {
        max-width: 100%;
        margin: 0;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        position: relative;
        box-sizing: border-box;
      }

      .logo-container {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 800;
        font-size: 12px;
        color: var(--text-primary);
        cursor: pointer;
        flex: 0 0 auto;
      }

      .logo-icon {
        width: 28px;
        height: 28px;
        border-radius: 12px;
        background: var(--accent-color);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
      }

      .logo-text {
        letter-spacing: -0.03em;
        text-transform: lowercase;
        font-size: 12px;
      }

      .header-slogan {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-secondary);
        margin: 0;
        white-space: nowrap;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1;
      }

      .header-auth {
        display: flex;
        align-items: center;
        flex: 0 0 auto;
      }

      @media (max-width: 768px) {
        .header-inner {
          padding: 12px 16px;
          flex-wrap: wrap;
          box-sizing: border-box;
          width: 100%;
          max-width: 100%;
        }
        
        .header-slogan {
          font-size: 12px;
          position: static;
          transform: none;
          order: 3;
          width: 100%;
          text-align: center;
          margin-top: 8px;
        }
        
        .logo-container {
          order: 1;
          gap: 8px;
        }
        
        .header-auth {
          order: 2;
        }

        .logo-icon {
          width: 26px;
          height: 26px;
          font-size: 13px;
        }

        .logo-text {
          font-size: 12px;
        }
      }

      @media (max-width: 480px) {
        .header-inner {
          padding: 10px 12px;
          gap: 12px;
          box-sizing: border-box;
          width: 100%;
          max-width: 100%;
        }
        
        .header-slogan {
          display: none;
        }

        .logo-container {
          gap: 6px;
        }
      }

      @media (max-width: 360px) {
        .header-inner {
          padding: 8px 6px 8px 8px;
          gap: 0;
          min-height: auto;
          flex-wrap: nowrap;
          justify-content: space-between;
          align-items: center;
          box-sizing: border-box;
          width: 100%;
          max-width: 100%;
        }

        .logo-container {
          gap: 4px;
          flex: 0 1 auto;
          min-width: 0;
          margin-right: auto;
        }

        .logo-icon {
          width: 19px;
          height: 19px;
          font-size: 10px;
          flex-shrink: 0;
        }

        .logo-text {
          font-size: 11px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          max-width: 120px;
        }

        .header-slogan {
          display: none;
        }

        .header-auth {
          flex-shrink: 0;
          margin-left: auto;
          margin-right: 0;
          max-width: 100%;
          box-sizing: border-box;
        }

        .auth-buttons {
          gap: 2px;
          flex-wrap: nowrap;
          justify-content: flex-end;
          box-sizing: border-box;
        }

        .auth-btn {
          height: 28px;
          padding: 0 6px;
          font-size: 9px;
          min-width: auto;
          flex-shrink: 0;
          box-sizing: border-box;
          white-space: nowrap;
        }

        .auth-btn i {
          font-size: 9px;
          margin-right: 2px;
        }

        .auth-btn span {
          font-size: 9px;
          white-space: nowrap;
        }

        .auth-btn--ghost {
          display: none;
        }
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .header-menu-btn {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        border: none;
        background: rgba(255, 126, 70, 0.15);
        color: var(--accent-color);
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.2s ease, background 0.2s ease;
      }

      .header-menu-btn:hover {
        transform: translateY(-2px);
        background: rgba(255, 126, 70, 0.25);
      }

      .logo-container {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 800;
        font-size: 12px;
        color: var(--text-primary);
        cursor: pointer;
      }

      .logo-icon {
        width: 28px;
        height: 28px;
        border-radius: 12px;
        background: var(--accent-color);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
      }

      .logo-text {
        letter-spacing: -0.03em;
        text-transform: lowercase;
        font-size: 12px;
      }

      @media (max-width: 768px) {
        .logo-icon {
          width: 26px;
          height: 26px;
          font-size: 13px;
        }

        .logo-text {
          font-size: 12px;
        }
      }

      /* 사이드바 스타일 - 새로운 디자인 */
      .side-nav {
        background: #ffe8d9;
        border-radius: 18px;
        padding: 18px 11px;
        display: flex;
        flex-direction: column;
        gap: 14px;
        align-items: center;
        position: fixed;
        left: 20px;
        top: 120px;
        width: 66px;
        height: auto;
        max-height: calc(100vh - 160px);
        overflow-y: auto;
        z-index: 40;
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
      }

      .side-nav .menu-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 3px;
        padding: 9px 6px;
        color: #5a5a5a;
        text-decoration: none;
        font-weight: 500;
        font-size: 9px;
        border-radius: 11px;
        transition: all 0.3s ease;
        width: 43px;
        position: relative;
        background: transparent;
      }
      
      .side-nav .menu-item:hover {
        background: #ffffff;
        color: #ff7e46;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 126, 70, 0.3);
      }
      
      .side-nav .menu-item:hover .ico {
        color: #ff7e46;
        background: rgba(255, 126, 70, 0.1);
      }

      .side-nav .menu-item.active {
        background: #ffffff;
        color: #ff7e46;
      }

      .side-nav .menu-item.active .ico {
        color: #ff7e46;
        background: rgba(255, 126, 70, 0.1);
      }

      .side-nav .ico {
        width: 29px;
        height: 29px;
        border-radius: 7px;
        display: grid;
        place-items: center;
        background: transparent;
        color: #5a5a5a;
        font-size: 13px;
        transition: all 0.3s ease;
      }

      /* 기존 사이드바 숨김 */
      .sidebar {
        display: none;
      }

      .sidebar-header {
        padding: 20px 16px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        display: block;
      }

      .sidebar-logo {
        display: flex;
        align-items: center;
        gap: 16px;
        text-decoration: none;
        color: inherit;
        transition: opacity 0.3s ease;
        width: 100%;
        position: relative;
      }

      .sidebar-logo:hover {
        opacity: 0.8;
      }

      .sidebar-logo-icon {
        width: 36px;
        height: 36px;
        background: var(--accent-color);
        color: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .sidebar-logo-text {
        font-size: 18px;
        font-weight: 800;
        color: #201a17;
      }

      .sidebar-menu {
        padding: 16px 0;
      }

      .sidebar-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 20px;
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
      }

      .sidebar-item:hover {
        background: rgba(255, 126, 70, 0.1);
        color: var(--accent-color);
        border-left-color: var(--accent-color);
      }

      .sidebar-item.active {
        background: rgba(255, 126, 70, 0.15);
        color: var(--accent-color);
        border-left-color: var(--accent-color);
        font-weight: 700;
      }

      .sidebar-item i {
        font-size: 16px;
        width: 20px;
        text-align: center;
      }

      /* 메인 컨텐츠 영역 */
      .main-content {
        margin-left: 0;
        padding-left: 100px;
        min-height: 100vh;
      }

      @media (max-width: 768px) {
        .container {
          padding: 16px 12px;
        }
      }

      @media (max-width: 360px) {
        .container {
          padding: 16px 12px;
        }
      }

      @media (max-width: 992px) {
        .side-nav {
          position: fixed !important;
          bottom: 20px !important;
          left: 50%;
          transform: translateX(-50%);
          top: auto !important;
          flex-direction: row;
          width: calc(100vw - 40px);
          max-width: calc(100vw - 40px);
          padding: 6px 10px; /* 높이 더 줄이기 (8px → 6px) */
          overflow-x: auto;
          overflow-y: hidden;
          gap: 8px; /* 간격 더 줄이기 (10px → 8px) */
          border-radius: 18px; /* 둥글기 더 줄이기 (20px → 18px) */
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
          z-index: 100;
          justify-content: flex-start;
          -webkit-overflow-scrolling: touch;
          touch-action: pan-x;
          scrollbar-width: thin;
          scroll-snap-type: x mandatory;
        }

        /* 오른쪽 페이드아웃 효과 */
        .side-nav::after {
          content: '';
          position: absolute;
          top: 0;
          right: 0;
          width: 50px;
          height: 100%;
          background: linear-gradient(to right, transparent, #ffe8d9);
          pointer-events: none;
          z-index: 1;
          opacity: 1;
          transition: opacity 0.3s ease;
        }

        /* 오른쪽 화살표 인디케이터 */
        .side-nav::before {
          content: '→';
          position: absolute;
          top: 50%;
          right: 8px;
          transform: translateY(-50%);
          font-size: 18px;
          color: rgba(255, 126, 70, 0.6);
          pointer-events: none;
          z-index: 2;
          opacity: 1;
          transition: opacity 0.3s ease;
          animation: slideHintSide 2s ease-in-out infinite;
        }

        @keyframes slideHintSide {
          0%, 100% {
            transform: translateY(-50%) translateX(0);
          }
          50% {
            transform: translateY(-50%) translateX(5px);
          }
        }

        /* 인디케이터가 숨겨진 경우 */
        .side-nav.hide-indicator::before,
        .side-nav.hide-indicator::after {
          opacity: 0 !important;
          animation: none !important;
        }

        .side-nav::-webkit-scrollbar {
          height: 4px;
        }

        .side-nav::-webkit-scrollbar-track {
          background: rgba(0, 0, 0, 0.05);
          border-radius: 2px;
        }

        .side-nav::-webkit-scrollbar-thumb {
          background: rgba(255, 126, 70, 0.4);
          border-radius: 2px;
        }

        .side-nav::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 126, 70, 0.6);
        }

        .side-nav .menu-item {
          flex-direction: column;
          min-width: 50px; /* 너비 더 줄이기 (55px → 50px) */
          padding: 4px 5px; /* 높이 더 줄이기 (6px → 4px) */
          font-size: 8px; /* 폰트 크기 더 줄이기 (9px → 8px) */
          flex: 0 0 50px; /* 고정 너비로 설정하여 처음 4-5개만 보이도록 */
          flex-shrink: 0;
          scroll-snap-align: start;
          gap: 3px; /* 아이콘과 텍스트 사이 간격 더 줄이기 (4px → 3px) */
        }

        .side-nav .menu-item .ico {
          width: 32px; /* 아이콘 크기 더 줄이기 (36px → 32px) */
          height: 32px;
          font-size: 14px; /* 폰트 크기 더 줄이기 (16px → 14px) */
        }

        .side-nav .menu-item.active {
          background: #ffffff;
          color: #ff7e46;
        }

        .side-nav .menu-item.active .ico {
          color: #ff7e46;
          background: rgba(255, 126, 70, 0.1);
        }

        .main-content {
          padding-left: 0;
          padding-bottom: 65px; /* 하단바 높이 더 줄어든 만큼 조정 (75px → 65px) */
        }
      }

      @media (max-width: 360px) {
        .side-nav {
          position: fixed !important;
          bottom: 12px !important;
          top: auto !important;
          width: calc(100vw - 16px);
          max-width: calc(100vw - 16px);
          padding: 5px 8px; /* 높이 더 줄이기 (6px → 5px) */
          gap: 6px; /* 간격 더 줄이기 (8px → 6px) */
          border-radius: 14px; /* 둥글기 더 줄이기 (16px → 14px) */
          overflow-x: auto;
          overflow-y: hidden;
          justify-content: flex-start;
          -webkit-overflow-scrolling: touch;
          touch-action: pan-x;
          scrollbar-width: thin;
          scroll-snap-type: x mandatory;
        }

        /* 오른쪽 페이드아웃 효과 */
        .side-nav::after {
          content: '';
          position: absolute;
          top: 0;
          right: 0;
          width: 40px;
          height: 100%;
          background: linear-gradient(to right, transparent, #ffe8d9);
          pointer-events: none;
          z-index: 1;
          opacity: 1;
          transition: opacity 0.3s ease;
        }

        /* 오른쪽 화살표 인디케이터 */
        .side-nav::before {
          content: '→';
          position: absolute;
          top: 50%;
          right: 6px;
          transform: translateY(-50%);
          font-size: 16px;
          color: rgba(255, 126, 70, 0.6);
          pointer-events: none;
          z-index: 2;
          animation: slideHintSide 2s ease-in-out infinite;
          opacity: 1;
          transition: opacity 0.3s ease;
        }

        /* 인디케이터가 숨겨진 경우 (360px 이하) */
        .side-nav.hide-indicator::before,
        .side-nav.hide-indicator::after {
          opacity: 0 !important;
          animation: none !important;
        }

        .side-nav::-webkit-scrollbar {
          height: 3px;
        }

        .side-nav::-webkit-scrollbar-track {
          background: rgba(0, 0, 0, 0.05);
          border-radius: 2px;
        }

        .side-nav::-webkit-scrollbar-thumb {
          background: rgba(255, 126, 70, 0.4);
          border-radius: 2px;
        }

        .side-nav .menu-item {
          min-width: 45px; /* 너비 더 줄이기 (50px → 45px) */
          padding: 3px 4px; /* 높이 더 줄이기 (5px → 3px) */
          font-size: 7px; /* 폰트 크기 더 줄이기 (8px → 7px) */
          flex: 0 0 45px; /* 고정 너비로 설정하여 처음 4-5개만 보이도록 */
          flex-shrink: 0;
          gap: 2px; /* 간격 더 줄이기 (3px → 2px) */
          scroll-snap-align: start;
        }

        .side-nav .menu-item .ico {
          width: 28px; /* 아이콘 크기 더 줄이기 (32px → 28px) */
          height: 28px;
          font-size: 12px; /* 폰트 크기 더 줄이기 (14px → 12px) */
        }

        .side-nav .menu-item span:not(.ico) {
          font-size: 7px; /* 폰트 크기 더 줄이기 (8px → 7px) */
          word-break: keep-all;
          line-height: 1.2;
          text-align: center;
        }

        .side-nav .menu-item:hover .ico {
          background: #ffffff;
        }

        .side-nav .menu-item.active {
          background: #ffffff;
          color: #ff7e46;
        }

        .side-nav .menu-item.active .ico {
          color: #ff7e46;
          background: rgba(255, 126, 70, 0.1);
        }

        .main-content {
          padding-bottom: 55px; /* 하단바 높이 더 줄어든 만큼 조정 (60px → 55px) */
        }
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .header-auth {
        display: flex;
        align-items: center;
      }

      .auth-buttons {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .auth-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 44px;
        padding: 0 22px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 14px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        background: #fff;
        color: var(--text-primary);
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease, border 0.2s ease;
      }

      .auth-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
      }

      .auth-btn--primary {
        background: transparent;
        color: var(--accent-color);
        border: 1px solid var(--accent-color);
      }

      .auth-btn--primary:hover {
        background: var(--accent-color);
        color: #fff;
        box-shadow: 0 8px 18px rgba(255, 126, 70, 0.3);
        transform: translateY(-1px);
      }

      .auth-btn--ghost {
        background: transparent;
        color: var(--text-secondary);
      }

      .auth-btn--ghost:hover {
        border-color: var(--accent-color);
        color: var(--accent-color);
      }

      .auth-user {
        display: none;
        align-items: center;
        gap: 14px;
        padding: 10px 16px;
        border-radius: 16px;
        background: rgba(255, 123, 84, 0.12);
        color: var(--text-primary);
      }

      .auth-user__avatar {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        background: var(--accent-color);
        color: #fff;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        letter-spacing: -0.02em;
        text-transform: uppercase;
      }

      .auth-user__meta {
        display: flex;
        flex-direction: column;
        line-height: 1.2;
      }

      .auth-user__label {
        font-size: 11px;
        font-weight: 600;
        color: var(--text-secondary);
        letter-spacing: 0.08em;
        text-transform: uppercase;
        text-decoration: none;
      }

      .auth-user__email {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        cursor: pointer;
        transition: color 0.2s ease;
        text-decoration: none;
      }

      .auth-user__email:hover {
        color: var(--accent-color);
      }

      .auth-token-info-inline {
        display: none !important;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 8px;
        background: rgba(255, 123, 84, 0.1);
        border: 1px solid rgba(255, 123, 84, 0.25);
        font-size: 11px;
        font-weight: 700;
        color: var(--text-primary);
      }

      .auth-token-info-inline.show {
        display: flex !important;
      }

      .auth-token-info-inline i {
        font-size: 12px;
        color: var(--accent-color);
      }

      .auth-token-text {
        display: flex;
        align-items: center;
        gap: 3px;
        font-weight: 700;
      }

      .auth-token-text span:first-child {
        color: var(--accent-color);
        font-size: 11px;
        font-weight: 800;
      }

      .auth-token-text span:last-child {
        color: var(--text-secondary);
        font-size: 10px;
        opacity: 0.7;
      }

      .auth-user__logout {
        height: 36px;
        padding: 0 16px;
        border-radius: 12px;
        border: 1px solid rgba(0, 0, 0, 0.08);
        background: #fff;
        color: var(--text-primary);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }

      .auth-user__logout:hover {
        background: rgba(255, 126, 70, 0.12);
        transform: translateY(-2px);
      }
      @media (max-width: 768px) {
        .auth-btn {
          height: 38px;
          padding: 0 16px;
          font-size: 13px;
        }

        .auth-user {
          padding: 8px 12px;
          gap: 10px;
        }

        .auth-user__avatar {
          width: 32px;
          height: 32px;
          font-size: 14px;
        }

        .auth-user__email {
          font-size: 13px;
        }

        .auth-user__logout {
          height: 32px;
          padding: 0 12px;
          font-size: 12px;
        }
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 32px;
        background: transparent;
        flex: 1;
      }

      @media (max-width: 768px) {
        .container {
          padding: 16px 12px;
        }
      }

      @media (max-width: 360px) {
        .container {
          padding: 16px 12px;
        }
      }

      /* 페이지 헤더 섹션 - 통일된 스타일 */
      .header-section {
        background: #ffe8d9;
        border-radius: 20px 20px 0 0;
        padding: 8px 20px 8px 20px;
        margin-bottom: 0;
        min-height: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .page-header {
        margin-bottom: 0;
        text-align: center;
        width: 100%;
      }

      .page-header h1 {
        font-size: 12pt;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 2px;
        line-height: 1.2;
      }

      .page-header p {
        font-size: 8pt;
        color: var(--text-secondary);
        line-height: 1.3;
        margin: 0;
      }

      @media (max-width: 768px) {
        .header-section {
          padding: 8px 12px 8px 12px;
          border-radius: 16px 16px 0 0;
          min-height: 56px;
        }

        .page-header {
          margin-bottom: 0;
        }

        .page-header h1 {
          font-size: 12pt;
          margin-bottom: 2px;
          line-height: 1.2;
        }

        .page-header p {
          font-size: 8pt;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          line-height: 1.3;
        }
      }

      @media (max-width: 360px) {
        .header-section {
          padding: 8px 8px 8px 8px;
          border-radius: 12px 12px 0 0;
          min-height: 56px;
        }

        .page-header {
          margin-bottom: 0;
        }

        .page-header h1 {
          font-size: 12pt;
          margin-bottom: 2px;
          line-height: 1.2;
        }

        .page-header p {
          font-size: 8pt;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          line-height: 1.3;
        }
      }

      .tab-container {
        background: white;
        border-radius: 0 0 20px 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        border: none;
        margin-bottom: 40px;
        overflow: hidden;
        margin-top: 0;
        width: 100%;
        box-sizing: border-box;
      }

      .tab-buttons {
        display: flex;
        background: white;
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        border-radius: 20px 20px 0 0;
        padding: 8px 8px 0 8px;
        gap: 8px;
      }

      .tab-button {
        flex: 1;
        padding: 16px 24px;
        background: transparent;
        border: none;
        cursor: pointer;
        font-weight: 700;
        font-size: 15px;
        color: var(--text-secondary);
        transition: all 0.3s ease;
        position: relative;
        border-radius: 12px 12px 0 0;
        margin-bottom: 0;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .tab-button.active {
        background: var(--accent-color);
        color: white;
        box-shadow: 0 -2px 8px rgba(255, 126, 70, 0.2);
      }

      .tab-button:hover:not(.active) {
        background: rgba(255, 126, 70, 0.08);
        color: var(--accent-color);
      }

      .tab-content {
        padding: 36px;
      }

      .tab-panel {
        display: none;
      }

      .tab-panel.active {
        display: block;
      }

      @media (max-width: 768px) {
        .tab-content {
          padding: 16px 12px;
        }
        
        .tab-button {
          padding: 12px 8px;
          font-size: 13px;
          text-align: center;
        }
        
        .tab-buttons {
          padding: 8px 4px 0 4px;
          gap: 4px;
        }
        
        .keyword-input-group h4 {
          text-align: center;
        }
      }
      
      @media (max-width: 360px) {
        .tab-content {
          padding: 12px 8px;
        }
        
        .tab-button {
          padding: 10px 4px;
          font-size: 11px;
        }
        
        .tab-buttons {
          padding: 6px 2px 0 2px;
          gap: 2px;
        }
      }

      /* 파워링크 키워드 조합 가이드 스타일 */
      .powerlink-guide-section {
        margin-top: 30px;
        margin-bottom: 0;
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        width: 100%;
        box-sizing: border-box;
      }

      .guide-toggle-button {
        width: 100%;
        padding: 20px 24px;
        background: linear-gradient(135deg, #ff7b54 0%, #ff8c69 100%);
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 700;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.3s ease;
        text-align: left;
      }

      .guide-toggle-button:hover {
        background: linear-gradient(135deg, #ff6b3d 0%, #ff7b54 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 123, 84, 0.3);
      }

      .guide-toggle-button i {
        transition: transform 0.3s ease;
        font-size: 18px;
      }

      .guide-toggle-button.active i {
        transform: rotate(180deg);
      }

      .guide-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease, padding 0.3s ease;
        padding: 0;
        background: white;
      }

      .guide-content.active {
        max-height: 3000px;
        padding: 30px 24px;
      }
      

      .guide-step {
        margin-bottom: 30px;
        padding: 20px;
        background: #fff7f0;
        border-radius: 16px;
        border-left: 4px solid var(--accent-color);
      }

      .guide-step:last-child {
        margin-bottom: 0;
      }

      .guide-step-number {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, #ff7b54 0%, #ff8c69 100%);
        color: white;
        border-radius: 50%;
        font-weight: 700;
        font-size: 16px;
        margin-bottom: 16px;
      }

      .guide-step-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 12px;
      }

      .guide-step-content {
        color: var(--text-secondary);
        font-size: 14px;
        line-height: 1.8;
      }

      .guide-step-content ul {
        list-style: none;
        padding-left: 0;
        margin: 12px 0;
      }

      .guide-step-content li {
        padding: 8px 0;
        padding-left: 24px;
        position: relative;
      }

      .guide-step-content li:before {
        content: "→";
        position: absolute;
        left: 0;
        color: var(--accent-color);
        font-weight: bold;
      }

      .guide-keyword-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin: 16px 0;
      }

      .guide-keyword-item {
        background: white;
        padding: 16px;
        border-radius: 12px;
        border: 2px solid #ffe8d9;
      }

      .guide-keyword-item h5 {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
      }

      .guide-keyword-item p {
        font-size: 12px;
        color: var(--text-secondary);
        margin: 0;
        line-height: 1.6;
      }

      .guide-formula-box {
        background: white;
        border: 2px dashed var(--accent-color);
        border-radius: 12px;
        padding: 20px;
        margin: 16px 0;
      }

      .guide-formula-box h5 {
        font-size: 15px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 12px;
      }

      .guide-formula-item {
        margin-bottom: 12px;
        padding: 12px;
        background: #fff7f0;
        border-radius: 8px;
      }

      .guide-formula-item:last-child {
        margin-bottom: 0;
      }

      .guide-formula-item strong {
        display: block;
        font-size: 13px;
        color: var(--text-primary);
        margin-bottom: 6px;
      }

      .guide-formula-item .example {
        font-size: 12px;
        color: var(--text-secondary);
        margin-top: 4px;
      }

      .guide-action-box {
        background: linear-gradient(135deg, #ff7b54 0%, #ff8c69 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        margin: 16px 0;
      }

      .guide-action-box p {
        font-size: 15px;
        font-weight: 600;
        margin: 0 0 12px 0;
      }

      .guide-flow {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 12px;
      }

      .guide-flow-item {
        background: white;
        color: var(--accent-color);
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
      }

      .guide-flow-arrow {
        color: white;
        font-size: 16px;
      }

      .guide-ebook-box {
        background: linear-gradient(135deg, #ff7b54 0%, #ff8c69 100%);
        color: white;
        padding: 24px;
        border-radius: 12px;
        margin-top: 20px;
        text-align: center;
      }

      .guide-ebook-box h5 {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 12px;
      }

      .guide-ebook-box p {
        font-size: 13px;
        line-height: 1.6;
        margin-bottom: 16px;
        opacity: 0.95;
      }

      .guide-ebook-button {
        background: white;
        color: var(--accent-color);
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 700;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .guide-ebook-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 123, 84, 0.3);
      }

      @media (max-width: 768px) {
        .guide-toggle-button {
          padding: 16px 20px;
          font-size: 14px;
        }

        .guide-content.active {
          padding: 20px 16px;
        }

        .guide-step {
          padding: 16px;
        }

        .guide-keyword-grid {
          grid-template-columns: 1fr;
        }

        .guide-flow {
          flex-direction: column;
        }

        .guide-flow-arrow {
          transform: rotate(90deg);
        }
      }

      .keyword-inputs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
        margin-bottom: 20px;
      }

      .keyword-input-group {
        background: transparent;
        padding: 12px;
        border-radius: 12px;
        border: none;
        box-shadow: none;
      }

      .keyword-input-group h4 {
        color: var(--text-primary);
        margin-bottom: 8px;
        font-size: 14px;
        font-weight: 600;
      }

      .keyword-input-group textarea {
        width: 100%;
        min-height: 100px;
        padding: 10px 14px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        resize: vertical;
        font-size: 13px;
        font-family: inherit;
        background: white;
        transition: all 0.3s ease;
      }

      .keyword-input-group textarea:focus {
        border-color: var(--accent-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(255, 126, 70, 0.15);
      }

      @media (max-width: 768px) {
        .keyword-inputs {
          gap: 10px;
          margin-bottom: 16px;
        }

        .keyword-input-group {
          padding: 10px;
        }

        .keyword-input-group h4 {
          margin-bottom: 6px;
          font-size: 13px;
        }

        .keyword-input-group textarea {
          min-height: 80px;
          padding: 8px 12px;
          font-size: 12px;
        }
      }

      @media (max-width: 360px) {
        .keyword-inputs {
          gap: 8px;
          margin-bottom: 12px;
        }

        .keyword-input-group {
          padding: 8px;
        }

        .keyword-input-group h4 {
          margin-bottom: 5px;
          font-size: 12px;
        }

        .keyword-input-group textarea {
          min-height: 70px;
          padding: 6px 10px;
          font-size: 11px;
        }
      }

      .combination-options {
        background: transparent;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        border: none;
        box-shadow: none;
      }

      .combination-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
      }

      .combination-option {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        background: white;
        border-radius: 6px;
        border: 1px solid #e9ecef;
        font-size: 13px;
      }

      @media (max-width: 768px) {
        .combination-options {
          padding: 16px;
        }

        .combination-grid {
          gap: 8px;
          margin-bottom: 16px;
        }

        .combination-option {
          padding: 6px 10px;
          font-size: 12px;
        }
      }

      @media (max-width: 360px) {
        .combination-options {
          padding: 12px;
        }

        .combination-grid {
          gap: 6px;
          margin-bottom: 12px;
        }

        .combination-option {
          padding: 5px 8px;
          font-size: 11px;
        }
      }

      .combination-option input[type="checkbox"] {
        transform: scale(1.1);
      }

      .combination-buttons {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
      }

      .combination-btn {
        padding: 12px 24px;
        border: 2px solid var(--accent-color);
        background: white;
        color: var(--accent-color);
        border-radius: 12px;
        cursor: pointer;
        font-weight: 700;
        transition: all 0.3s ease;
        font-size: 14px;
        flex: 1 1 auto;
        min-width: 120px;
      }

      .combination-btn:hover {
        background: var(--accent-color);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 18px rgba(255, 126, 70, 0.18);
      }

      .combination-btn.primary {
        background: var(--accent-color);
        color: white;
        flex: 2 1 auto;
        min-width: 160px;
        box-shadow: 0 4px 12px rgba(255, 126, 70, 0.3);
      }

      .combination-btn.primary:hover {
        background: rgba(255, 126, 70, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 8px 18px rgba(255, 126, 70, 0.25);
      }

      .combination-btn.secondary {
        background: rgba(255, 126, 70, 0.1);
        border-color: var(--accent-color);
        color: var(--accent-color);
      }

      .combination-btn.secondary:hover {
        background: var(--accent-color);
        color: white;
      }

      @media (max-width: 768px) {
        .combination-buttons {
          flex-direction: column;
          gap: 10px;
        }

        .combination-btn {
          width: 100%;
          padding: 14px 20px;
          font-size: 14px;
          min-width: 100%;
        }

        .combination-btn.primary {
          order: 1;
          width: 100%;
          font-size: 15px;
          padding: 16px 24px;
        }

        .combination-btn:not(.primary) {
          order: 2;
        }
      }

      @media (max-width: 360px) {
        .combination-btn {
          padding: 12px 16px;
          font-size: 13px;
        }

        .combination-btn.primary {
          font-size: 14px;
          padding: 14px 20px;
        }
      }

      .combination-result {
        background: transparent;
        padding: 20px;
        border-radius: 12px;
        border: none;
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
      }

      .combination-result h4 {
        color: var(--text-primary);
        margin-bottom: 15px;
        font-size: 16px;
        font-weight: 600;
      }

      .combination-list {
        display: grid;
        gap: 8px;
      }

      .combination-item {
        padding: 10px 15px;
        background: transparent;
        border-radius: 6px;
        font-size: 14px;
        color: var(--text-primary);
        border-left: 3px solid var(--accent-color);
      }

      .search-form {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-direction: column;
        align-items: stretch;
      }

      .search-input {
        flex: 1;
        padding: 12px 16px;
        font-size: 13px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        outline: none;
        transition: all 0.3s ease;
        background: #fff;
        font-family: inherit;
        color: var(--text-primary);
        width: 100%;
        box-sizing: border-box;
      }

      .search-input:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(255, 126, 70, 0.15);
      }

      .search-input::placeholder {
        color: rgba(0, 0, 0, 0.35);
      }

      .search-options {
        display: flex;
        gap: 20px;
        align-items: center;
        padding: 15px 0;
        border-top: 1px solid #eee;
        margin-top: 20px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .search-btn {
        padding: 12px 24px;
        background: var(--accent-color);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
        box-shadow: 0 4px 12px rgba(255, 126, 70, 0.3);
        width: 100%;
        box-sizing: border-box;
      }

      .search-btn:hover {
        background: #ff9068;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(255, 126, 70, 0.4);
      }

      .search-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        opacity: 0.6;
      }

      @media (max-width: 768px) {
        .search-form {
          gap: 12px;
          margin-bottom: 8px;
        }
        
        .search-btn {
          width: 100%;
          padding: 14px 20px;
          font-size: 15px;
        }
        
        .search-options {
          justify-content: center;
          text-align: center;
          padding: 6px 0;
          margin-top: 4px;
          margin-bottom: 4px;
        }
      }
      
      @media (max-width: 360px) {
        .search-form {
          gap: 10px;
          margin-bottom: 6px;
        }
        
        .search-btn {
          padding: 12px 16px;
          font-size: 14px;
        }

        .search-options {
          padding: 4px 0;
          margin-top: 2px;
          margin-bottom: 2px;
        }
      }

      /* 기본 버튼 스타일 추가 */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 12px 20px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 14px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      .btn-primary {
        background: var(--accent-color);
        color: #fff;
        border: none;
      }

      .btn-primary:hover {
        background: rgba(255, 126, 70, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 8px 18px rgba(255, 126, 70, 0.18);
      }

      .btn-secondary {
        background: #fff;
        color: var(--text-primary);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
      }

      .btn-success {
        background: var(--accent-color);
        color: #fff;
        border: none;
      }

      .btn-success:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 8px 18px rgba(255, 123, 84, 0.3);
      }

      .server-status {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        border-radius: 12px;
        padding: 20px 25px;
        margin-bottom: 30px;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      }

      .server-status.offline {
        background: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
      }

      .loading {
        background: transparent;
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 25px;
        color: var(--text-primary);
        border: none;
        box-shadow: none;
      }

      @media (max-width: 768px) {
        .loading {
          padding: 12px;
          margin-bottom: 4px;
        }
      }

      @media (max-width: 360px) {
        .loading {
          padding: 10px;
          margin-bottom: 2px;
        }
      }

      .loading i {
        color: #3498db;
        font-size: 1.8rem;
        margin-right: 12px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading span {
        font-weight: 600;
        font-size: 1.1rem;
      }

      .stats {
        background: transparent;
        padding: 20px 25px;
        border-radius: 12px;
        margin-bottom: 25px;
        color: var(--text-primary);
        font-weight: 600;
        border: none;
        box-shadow: none;
      }

      .error {
        background: #ffebee;
        color: #c62828;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 25px;
        border-left: 4px solid #c62828;
        font-weight: 500;
        border: 1px solid #ffcdd2;
      }

      .results-table {
        background: transparent;
        border-radius: 16px;
        box-shadow: none;
        border: none;
        overflow: hidden;
      }

      .table-header {
        background: transparent;
        padding: 15px 20px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        font-weight: 700;
        color: var(--text-primary);
        font-size: 1.1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
      }

      .pagination-info {
        color: #666;
        font-size: 14px;
        font-weight: 500;
      }

      .table-container {
        overflow-x: auto;
      }

      .keyword-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }

      .keyword-table th {
        background: transparent;
        padding: 12px 15px;
        text-align: center;
        font-weight: 600;
        color: var(--text-primary);
        border-bottom: 2px solid rgba(0, 0, 0, 0.1);
        white-space: nowrap;
        font-size: 13px;
        line-height: 1.5;
      }

      .keyword-table td {
        padding: 12px 15px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        text-align: center;
        color: var(--text-primary);
        font-size: 13px;
        line-height: 1.5;
      }

      @media (max-width: 768px) {
        .table-header {
          padding: 12px 12px;
          font-size: 0.9rem;
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .table-header > div {
          width: 100%;
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .table-header button {
          font-size: 11px !important;
          padding: 6px 12px !important;
          width: 100%;
          white-space: nowrap;
        }

        .pagination-info {
          font-size: 11px;
        }

        .keyword-table {
          font-size: 11px;
        }

        .keyword-table th {
          padding: 10px 8px;
          font-size: 10px;
          line-height: 1.5;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .keyword-table td {
          padding: 10px 8px;
          font-size: 10px;
          line-height: 1.5;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .keyword-table button {
          font-size: 11px;
          padding: 6px 12px;
        }

        .pagination-btn {
          padding: 6px 10px;
          font-size: 11px;
          min-width: 32px;
        }

        .pagination-jump {
          margin-left: 0;
          flex-wrap: wrap;
          justify-content: center;
        }

        .pagination-jump input {
          width: 50px;
          padding: 5px 6px;
          font-size: 11px;
        }

        .pagination-jump button {
          padding: 6px 12px;
          font-size: 11px;
        }

        .pagination-container {
          padding: 12px;
          gap: 10px;
        }

        .empty-state {
          padding: 30px 15px;
        }

        .empty-state p {
          font-size: 13px;
        }
      }

      @media (max-width: 360px) {
        .table-header {
          padding: 10px 8px;
          font-size: 0.85rem;
        }

        .table-header button {
          font-size: 10px !important;
          padding: 5px 10px !important;
        }

        .keyword-table th {
          padding: 10px 6px;
          font-size: 9px;
          line-height: 1.5;
        }

        .keyword-table td {
          padding: 10px 6px;
          font-size: 9px;
          line-height: 1.5;
        }

        .keyword-table button {
          font-size: 10px;
          padding: 5px 10px;
        }

        .pagination-btn {
          padding: 5px 8px;
          font-size: 10px;
          min-width: 28px;
        }

        .pagination-info {
          font-size: 10px;
        }

        .pagination-jump input {
          width: 45px;
          font-size: 10px;
        }

        .pagination-jump button {
          padding: 5px 10px;
          font-size: 10px;
        }
      }

      .keyword-table tbody tr:hover {
        background: rgba(255, 126, 70, 0.05);
      }

      .keyword-table tbody tr:nth-child(even) {
        background: transparent;
      }

      .keyword-cell {
        text-align: left !important;
        font-weight: 600;
        color: #2c3e50;
      }

      .number-cell {
        font-weight: 600;
        color: #28a745;
      }

      .competition-cell {
        font-weight: 600;
      }

      .competition-high {
        color: #dc3545;
      }

      .competition-medium {
        color: #ffc107;
      }

      .competition-low {
        color: #28a745;
      }

      .checkbox-cell {
        width: 40px;
      }

      .checkbox-cell input[type="checkbox"] {
        transform: scale(1.2);
      }

      .keyword-preview-section {
        margin-top: 40px;
      }

      .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      @media (max-width: 768px) {
        .keyword-preview-section {
          margin-top: 0px !important;
        }

        .preview-header {
          margin-bottom: 8px;
        }

        .preview-info-box {
          margin: 6px 0 !important;
          padding: 8px !important;
        }

        .stats {
          padding: 8px 12px;
          margin-bottom: 0px !important;
        }

        .keyword-table th {
          padding: 10px 8px;
          font-size: 10px;
          line-height: 1.5;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .keyword-table td {
          padding: 10px 8px;
          font-size: 10px;
          line-height: 1.5;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }
      }

      @media (max-width: 360px) {
        .keyword-preview-section {
          margin-top: 0px !important;
        }

        .preview-header {
          margin-bottom: 6px;
        }

        .preview-info-box {
          margin: 5px 0 !important;
          padding: 6px !important;
        }

        .stats {
          padding: 6px 8px;
          margin-bottom: 0px !important;
          font-size: 12px;
        }

        .keyword-table th {
          padding: 10px 6px;
          font-size: 9px;
          line-height: 1.5;
        }

        .keyword-table td {
          padding: 10px 6px;
          font-size: 9px;
          line-height: 1.5;
        }
      }

      .preview-btn:hover {
        background: var(--accent-color) !important;
        color: white !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 126, 70, 0.3);
      }

      /* 빈 상태 메시지 스타일 */
      .empty-table-message {
        padding: 60px 20px;
        text-align: center;
        color: var(--text-secondary);
      }

      @media (max-width: 768px) {
        .empty-table-message {
          padding: 30px 15px;
        }
      }

      @media (max-width: 360px) {
        .empty-table-message {
          padding: 20px 10px;
        }
      }

      /* 페이지네이션 스타일 */
      .pagination-container {
        background: white;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid #e9ecef;
        margin-top: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
      }

      .pagination {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .pagination-btn {
        padding: 8px 12px;
        border: 1px solid rgba(0, 0, 0, 0.08);
        background: white;
        color: var(--text-primary);
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        min-width: 40px;
        text-align: center;
        text-decoration: none;
      }

      .pagination-btn:hover:not(.active):not(.disabled) {
        background: rgba(255, 126, 70, 0.06);
        border-color: var(--accent-color);
        color: var(--accent-color);
        transform: translateY(-1px);
      }

      .pagination-btn.active {
        background: var(--accent-color);
        border-color: var(--accent-color);
        color: white;
        font-weight: 700;
      }

      .pagination-btn.disabled {
        color: #ced4da;
        cursor: not-allowed;
        background: #f8f9fa;
      }

      .pagination-btn.nav-btn {
        padding: 8px 16px;
        font-weight: 600;
      }

      .pagination-jump {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: 20px;
      }

      .pagination-jump input {
        width: 60px;
        padding: 6px 8px;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        text-align: center;
        font-size: 14px;
      }

      .pagination-jump button {
        padding: 8px 16px;
        background: var(--accent-color);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .pagination-jump button:hover {
        background: rgba(255, 126, 70, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 8px 18px rgba(255, 126, 70, 0.18);
      }

      .empty-state {
        padding: 40px 20px;
        color: var(--text-secondary);
      }

      .empty-state svg {
        margin-bottom: 16px;
        opacity: 0.6;
      }

      .empty-state p {
        font-size: 16px;
        font-weight: 500;
        color: var(--text-secondary);
      }

      /* 정렬 화살표 스타일 */
      .sortable-header {
        cursor: pointer;
        user-select: none;
        position: relative;
        transition: background-color 0.2s ease;
      }

      .sortable-header:hover {
        background: #e9ecef !important;
      }

      .sortable-header .sort-arrow {
        margin-left: 5px;
        font-size: 12px;
        opacity: 0.5;
      }

      .sortable-header.sort-desc .sort-arrow::before {
        content: "▼";
        opacity: 1;
        color: #3498db;
      }

      .sortable-header.sort-asc .sort-arrow::before {
        content: "▲";
        opacity: 1;
        color: #3498db;
      }

      .sortable-header:not(.sort-desc):not(.sort-asc) .sort-arrow::before {
        content: "↕";
        opacity: 0.5;
      }

      /* 키워드 차트 모달 스타일 */
      .chart-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        justify-content: center;
        align-items: center;
      }

      .chart-modal.show {
        display: flex;
      }

      .chart-content {
        background: white;
        border-radius: 16px;
        padding: 30px;
        max-width: 900px;
        width: 90%;
        max-height: 90%;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e9ecef;
      }

      .chart-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2c3e50;
      }

      .close-btn {
        background: var(--accent-color);
        color: white;
        border: none;
        border-radius: 12px;
        width: 40px;
        height: 40px;
        cursor: pointer;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .close-btn:hover {
        background: rgba(255, 126, 70, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 8px 18px rgba(255, 126, 70, 0.25);
      }

      .charts-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .chart-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid #e9ecef;
      }

      .chart-section h3 {
        color: var(--text-primary);
        margin-bottom: 15px;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .chart-container {
        position: relative;
        height: 300px;
        margin-bottom: 20px;
      }

      .trend-chart-container {
        position: relative;
        height: 250px;
        margin-bottom: 20px;
      }

      .chart-info {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
      }

      .chart-info h4 {
        color: #1976d2;
        margin-bottom: 10px;
        font-size: 14px;
      }

      .chart-info ul {
        color: #1976d2;
        font-size: 13px;
        line-height: 1.5;
        margin-left: 20px;
      }

      .keyword-link {
        cursor: pointer;
        color: var(--accent-color);
        text-decoration: underline;
        transition: color 0.3s ease;
      }

      .keyword-link:hover {
        color: #02b14f;
        text-decoration: none;
      }

      .place-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .place-item {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        transition: all 0.3s ease;
      }

      .place-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .place-title {
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
        text-decoration: none;
      }

      .place-title:hover {
        color: #3498db;
      }

      .place-category {
        background: #e3f2fd;
        color: #1976d2;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 4px;
        display: inline-block;
        margin-bottom: 8px;
      }

      .place-address {
        color: #666;
        font-size: 14px;
        margin-bottom: 8px;
      }

      .place-description {
        color: #495057;
        font-size: 13px;
        line-height: 1.4;
        margin-bottom: 10px;
      }

      .place-phone {
        color: #28a745;
        font-size: 14px;
        font-weight: 500;
      }

      @media (max-width: 768px) {
        /* 헤더 겹침 방지: 로고/버튼 세로 스택 & 버튼 absolute 해제 */
        .top-nav {
          flex-direction: column;
          gap: 10px;
        }
        .user-actions {
          position: static;
          right: auto;
          width: 100%;
          display: flex;
          justify-content: center;
          gap: 8px;
          flex-wrap: wrap;
        }
        .nav-menu {
          justify-content: flex-start;
          overflow-x: auto;
          white-space: nowrap;
          padding: 5px 0;
          scrollbar-width: none; /* Firefox */
          -ms-overflow-style: none; /* IE and Edge */
        }

        .nav-menu::-webkit-scrollbar {
          display: none; /* Chrome, Safari and Opera */
        }

        .nav-menu li {
          flex-shrink: 0;
        }

        .nav-menu a {
          font-size: 12px;
          padding: 8px 12px;
          white-space: nowrap;
        }

        .search-form {
          flex-direction: column;
        }

        .nav-container {
          flex-direction: column;
          gap: 15px;
        }

        .top-nav {
          flex-direction: column;
          gap: 15px;
        }

        .search-options {
          flex-direction: column;
          align-items: flex-start;
        }

        .search-box {
          padding: 25px;
        }

        .container {
          padding: 30px 15px;
        }

        .pagination-container {
          flex-direction: column;
          gap: 10px;
        }

        .pagination-jump {
          margin-left: 0;
        }

        .table-header {
          flex-direction: column;
          gap: 8px;
          align-items: flex-start;
          padding: 12px 12px;
          font-size: 0.9rem;
        }

        .table-header > div {
          width: 100%;
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        /* 사이드바 모바일 스타일 */
        .sidebar {
          width: 60px;
        }

        .sidebar-logo-text {
          display: none;
        }

        .sidebar-item span {
          display: none;
        }

        .sidebar-item {
          justify-content: center;
          padding: 12px 8px;
        }

        .main-content {
          margin-left: 0;
          padding-left: 0;
        }

        .header-inner {
          padding: 8px 16px;
        }
      }

      @media (max-width: 480px) {
        .sidebar {
          width: 50px;
        }

        .sidebar-item {
          padding: 10px;
        }

        .main-content {
          margin-left: 0;
          padding-left: 0;
        }

        .container {
          padding: 16px 12px;
        }
      }

      /* 푸터 스타일 */
      .site-footer {
        background: rgba(255, 255, 255, 0.95);
        border-top: 1px solid rgba(0, 0, 0, 0.08);
        padding: 40px 20px;
        margin-top: auto;
        color: var(--text-secondary);
        width: 100%;
      }

      .footer-content {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        gap: 24px;
        font-size: 14px;
        line-height: 1.8;
        align-items: center;
      }

      .footer-item {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 12px;
      }

      .footer-label {
        font-weight: 700;
        color: var(--text-primary);
        font-size: 13px;
        margin-bottom: 4px;
      }

      .footer-value {
        color: var(--text-secondary);
        font-size: 13px;
      }

      .footer-value a {
        color: var(--accent-color);
        text-decoration: none;
        transition: opacity 0.2s ease;
      }

      .footer-value a:hover {
        opacity: 0.8;
        text-decoration: underline;
      }

      @media (max-width: 768px) {
        .site-footer {
          padding: 10px 8px;
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          z-index: 30;
          margin-top: 0;
        }

        .footer-content {
          gap: 5px;
          font-size: 8px;
          flex-direction: row;
          flex-wrap: wrap;
          line-height: 1.4;
        }

        .footer-item {
          flex-direction: row;
          align-items: center;
          gap: 3px;
        }

        .footer-label {
          font-size: 8px;
        }

        .footer-value {
          font-size: 8px;
        }
      }
    </style>
    <!-- 인증 가드: 로그인 필수 기능 보호 -->
    <script src="./assets/auth-guard.js" defer></script>
    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '823098897158597');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=823098897158597&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
  </head>
  <body>
    <header class="header">
      <div class="header-inner">
        <a href="../" class="logo-container">
          <div class="logo-icon">
            <i class="fa-solid fa-thumbtack"></i>
          </div>
          <span class="logo-text">sajang pick</span>
        </a>
        
        <h1 class="header-slogan">센스있는 사장님들의 선택</h1>
        
        <div class="header-auth">
          <div class="auth-buttons" id="authButtons">
            <div class="auth-user" id="authUser" style="display: none;">
              <div class="auth-user__avatar" id="userAvatar">U</div>
              <div class="auth-user__meta">
                <div style="display: flex; align-items: center; gap: 8px;">
                  <a href="../mypage.html" class="auth-user__label" style="cursor: pointer; text-decoration: none; display: flex; align-items: center; gap: 6px;"><i class="fa-solid fa-door-open" style="font-size: 14px;"></i>나의 페이지</a>
                  <div class="auth-token-info-inline" id="authTokenInfo" style="display: none;">
                    <i class="fa-solid fa-coins"></i>
                    <span class="auth-token-text">
                      <span id="tokenRemaining">-</span>
                      <span style="color: var(--text-secondary); font-weight: 400;">/</span>
                      <span id="tokenLimit">-</span>
                    </span>
                  </div>
                </div>
                <a href="../mypage.html" class="auth-user__email" id="userEmail" style="cursor: pointer; text-decoration: none;"></a>
              </div>
              <button class="auth-user__logout" id="logoutBtn" type="button">
                로그아웃
              </button>
            </div>
            <a href="../login.html" class="auth-btn auth-btn--primary" id="loginBtn">
              <i class="fa-solid fa-sign-in-alt" style="margin-right: 8px;"></i>
              <span>로그인</span>
            </a>
            <a href="../join.html" class="auth-btn auth-btn--ghost" id="signupBtn">
              <i class="fa-solid fa-user-plus" style="margin-right: 8px;"></i>
              <span>회원가입</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <aside class="side-nav" aria-label="사이드 네비게이션">
      <a class="menu-item" href="./index.html">
        <span class="ico"><i class="fa-solid fa-house"></i></span>
        <span>홈</span>
      </a>
      <a class="menu-item active" href="./naver_search.html">
        <span class="ico"><i class="fa-solid fa-key"></i></span>
        <span>키워드</span>
      </a>
      <a class="menu-item" href="./AI-Review.html">
        <span class="ico"><i class="fa-solid fa-pen-nib"></i></span>
        <span>리뷰</span>
      </a>
      <a class="menu-item" href="./Blog-Editor.html">
        <span class="ico"><i class="fa-solid fa-blog"></i></span>
        <span>블로그</span>
      </a>
      <a class="menu-item" href="./recipe-manager.html">
        <span class="ico"><i class="fa-solid fa-utensils"></i></span>
        <span>레시피</span>
      </a>
      <a class="menu-item" href="./shorts-editor.html">
        <span class="ico"><i class="fa-solid fa-film"></i></span>
        <span>영상</span>
      </a>
      <a class="menu-item" href="./sajangpick-book.html">
        <span class="ico"><i class="fa-solid fa-book-open"></i></span>
        <span>전자책</span>
      </a>
      <a class="menu-item" href="./news-board.html">
        <span class="ico"><i class="fa-solid fa-newspaper"></i></span>
        <span>뉴스</span>
      </a>
      <a class="menu-item" href="./policy-support.html">
        <span class="ico"><i class="fa-solid fa-coins"></i></span>
        <span>정책</span>
      </a>
    </aside>

    <div class="main-content">
      <div class="container">
        <!-- 헤더 섹션 -->
        <div class="header-section">
          <div class="page-header">
            <h1>네이버 키워드 도구</h1>
            <p>네이버 광고 API를 활용한 키워드 분석 서비스</p>
          </div>
        </div>

        <div class="tab-container">
        <div class="tab-buttons">
          <button
            class="tab-button active"
            onclick="switchTab('keyword-search')"
          >
            키워드 조회
          </button>
          <button class="tab-button" onclick="switchTab('keyword-combination')">
            키워드 조합기
          </button>
          <button class="tab-button" onclick="switchTab('related-keywords')">
            연관키워드
          </button>
        </div>

        <div class="tab-content">
          <!-- 키워드 조회 탭 -->
          <div id="keyword-search" class="tab-panel active">
            <div class="search-form">
              <textarea
                id="searchQuery"
                class="search-input"
                placeholder="키워드를 한 줄에 하나씩 입력하세요 (최대 100개)&#10;예:&#10;강남맛집&#10;부산맛집&#10;역삼삼겹살회식"
                rows="6"
                style="
                  resize: none;
                  overflow-y: auto;
                  min-height: 120px;
                  font-family: inherit;
                "
              ></textarea>
              <button type="button" class="search-btn" id="searchBtn">
                검색
              </button>
            </div>

            <div class="search-options">
              <span style="color: var(--text-secondary); font-size: 14px">
                <span id="keywordCount">0</span>/100개 키워드
              </span>
            </div>

            <!-- 파워링크 키워드 조합 가이드 -->
            <div class="powerlink-guide-section">
              <button class="guide-toggle-button" onclick="toggleGuide()">
                <span>파워링크 키워드 조합 가이드</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="guide-content" id="guideContentSearch">
                <!-- 1단계: 광고센터 접속하기 -->
                <div class="guide-step">
                  <div class="guide-step-number">1</div>
                  <div class="guide-step-title">광고센터 접속하기</div>
                  <div class="guide-step-content">
                    <ul>
                      <li>네이버 스마트플레이스 로그인</li>
                      <li>화면 상단 '광고주센터' 탭 클릭</li>
                      <li>'광고 만들기' 버튼 클릭</li>
                    </ul>
                  </div>
                </div>

                <!-- 2단계: 4가지 키워드 입력하기 -->
                <div class="guide-step">
                  <div class="guide-step-number">2</div>
                  <div class="guide-step-title">4가지 키워드 입력하기</div>
                  <div class="guide-step-content">
                    <div class="guide-keyword-grid">
                      <div class="guide-keyword-item">
                        <h5>키워드1 지역</h5>
                        <p>예: 명장동, 동래역, 안락동</p>
                      </div>
                      <div class="guide-keyword-item">
                        <h5>키워드2 대표 메뉴/상품</h5>
                        <p>예: 삼겹살, 돼지고기, 특수부위</p>
                      </div>
                      <div class="guide-keyword-item">
                        <h5>키워드3 가게 유형</h5>
                        <p>예: 맛집, 고기집, 회식</p>
                      </div>
                      <div class="guide-keyword-item">
                        <h5>키워드4 행동/가치</h5>
                        <p>예: 주천, 예약, 할인</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 3단계: 조합 선택하기 -->
                <div class="guide-step">
                  <div class="guide-step-number">3</div>
                  <div class="guide-step-title">조합 선택하기</div>
                  <div class="guide-step-content">
                    <div class="guide-formula-box">
                      <h5>추천 조합 공식</h5>
                      <div class="guide-formula-item">
                        <strong>기본 조합: 키워드1 + 키워드2</strong>
                        <div class="example">예: "명장동 삼겹살", "동래역 돼지고기"</div>
                      </div>
                      <div class="guide-formula-item">
                        <strong>추천 조합: 키워드1 + 키워드2 + 키워드3 ⭐</strong>
                        <div class="example">예: "명장동 삼겹살 맛집", "동래역 고기집 주천"</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 4단계: 조합 실행 및 다운로드 -->
                <div class="guide-step">
                  <div class="guide-step-number">4</div>
                  <div class="guide-step-title">조합 실행 및 다운로드</div>
                  <div class="guide-step-content">
                    <div class="guide-action-box">
                      <p>클릭 한 번으로 수백 개 키워드 완성!</p>
                      <div class="guide-flow">
                        <div class="guide-flow-item">조합하기 클릭</div>
                        <i class="fas fa-arrow-right guide-flow-arrow"></i>
                        <div class="guide-flow-item">자동 생성</div>
                        <i class="fas fa-arrow-right guide-flow-arrow"></i>
                        <div class="guide-flow-item">다운로드</div>
                        <i class="fas fa-arrow-right guide-flow-arrow"></i>
                        <div class="guide-flow-item">광고 등록</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 전자책 다운로드 안내 -->
                <div class="guide-ebook-box">
                  <h5>더 자세한 광고 셋팅 방법이 궁금하신가요?</h5>
                  <p>캠페인 생성, 광고 소재 작성, 예산 설정, 확장 소재 활용 등 전체 과정을 담은 전자책을 무료로 다운로드하세요!</p>
                  <button class="guide-ebook-button" data-download-source="naver_search_keyword" onclick="downloadEbook(event)">
                    전자책 무료 다운로드 →
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- 키워드 조합기 탭 -->
          <div id="keyword-combination" class="tab-panel">
            <div class="keyword-inputs">
              <div class="keyword-input-group">
                <h4>키워드1</h4>
                <textarea
                  id="keyword1"
                  placeholder="키워드를 입력해주세요&#10;(최대100개)"
                ></textarea>
              </div>
              <div class="keyword-input-group">
                <h4>키워드2</h4>
                <textarea
                  id="keyword2"
                  placeholder="키워드를 입력해주세요&#10;(최대100개)"
                ></textarea>
              </div>
              <div class="keyword-input-group">
                <h4>키워드3</h4>
                <textarea
                  id="keyword3"
                  placeholder="키워드를 입력해주세요&#10;(최대100개)"
                ></textarea>
              </div>
              <div class="keyword-input-group">
                <h4>키워드4</h4>
                <textarea
                  id="keyword4"
                  placeholder="키워드를 입력해주세요&#10;(최대100개)"
                ></textarea>
              </div>
              <div class="keyword-input-group">
                <h4>키워드5</h4>
                <textarea
                  id="keyword5"
                  placeholder="키워드를 입력해주세요&#10;(최대100개)"
                ></textarea>
              </div>
            </div>

            <div class="combination-options">
              <h4 style="color: var(--text-primary); margin-bottom: 20px; font-size: 14px; font-weight: 600;">
                조합 옵션 선택
              </h4>

              <!-- 2개 조합 -->
              <div style="margin-bottom: 20px">
                <strong style="color: var(--text-primary); font-size: 14px; font-weight: 600; display: block; margin-bottom: 12px;"
                  >2개 조합:</strong
                >
                <div class="combination-grid">
                  <label class="combination-option">
                    <input type="checkbox" name="combo2" value="1+2" /> 1+2
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo2" value="1+3" /> 1+3
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo2" value="1+4" /> 1+4
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo2" value="1+5" /> 1+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo2" value="2+3" /> 2+3
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo2" value="2+4" /> 2+4
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo2" value="2+5" /> 2+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo2" value="3+4" /> 3+4
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo2" value="3+5" /> 3+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo2" value="4+5" /> 4+5
                  </label>
                </div>
              </div>

              <!-- 3개 조합 -->
              <div style="margin-bottom: 20px">
                <strong style="color: var(--text-primary); font-size: 14px; font-weight: 600; display: block; margin-bottom: 12px;"
                  >3개 조합:</strong
                >
                <div class="combination-grid">
                  <label class="combination-option">
                    <input type="checkbox" name="combo3" value="1+2+3" /> 1+2+3
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo3" value="1+2+4" /> 1+2+4
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo3" value="1+2+5" /> 1+2+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo3" value="1+3+4" /> 1+3+4
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo3" value="1+3+5" /> 1+3+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo3" value="1+4+5" /> 1+4+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo3" value="2+3+4" /> 2+3+4
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo3" value="2+3+5" /> 2+3+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo3" value="2+4+5" /> 2+4+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo3" value="3+4+5" /> 3+4+5
                  </label>
                </div>
              </div>

              <!-- 4개, 5개 조합 -->
              <div style="margin-bottom: 20px">
                <strong style="color: var(--text-primary); font-size: 14px; font-weight: 600; display: block; margin-bottom: 12px;"
                  >4개 조합:</strong
                >
                <div class="combination-grid">
                  <label class="combination-option">
                    <input type="checkbox" name="combo4" value="1+2+3+4" />
                    1+2+3+4
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo4" value="1+2+3+5" />
                    1+2+3+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo4" value="1+2+4+5" />
                    1+2+4+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo4" value="1+3+4+5" />
                    1+3+4+5
                  </label>
                  <label class="combination-option">
                    <input type="checkbox" name="combo4" value="2+3+4+5" />
                    2+3+4+5
                  </label>
                </div>
              </div>

              <div style="margin-bottom: 20px">
                <strong style="color: var(--text-primary); font-size: 14px; font-weight: 600; display: block; margin-bottom: 12px;"
                  >5개 조합:</strong
                >
                <div class="combination-grid">
                  <label class="combination-option">
                    <input type="checkbox" name="combo5" value="1+2+3+4+5" />
                    1+2+3+4+5
                  </label>
                </div>
              </div>

              <div class="combination-buttons">
                <button
                  class="combination-btn secondary"
                  onclick="selectAllCombinations()"
                >
                  전체선택
                </button>
                <button
                  class="combination-btn secondary"
                  onclick="deselectAllCombinations()"
                >
                  전체해제
                </button>
                <button
                  class="combination-btn primary"
                  onclick="generateCombinations()"
                >
                  조합하기
                </button>
                <button
                  class="combination-btn secondary"
                  onclick="downloadCombinations()"
                >
                  다운로드
                </button>
              </div>
            </div>

            <div
              id="combinationResult"
              class="combination-result"
              style="display: none"
            >
              <h4>조합된 키워드 결과</h4>
              <div class="combination-list" id="combinationList"></div>
            </div>

            <!-- 파워링크 키워드 조합 가이드 -->
            <div class="powerlink-guide-section">
              <button class="guide-toggle-button" onclick="toggleGuide()">
                <span>파워링크 키워드 조합 가이드</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="guide-content" id="guideContentCombination">
                <!-- 1단계: 광고센터 접속하기 -->
                <div class="guide-step">
                  <div class="guide-step-number">1</div>
                  <div class="guide-step-title">광고센터 접속하기</div>
                  <div class="guide-step-content">
                    <ul>
                      <li>네이버 스마트플레이스 로그인</li>
                      <li>화면 상단 '광고주센터' 탭 클릭</li>
                      <li>'광고 만들기' 버튼 클릭</li>
                    </ul>
                  </div>
                </div>

                <!-- 2단계: 4가지 키워드 입력하기 -->
                <div class="guide-step">
                  <div class="guide-step-number">2</div>
                  <div class="guide-step-title">4가지 키워드 입력하기</div>
                  <div class="guide-step-content">
                    <div class="guide-keyword-grid">
                      <div class="guide-keyword-item">
                        <h5>키워드1 지역</h5>
                        <p>예: 명장동, 동래역, 안락동</p>
                      </div>
                      <div class="guide-keyword-item">
                        <h5>키워드2 대표 메뉴/상품</h5>
                        <p>예: 삼겹살, 돼지고기, 특수부위</p>
                      </div>
                      <div class="guide-keyword-item">
                        <h5>키워드3 가게 유형</h5>
                        <p>예: 맛집, 고기집, 회식</p>
                      </div>
                      <div class="guide-keyword-item">
                        <h5>키워드4 행동/가치</h5>
                        <p>예: 주천, 예약, 할인</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 3단계: 조합 선택하기 -->
                <div class="guide-step">
                  <div class="guide-step-number">3</div>
                  <div class="guide-step-title">조합 선택하기</div>
                  <div class="guide-step-content">
                    <div class="guide-formula-box">
                      <h5>추천 조합 공식</h5>
                      <div class="guide-formula-item">
                        <strong>기본 조합: 키워드1 + 키워드2</strong>
                        <div class="example">예: "명장동 삼겹살", "동래역 돼지고기"</div>
                      </div>
                      <div class="guide-formula-item">
                        <strong>추천 조합: 키워드1 + 키워드2 + 키워드3 ⭐</strong>
                        <div class="example">예: "명장동 삼겹살 맛집", "동래역 고기집 주천"</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 4단계: 조합 실행 및 다운로드 -->
                <div class="guide-step">
                  <div class="guide-step-number">4</div>
                  <div class="guide-step-title">조합 실행 및 다운로드</div>
                  <div class="guide-step-content">
                    <div class="guide-action-box">
                      <p>클릭 한 번으로 수백 개 키워드 완성!</p>
                      <div class="guide-flow">
                        <div class="guide-flow-item">조합하기 클릭</div>
                        <i class="fas fa-arrow-right guide-flow-arrow"></i>
                        <div class="guide-flow-item">자동 생성</div>
                        <i class="fas fa-arrow-right guide-flow-arrow"></i>
                        <div class="guide-flow-item">다운로드</div>
                        <i class="fas fa-arrow-right guide-flow-arrow"></i>
                        <div class="guide-flow-item">광고 등록</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 전자책 다운로드 안내 -->
                <div class="guide-ebook-box">
                  <h5>더 자세한 광고 셋팅 방법이 궁금하신가요?</h5>
                  <p>캠페인 생성, 광고 소재 작성, 예산 설정, 확장 소재 활용 등 전체 과정을 담은 전자책을 무료로 다운로드하세요!</p>
                  <button class="guide-ebook-button" data-download-source="naver_search_combination" onclick="downloadEbook(event)">
                    전자책 무료 다운로드 →
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- 연관키워드 탭 -->
          <div id="related-keywords" class="tab-panel">
            <div class="search-form">
              <textarea
                id="relatedKeywordQuery"
                class="search-input"
                placeholder="시드 키워드를 입력하세요 (한 줄에 하나씩)&#10;예:&#10;강남맛집&#10;부산맛집"
                rows="6"
                style="
                  resize: none;
                  overflow-y: auto;
                  min-height: 120px;
                  font-family: inherit;
                "
              ></textarea>
              <button type="button" class="search-btn" id="relatedSearchBtn">
                연관 키워드 검색
              </button>
            </div>

            <div class="search-options">
              <span style="color: var(--text-secondary); font-size: 14px">
                <span id="relatedKeywordCount">0</span>개 키워드
              </span>
            </div>

            <div id="relatedLoadingDiv" class="loading" style="display: none">
              <i class="fas fa-spinner fa-spin"></i>
              <span>연관 키워드 검색 중입니다...</span>
            </div>

            <div id="relatedStatsDiv" class="stats" style="display: none"></div>

            <div class="results" id="relatedResultsDiv"></div>

            <div id="relatedErrorDiv" class="error" style="display: none"></div>

            <!-- 파워링크 키워드 조합 가이드 -->
            <div class="powerlink-guide-section">
              <button class="guide-toggle-button" onclick="toggleGuide()">
                <span>파워링크 키워드 조합 가이드</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="guide-content" id="guideContentRelated">
                <!-- 1단계: 광고센터 접속하기 -->
                <div class="guide-step">
                  <div class="guide-step-number">1</div>
                  <div class="guide-step-title">광고센터 접속하기</div>
                  <div class="guide-step-content">
                    <ul>
                      <li>네이버 스마트플레이스 로그인</li>
                      <li>화면 상단 '광고주센터' 탭 클릭</li>
                      <li>'광고 만들기' 버튼 클릭</li>
                    </ul>
                  </div>
                </div>

                <!-- 2단계: 4가지 키워드 입력하기 -->
                <div class="guide-step">
                  <div class="guide-step-number">2</div>
                  <div class="guide-step-title">4가지 키워드 입력하기</div>
                  <div class="guide-step-content">
                    <div class="guide-keyword-grid">
                      <div class="guide-keyword-item">
                        <h5>키워드1 지역</h5>
                        <p>예: 명장동, 동래역, 안락동</p>
                      </div>
                      <div class="guide-keyword-item">
                        <h5>키워드2 대표 메뉴/상품</h5>
                        <p>예: 삼겹살, 돼지고기, 특수부위</p>
                      </div>
                      <div class="guide-keyword-item">
                        <h5>키워드3 가게 유형</h5>
                        <p>예: 맛집, 고기집, 회식</p>
                      </div>
                      <div class="guide-keyword-item">
                        <h5>키워드4 행동/가치</h5>
                        <p>예: 주천, 예약, 할인</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 3단계: 조합 선택하기 -->
                <div class="guide-step">
                  <div class="guide-step-number">3</div>
                  <div class="guide-step-title">조합 선택하기</div>
                  <div class="guide-step-content">
                    <div class="guide-formula-box">
                      <h5>추천 조합 공식</h5>
                      <div class="guide-formula-item">
                        <strong>기본 조합: 키워드1 + 키워드2</strong>
                        <div class="example">예: "명장동 삼겹살", "동래역 돼지고기"</div>
                      </div>
                      <div class="guide-formula-item">
                        <strong>추천 조합: 키워드1 + 키워드2 + 키워드3 ⭐</strong>
                        <div class="example">예: "명장동 삼겹살 맛집", "동래역 고기집 주천"</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 4단계: 조합 실행 및 다운로드 -->
                <div class="guide-step">
                  <div class="guide-step-number">4</div>
                  <div class="guide-step-title">조합 실행 및 다운로드</div>
                  <div class="guide-step-content">
                    <div class="guide-action-box">
                      <p>클릭 한 번으로 수백 개 키워드 완성!</p>
                      <div class="guide-flow">
                        <div class="guide-flow-item">조합하기 클릭</div>
                        <i class="fas fa-arrow-right guide-flow-arrow"></i>
                        <div class="guide-flow-item">자동 생성</div>
                        <i class="fas fa-arrow-right guide-flow-arrow"></i>
                        <div class="guide-flow-item">다운로드</div>
                        <i class="fas fa-arrow-right guide-flow-arrow"></i>
                        <div class="guide-flow-item">광고 등록</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 전자책 다운로드 안내 -->
                <div class="guide-ebook-box">
                  <h5>더 자세한 광고 셋팅 방법이 궁금하신가요?</h5>
                  <p>캠페인 생성, 광고 소재 작성, 예산 설정, 확장 소재 활용 등 전체 과정을 담은 전자책을 무료로 다운로드하세요!</p>
                  <button class="guide-ebook-button" data-download-source="naver_search_related" onclick="downloadEbook(event)">
                    전자책 무료 다운로드 →
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="loadingDiv" class="loading" style="display: none">
        <i class="fas fa-spinner fa-spin"></i>
        <span>검색 중입니다...</span>
      </div>

      <div id="statsDiv" class="stats" style="display: none"></div>

      <div class="results" id="resultsDiv"></div>

      <div id="errorDiv" class="error" style="display: none"></div>

      <!-- 키워드 조회 결과 미리보기 -->
      <div class="keyword-preview-section" id="keywordPreviewSection" style="margin-top: 20px;">
        <div class="preview-header">
          <h2 id="previewTitle" style="font-size: 18px; font-weight: 700; color: var(--text-primary); margin: 0;">
            키워드 조회 결과
          </h2>
          <div style="display: flex; gap: 10px; align-items: center;">
            <button class="preview-btn" id="previewDownloadBtn" onclick="downloadSelectedKeywords()" style="padding: 8px 12px; border: 2px solid var(--accent-color); background: transparent; color: var(--accent-color); border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: 600; transition: all 0.3s ease;">
              다운로드
            </button>
            <button class="preview-btn" id="previewResetBtn" onclick="resetSearchValues()" style="padding: 8px 12px; border: 2px solid var(--accent-color); background: transparent; color: var(--accent-color); border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: 600; transition: all 0.3s ease; display: none;">
              검색값초기화
            </button>
          </div>
        </div>
        
        <div class="preview-info-box" style="margin: 15px 0; padding: 12px; background: rgba(255, 126, 70, 0.05); border-radius: 8px;">
          <p style="margin: 0; font-size: 13px; color: var(--text-secondary); line-height: 1.6;">
            ※키워드를 선택하신 후 다운로드가 가능합니다.<br>
            ※키워드 클릭시 상세정보 제공
          </p>
        </div>

        <div class="results-table" style="background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); overflow: hidden;">
          <div class="table-container">
            <table class="keyword-table">
              <thead>
                <tr>
                  <th class="checkbox-cell" rowspan="2">
                    <input type="checkbox" id="previewSelectAll" onchange="togglePreviewAllCheckboxes()">
                  </th>
                  <th rowspan="2">NO</th>
                  <th rowspan="2">키워드</th>
                  <th colspan="2">월간검색수</th>
                  <th rowspan="2">검색수합계</th>
                  <th colspan="2">월평균클릭수</th>
                  <th colspan="2">월평균클릭율</th>
                  <th rowspan="2">경쟁정도</th>
                  <th rowspan="2">월평균노출광고수</th>
                </tr>
                <tr>
                  <th>PC</th>
                  <th>Mobile</th>
                  <th>PC</th>
                  <th>Mobile</th>
                  <th>PC</th>
                  <th>Mobile</th>
                </tr>
              </thead>
              <tbody id="previewTableBody">
                <tr>
                  <td colspan="12" class="empty-table-message">
                    키워드를 조회하십시오.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- 키워드 차트 모달 -->
    <div id="chartModal" class="chart-modal">
      <div class="chart-content">
        <div class="chart-header">
          <h2 class="chart-title" id="chartTitle">키워드 분석</h2>
          <button class="close-btn" onclick="closeChartModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <!-- 키워드 데이터 -->
        <div class="chart-section">
          <h3>키워드 데이터 현황</h3>
          <div class="trend-chart-container">
            <canvas id="overviewChart"></canvas>
          </div>
        </div>

        <!-- 차트 그리드 -->
        <div class="charts-grid">
          <!-- PC vs 모바일 검색수 -->
          <div class="chart-section">
            <h3>PC vs 모바일 검색수</h3>
            <div class="chart-container">
              <canvas id="searchChart"></canvas>
            </div>
          </div>

          <!-- PC vs 모바일 클릭수 -->
          <div class="chart-section">
            <h3>PC vs 모바일 클릭수</h3>
            <div class="chart-container">
              <canvas id="clickChart"></canvas>
            </div>
          </div>
        </div>

        <div class="chart-info">
          <h4>차트 정보</h4>
          <ul>
            <li>
              표시된 데이터는 네이버 키워드 도구 API에서 제공하는 실제 월간 평균
              데이터입니다.
            </li>
            <li>
              월간 검색수는 네이버에서 해당 키워드를 검색한 월평균 횟수입니다.
            </li>
            <li>
              클릭수는 검색 결과에서 실제로 클릭된 월평균 횟수를 나타냅니다.
            </li>
            <li>모든 수치는 네이버 광고 시스템 기준 데이터입니다.</li>
          </ul>
        </div>

        <!-- 네이버 플레이스 검색 결과 -->
        <div
          id="placeResults"
          class="chart-section"
          style="margin-top: 30px; display: none"
        >
          <h3>관련 네이버 플레이스</h3>
          <div id="placeList" class="place-list"></div>
        </div>
      </div>
    </div>

    <script>
      // 백엔드 서버 설정
      const API_BASE_URL = (() => {
        const hostname = window.location.hostname;
        const port = window.location.port;
        
        // 로컬 개발 환경
        if (hostname === 'localhost' || hostname === '127.0.0.1') {
          // 로컬에서는 localhost:3003 사용
          return 'http://localhost:3003';
        }
        
        // 배포 환경 - Render 서버 직접 연결
        return 'https://naver-keyword-tool.onrender.com';
      })();
      
      console.log('API_BASE_URL 설정:', API_BASE_URL);
      console.log('현재 호스트:', window.location.hostname);
      console.log('현재 포트:', window.location.port);

      // DOM 요소
      const searchQuery = document.getElementById("searchQuery");
      const searchBtn = document.getElementById("searchBtn");
      const loadingDiv = document.getElementById("loadingDiv");
      const resultsDiv = document.getElementById("resultsDiv");
      const errorDiv = document.getElementById("errorDiv");
      const statsDiv = document.getElementById("statsDiv");
      const serverStatus = document.getElementById("serverStatus");
      const statusText = document.getElementById("statusText");
      const keywordCount = document.getElementById("keywordCount");

      // 페이지네이션 변수
      let allResults = []; // 전체 검색 결과
      let allKeywordResults = []; // 전체 키워드 결과 (입력 키워드 + 연관 키워드)
      let searchedKeywords = []; // 입력한 키워드 목록
      let currentPage = 1;
      const itemsPerPage = 100;

      // 키워드 조합 변수
      let combinationResults = [];

      // 탭 전환 함수
      function switchTab(tabName) {
        // 모든 탭 버튼에서 active 클래스 제거
        document.querySelectorAll(".tab-button").forEach((btn) => {
          btn.classList.remove("active");
        });

        // 모든 탭 패널 숨기기
        document.querySelectorAll(".tab-panel").forEach((panel) => {
          panel.classList.remove("active");
        });

        // 선택된 탭 버튼에 active 클래스 추가
        event.target.classList.add("active");

        // 선택된 탭 패널 보이기
        document.getElementById(tabName).classList.add("active");

        // 키워드 조회 결과 섹션 표시 제어
        const previewSection = document.getElementById("keywordPreviewSection");
        const previewTitle = document.getElementById("previewTitle");
        const previewResetBtn = document.getElementById("previewResetBtn");
        const previewDownloadBtn = document.getElementById("previewDownloadBtn");
        
        if (previewSection) {
          if (tabName === "keyword-search" || tabName === "related-keywords") {
            previewSection.style.display = "block";
            
            // 탭에 따라 제목과 버튼 변경
            if (tabName === "keyword-search") {
              if (previewTitle) previewTitle.textContent = "키워드 조회 결과";
              if (previewResetBtn) previewResetBtn.style.display = "inline-block";
              if (previewDownloadBtn) {
                previewDownloadBtn.onclick = downloadSelectedKeywords;
                previewDownloadBtn.textContent = "다운로드";
              }
            } else if (tabName === "related-keywords") {
              if (previewTitle) previewTitle.textContent = "연관 키워드 검색 결과";
              if (previewResetBtn) previewResetBtn.style.display = "none";
              if (previewDownloadBtn) {
                previewDownloadBtn.onclick = downloadRelatedKeywords;
                previewDownloadBtn.textContent = "다운로드";
              }
            }
          } else {
            previewSection.style.display = "none";
          }
        }

        // 결과 영역 초기화
        if (tabName !== "keyword-search" && tabName !== "related-keywords") {
          resultsDiv.innerHTML = "";
          errorDiv.style.display = "none";
          statsDiv.style.display = "none";
          loadingDiv.style.display = "none";
        }
        
        // 탭별 미리보기 테이블 업데이트
        if (tabName === "keyword-search") {
          // 키워드 조회 탭으로 전환 시 키워드 조회 결과 표시
          updatePreviewTable();
        } else if (tabName === "related-keywords") {
          // 연관키워드 탭으로 전환 시 연관키워드 결과 표시
          updateRelatedPreviewTable();
        }
      }

      // 파워링크 키워드 조합 가이드 토글 함수
      function toggleGuide() {
        // 현재 활성화된 탭에 따라 해당 가이드 섹션을 찾아서 토글
        const keywordSearchTab = document.getElementById('keyword-search');
        const keywordCombinationTab = document.getElementById('keyword-combination');
        const relatedKeywordsTab = document.getElementById('related-keywords');
        
        let guideContent, toggleButton;
        
        if (keywordSearchTab && keywordSearchTab.classList.contains('active')) {
          // 키워드 조회 탭이 활성화된 경우
          guideContent = document.getElementById("guideContentSearch");
          toggleButton = keywordSearchTab.querySelector(".guide-toggle-button");
        } else if (keywordCombinationTab && keywordCombinationTab.classList.contains('active')) {
          // 키워드 조합기 탭이 활성화된 경우
          guideContent = document.getElementById("guideContentCombination");
          toggleButton = keywordCombinationTab.querySelector(".guide-toggle-button");
        } else if (relatedKeywordsTab && relatedKeywordsTab.classList.contains('active')) {
          // 연관키워드 탭이 활성화된 경우
          guideContent = document.getElementById("guideContentRelated");
          toggleButton = relatedKeywordsTab.querySelector(".guide-toggle-button");
        }
        
        if (guideContent && toggleButton) {
          guideContent.classList.toggle("active");
          toggleButton.classList.toggle("active");
        }
      }

      const EBOOK_DOWNLOAD_ENDPOINT = "/api/ebook/download";
      const EBOOK_FILE_NAME =
        "Naver_Place_Introduction_Guide_2026_Sajangpick_vol1.pdf";
      const EBOOK_LOGIN_REDIRECT = "./naver_search.html";
      let ebookDownloadUser = null;

      function normalizeEbookUser(user) {
        if (!user || typeof user !== "object") return null;
        const id =
          user.id ||
          user.user_id ||
          user.userId ||
          user.uid ||
          user?.user_metadata?.sub ||
          null;
        const rawEmail =
          user.email ||
          user.user_metadata?.email ||
          user.user_metadata?.email_address ||
          user.email?.address ||
          null;
        const email = rawEmail ? String(rawEmail).toLowerCase() : null;
        const displayName =
          user.displayName ||
          user.name ||
          user.user_metadata?.full_name ||
          user.user_metadata?.name ||
          email ||
          "사장님";
        const provider =
          user.provider ||
          user.app_metadata?.provider ||
          user.user_metadata?.provider ||
          "unknown";
        return { id, email, displayName, provider };
      }

      function setEbookDownloadUser(user) {
        const normalized = normalizeEbookUser(user);
        if (normalized) {
          ebookDownloadUser = normalized;
          window.ebookDownloadUser = normalized;
        }
      }

      function getEbookDeviceType() {
        if (
          /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
            navigator.userAgent
          )
        ) {
          return "mobile";
        }
        if (window.innerWidth <= 768) return "mobile";
        if (window.innerWidth <= 1024) return "tablet";
        return "desktop";
      }

      async function getEbookAccessTokenForDownload() {
        let waitCount = 0;
        const maxWait = 30;
        while (!window.authState?.supabase && waitCount < maxWait) {
          await new Promise((resolve) => setTimeout(resolve, 100));
          waitCount++;
        }

        if (!window.authState?.supabase) {
          alert(
            "로그인 정보를 확인하고 있습니다. 페이지를 새로고침한 뒤 다시 시도해주세요."
          );
          return null;
        }

        try {
          const { data } = await window.authState.supabase.auth.getSession();
          const session = data?.session;
          if (!session?.access_token) {
            alert("전자책은 로그인 후 이용할 수 있습니다. 로그인 페이지로 이동합니다.");
            window.location.href = `./login.html?redirect=${EBOOK_LOGIN_REDIRECT}`;
            return null;
          }
          setEbookDownloadUser({
            id: session.user?.id,
            email: session.user?.email,
            displayName:
              session.user?.user_metadata?.full_name || session.user?.email,
            provider: session.user?.app_metadata?.provider || "supabase",
          });
          return session.access_token;
        } catch (error) {
          console.error("[naver_search] 액세스 토큰 확인 실패:", error);
          alert(
            "로그인 상태를 확인하는 중 오류가 발생했습니다. 새로고침 후 다시 시도해주세요."
          );
          return null;
        }
      }

      async function logEbookDownload(triggerSource = "naver_search_widget") {
        if (!ebookDownloadUser?.id) {
          console.warn("[naver_search] 사용자 정보가 없어 다운로드 로그를 생략합니다.");
          return;
        }

        const deviceType = getEbookDeviceType();
        const downloadMethod = deviceType === "mobile" ? "mobile_direct" : "desktop_window";

        try {
          const response = await fetch("/api/ebook/downloads", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              userId: ebookDownloadUser.id,
              email: ebookDownloadUser.email,
              name: ebookDownloadUser.displayName,
              downloadSource: triggerSource,
              deviceType,
              downloadMethod,
              pageUrl: window.location.href,
              metadata: {
                page: "naver_search",
                section: triggerSource,
                referrer: document.referrer || undefined,
              },
              userAgent: navigator.userAgent,
            }),
          });

          if (!response.ok) {
            const payload = await response.json().catch(() => ({}));
            console.warn(
              "[naver_search] 전자책 다운로드 로그 저장 실패:",
              payload.error || response.status
            );
          }
        } catch (error) {
          console.warn("[naver_search] 전자책 다운로드 로그 요청 오류:", error);
        }
      }

      // 전자책 다운로드 함수
      async function downloadEbook(event) {
        event?.preventDefault();
        const triggerBtn = event?.currentTarget || null;
        const triggerSource =
          triggerBtn?.dataset?.downloadSource || "naver_search_widget";

        if (triggerBtn) {
          triggerBtn.disabled = true;
          triggerBtn.classList.add("loading");
        }

        try {
          const accessToken = await getEbookAccessTokenForDownload();
          if (!accessToken) {
            return;
          }

          await logEbookDownload(triggerSource);

          const response = await fetch(EBOOK_DOWNLOAD_ENDPOINT, {
            method: "GET",
            headers: {
              Authorization: `Bearer ${accessToken}`,
            },
          });

          if (!response.ok) {
            if (response.status === 401) {
              alert("로그인이 필요합니다. 다시 로그인해주세요.");
              window.location.href = `./login.html?redirect=${EBOOK_LOGIN_REDIRECT}`;
              return;
            }

            let message = response.statusText || "전자책 다운로드에 실패했습니다.";
            try {
              const payload = await response.clone().json();
              if (payload?.error) {
                message = payload.error;
              }
            } catch (error) {
              // JSON 파싱 실패 시 무시
            }

            throw new Error(message);
          }

          const blob = await response.blob();
          const blobUrl = window.URL.createObjectURL(blob);

          const link = document.createElement("a");
          link.href = blobUrl;
          link.download = EBOOK_FILE_NAME;
          link.target = "_blank";
          link.rel = "noopener noreferrer";
          link.style.display = "none";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          setTimeout(() => {
            window.URL.revokeObjectURL(blobUrl);
          }, 2000);

          console.log("[naver_search] ✅ 전자책 다운로드 시작");
        } catch (error) {
          console.error("[naver_search] 전자책 다운로드 실패:", error);
          alert(
            `전자책 다운로드 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.\n\n사유: ${
              error.message || "알 수 없는 오류"
            }`
          );
        } finally {
          if (triggerBtn) {
            triggerBtn.disabled = false;
            triggerBtn.classList.remove("loading");
          }
        }
      }

      // 페이지네이션 함수들
      function getTotalPages() {
        return Math.ceil(allResults.length / itemsPerPage);
      }

      function getCurrentPageData() {
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        return allResults.slice(startIndex, endIndex);
      }

      function renderPagination() {
        const totalPages = getTotalPages();

        if (totalPages <= 1) {
          return ""; // 페이지가 1개 이하면 페이지네이션 숨김
        }

        let paginationHtml = `
                <div class="pagination-container">
                    <div class="pagination">
                        <button class="pagination-btn nav-btn ${
                          currentPage === 1 ? "disabled" : ""
                        }" 
                                onclick="goToPage(1)" ${
                                  currentPage === 1 ? "disabled" : ""
                                }>
                            <i class="fas fa-angle-double-left"></i> 처음
                        </button>
                        <button class="pagination-btn nav-btn ${
                          currentPage === 1 ? "disabled" : ""
                        }" 
                                onclick="goToPage(${currentPage - 1})" ${
          currentPage === 1 ? "disabled" : ""
        }>
                            <i class="fas fa-angle-left"></i> 이전
                        </button>
            `;

        // 페이지 번호 생성 (현재 페이지 주변 10개 페이지 표시)
        const startPage = Math.max(1, currentPage - 5);
        const endPage = Math.min(totalPages, currentPage + 5);

        // 시작 부분 생략 표시
        if (startPage > 1) {
          paginationHtml += `<button class="pagination-btn" onclick="goToPage(1)">1</button>`;
          if (startPage > 2) {
            paginationHtml += `<span class="pagination-btn disabled">...</span>`;
          }
        }

        // 페이지 번호들
        for (let i = startPage; i <= endPage; i++) {
          paginationHtml += `
                    <button class="pagination-btn ${
                      i === currentPage ? "active" : ""
                    }" 
                            onclick="goToPage(${i})">${i}</button>
                `;
        }

        // 끝 부분 생략 표시
        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            paginationHtml += `<span class="pagination-btn disabled">...</span>`;
          }
          paginationHtml += `<button class="pagination-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
        }

        paginationHtml += `
                        <button class="pagination-btn nav-btn ${
                          currentPage === totalPages ? "disabled" : ""
                        }" 
                                onclick="goToPage(${currentPage + 1})" ${
          currentPage === totalPages ? "disabled" : ""
        }>
                            다음 <i class="fas fa-angle-right"></i>
                        </button>
                        <button class="pagination-btn nav-btn ${
                          currentPage === totalPages ? "disabled" : ""
                        }" 
                                onclick="goToPage(${totalPages})" ${
          currentPage === totalPages ? "disabled" : ""
        }>
                            마지막 <i class="fas fa-angle-double-right"></i>
                        </button>
                    </div>
                    <div class="pagination-jump">
                        <span>페이지 이동:</span>
                        <input type="number" id="pageJumpInput" min="1" max="${totalPages}" value="${currentPage}">
                        <button onclick="jumpToPage()">이동</button>
                    </div>
                </div>
            `;

        return paginationHtml;
      }

      function goToPage(page) {
        const totalPages = getTotalPages();
        if (page < 1 || page > totalPages) return;

        currentPage = page;
        renderCurrentPage();

        // 페이지 이동 후 상단으로 스크롤
        document.querySelector(".results-table").scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
      }

      function jumpToPage() {
        const pageInput = document.getElementById("pageJumpInput");
        const page = parseInt(pageInput.value);
        const totalPages = getTotalPages();

        if (page >= 1 && page <= totalPages) {
          goToPage(page);
        } else {
          alert(`1부터 ${totalPages} 사이의 페이지 번호를 입력해주세요.`);
          pageInput.value = currentPage;
        }
      }

      function renderCurrentPage() {
        const currentData = getCurrentPageData();
        const totalPages = getTotalPages();
        const startIndex = (currentPage - 1) * itemsPerPage;

        // 테이블 헤더 정보 업데이트
        const paginationInfo =
          totalPages > 1
            ? `${currentPage}/${totalPages} 페이지 (${startIndex + 1}-${
                startIndex + currentData.length
              }번째 / 총 ${allResults.length}개)`
            : `총 ${allResults.length}개`;

        // 테이블 렌더링
        const tableHtml = `
                <div class="results-table">
                    <div class="table-header">
                        <span>키워드 검색 결과</span>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button onclick="downloadSelectedKeywords()" style="padding: 8px 16px; background: var(--accent-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease;">
                                선택된 키워드 다운로드
                            </button>
                            <span class="pagination-info">${paginationInfo}</span>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="keyword-table">
                            <thead>
                                <tr>
                                    <th class="checkbox-cell">
                                        <input type="checkbox" id="selectAll" onchange="toggleAllCheckboxes()">
                                    </th>
                                    <th>NO</th>
                                    <th class="sortable-header ${
                                      currentSort.column === "keyword"
                                        ? "sort-" + currentSort.direction
                                        : ""
                                    }" 
                                        onclick="sortResults('keyword')">
                                        연관키워드<span class="sort-arrow"></span>
                                    </th>
                                    <th class="sortable-header ${
                                      currentSort.column === "pcCount"
                                        ? "sort-" + currentSort.direction
                                        : ""
                                    }" 
                                        onclick="sortResults('pcCount')">
                                        월간검색수<br>PC<span class="sort-arrow"></span>
                                    </th>
                                    <th class="sortable-header ${
                                      currentSort.column === "mobileCount"
                                        ? "sort-" + currentSort.direction
                                        : ""
                                    }" 
                                        onclick="sortResults('mobileCount')">
                                        월간검색수<br>모바일<span class="sort-arrow"></span>
                                    </th>
                                    <th class="sortable-header ${
                                      currentSort.column === "totalCount"
                                        ? "sort-" + currentSort.direction
                                        : ""
                                    }" 
                                        onclick="sortResults('totalCount')">
                                        검색수합계<span class="sort-arrow"></span>
                                    </th>
                                    <th class="sortable-header ${
                                      currentSort.column === "pcClick"
                                        ? "sort-" + currentSort.direction
                                        : ""
                                    }" 
                                        onclick="sortResults('pcClick')">
                                        월평균클릭수<br>PC<span class="sort-arrow"></span>
                                    </th>
                                    <th class="sortable-header ${
                                      currentSort.column === "mobileClick"
                                        ? "sort-" + currentSort.direction
                                        : ""
                                    }" 
                                        onclick="sortResults('mobileClick')">
                                        월평균클릭수<br>모바일<span class="sort-arrow"></span>
                                    </th>
                                    <th class="sortable-header ${
                                      currentSort.column === "pcCtr"
                                        ? "sort-" + currentSort.direction
                                        : ""
                                    }" 
                                        onclick="sortResults('pcCtr')">
                                        월평균클릭율<br>PC<span class="sort-arrow"></span>
                                    </th>
                                    <th class="sortable-header ${
                                      currentSort.column === "mobileCtr"
                                        ? "sort-" + currentSort.direction
                                        : ""
                                    }" 
                                        onclick="sortResults('mobileCtr')">
                                        월평균클릭율<br>모바일<span class="sort-arrow"></span>
                                    </th>
                                    <th class="sortable-header ${
                                      currentSort.column === "competition"
                                        ? "sort-" + currentSort.direction
                                        : ""
                                    }" 
                                        onclick="sortResults('competition')">
                                        경쟁정도<span class="sort-arrow"></span>
                                    </th>
                                    <th class="sortable-header ${
                                      currentSort.column === "adCount"
                                        ? "sort-" + currentSort.direction
                                        : ""
                                    }" 
                                        onclick="sortResults('adCount')">
                                        월평균노출<br>광고수<span class="sort-arrow"></span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                ${currentData
                                  .map((item, index) => {
                                    const globalIndex = startIndex + index + 1;
                                    const keyword = extractKeyword(item);
                                    const pcCount = sanitizeData(
                                      item.monthlyPcQcCnt
                                    );
                                    const mobileCount = sanitizeData(
                                      item.monthlyMobileQcCnt
                                    );
                                    const totalCount = pcCount + mobileCount;
                                    const pcClick =
                                      parseFloat(item.monthlyAvePcClkCnt) || 0;
                                    const mobileClick =
                                      parseFloat(item.monthlyAveMobileClkCnt) ||
                                      0;
                                    const pcCtr =
                                      parseFloat(item.monthlyAvePcCtr) || 0;
                                    const mobileCtr =
                                      parseFloat(item.monthlyAveMobileCtr) || 0;
                                    const competition = sanitizeData(
                                      item.compIdx,
                                      "string"
                                    );
                                    const adCount = extractAdCount(item);

                                    let competitionClass = "";
                                    if (competition === "높음")
                                      competitionClass = "competition-high";
                                    else if (competition === "중간")
                                      competitionClass = "competition-medium";
                                    else if (competition === "낮음")
                                      competitionClass = "competition-low";

                                    return `
                                        <tr>
                                            <td class="checkbox-cell">
                                                <input type="checkbox" name="keywordCheck" value="${keyword}">
                                            </td>
                                            <td>${globalIndex}</td>
                                            <td class="keyword-cell">
                                                <span class="keyword-link" onclick="showKeywordChart('${keyword}', ${JSON.stringify(
                                      item
                                    ).replace(/"/g, "&quot;")})">
                                                    ${keyword}
                                                </span>
                                            </td>
                                            <td class="number-cell">${pcCount.toLocaleString()}</td>
                                            <td class="number-cell">${mobileCount.toLocaleString()}</td>
                                            <td class="number-cell" style="font-weight: 700; color: #2c3e50;">${totalCount.toLocaleString()}</td>
                                            <td class="number-cell">${pcClick}</td>
                                            <td class="number-cell">${mobileClick}</td>
                                            <td>${pcCtr.toFixed(2)}%</td>
                                            <td>${mobileCtr.toFixed(2)}%</td>
                                            <td class="competition-cell ${competitionClass}">${competition}</td>
                                            <td class="number-cell">${adCount.toLocaleString()}</td>
                                        </tr>
                                    `;
                                  })
                                  .join("")}
                            </tbody>
                        </table>
                    </div>
                </div>
                ${renderPagination()}
            `;

        resultsDiv.innerHTML = tableHtml;
      }

      // 키워드 조합 관련 함수들
      function selectAllCombinations() {
        document
          .querySelectorAll('input[type="checkbox"][name^="combo"]')
          .forEach((checkbox) => {
            checkbox.checked = true;
          });
      }

      function deselectAllCombinations() {
        document
          .querySelectorAll('input[type="checkbox"][name^="combo"]')
          .forEach((checkbox) => {
            checkbox.checked = false;
          });
      }

      function generateCombinations() {
        // 키워드 입력값 가져오기
        const keywords = [];
        for (let i = 1; i <= 5; i++) {
          const input = document.getElementById(`keyword${i}`);
          if (input.value.trim()) {
            keywords[i - 1] = input.value
              .trim()
              .split("\n")
              .filter((k) => k.trim() !== "");
          } else {
            keywords[i - 1] = [];
          }
        }

        // 선택된 조합 옵션 가져오기
        const selectedCombos = [];
        document
          .querySelectorAll('input[type="checkbox"][name^="combo"]:checked')
          .forEach((checkbox) => {
            selectedCombos.push(checkbox.value);
          });

        if (selectedCombos.length === 0) {
          alert("조합 옵션을 선택해주세요.");
          return;
        }

        // 조합 생성
        combinationResults = [];

        selectedCombos.forEach((combo) => {
          const indices = combo.split("+").map((n) => parseInt(n) - 1);

          // 해당 인덱스의 키워드들이 모두 있는지 확인
          const validIndices = indices.filter(
            (idx) => keywords[idx] && keywords[idx].length > 0
          );

          if (validIndices.length === indices.length) {
            // 모든 경우의 수 조합 생성
            const combinations = generateCartesianProduct(
              validIndices.map((idx) => keywords[idx])
            );

            combinations.forEach((combination) => {
              combinationResults.push(combination.join(" "));
            });
          }
        });

        // 중복 제거
        combinationResults = [...new Set(combinationResults)];

        // 결과 표시
        displayCombinationResults();
      }

      function generateCartesianProduct(arrays) {
        if (arrays.length === 0) return [[]];
        if (arrays.length === 1) return arrays[0].map((item) => [item]);

        const result = [];
        const first = arrays[0];
        const rest = generateCartesianProduct(arrays.slice(1));

        first.forEach((firstItem) => {
          rest.forEach((restCombination) => {
            result.push([firstItem, ...restCombination]);
          });
        });

        return result;
      }

      function displayCombinationResults() {
        const resultDiv = document.getElementById("combinationResult");
        const listDiv = document.getElementById("combinationList");

        if (combinationResults.length === 0) {
          alert(
            "조합 결과가 없습니다. 키워드를 입력하고 조합 옵션을 선택해주세요."
          );
          return;
        }

        resultDiv.style.display = "block";

        listDiv.innerHTML = combinationResults
          .map(
            (combination, index) => `
                <div class="combination-item">
                    ${index + 1}. ${combination}
                </div>
            `
          )
          .join("");

        // 결과 개수 업데이트
        const header = resultDiv.querySelector("h4");
        header.textContent = `조합된 키워드 결과 (총 ${combinationResults.length}개)`;
      }

      function downloadCombinations() {
        if (combinationResults.length === 0) {
          alert("다운로드할 조합 결과가 없습니다.");
          return;
        }

        const content = combinationResults.join("\n");
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "keyword_combinations.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      }

      // 단일 키워드 다운로드 함수
      function downloadSingleKeyword(keyword) {
        const content = keyword;
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `keyword_${keyword}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      }

      // 키워드 차트 모달 표시 함수
      function showKeywordChart(keyword, itemData) {
        const modal = document.getElementById("chartModal");
        const title = document.getElementById("chartTitle");

        title.textContent = `"${keyword}" 키워드 분석`;
        modal.classList.add("show");

        // 월별 트렌드 데이터 요청 후 차트 생성
        fetchKeywordTrendData(keyword, itemData);
      }

      // 키워드 월별 트렌드 데이터 요청
      async function fetchKeywordTrendData(keyword, itemData) {
        try {
          // 로딩 표시
          const trendSection = document.querySelector(".chart-section h3");
          trendSection.textContent = "월별 트렌드 데이터 로딩 중...";

          const response = await fetch(`${API_BASE_URL}/api/keyword-trend`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ keyword: keyword }),
          });

          if (response.ok) {
            const trendData = await response.json();
            trendSection.textContent = "월간 검색수 추이 (최근 12개월)";
            createKeywordCharts(keyword, itemData, trendData.data);

            // 네이버 플레이스 검색
            await fetchPlaceData(keyword);
          } else {
            console.warn("트렌드 데이터 로딩 실패, 기본 차트 표시");
            trendSection.textContent = "키워드 데이터 현황";
            createKeywordCharts(keyword, itemData, null);

            // 네이버 플레이스 검색
            await fetchPlaceData(keyword);
          }
        } catch (error) {
          console.error("트렌드 데이터 요청 오류:", error);
          const trendSection = document.querySelector(".chart-section h3");
          trendSection.textContent = "키워드 데이터 현황";
          createKeywordCharts(keyword, itemData, null);

          // 네이버 플레이스 검색
          await fetchPlaceData(keyword);
        }
      }

      // 네이버 플레이스 데이터 검색
      async function fetchPlaceData(keyword) {
        try {
          console.log(`네이버 플레이스 검색: ${keyword}`);

          const response = await fetch(
            `${API_BASE_URL}/api/search/local?query=${encodeURIComponent(keyword)}`
          );

          if (response.ok) {
            const data = await response.json();
            displayPlaceResults(data.items || []);
          } else {
            console.warn("플레이스 데이터 로딩 실패");
            document.getElementById("placeResults").style.display = "none";
          }
        } catch (error) {
          console.error("플레이스 데이터 요청 오류:", error);
          document.getElementById("placeResults").style.display = "none";
        }
      }

      // 플레이스 검색 결과 표시
      function displayPlaceResults(places) {
        const placeResults = document.getElementById("placeResults");
        const placeList = document.getElementById("placeList");

        if (!places || places.length === 0) {
          placeResults.style.display = "none";
          return;
        }

        placeResults.style.display = "block";

        placeList.innerHTML = places
          .map((place) => {
            // HTML 태그 제거 및 텍스트 정리
            const title = stripHtml(place.title);
            const category = stripHtml(place.category);
            const address = stripHtml(place.address);
            const description = stripHtml(place.description);
            const telephone = place.telephone || "";
            const link = place.link || "#";

            return `
                    <div class="place-item">
                        <a href="${link}" target="_blank" class="place-title">${title}</a>
                        <div class="place-category">${category}</div>
                        <div class="place-address">${address}</div>
                        ${
                          description
                            ? `<div class="place-description">${description}</div>`
                            : ""
                        }
                        ${
                          telephone
                            ? `<div class="place-phone">☎ ${telephone}</div>`
                            : ""
                        }
                    </div>
                `;
          })
          .join("");
      }

      // 차트 모달 닫기
      function closeChartModal() {
        const modal = document.getElementById("chartModal");
        modal.classList.remove("show");

        // 기존 차트 인스턴스 제거
        destroyExistingCharts();
      }

      // 기존 차트 인스턴스 제거
      function destroyExistingCharts() {
        const chartIds = ["overviewChart", "searchChart", "clickChart"];
        chartIds.forEach((id) => {
          const canvas = document.getElementById(id);
          if (canvas && canvas.chart) {
            canvas.chart.destroy();
          }
        });
      }

      // 키워드 차트 생성
      function createKeywordCharts(keyword, itemData, trendData = null) {
        // 기존 차트 제거
        destroyExistingCharts();

        const pcCount = sanitizeData(itemData.monthlyPcQcCnt);
        const mobileCount = sanitizeData(itemData.monthlyMobileQcCnt);
        const pcClick = parseFloat(itemData.monthlyAvePcClkCnt) || 0;
        const mobileClick = parseFloat(itemData.monthlyAveMobileClkCnt) || 0;
        const pcCtr = parseFloat(itemData.monthlyAvePcCtr) || 0;
        const mobileCtr = parseFloat(itemData.monthlyAveMobileCtr) || 0;
        const competition = sanitizeData(itemData.compIdx, "string");

        // 1. 트렌드 차트 또는 개요 차트
        if (
          trendData &&
          trendData.monthlyTrend &&
          trendData.monthlyTrend.length > 0
        ) {
          createTrendChart(keyword, trendData.monthlyTrend);
        } else {
          createOverviewChart(
            keyword,
            pcCount,
            mobileCount,
            pcClick,
            mobileClick
          );
        }

        // 2. PC vs 모바일 검색수 차트
        createSearchChart(pcCount, mobileCount);

        // 3. PC vs 모바일 클릭수 차트
        createClickChart(pcClick, mobileClick);
      }

      // 실제 월별 트렌드 차트 생성
      function createTrendChart(keyword, monthlyTrend) {
        const ctx = document.getElementById("overviewChart").getContext("2d");

        // 월별 데이터 파싱
        const months = [];
        const pcData = [];
        const mobileData = [];

        monthlyTrend.forEach((item) => {
          // 월 정보 파싱 (YYYY-MM 형식 또는 월 인덱스)
          if (item.month) {
            const monthStr =
              typeof item.month === "string" ? item.month : `${item.month}월`;
            months.push(monthStr);
          }

          pcData.push(sanitizeData(item.monthlyPcQcCnt || item.pcCount || 0));
          mobileData.push(
            sanitizeData(item.monthlyMobileQcCnt || item.mobileCount || 0)
          );
        });

        const chart = new Chart(ctx, {
          type: "line",
          data: {
            labels: months,
            datasets: [
              {
                label: "PC 검색수",
                data: pcData,
                borderColor: "#3498db",
                backgroundColor: "rgba(52, 152, 219, 0.1)",
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: "#3498db",
                pointBorderColor: "#2980b9",
                pointRadius: 5,
                pointHoverRadius: 7,
              },
              {
                label: "모바일 검색수",
                data: mobileData,
                borderColor: "#2ecc71",
                backgroundColor: "rgba(46, 204, 113, 0.1)",
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: "#2ecc71",
                pointBorderColor: "#27ae60",
                pointRadius: 5,
                pointHoverRadius: 7,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "top",
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const label = context.dataset.label || "";
                    const value = context.parsed.y.toLocaleString();
                    return `${label}: ${value}`;
                  },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return value.toLocaleString();
                  },
                },
              },
              x: {
                ticks: {
                  maxRotation: 45,
                  minRotation: 0,
                },
              },
            },
          },
        });

        ctx.canvas.chart = chart;
      }

      // 키워드 데이터 개요 차트 생성
      function createOverviewChart(
        keyword,
        pcCount,
        mobileCount,
        pcClick,
        mobileClick
      ) {
        const ctx = document.getElementById("overviewChart").getContext("2d");

        const chart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: ["PC 검색수", "모바일 검색수"],
            datasets: [
              {
                label: "검색수 분포",
                data: [pcCount, mobileCount],
                backgroundColor: ["#3498db", "#2ecc71"],
                borderColor: ["#2980b9", "#27ae60"],
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const label = context.label || "";
                    const value = context.parsed.toLocaleString();
                    const total = pcCount + mobileCount;
                    const percentage =
                      total > 0
                        ? ((context.parsed / total) * 100).toFixed(1)
                        : 0;
                    return `${label}: ${value} (${percentage}%)`;
                  },
                },
              },
            },
          },
        });

        ctx.canvas.chart = chart;
      }

      // 검색수 차트 생성 (가로형)
      function createSearchChart(pcCount, mobileCount) {
        const ctx = document.getElementById("searchChart").getContext("2d");

        const chart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["PC", "모바일"],
            datasets: [
              {
                label: "월간 검색수",
                data: [pcCount, mobileCount],
                backgroundColor: ["#3498db", "#2ecc71"],
                borderColor: ["#2980b9", "#27ae60"],
                borderWidth: 2,
              },
            ],
          },
          options: {
            indexAxis: "y", // 가로형으로 변경
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              x: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return value.toLocaleString();
                  },
                },
              },
            },
          },
        });

        ctx.canvas.chart = chart;
      }

      // 클릭수 차트 생성
      function createClickChart(pcClick, mobileClick) {
        const ctx = document.getElementById("clickChart").getContext("2d");

        const chart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["PC", "모바일"],
            datasets: [
              {
                label: "월평균 클릭수",
                data: [pcClick, mobileClick],
                backgroundColor: ["#e74c3c", "#f39c12"],
                borderColor: ["#c0392b", "#e67e22"],
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return value.toLocaleString();
                  },
                },
              },
            },
          },
        });

        ctx.canvas.chart = chart;
      }

      // 트렌드 데이터 생성 (샘플)
      function generateTrendData(baseValue, months) {
        const data = [];
        let currentValue = baseValue;

        for (let i = 0; i < months; i++) {
          // 15% 범위에서 랜덤 변동
          const variation = (Math.random() - 0.5) * 0.3;
          currentValue = Math.max(0, Math.floor(baseValue * (1 + variation)));
          data.push(currentValue);
        }

        return data;
      }

      // 모달 외부 클릭 시 닫기
      document
        .getElementById("chartModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeChartModal();
          }
        });

      // ESC 키로 모달 닫기
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeChartModal();
        }
      });

      // 선택된 키워드들 일괄 다운로드 함수
      function downloadSelectedKeywords() {
        // 메인 테이블과 미리보기 테이블 모두에서 선택된 키워드 가져오기
        const checkedBoxes = document.querySelectorAll(
          'input[name="keywordCheck"]:checked, input[name="previewKeywordCheck"]:checked'
        );

        if (checkedBoxes.length === 0) {
          alert("다운로드할 키워드를 선택해주세요.");
          return;
        }

        const selectedKeywords = Array.from(checkedBoxes).map(
          (checkbox) => checkbox.value
        );
        // 중복 제거
        const uniqueKeywords = [...new Set(selectedKeywords)];
        const content = uniqueKeywords.join("\n");
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `selected_keywords_${uniqueKeywords.length}개.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      }
      
      // 연관 키워드 다운로드 함수 (미리보기 테이블 포함)
      function downloadRelatedKeywords() {
        const checkedBoxes = document.querySelectorAll(
          'input[name="relatedKeywordCheck"]:checked, input[name="previewRelatedKeywordCheck"]:checked'
        );

        if (checkedBoxes.length === 0) {
          alert("다운로드할 키워드를 선택해주세요.");
          return;
        }

        const selectedKeywords = Array.from(checkedBoxes).map((checkbox) => checkbox.value);
        const uniqueKeywords = [...new Set(selectedKeywords)];
        const content = uniqueKeywords.join("\n");
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `related_keywords_${uniqueKeywords.length}개.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      }

      // 키워드 개수 업데이트
      function updateKeywordCount() {
        const keywords = searchQuery.value
          .trim()
          .split("\n")
          .filter((k) => k.trim() !== "");
        keywordCount.textContent = keywords.length;

        if (keywords.length > 100) {
          keywordCount.style.color = "#dc3545";
        } else {
          keywordCount.style.color = "#666";
        }
      }

      // 키워드 입력 시 실시간 카운팅
      searchQuery.addEventListener("input", updateKeywordCount);

      // 연관 키워드 검색 관련 변수
      let relatedKeywordResults = [];
      let relatedCurrentPage = 1;
      const relatedItemsPerPage = 100;

      // 연관 키워드 개수 업데이트
      function updateRelatedKeywordCount() {
        const relatedQuery = document.getElementById("relatedKeywordQuery");
        if (!relatedQuery) return;
        
        const keywords = relatedQuery.value
          .trim()
          .split("\n")
          .filter((k) => k.trim() !== "");
        const countEl = document.getElementById("relatedKeywordCount");
        if (countEl) {
          countEl.textContent = keywords.length;
          if (keywords.length > 100) {
            countEl.style.color = "#dc3545";
          } else {
            countEl.style.color = "#666";
          }
        }
      }

      // 연관 키워드 검색 함수
      async function performRelatedKeywordSearch(query) {
        try {
          // 줄바꿈 또는 쉼표로 구분된 키워드들을 개별적으로 검색
          const keywords = query
            .split(/[,\n]/)
            .map((k) => k.trim())
            .filter((k) => k !== "");
          
          const seedKeywordItems = []; // 시드 키워드 항목 (맨 앞에 표시)
          const allRelatedKeywords = []; // 연관 키워드 항목
          const searchedKeywordSet = new Set(keywords.map(k => k.toLowerCase().replace(/\s+/g, "")));

          console.log("=== 연관 키워드 검색 시작 ===");
          console.log("시드 키워드:", keywords);

          // 1단계: 각 시드 키워드에 대한 직접 검색 수행 (시드 키워드 자체의 데이터 가져오기)
          for (const keyword of keywords) {
            try {
              console.log(`시드 키워드 "${keyword}" 직접 검색 중...`);
              const searchData = await performSearch(keyword);
              const searchItems = searchData.keywordList || [];
              
              // 시드 키워드와 정확히 일치하는 항목 찾기
              const seedItem = searchItems.find((item) => {
                const itemKeyword = extractKeyword(item);
                const normalizedItemKeyword = itemKeyword.toLowerCase().replace(/\s+/g, "");
                const normalizedSeedKeyword = keyword.toLowerCase().replace(/\s+/g, "");
                return normalizedItemKeyword === normalizedSeedKeyword;
              });
              
              if (seedItem) {
                // 중복 방지: 이미 추가되지 않은 경우만 추가
                const alreadyAdded = seedKeywordItems.some(seedItem => {
                  const seedItemKeyword = extractKeyword(seedItem);
                  return seedItemKeyword.toLowerCase().replace(/\s+/g, "") === keyword.toLowerCase().replace(/\s+/g, "");
                });
                if (!alreadyAdded) {
                  seedKeywordItems.push(seedItem);
                  console.log(`✓ 시드 키워드 데이터 추가: "${extractKeyword(seedItem)}"`);
                }
              } else {
                console.warn(`⚠ 시드 키워드 "${keyword}"의 데이터를 찾을 수 없습니다.`);
              }
            } catch (error) {
              console.warn(`시드 키워드 "${keyword}" 직접 검색 실패:`, error);
              // 시드 키워드 검색 실패해도 연관 키워드 검색은 계속 진행
            }
          }

          // 2단계: 각 시드 키워드에 대한 연관 키워드 검색 수행
          for (const keyword of keywords) {
            try {
              const apiUrl = `${API_BASE_URL}/api/related-keywords?seed=${encodeURIComponent(keyword)}`;
              console.log(`연관 키워드 API 호출: ${apiUrl}`);
              
              let response;
              try {
                response = await fetch(apiUrl, {
                  method: "GET",
                  headers: {
                    "Content-Type": "application/json",
                  },
                });
              } catch (fetchError) {
                // 네트워크 오류
                console.error("Fetch 오류:", fetchError);
                const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                if (isLocal) {
                  throw new Error(`로컬 서버에 연결할 수 없습니다.\n\n해결 방법:\n1. 터미널에서 "node server.js" 실행\n2. 또는 "서버시작.bat" 파일 실행\n3. 포트 3003이 사용 가능한지 확인`);
                } else {
                  throw new Error(`백엔드 서버에 연결할 수 없습니다.\n\n서버 상태를 확인 중입니다. 잠시만 기다려주세요.\n만약 문제가 지속되면 관리자에게 문의하세요.`);
                }
              }

              if (!response.ok) {
                if (response.status === 404) {
                  throw new Error(`서버에서 연관 키워드 API를 찾을 수 없습니다 (404). 서버가 실행 중인지 확인해주세요.`);
                } else if (response.status === 500) {
                  const errorData = await response.json().catch(() => ({}));
                  throw new Error(`서버 오류 (500): ${errorData.error || '서버 내부 오류가 발생했습니다.'}`);
                } else {
                  const errorData = await response.json().catch(() => ({}));
                  throw new Error(`API 오류 (${response.status}): ${errorData.error || '알 수 없는 오류'}`);
                }
              }

              const data = await response.json();
              const items = data.keywordList || [];
            
            console.log(`"${keyword}"에 대한 연관 키워드 ${items.length}개 수신`);
            
            // 연관 키워드만 필터링 (시드 키워드는 이미 위에서 추가했으므로 제외)
            items.forEach((item) => {
              const itemKeyword = extractKeyword(item);
              const normalizedItemKeyword = itemKeyword.toLowerCase().replace(/\s+/g, "");
              
              // 시드 키워드가 아닌 경우만 연관 키워드 배열에 추가
              if (!searchedKeywordSet.has(normalizedItemKeyword)) {
                // 중복 방지: 이미 추가되지 않은 경우만 추가
                const alreadyAdded = allRelatedKeywords.some(relatedItem => {
                  const relatedItemKeyword = extractKeyword(relatedItem);
                  return relatedItemKeyword.toLowerCase().replace(/\s+/g, "") === normalizedItemKeyword;
                });
                if (!alreadyAdded) {
                  allRelatedKeywords.push(item);
                }
              }
            });

              console.log(`"${keyword}" - 연관 키워드 ${allRelatedKeywords.length}개 추가됨`);
            } catch (error) {
              console.error(`키워드 "${keyword}"에 대한 연관 키워드 검색 오류:`, error);
              // 첫 번째 키워드에서 오류가 발생하면 전체 검색 중단하고 오류 전파
              if (keywords.length === 1 || keyword === keywords[0]) {
                throw error;
              }
              // 여러 키워드 중 일부만 실패한 경우 경고만 표시하고 계속 진행
              console.warn(`키워드 "${keyword}"에 대한 연관 키워드 검색 실패, 다른 키워드 계속 검색`);
            }
          }

          // 시드 키워드를 맨 앞에, 연관 키워드를 그 다음에 배치
          const finalKeywordList = [...seedKeywordItems, ...allRelatedKeywords];
          
          console.log(`총 결과: 시드 키워드 ${seedKeywordItems.length}개 + 연관 키워드 ${allRelatedKeywords.length}개 = ${finalKeywordList.length}개`);
          console.log("시드 키워드 목록:", seedKeywordItems.map(item => extractKeyword(item)));
          console.log("=====================");

          return { keywordList: finalKeywordList };
        } catch (error) {
          console.error("Related keyword search error:", error);
          
          // 연결 오류인 경우 더 명확한 메시지 제공
          if (error.message.includes('Failed to fetch') || 
              error.message.includes('ERR_CONNECTION_REFUSED') ||
              error.message.includes('서버에 연결할 수 없습니다')) {
            const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            if (isLocal) {
              throw new Error(`❌ 로컬 서버 연결 실패\n\n백엔드 서버가 실행되지 않았습니다.\n\n해결 방법:\n1. 터미널을 열고 프로젝트 폴더로 이동\n2. "node server.js" 명령어 실행\n3. 또는 "서버시작.bat" 파일을 더블클릭\n\n서버는 포트 3003에서 실행되어야 합니다.`);
            } else {
              throw new Error(`❌ 서버 연결 실패\n\n백엔드 서버가 일시적으로 응답하지 않습니다.\n잠시 후 다시 시도해주세요.\n\n문제가 지속되면 관리자에게 문의하세요.`);
            }
          }
          
          if (error.message.includes("fetch")) {
            throw new Error(
              `백엔드 서버에 연결할 수 없습니다. 서버가 실행 중인지 확인해주세요.\n\n오류: ${error.message}`
            );
          }
          throw error;
        }
      }

      // 연관 키워드 결과 렌더링
      function renderRelatedKeywordResults(data, query) {
        const items = data.keywordList || [];
        const relatedResultsDiv = document.getElementById("relatedResultsDiv");
        const relatedStatsDiv = document.getElementById("relatedStatsDiv");

        if (!relatedResultsDiv) {
          console.error("relatedResultsDiv 요소를 찾을 수 없습니다.");
          return;
        }

        if (items.length === 0) {
          relatedKeywordResults = [];
          relatedResultsDiv.innerHTML = `
            <div class="error">
              <h3>연관 키워드 검색 결과가 없습니다</h3>
              <p>"${query}"에 대한 연관 키워드를 찾을 수 없습니다.</p>
              <small>시드 키워드를 확인하거나 다른 키워드로 시도해보세요.</small>
            </div>
          `;
          // 연관키워드 탭인 경우에만 미리보기 테이블 업데이트
          const relatedKeywordsTab = document.getElementById('related-keywords');
          if (relatedKeywordsTab && relatedKeywordsTab.classList.contains('active')) {
            updateRelatedPreviewTable();
          }
          return;
        }

        relatedKeywordResults = items;
        relatedCurrentPage = 1;

        // 연관키워드 탭인 경우에만 미리보기 테이블 업데이트
        const relatedKeywordsTab = document.getElementById('related-keywords');
        if (relatedKeywordsTab && relatedKeywordsTab.classList.contains('active')) {
          // 통계 정보
          if (relatedStatsDiv) {
            const keywordCount = query.split(/[,\n]/).filter((k) => k.trim()).length;
            relatedStatsDiv.innerHTML = `
              <strong>${keywordCount}개 시드 키워드</strong>에 대한 연관 키워드 
              <strong>${items.length}</strong>개 표시
            `;
            relatedStatsDiv.style.display = "block";
          }

          // 미리보기 테이블 업데이트 (전체 결과 표시)
          updateRelatedPreviewTable();
        }
        
        // 상단 테이블 렌더링 (페이지네이션 포함)
        renderRelatedKeywordTable();
      }

      // 연관 키워드 테이블 렌더링
      function renderRelatedKeywordTable() {
        const relatedResultsDiv = document.getElementById("relatedResultsDiv");
        if (!relatedResultsDiv) {
          console.error("relatedResultsDiv 요소를 찾을 수 없습니다.");
          return;
        }

        const totalPages = Math.ceil(relatedKeywordResults.length / relatedItemsPerPage);
        const startIndex = (relatedCurrentPage - 1) * relatedItemsPerPage;
        const endIndex = startIndex + relatedItemsPerPage;
        const currentData = relatedKeywordResults.slice(startIndex, endIndex);

        const paginationInfo =
          totalPages > 1
            ? `${relatedCurrentPage}/${totalPages} 페이지 (${startIndex + 1}-${endIndex}번째 / 총 ${relatedKeywordResults.length}개)`
            : `총 ${relatedKeywordResults.length}개`;

        const tableHtml = `
          <div class="results-table">
            <div class="table-header">
              <span>연관 키워드 검색 결과</span>
              <div style="display: flex; gap: 10px; align-items: center;">
                <button onclick="downloadRelatedKeywords()" style="padding: 8px 16px; background: var(--accent-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease;">
                  선택된 키워드 다운로드
                </button>
                <span class="pagination-info">${paginationInfo}</span>
              </div>
            </div>
            <div class="table-container">
              <table class="keyword-table">
                <thead>
                  <tr>
                    <th class="checkbox-cell">
                      <input type="checkbox" id="relatedSelectAll" onchange="toggleRelatedAllCheckboxes()">
                    </th>
                    <th>NO</th>
                    <th>연관키워드</th>
                    <th>월간검색수<br>PC</th>
                    <th>월간검색수<br>모바일</th>
                    <th>검색수합계</th>
                    <th>월평균클릭수<br>PC</th>
                    <th>월평균클릭수<br>모바일</th>
                    <th>월평균클릭율<br>PC</th>
                    <th>월평균클릭율<br>모바일</th>
                    <th>경쟁정도</th>
                    <th>월평균노출<br>광고수</th>
                  </tr>
                </thead>
                <tbody>
                  ${currentData
                    .map((item, index) => {
                      const globalIndex = startIndex + index + 1;
                      const keyword = extractKeyword(item);
                      const pcCount = sanitizeData(item.monthlyPcQcCnt);
                      const mobileCount = sanitizeData(item.monthlyMobileQcCnt);
                      const totalCount = pcCount + mobileCount;
                      const pcClick = parseFloat(item.monthlyAvePcClkCnt) || 0;
                      const mobileClick = parseFloat(item.monthlyAveMobileClkCnt) || 0;
                      const pcCtr = parseFloat(item.monthlyAvePcCtr) || 0;
                      const mobileCtr = parseFloat(item.monthlyAveMobileCtr) || 0;
                      const competition = sanitizeData(item.compIdx, "string");
                      const adCount = extractAdCount(item);

                      let competitionClass = "";
                      if (competition === "높음") competitionClass = "competition-high";
                      else if (competition === "중간") competitionClass = "competition-medium";
                      else if (competition === "낮음") competitionClass = "competition-low";

                      return `
                        <tr>
                          <td class="checkbox-cell">
                            <input type="checkbox" name="relatedKeywordCheck" value="${keyword}">
                          </td>
                          <td>${globalIndex}</td>
                          <td class="keyword-cell">
                            <span class="keyword-link" onclick="showKeywordChart('${keyword}', ${JSON.stringify(item).replace(/"/g, "&quot;")})">
                              ${keyword}
                            </span>
                          </td>
                          <td class="number-cell">${pcCount.toLocaleString()}</td>
                          <td class="number-cell">${mobileCount.toLocaleString()}</td>
                          <td class="number-cell" style="font-weight: 700; color: #2c3e50;">${totalCount.toLocaleString()}</td>
                          <td class="number-cell">${pcClick}</td>
                          <td class="number-cell">${mobileClick}</td>
                          <td>${pcCtr.toFixed(2)}%</td>
                          <td>${mobileCtr.toFixed(2)}%</td>
                          <td class="competition-cell ${competitionClass}">${competition}</td>
                          <td class="number-cell">${adCount.toLocaleString()}</td>
                        </tr>
                      `;
                    })
                    .join("")}
                </tbody>
              </table>
            </div>
          </div>
          ${renderRelatedKeywordPagination(totalPages)}
        `;

        relatedResultsDiv.innerHTML = tableHtml;
      }

      // 연관 키워드 페이지네이션 렌더링
      function renderRelatedKeywordPagination(totalPages) {
        if (totalPages <= 1) return "";

        let paginationHtml = `
          <div class="pagination-container">
            <div class="pagination">
              <button class="pagination-btn nav-btn ${relatedCurrentPage === 1 ? "disabled" : ""}" 
                      onclick="goToRelatedPage(1)" ${relatedCurrentPage === 1 ? "disabled" : ""}>
                <i class="fas fa-angle-double-left"></i> 처음
              </button>
              <button class="pagination-btn nav-btn ${relatedCurrentPage === 1 ? "disabled" : ""}" 
                      onclick="goToRelatedPage(${relatedCurrentPage - 1})" ${relatedCurrentPage === 1 ? "disabled" : ""}>
                <i class="fas fa-angle-left"></i> 이전
              </button>
        `;

        const startPage = Math.max(1, relatedCurrentPage - 5);
        const endPage = Math.min(totalPages, relatedCurrentPage + 5);

        if (startPage > 1) {
          paginationHtml += `<button class="pagination-btn" onclick="goToRelatedPage(1)">1</button>`;
          if (startPage > 2) {
            paginationHtml += `<span class="pagination-btn disabled">...</span>`;
          }
        }

        for (let i = startPage; i <= endPage; i++) {
          paginationHtml += `
            <button class="pagination-btn ${i === relatedCurrentPage ? "active" : ""}" 
                    onclick="goToRelatedPage(${i})">${i}</button>
          `;
        }

        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            paginationHtml += `<span class="pagination-btn disabled">...</span>`;
          }
          paginationHtml += `<button class="pagination-btn" onclick="goToRelatedPage(${totalPages})">${totalPages}</button>`;
        }

        paginationHtml += `
              <button class="pagination-btn nav-btn ${relatedCurrentPage === totalPages ? "disabled" : ""}" 
                      onclick="goToRelatedPage(${relatedCurrentPage + 1})" ${relatedCurrentPage === totalPages ? "disabled" : ""}>
                다음 <i class="fas fa-angle-right"></i>
              </button>
              <button class="pagination-btn nav-btn ${relatedCurrentPage === totalPages ? "disabled" : ""}" 
                      onclick="goToRelatedPage(${totalPages})" ${relatedCurrentPage === totalPages ? "disabled" : ""}>
                마지막 <i class="fas fa-angle-double-right"></i>
              </button>
            </div>
            <div class="pagination-jump">
              <span>페이지 이동:</span>
              <input type="number" id="relatedPageJumpInput" min="1" max="${totalPages}" value="${relatedCurrentPage}">
              <button onclick="jumpToRelatedPage()">이동</button>
            </div>
          </div>
        `;

        return paginationHtml;
      }

      // 연관 키워드 미리보기 테이블 업데이트 함수 (전체 결과 표시)
      function updateRelatedPreviewTable() {
        const previewBody = document.getElementById('previewTableBody');
        if (!previewBody) return;
        
        // 현재 탭이 연관키워드 탭인지 확인
        const relatedKeywordsTab = document.getElementById('related-keywords');
        if (!relatedKeywordsTab || !relatedKeywordsTab.classList.contains('active')) {
          return; // 연관키워드 탭이 아니면 업데이트하지 않음
        }
        
        if (!relatedKeywordResults || relatedKeywordResults.length === 0) {
          previewBody.innerHTML = `
            <tr>
              <td colspan="12" class="empty-table-message">
                연관 키워드를 검색하십시오.
              </td>
            </tr>
          `;
          return;
        }
        
        // 전체 결과 표시
        previewBody.innerHTML = relatedKeywordResults.map((item, index) => {
          const keyword = extractKeyword(item);
          const pcCount = sanitizeData(item.monthlyPcQcCnt);
          const mobileCount = sanitizeData(item.monthlyMobileQcCnt);
          const totalCount = pcCount + mobileCount;
          const pcClick = parseFloat(item.monthlyAvePcClkCnt) || 0;
          const mobileClick = parseFloat(item.monthlyAveMobileClkCnt) || 0;
          const pcCtr = parseFloat(item.monthlyAvePcCtr) || 0;
          const mobileCtr = parseFloat(item.monthlyAveMobileCtr) || 0;
          const competition = sanitizeData(item.compIdx, "string");
          const adCount = extractAdCount(item);
          
          let competitionClass = "";
          if (competition === "높음") competitionClass = "competition-high";
          else if (competition === "중간") competitionClass = "competition-medium";
          else if (competition === "낮음") competitionClass = "competition-low";
          
          return `
            <tr>
              <td class="checkbox-cell">
                <input type="checkbox" name="previewRelatedKeywordCheck" value="${keyword}">
              </td>
              <td>${index + 1}</td>
              <td class="keyword-cell">
                <span class="keyword-link" onclick="showKeywordChart('${keyword}', ${JSON.stringify(item).replace(/"/g, "&quot;")})">
                  ${keyword}
                </span>
              </td>
              <td class="number-cell">${pcCount.toLocaleString()}</td>
              <td class="number-cell">${mobileCount.toLocaleString()}</td>
              <td class="number-cell" style="font-weight: 700; color: var(--text-primary);">${totalCount.toLocaleString()}</td>
              <td class="number-cell">${pcClick.toLocaleString()}</td>
              <td class="number-cell">${mobileClick.toLocaleString()}</td>
              <td>${pcCtr.toFixed(2)}%</td>
              <td>${mobileCtr.toFixed(2)}%</td>
              <td class="competition-cell ${competitionClass}">${competition || '-'}</td>
              <td class="number-cell">${adCount.toLocaleString()}</td>
            </tr>
          `;
        }).join('');
      }
      
      // 연관 키워드 페이지 이동
      function goToRelatedPage(page) {
        const totalPages = Math.ceil(relatedKeywordResults.length / relatedItemsPerPage);
        if (page < 1 || page > totalPages) return;

        relatedCurrentPage = page;
        renderRelatedKeywordTable();

        const relatedResultsDiv = document.getElementById("relatedResultsDiv");
        if (relatedResultsDiv) {
          relatedResultsDiv.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }

      function jumpToRelatedPage() {
        const pageInput = document.getElementById("relatedPageJumpInput");
        const page = parseInt(pageInput.value);
        const totalPages = Math.ceil(relatedKeywordResults.length / relatedItemsPerPage);

        if (page >= 1 && page <= totalPages) {
          goToRelatedPage(page);
        } else {
          alert(`1부터 ${totalPages} 사이의 페이지 번호를 입력해주세요.`);
          pageInput.value = relatedCurrentPage;
        }
      }

      // 연관 키워드 전체 선택/해제
      function toggleRelatedAllCheckboxes() {
        const selectAll = document.getElementById("relatedSelectAll");
        const checkboxes = document.querySelectorAll('input[name="relatedKeywordCheck"]');
        checkboxes.forEach((checkbox) => {
          checkbox.checked = selectAll.checked;
        });
      }


      // 서버 상태 확인
      async function checkServerStatus() {
        // serverStatus 요소가 없으면 함수 종료 (선택적 기능)
        if (!serverStatus || !statusText) {
          return true; // 요소가 없어도 오류로 처리하지 않음
        }

        try {
          const response = await fetch(`${API_BASE_URL}/api/health`);
          if (response.ok) {
            serverStatus.className = "server-status";
            statusText.textContent =
              "✅ 백엔드 서버가 정상적으로 실행 중입니다.";
            serverStatus.style.display = "block";
            return true;
          }
        } catch (error) {
          serverStatus.className = "server-status offline";
          statusText.innerHTML = `
                    ❌ 백엔드 서버에 연결할 수 없습니다.<br>
                    <strong>naver_search.js</strong>를 실행했는지 확인해주세요. (node naver_search.js)
                `;
          serverStatus.style.display = "block";
          return false;
        }
        return false;
      }

      // 검색 함수 (키워드 검색만 사용)
      async function performSearch(query) {
        try {
          const response = await fetch(`${API_BASE_URL}/api/keywords`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ DataQ: query }),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || `서버 오류: ${response.status}`);
          }

          const data = await response.json();
          return data;
        } catch (error) {
          console.error("Search error:", error);
          if (error.message.includes("fetch")) {
            throw new Error(
              "백엔드 서버에 연결할 수 없습니다. 서버가 실행 중인지 확인해주세요."
            );
          }
          throw error;
        }
      }

      // HTML 태그 제거 함수
      function stripHtml(html) {
        const tmp = document.createElement("div");
        tmp.innerHTML = html;
        return tmp.textContent || tmp.innerText || "";
      }

      // 데이터 정제 함수
      function sanitizeData(value, type = "number") {
        if (
          value === null ||
          value === undefined ||
          value === "" ||
          value === "NaN"
        ) {
          return type === "number" ? 0 : "-";
        }

        if (type === "number") {
          const num = parseInt(value);
          return isNaN(num) ? 0 : num;
        } else {
          return String(value).trim() || "-";
        }
      }

      // 키워드 추출 함수
      function extractKeyword(item) {
        // 다양한 키워드 필드명 시도
        const possibleFields = [
          "relKeyword",
          "keyword",
          "searchKeyword",
          "word",
          "term",
        ];

        for (let field of possibleFields) {
          if (item[field] && String(item[field]).trim() !== "") {
            return String(item[field]).trim();
          }
        }

        return "키워드 없음";
      }

      // 광고수 데이터 추출 함수
      function extractAdCount(item) {
        // 네이버 API에서 사용하는 실제 필드명들
        const possibleAdFields = [
          "plAvgDepth", // 네이버 키워드 도구에서 주로 사용
          "monthlyAveAd",
          "monthlyAverageAd",
          "adExposureCount",
          "avgAdCount",
          "adCount",
          "exposureAdCount",
          "avgDepth",
          "depth",
        ];

        for (let field of possibleAdFields) {
          if (
            item[field] !== null &&
            item[field] !== undefined &&
            item[field] !== ""
          ) {
            const num = parseFloat(item[field]);
            if (!isNaN(num)) {
              return num;
            }
          }
        }

        // 디버깅: 어떤 필드가 있는지 확인
        console.log(
          "광고수 필드 찾기 실패. 사용 가능한 필드들:",
          Object.keys(item)
        );
        return 0;
      }

      // 정렬 상태 관리
      let currentSort = {
        column: null,
        direction: "desc",
      };

      // 정렬 함수
      function sortResults(column) {
        if (currentSort.column === column) {
          currentSort.direction =
            currentSort.direction === "desc" ? "asc" : "desc";
        } else {
          currentSort.column = column;
          currentSort.direction = "desc";
        }

        allResults.sort((a, b) => {
          let aValue, bValue;

          switch (column) {
            case "keyword":
              aValue = (a.relKeyword || a.keyword || "").toLowerCase();
              bValue = (b.relKeyword || b.keyword || "").toLowerCase();
              break;
            case "pcCount":
              aValue = sanitizeData(a.monthlyPcQcCnt);
              bValue = sanitizeData(b.monthlyPcQcCnt);
              break;
            case "mobileCount":
              aValue = sanitizeData(a.monthlyMobileQcCnt);
              bValue = sanitizeData(b.monthlyMobileQcCnt);
              break;
            case "totalCount":
              aValue =
                sanitizeData(a.monthlyPcQcCnt) +
                sanitizeData(a.monthlyMobileQcCnt);
              bValue =
                sanitizeData(b.monthlyPcQcCnt) +
                sanitizeData(b.monthlyMobileQcCnt);
              break;
            case "pcClick":
              aValue = sanitizeData(a.monthlyAvePcClkCnt);
              bValue = sanitizeData(b.monthlyAvePcClkCnt);
              break;
            case "mobileClick":
              aValue = sanitizeData(a.monthlyAveMobileClkCnt);
              bValue = sanitizeData(b.monthlyAveMobileClkCnt);
              break;
            case "pcCtr":
              aValue = parseFloat(a.monthlyAvePcCtr) || 0;
              bValue = parseFloat(b.monthlyAvePcCtr) || 0;
              break;
            case "mobileCtr":
              aValue = parseFloat(a.monthlyAveMobileCtr) || 0;
              bValue = parseFloat(b.monthlyAveMobileCtr) || 0;
              break;
            case "competition":
              const compOrder = { 높음: 3, 중간: 2, 낮음: 1, "-": 0 };
              aValue = compOrder[a.compIdx] || 0;
              bValue = compOrder[b.compIdx] || 0;
              break;
            case "adCount":
              aValue = sanitizeData(a.monthlyAveAd);
              bValue = sanitizeData(b.monthlyAveAd);
              break;
            default:
              return 0;
          }

          if (typeof aValue === "string") {
            return currentSort.direction === "desc"
              ? bValue.localeCompare(aValue)
              : aValue.localeCompare(bValue);
          } else {
            return currentSort.direction === "desc"
              ? bValue - aValue
              : aValue - bValue;
          }
        });

        currentPage = 1; // 정렬 후 첫 페이지로 이동
        renderCurrentPage();
      }

      // 검색 결과 렌더링 (페이지네이션 적용)
      function renderResults(data, query) {
        const allItems = data.keywordList || [];
        
        // 입력한 키워드 목록 저장 (원본과 정규화된 버전 모두 저장)
        const rawKeywords = query
          .split("\n")
          .map((k) => k.trim())
          .filter((k) => k !== "");
        
        // 정규화: 공백 제거, 소문자 변환 (비교용)
        searchedKeywords = rawKeywords.map((k) => k.toLowerCase().replace(/\s+/g, ""));

        // 디버깅: API 응답 구조 확인
        console.log("=== 키워드 조회 필터링 디버깅 ===");
        console.log("입력한 원본 키워드:", rawKeywords);
        console.log("정규화된 키워드:", searchedKeywords);
        console.log("전체 API 응답 키워드 수:", allItems.length);
        if (allItems.length > 0) {
          console.log("첫 번째 아이템 키워드:", extractKeyword(allItems[0]));
          console.log("첫 번째 아이템의 모든 키:", Object.keys(allItems[0]));
        }
        console.log("=====================");

        // 전체 결과 저장 (나중에 연관 키워드 탭에서 사용)
        allKeywordResults = allItems;

        // 입력한 키워드만 필터링 (키워드 조회 탭용)
        // 네이버 API는 입력한 키워드와 정확히 일치하는 것도 반환하므로, 정확히 일치하는 것만 필터링
        const items = allItems.filter((item) => {
          const itemKeyword = extractKeyword(item);
          // 공백 제거하고 소문자로 변환하여 비교
          const normalizedItemKeyword = itemKeyword.toLowerCase().replace(/\s+/g, "");
          
          // 입력한 키워드 중 하나와 정확히 일치하는지 확인
          const isExactMatch = searchedKeywords.some((searched) => {
            return normalizedItemKeyword === searched;
          });
          
          if (isExactMatch) {
            console.log(`✓ 일치: "${itemKeyword}" (정규화: "${normalizedItemKeyword}")`);
          }
          
          return isExactMatch;
        });
        
        console.log(`필터링 결과: ${items.length}개 (전체 ${allItems.length}개 중)`);

        if (items.length === 0) {
          resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>검색 결과가 없습니다</h3>
                        <p>"${query}"에 대한 키워드 결과를 찾을 수 없습니다.</p>
                    </div>
                `;
          return;
        }

        // 입력한 키워드 결과만 저장 및 페이지 초기화
        allResults = items;
        currentPage = 1;
        currentSort = { column: null, direction: "desc" }; // 정렬 상태 초기화

        // 키워드 조회 탭인 경우에만 미리보기 테이블 업데이트
        const keywordSearchTab = document.getElementById('keyword-search');
        if (keywordSearchTab && keywordSearchTab.classList.contains('active')) {
          // 키워드 조회 결과 섹션 표시
          const previewSection = document.getElementById("keywordPreviewSection");
          if (previewSection) {
            previewSection.style.display = "block";
          }

          // 통계 정보
          statsDiv.innerHTML = `
                <strong>${
                  searchedKeywords.length
                }개 키워드</strong>에 대한 검색 결과 
                <strong>${items.length}</strong>개 표시
                <span style="color: var(--text-secondary); font-size: 13px;">
                  (연관 키워드 ${allItems.length - items.length}개는 연관 키워드 탭에서 확인하세요)
                </span>
            `;
          statsDiv.style.display = "block";

          // 키워드 조회 탭에서는 상단 테이블 숨기고 미리보기 테이블만 표시
          resultsDiv.innerHTML = "";
          
          // 미리보기 테이블 업데이트 (전체 결과 표시)
          updatePreviewTable();
        }
      }
      
      // 미리보기 테이블 업데이트 함수 (전체 결과 표시)
      function updatePreviewTable() {
        const previewBody = document.getElementById('previewTableBody');
        if (!previewBody) return;
        
        // 현재 탭이 키워드 조회 탭인지 확인
        const keywordSearchTab = document.getElementById('keyword-search');
        if (!keywordSearchTab || !keywordSearchTab.classList.contains('active')) {
          return; // 키워드 조회 탭이 아니면 업데이트하지 않음
        }
        
        if (!allResults || allResults.length === 0) {
          previewBody.innerHTML = `
            <tr>
              <td colspan="12" class="empty-table-message">
                키워드를 조회하십시오.
              </td>
            </tr>
          `;
          return;
        }
        
        // 전체 결과 표시
        previewBody.innerHTML = allResults.map((item, index) => {
          const keyword = extractKeyword(item);
          const pcCount = sanitizeData(item.monthlyPcQcCnt);
          const mobileCount = sanitizeData(item.monthlyMobileQcCnt);
          const totalCount = pcCount + mobileCount;
          const pcClick = parseFloat(item.monthlyAvePcClkCnt) || 0;
          const mobileClick = parseFloat(item.monthlyAveMobileClkCnt) || 0;
          const pcCtr = parseFloat(item.monthlyAvePcCtr) || 0;
          const mobileCtr = parseFloat(item.monthlyAveMobileCtr) || 0;
          const competition = sanitizeData(item.compIdx, "string");
          const adCount = extractAdCount(item);
          
          let competitionClass = "";
          if (competition === "높음") competitionClass = "competition-high";
          else if (competition === "중간") competitionClass = "competition-medium";
          else if (competition === "낮음") competitionClass = "competition-low";
          
          return `
            <tr>
              <td class="checkbox-cell">
                <input type="checkbox" name="previewKeywordCheck" value="${keyword}">
              </td>
              <td>${index + 1}</td>
              <td class="keyword-cell">
                <span class="keyword-link" onclick="showKeywordChart('${keyword}', ${JSON.stringify(item).replace(/"/g, "&quot;")})">
                  ${keyword}
                </span>
              </td>
              <td class="number-cell">${pcCount.toLocaleString()}</td>
              <td class="number-cell">${mobileCount.toLocaleString()}</td>
              <td class="number-cell" style="font-weight: 700; color: var(--text-primary);">${totalCount.toLocaleString()}</td>
              <td class="number-cell">${pcClick.toLocaleString()}</td>
              <td class="number-cell">${mobileClick.toLocaleString()}</td>
              <td>${pcCtr.toFixed(2)}%</td>
              <td>${mobileCtr.toFixed(2)}%</td>
              <td class="competition-cell ${competitionClass}">${competition || '-'}</td>
              <td class="number-cell">${adCount.toLocaleString()}</td>
            </tr>
          `;
        }).join('');
      }
      
      // 미리보기 테이블 전체 선택/해제
      function togglePreviewAllCheckboxes() {
        const selectAll = document.getElementById("previewSelectAll");
        
        // 현재 활성화된 탭에 따라 다른 체크박스 선택
        const keywordSearchTab = document.getElementById('keyword-search');
        const relatedKeywordsTab = document.getElementById('related-keywords');
        
        if (keywordSearchTab && keywordSearchTab.classList.contains('active')) {
          // 키워드 조회 탭
          const checkboxes = document.querySelectorAll('input[name="previewKeywordCheck"]');
          checkboxes.forEach((checkbox) => {
            checkbox.checked = selectAll.checked;
          });
        } else if (relatedKeywordsTab && relatedKeywordsTab.classList.contains('active')) {
          // 연관키워드 탭
          const checkboxes = document.querySelectorAll('input[name="previewRelatedKeywordCheck"]');
          checkboxes.forEach((checkbox) => {
            checkbox.checked = selectAll.checked;
          });
        }
      }
      
      // 검색값 초기화 함수
      function resetSearchValues() {
        if (confirm('검색값을 초기화하시겠습니까?')) {
          searchQuery.value = '';
          allResults = [];
          currentPage = 1;
          resultsDiv.innerHTML = '';
          statsDiv.style.display = 'none';
          errorDiv.style.display = 'none';
          updateKeywordCount();
          updatePreviewTable();
        }
      }

      // 전체 선택/해제 기능
      function toggleAllCheckboxes() {
        const selectAll = document.getElementById("selectAll");
        const checkboxes = document.querySelectorAll(
          'input[name="keywordCheck"]'
        );

        checkboxes.forEach((checkbox) => {
          checkbox.checked = selectAll.checked;
        });
      }

      // 에러 표시
      function showError(message) {
        errorDiv.innerHTML = `
                <h3>❌ 검색 오류</h3>
                <p>${message}</p>
                <small>백엔드 서버가 실행 중인지 확인해주세요.</small>
            `;
        errorDiv.style.display = "block";
      }

      // 폼 제출 이벤트 (마우스 클릭만)
      searchBtn.addEventListener("click", async (e) => {
        e.preventDefault();

        const queryText = searchQuery.value.trim();

        if (!queryText) {
          alert("키워드를 입력해주세요.");
          return;
        }

        // 키워드 개수 확인
        const keywords = queryText.split("\n").filter((k) => k.trim() !== "");
        if (keywords.length === 0) {
          alert("최소 1개의 키워드를 입력해주세요.");
          return;
        }

        if (keywords.length > 100) {
          alert("최대 100개의 키워드까지 입력 가능합니다.");
          return;
        }

        // 다중 키워드를 쉼표로 구분하여 전송
        const query = keywords.join(",");

        // UI 상태 업데이트
        searchBtn.disabled = true;
        searchBtn.textContent = "검색 중...";
        loadingDiv.style.display = "block";
        resultsDiv.innerHTML = "";
        errorDiv.style.display = "none";
        statsDiv.style.display = "none";

        try {
          const data = await performSearch(query);
          renderResults(data, queryText);
        } catch (error) {
          showError(error.message || "검색 중 오류가 발생했습니다.");
          await checkServerStatus();
        } finally {
          // UI 상태 복원
          searchBtn.disabled = false;
          searchBtn.textContent = "검색";
          loadingDiv.style.display = "none";
        }
      });

      // textarea에서 엔터키는 줄바꿈만 실행 (검색 실행 안 함)
      searchQuery.addEventListener("keydown", (e) => {
        // 엔터키로 검색 실행 방지 - 줄바꿈만 허용
        if (e.key === "Enter") {
          // 기본 동작(줄바꿈) 허용, 검색은 실행하지 않음
          updateKeywordCount(); // 키워드 카운트 업데이트
        }
      });

      // 페이지 로드 시 초기화
      window.addEventListener("load", async () => {
        searchQuery.focus();
        updateKeywordCount(); // 초기 키워드 카운트 설정
        await checkServerStatus();
        checkLoginStatusNav(); // 로그인 상태 확인
        updatePreviewTable(); // 미리보기 테이블 초기화

        // 연관 키워드 검색 버튼 이벤트 등록 (지연 등록으로 탭이 로드된 후에도 작동)
        setTimeout(() => {
          const relatedSearchBtn = document.getElementById("relatedSearchBtn");
          const relatedKeywordQuery = document.getElementById("relatedKeywordQuery");
          
          if (relatedSearchBtn && relatedKeywordQuery) {
            console.log("연관 키워드 검색 버튼 이벤트 등록 완료");
            
            // 기존 이벤트 리스너 제거 후 새로 등록 (중복 방지)
            const newRelatedSearchBtn = relatedSearchBtn.cloneNode(true);
            relatedSearchBtn.parentNode.replaceChild(newRelatedSearchBtn, relatedSearchBtn);
            
            newRelatedSearchBtn.addEventListener("click", async (e) => {
              e.preventDefault();
              console.log("연관 키워드 검색 버튼 클릭됨");

              const queryText = relatedKeywordQuery.value.trim();

              if (!queryText) {
                alert("시드 키워드를 입력해주세요.");
                return;
              }

              const keywords = queryText.split("\n").filter((k) => k.trim() !== "");
              if (keywords.length === 0) {
                alert("최소 1개의 키워드를 입력해주세요.");
                return;
              }

              if (keywords.length > 100) {
                alert("최대 100개의 키워드까지 입력 가능합니다.");
                return;
              }

              // 줄바꿈으로 구분된 키워드를 쉼표로 변환 (performRelatedKeywordSearch에서 처리)
              const query = keywords.join(",");

              newRelatedSearchBtn.disabled = true;
              newRelatedSearchBtn.textContent = "검색 중...";
              
              const relatedLoadingDiv = document.getElementById("relatedLoadingDiv");
              const relatedResultsDiv = document.getElementById("relatedResultsDiv");
              const relatedErrorDiv = document.getElementById("relatedErrorDiv");
              const relatedStatsDiv = document.getElementById("relatedStatsDiv");
              
              if (relatedLoadingDiv) relatedLoadingDiv.style.display = "block";
              if (relatedResultsDiv) relatedResultsDiv.innerHTML = "";
              if (relatedErrorDiv) relatedErrorDiv.style.display = "none";
              if (relatedStatsDiv) relatedStatsDiv.style.display = "none";

              try {
                console.log("연관 키워드 검색 시작:", query);
                const data = await performRelatedKeywordSearch(query);
                console.log("연관 키워드 검색 완료:", data);
                renderRelatedKeywordResults(data, queryText);
              } catch (error) {
                console.error("연관 키워드 검색 오류:", error);
                if (relatedErrorDiv) {
                  // 줄바꿈을 <br>로 변환
                  const errorMessage = (error.message || "검색 중 오류가 발생했습니다.")
                    .replace(/\n/g, '<br>');
                  
                  relatedErrorDiv.innerHTML = `
                    <h3>❌ 연관 키워드 검색 오류</h3>
                    <div style="line-height: 1.6;">${errorMessage}</div>
                    <small style="display: block; margin-top: 10px; color: #666;">콘솔을 확인하여 자세한 오류 정보를 확인하세요.</small>
                  `;
                  relatedErrorDiv.style.display = "block";
                } else {
                  alert(`연관 키워드 검색 오류: ${error.message || "알 수 없는 오류"}`);
                }
              } finally {
                newRelatedSearchBtn.disabled = false;
                newRelatedSearchBtn.textContent = "연관 키워드 검색";
                if (relatedLoadingDiv) relatedLoadingDiv.style.display = "none";
              }
            });

            relatedKeywordQuery.addEventListener("input", updateRelatedKeywordCount);
          } else {
            console.warn("연관 키워드 검색 요소를 찾을 수 없습니다:", {
              relatedSearchBtn: !!relatedSearchBtn,
              relatedKeywordQuery: !!relatedKeywordQuery
            });
          }
        }, 100); // DOM이 완전히 로드될 때까지 약간의 지연
      });

      // 로그인 상태 확인 및 UI 업데이트
      function checkLoginStatusNav() {
        const isLoggedIn = localStorage.getItem("isLoggedIn");
        const userData = localStorage.getItem("userData");

        const loginBtn = document.querySelector(".login-btn");
        const signupBtns = document.querySelectorAll(".signup-btn");

        if (isLoggedIn === "true" && userData) {
          try {
            const user = JSON.parse(userData);

            // 로그인 버튼 숨기기
            if (loginBtn) loginBtn.style.display = "none";

            // 회원가입 버튼은 로그아웃 버튼으로 변경
            if (signupBtns.length > 0) {
              signupBtns[0].textContent = "로그아웃";
              signupBtns[0].onclick = function (e) {
                e.preventDefault();
                if (confirm("로그아웃 하시겠습니까?")) {
                  localStorage.removeItem("isLoggedIn");
                  localStorage.removeItem("userData");
                  location.href = "index.html";
                }
              };
            }
          } catch (e) {
            console.error("로그인 정보 파싱 오류:", e);
            localStorage.removeItem("isLoggedIn");
            localStorage.removeItem("userData");
          }
        } else {
          // 로그인하지 않은 상태
          if (loginBtn) loginBtn.style.display = "inline-block";
          signupBtns.forEach((btn) => (btn.style.display = "inline-block"));
        }
      }
      // 로그인 상태 UI 업데이트 (localStorage 우선, Supabase 세션 확인)
      async function updateAuthUI() {
        const authUser = document.getElementById("authUser");
        const loginBtn = document.getElementById("loginBtn");
        const signupBtn = document.getElementById("signupBtn");
        const userAvatar = document.getElementById("userAvatar");
        const userEmailSpan = document.getElementById("userEmail");
        const logoutBtn = document.getElementById("logoutBtn");

        let currentUser = null;

        // 먼저 localStorage에서 사용자 정보 확인 (빠른 초기 렌더링)
        const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
        const rawUser = localStorage.getItem("userData");
        
        if (isLoggedIn && rawUser) {
          try {
            currentUser = JSON.parse(rawUser);
            console.log('[naver_search] localStorage 사용자 정보:', { email: currentUser.email });
            
            // 즉시 UI 업데이트
            if (loginBtn) loginBtn.style.display = "none";
            if (signupBtn) signupBtn.style.display = "none";
            if (authUser) authUser.style.display = "flex";
            if (userEmailSpan) {
              userEmailSpan.textContent = currentUser.email || "마이페이지";
              userEmailSpan.title = currentUser.email ? `${currentUser.email} (마이페이지로 이동)` : "클릭하여 마이페이지로 이동";
            }
            if (userAvatar) {
              const base = currentUser.displayName || currentUser.email || "U";
              userAvatar.textContent = (base.trim()[0] || "U").toUpperCase();
            }
            if (logoutBtn) {
              logoutBtn.style.display = "inline-flex";
              logoutBtn.onclick = async function () {
                if (!confirm("로그아웃 하시겠습니까?")) return;
                try {
                  if (window.authState?.signOut) {
                    await window.authState.signOut();
                  }
                } finally {
                  localStorage.removeItem("isLoggedIn");
                  localStorage.removeItem("userData");
                  location.href = "./login.html";
                }
              };
            }
            setEbookDownloadUser(currentUser);
          } catch (error) {
            console.error("[naver_search] userData 파싱 오류:", error);
            currentUser = null;
          }
        }

        // Supabase 세션 확인 (auth-state.js가 로드된 경우)
        if (window.authState?.supabase) {
          try {
            const { data } = await window.authState.supabase.auth.getSession();
            const session = data?.session;
            
            if (session?.user) {
              // Supabase 세션이 있으면 Supabase 사용자 정보 사용
              currentUser = {
                email: session.user.email,
                displayName: session.user.user_metadata?.full_name || session.user.email,
                id: session.user.id
              };
              
              console.log('[naver_search] Supabase 세션 확인됨:', { email: currentUser.email });
              
              // UI 업데이트
              if (loginBtn) loginBtn.style.display = "none";
              if (signupBtn) signupBtn.style.display = "none";
              if (authUser) authUser.style.display = "flex";
              if (userEmailSpan) {
                userEmailSpan.textContent = currentUser.email || "마이페이지";
                userEmailSpan.title = currentUser.email ? `${currentUser.email} (마이페이지로 이동)` : "클릭하여 마이페이지로 이동";
              }
              if (userAvatar) {
                const base = currentUser.displayName || currentUser.email || "U";
                userAvatar.textContent = (base.trim()[0] || "U").toUpperCase();
              }
              if (logoutBtn) {
                logoutBtn.style.display = "inline-flex";
                logoutBtn.onclick = async function () {
                  if (!confirm("로그아웃 하시겠습니까?")) return;
                  try {
                    if (window.authState?.signOut) {
                      await window.authState.signOut();
                    }
                  } finally {
                    localStorage.removeItem("isLoggedIn");
                    localStorage.removeItem("userData");
                    location.href = "./login.html";
                  }
                };
              }
            setEbookDownloadUser(currentUser);
            } else if (!isLoggedIn || !rawUser) {
              // 세션이 없고 localStorage에도 없으면 로그아웃 상태
              if (authUser) authUser.style.display = "none";
              if (loginBtn) loginBtn.style.display = "inline-flex";
              if (signupBtn) signupBtn.style.display = "inline-flex";
              if (logoutBtn) logoutBtn.style.display = "none";
            }
          } catch (error) {
            console.error("[naver_search] Supabase 세션 확인 오류:", error);
            // 에러 발생 시 localStorage 기반으로 유지
            if (!currentUser) {
              if (authUser) authUser.style.display = "none";
              if (loginBtn) loginBtn.style.display = "inline-flex";
              if (signupBtn) signupBtn.style.display = "inline-flex";
              if (logoutBtn) logoutBtn.style.display = "none";
            }
          }
        } else if (!currentUser) {
          // auth-state.js가 없고 localStorage에도 없으면 로그아웃 상태
          if (authUser) authUser.style.display = "none";
          if (loginBtn) loginBtn.style.display = "inline-flex";
          if (signupBtn) signupBtn.style.display = "inline-flex";
          if (logoutBtn) logoutBtn.style.display = "none";
        }
      }

      // 페이지 로드 시 실행
      (async function() {
        // 즉시 localStorage 기반으로 UI 업데이트 (빠른 초기 렌더링)
        await updateAuthUI();
        
        // auth-state.js가 로드될 때까지 대기 후 재실행
        let waitCount = 0;
        const maxWait = 50; // 5초 대기
        const checkAuthState = setInterval(() => {
          if (window.authState?.supabase) {
            clearInterval(checkAuthState);
            updateAuthUI();
            window.addEventListener("auth:state-changed", updateAuthUI);
            if (window.authState?.syncSession) {
              window.authState.syncSession();
            }
          } else if (waitCount >= maxWait) {
            clearInterval(checkAuthState);
            // auth-state.js가 로드되지 않아도 localStorage 기반으로 표시
            window.addEventListener("auth:state-changed", updateAuthUI);
          }
          waitCount++;
        }, 100);
      })();

      // 하단바 슬라이드 인디케이터 제어
      (function() {
        const sideNav = document.querySelector('.side-nav');
        if (!sideNav) return;

        function updateSideNavIndicator() {
          // PC 화면에서는 인디케이터 숨기기 (절대 건들지 않음)
          if (window.innerWidth > 992) {
            sideNav.classList.add('hide-indicator');
            return;
          }

          // 모바일 화면에서만 동작
          const scrollLeft = Math.round(sideNav.scrollLeft);
          const scrollWidth = sideNav.scrollWidth;
          const clientWidth = sideNav.clientWidth;
          
          // 스크롤이 끝에 도달했는지 확인
          // scrollLeft + clientWidth가 scrollWidth와 같거나 거의 같으면 끝
          const remainingScroll = scrollWidth - scrollLeft - clientWidth;
          
          if (remainingScroll <= 3 || scrollWidth <= clientWidth) {
            // 스크롤이 끝에 도달하거나 스크롤이 필요 없으면 인디케이터 숨기기
            sideNav.classList.add('hide-indicator');
          } else {
            // 스크롤 가능하면 인디케이터 보이기
            sideNav.classList.remove('hide-indicator');
          }
        }

        // DOM이 완전히 로드된 후 초기 상태 확인
        function initIndicator() {
          setTimeout(() => {
            updateSideNavIndicator();
          }, 300);
        }

        // 초기 상태 확인
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initIndicator);
        } else {
          initIndicator();
        }

        // 스크롤 이벤트 리스너
        sideNav.addEventListener('scroll', updateSideNavIndicator, { passive: true });
        
        // 리사이즈 이벤트 리스너
        let resizeTimeout;
        window.addEventListener('resize', () => {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(updateSideNavIndicator, 150);
        });

        // 페이지 로드 완료 후 재확인
        window.addEventListener('load', () => {
          setTimeout(updateSideNavIndicator, 500);
        });

        // MutationObserver로 DOM 변경 감지 (동적 콘텐츠 대응)
        const observer = new MutationObserver(() => {
          setTimeout(updateSideNavIndicator, 100);
        });
        observer.observe(sideNav, { childList: true, subtree: true });
      })();
    </script>

      </div> <!-- container 끝 -->
    </div> <!-- main-content 끝 -->

    <!-- 공통 인증 스크립트 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js" integrity="sha384-GFr3yTh5lJznCbZfpTtXnwboFsxqtTQoeTZCRHhE0579KrRmlCzen5AA8ohaB5ug" crossorigin="anonymous"></script>
    <script src="./assets/auth-state.js?v=202410"></script>

    <!-- 푸터 -->
    <footer class="site-footer">
      <div class="footer-content">
        <div class="footer-item">
          <div class="footer-label">상호명</div>
          <div class="footer-value">사장픽</div>
        </div>
        <div class="footer-item">
          <div class="footer-label">대표자명</div>
          <div class="footer-value">오대준</div>
        </div>
        <div class="footer-item">
          <div class="footer-label">사업장 주소지</div>
          <div class="footer-value">부산광역시 북구 백양대로 1003 5동307호</div>
        </div>
        <div class="footer-item">
          <div class="footer-label">사업자 번호</div>
          <div class="footer-value">441-31-01878</div>
        </div>
        <div class="footer-item">
          <div class="footer-label">이메일 주소</div>
          <div class="footer-value">
            <a href="mailto:ohdaejun@naver.com">ohdaejun@naver.com</a>
          </div>
        </div>
        <div class="footer-item">
          <div class="footer-label">전화번호</div>
          <div class="footer-value">
            <a href="tel:010-6664-3744">010-6664-3744</a>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
