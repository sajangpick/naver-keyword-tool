# 회원 관리 시스템 연동 가이드

> 📅 작성일: 2025-10-28  
> 🎯 목적: 프론트엔드(admin/member-management.html)와 백엔드(server.js) 연동  
> ⚠️ 주의: 블로그 작업 완료 후 server.js 수정 시작!

---

## 📋 현재 상황

### 완료된 작업
- ✅ Supabase 데이터베이스 구축 완료 (`profiles` 테이블)
- ✅ 회원 등급 체계 설계 완료
- ✅ 실제 회원 8명 Supabase에 저장됨
- ✅ `admin/member-management.html` 프론트엔드 완성 (**A안: Supabase 직접 호출**)
- ✅ 실제 회원 8명 조회/수정/삭제 가능
- ✅ 등급 변경 기능 작동
- ✅ 검색/필터 기능 작동
- ✅ **회원 상세보기 기능 추가** (2025-10-28)
  - 회원별 리뷰 답글 내역 조회 (최근 10개)
  - 회원별 블로그 포스팅 내역 조회 (최근 10개)
  - 사용량 통계 시각화
  - 가입일/마지막 수정일 표시

### 대기 중인 작업
- ⏳ 블로그 작업자가 `Blog-Editor.html` 작업 중
- ⏳ 블로그 작업 완료 후 A안 → B안 전환 예정 (5-10분)

### 남은 작업
- ❌ server.js에 API 라우트 추가 (블로그 완료 후)
- ❌ A안 → B안 전환 (프론트엔드 Supabase 직접 → server.js API)
- ❌ 관리자 인증 추가 (선택사항)

---

## 🎯 회원 등급 체계 (참고)

### Owner (식당 대표)
| 등급 | 코드 | 월 리뷰 제한 | 월 블로그 제한 |
|------|------|-------------|---------------|
| 씨앗 | `seed` | 10개 | 2개 |
| 파워 | `power` | 50개 | 10개 |
| 빅파워 | `big_power` | 200개 | 30개 |
| 프리미엄 | `premium` | 무제한 | 100개 |

### Agency (대행사/블로거)
| 등급 | 코드 | 월 리뷰 제한 | 월 블로그 제한 |
|------|------|-------------|---------------|
| 엘리트 | `elite` | 100개 | 50개 |
| 전문가 | `expert` | 500개 | 200개 |
| 마스터 | `master` | 2000개 | 500개 |
| 플래티넘 | `platinum` | 무제한 | 무제한 |

### Admin (관리자)
| 등급 | 코드 | 제한 |
|------|------|------|
| 관리자 | `admin` | 무제한 |

---

## 🗂️ Supabase 테이블 구조

### `profiles` 테이블

```sql
CREATE TABLE profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  kakao_id TEXT UNIQUE,
  name TEXT NOT NULL,
  email TEXT UNIQUE,
  phone TEXT,
  business_name TEXT,
  
  -- 회원 등급
  user_type TEXT NOT NULL DEFAULT 'owner', -- 'owner', 'agency', 'admin'
  membership_level TEXT NOT NULL DEFAULT 'seed',
  
  -- 사용량 추적
  monthly_review_count INTEGER DEFAULT 0,
  monthly_blog_count INTEGER DEFAULT 0,
  
  -- 날짜
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 등급별 제한 확인 방법

```javascript
const LIMITS = {
  owner: {
    seed: { review: 10, blog: 2 },
    power: { review: 50, blog: 10 },
    big_power: { review: 200, blog: 30 },
    premium: { review: null, blog: 100 } // null = 무제한
  },
  agency: {
    elite: { review: 100, blog: 50 },
    expert: { review: 500, blog: 200 },
    master: { review: 2000, blog: 500 },
    platinum: { review: null, blog: null }
  },
  admin: {
    admin: { review: null, blog: null }
  }
};

// 사용 예시
const limit = LIMITS[userType][membershipLevel].review;
```

---

## 🔌 필요한 API 엔드포인트

### 1. 회원 목록 조회
**엔드포인트**: `GET /api/admin/members`

**Query 파라미터**:
- `user_type` (선택): `owner`, `agency`, `admin`
- `search` (선택): 이름 또는 이메일 검색
- `page` (선택): 페이지 번호 (기본: 1)
- `limit` (선택): 페이지당 개수 (기본: 20)

**응답 예시**:
```json
{
  "success": true,
  "members": [
    {
      "id": "uuid-1",
      "name": "김사장",
      "email": "kim@test.com",
      "user_type": "owner",
      "membership_level": "premium",
      "monthly_review_count": 23,
      "monthly_blog_count": 5,
      "created_at": "2025-10-01T00:00:00Z"
    }
  ],
  "total": 150,
  "page": 1,
  "limit": 20
}
```

### 2. 회원 등급 변경
**엔드포인트**: `PUT /api/admin/members/:id`

**Request Body**:
```json
{
  "membership_level": "power",
  "reset_usage": false // true면 사용량 초기화
}
```

**응답 예시**:
```json
{
  "success": true,
  "member": {
    "id": "uuid-1",
    "membership_level": "power",
    "monthly_review_count": 12
  }
}
```

### 3. 회원 상세 조회
**엔드포인트**: `GET /api/admin/members/:id`

**응답 예시**:
```json
{
  "success": true,
  "member": {
    "id": "uuid-1",
    "name": "김사장",
    "email": "kim@test.com",
    "phone": "010-1234-5678",
    "business_name": "두찜 명장점",
    "user_type": "owner",
    "membership_level": "premium",
    "monthly_review_count": 23,
    "monthly_blog_count": 5,
    "created_at": "2025-10-01T00:00:00Z",
    "updated_at": "2025-10-28T00:00:00Z"
  }
}
```

### 4. 회원 삭제
**엔드포인트**: `DELETE /api/admin/members/:id`

**응답 예시**:
```json
{
  "success": true,
  "message": "회원이 삭제되었습니다"
}
```

---

## 💻 server.js에 추가할 코드

### 1단계: Supabase 클라이언트 확인

```javascript
// server.js 상단 (이미 있는지 확인)
const { createClient } = require('@supabase/supabase-js');

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY // 관리자 권한
);
```

### 2단계: 회원 목록 조회 API

```javascript
// 회원 목록 조회 (관리자만)
app.get('/api/admin/members', async (req, res) => {
  try {
    const { user_type, search, page = 1, limit = 20 } = req.query;
    
    // 기본 쿼리
    let query = supabase
      .from('profiles')
      .select('*', { count: 'exact' });
    
    // 필터링
    if (user_type) {
      query = query.eq('user_type', user_type);
    }
    
    if (search) {
      query = query.or(`name.ilike.%${search}%,email.ilike.%${search}%`);
    }
    
    // 페이징
    const offset = (page - 1) * limit;
    query = query
      .order('created_at', { ascending: false })
      .range(offset, offset + limit - 1);
    
    // 실행
    const { data, error, count } = await query;
    
    if (error) {
      console.error('회원 목록 조회 오류:', error);
      return res.status(500).json({ 
        success: false, 
        error: error.message 
      });
    }
    
    res.json({
      success: true,
      members: data,
      total: count,
      page: parseInt(page),
      limit: parseInt(limit)
    });
    
  } catch (error) {
    console.error('회원 목록 조회 실패:', error);
    res.status(500).json({ 
      success: false, 
      error: '서버 오류가 발생했습니다' 
    });
  }
});
```

### 3단계: 회원 등급 변경 API

```javascript
// 회원 등급 변경 (관리자만)
app.put('/api/admin/members/:id', async (req, res) => {
  try {
    const { id } = req.params;
    const { membership_level, reset_usage } = req.body;
    
    // 유효성 검사
    const validLevels = [
      'seed', 'power', 'big_power', 'premium',
      'elite', 'expert', 'master', 'platinum',
      'admin'
    ];
    
    if (!validLevels.includes(membership_level)) {
      return res.status(400).json({
        success: false,
        error: '유효하지 않은 등급입니다'
      });
    }
    
    // 업데이트할 데이터
    const updateData = {
      membership_level,
      updated_at: new Date().toISOString()
    };
    
    // 사용량 초기화 옵션
    if (reset_usage) {
      updateData.monthly_review_count = 0;
      updateData.monthly_blog_count = 0;
    }
    
    // 실행
    const { data, error } = await supabase
      .from('profiles')
      .update(updateData)
      .eq('id', id)
      .select()
      .single();
    
    if (error) {
      console.error('회원 등급 변경 오류:', error);
      return res.status(500).json({ 
        success: false, 
        error: error.message 
      });
    }
    
    res.json({
      success: true,
      member: data
    });
    
  } catch (error) {
    console.error('회원 등급 변경 실패:', error);
    res.status(500).json({ 
      success: false, 
      error: '서버 오류가 발생했습니다' 
    });
  }
});
```

### 4단계: 회원 상세 조회 API

```javascript
// 회원 상세 조회 (관리자만)
app.get('/api/admin/members/:id', async (req, res) => {
  try {
    const { id } = req.params;
    
    const { data, error } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', id)
      .single();
    
    if (error) {
      console.error('회원 조회 오류:', error);
      return res.status(404).json({ 
        success: false, 
        error: '회원을 찾을 수 없습니다' 
      });
    }
    
    res.json({
      success: true,
      member: data
    });
    
  } catch (error) {
    console.error('회원 조회 실패:', error);
    res.status(500).json({ 
      success: false, 
      error: '서버 오류가 발생했습니다' 
    });
  }
});
```

### 5단계: 회원 삭제 API

```javascript
// 회원 삭제 (관리자만)
app.delete('/api/admin/members/:id', async (req, res) => {
  try {
    const { id } = req.params;
    
    // 삭제 (ON DELETE CASCADE로 연관 데이터도 자동 삭제)
    const { error } = await supabase
      .from('profiles')
      .delete()
      .eq('id', id);
    
    if (error) {
      console.error('회원 삭제 오류:', error);
      return res.status(500).json({ 
        success: false, 
        error: error.message 
      });
    }
    
    res.json({
      success: true,
      message: '회원이 삭제되었습니다'
    });
    
  } catch (error) {
    console.error('회원 삭제 실패:', error);
    res.status(500).json({ 
      success: false, 
      error: '서버 오류가 발생했습니다' 
    });
  }
});
```

---

## 🔄 A안 → B안 전환 가이드 (중요!)

> 📌 **전환 결정**: A안(프론트엔드 직접)으로 시작 → 나중에 B안(서버 API)으로 전환  
> ⏱️ **소요 시간**: 약 5-10분  
> 🎯 **이유**: 블로그 작업과 충돌 방지, 지금 바로 실제 회원 8명 조회 가능

### A안과 B안 비교

| 구분 | A안 (프론트엔드 직접) | B안 (서버 API) |
|------|---------------------|---------------|
| 장점 | ✅ 지금 바로 작동<br>✅ server.js 수정 불필요<br>✅ 충돌 0% | ✅ 보안 강화<br>✅ 계층 분리<br>✅ 확장 용이 |
| 단점 | ⚠️ Anon Key 노출<br>⚠️ RLS 정책 의존 | ⚠️ server.js 수정 필요<br>⚠️ 블로그 작업과 조율 |
| 사용 | 🔵 현재 (임시) | 🟢 나중에 (최종) |

---

## 🔄 A안 → B안 전환 방법 (5-10분)

### 변경되는 부분 (5%)

**1. 회원 목록 조회**

**A안 (현재):**
```javascript
// admin/member-management.html
async function loadMembers(userType = '', search = '', page = 1) {
  try {
    showLoading(true);
    
    // Supabase 직접 호출
    let query = supabase
      .from('profiles')
      .select('*', { count: 'exact' });
    
    if (userType) query = query.eq('user_type', userType);
    if (search) query = query.or(`name.ilike.%${search}%,email.ilike.%${search}%`);
    
    const offset = (page - 1) * 20;
    query = query
      .order('created_at', { ascending: false })
      .range(offset, offset + 19);
    
    const { data, error, count } = await query;
    
    if (error) throw new Error(error.message);
    
    renderMembers(data);
    renderPagination(page, count, 20);
    
  } catch (error) {
    showError(error.message);
  } finally {
    showLoading(false);
  }
}
```

**B안 (나중에 - 이것만 교체):**
```javascript
// admin/member-management.html
async function loadMembers(userType = '', search = '', page = 1) {
  try {
    showLoading(true);
    
    // API 호출로 변경 (3줄만!)
    const params = new URLSearchParams({ page, limit: 20 });
    if (userType) params.append('user_type', userType);
    if (search) params.append('search', search);
    
    const response = await fetch(`/api/admin/members?${params}`);
    const result = await response.json();
    
    if (!result.success) throw new Error(result.error);
    
    renderMembers(result.members); // 동일!
    renderPagination(result.page, result.total, result.limit);
    
  } catch (error) {
    showError(error.message);
  } finally {
    showLoading(false);
  }
}
```

---

**2. 회원 등급 변경**

**A안 (현재):**
```javascript
async function updateMemberLevel(memberId, newLevel, resetUsage = false) {
  try {
    const updateData = {
      membership_level: newLevel,
      updated_at: new Date().toISOString()
    };
    
    if (resetUsage) {
      updateData.monthly_review_count = 0;
      updateData.monthly_blog_count = 0;
    }
    
    // Supabase 직접 호출
    const { error } = await supabase
      .from('profiles')
      .update(updateData)
      .eq('id', memberId);
    
    if (error) throw new Error(error.message);
    
    alert('등급이 변경되었습니다');
    loadMembers(); // 새로고침
    
  } catch (error) {
    alert('변경 실패: ' + error.message);
  }
}
```

**B안 (나중에):**
```javascript
async function updateMemberLevel(memberId, newLevel, resetUsage = false) {
  try {
    // API 호출로 변경
    const response = await fetch(`/api/admin/members/${memberId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        membership_level: newLevel,
        reset_usage: resetUsage 
      })
    });
    
    const result = await response.json();
    
    if (!result.success) throw new Error(result.error);
    
    alert('등급이 변경되었습니다');
    loadMembers(); // 새로고침 (동일)
    
  } catch (error) {
    alert('변경 실패: ' + error.message);
  }
}
```

---

**3. 회원 삭제**

**A안 (현재):**
```javascript
async function deleteMember(memberId, memberName) {
  if (!confirm(`${memberName} 회원을 삭제하시겠습니까?`)) return;
  
  try {
    // Supabase 직접 호출
    const { error } = await supabase
      .from('profiles')
      .delete()
      .eq('id', memberId);
    
    if (error) throw new Error(error.message);
    
    alert('회원이 삭제되었습니다');
    loadMembers();
    
  } catch (error) {
    alert('삭제 실패: ' + error.message);
  }
}
```

**B안 (나중에):**
```javascript
async function deleteMember(memberId, memberName) {
  if (!confirm(`${memberName} 회원을 삭제하시겠습니까?`)) return;
  
  try {
    // API 호출로 변경
    const response = await fetch(`/api/admin/members/${memberId}`, {
      method: 'DELETE'
    });
    
    const result = await response.json();
    
    if (!result.success) throw new Error(result.error);
    
    alert('회원이 삭제되었습니다');
    loadMembers(); // 동일
    
  } catch (error) {
    alert('삭제 실패: ' + error.message);
  }
}
```

---

### 변경되지 않는 부분 (95%)

✅ **그대로 유지:**
- HTML 구조 전체
- CSS 스타일 전체
- `renderMembers()` 함수
- `renderPagination()` 함수
- 검색/필터 UI
- 버튼 이벤트 핸들러
- 로딩/에러 표시 함수

---

### 전환 체크리스트

**블로그 작업 완료 후 진행:**

```markdown
✅ 준비 단계
- [ ] 블로그 작업 완료 확인
- [ ] server.js에 API 라우트 추가 완료
- [ ] 로컬 서버 실행 및 API 테스트

🔄 전환 작업 (5-10분)
- [ ] admin/member-management.html 열기
- [ ] loadMembers() 함수 교체 (2분)
- [ ] updateMemberLevel() 함수 교체 (2분)
- [ ] deleteMember() 함수 교체 (1분)
- [ ] Supabase 클라이언트 초기화 코드 제거 (1분)

✅ 테스트
- [ ] 회원 목록 조회 확인
- [ ] 등급 변경 테스트
- [ ] 검색/필터 테스트
- [ ] 회원 삭제 테스트
- [ ] 에러 처리 확인

🚀 배포
- [ ] Git commit
- [ ] Vercel/Render 배포
- [ ] 프로덕션 테스트
```

---

### 예상 문제 및 해결

**문제 1: API가 404 에러**
```
증상: fetch('/api/admin/members') → 404 Not Found
해결: server.js에 라우트 추가 확인
```

**문제 2: CORS 오류**
```
증상: Access-Control-Allow-Origin 오류
해결: server.js의 CORS 설정 확인 (이미 있을 것)
```

**문제 3: 데이터 형식 불일치**
```
증상: result.members가 undefined
해결: server.js 응답 형식 확인 ({ success, members })
```

---

## 🔄 Mock 데이터 → 실제 API 교체 (참고용)

### admin/member-management.html 수정

**현재 (Mock 데이터 - 사용 안 함)**:
```javascript
const mockMembers = [...];
renderMembers(mockMembers);
```

**교체 후 (실제 API)**:
```javascript
async function loadMembers(userType = '', search = '', page = 1) {
  try {
    showLoading(true);
    
    const params = new URLSearchParams({
      page,
      limit: 20
    });
    
    if (userType) params.append('user_type', userType);
    if (search) params.append('search', search);
    
    const response = await fetch(`/api/admin/members?${params}`);
    const data = await response.json();
    
    if (!data.success) {
      throw new Error(data.error || '데이터를 불러올 수 없습니다');
    }
    
    renderMembers(data.members);
    renderPagination(data.page, data.total, data.limit);
    
  } catch (error) {
    console.error('회원 목록 로드 실패:', error);
    showError(error.message);
  } finally {
    showLoading(false);
  }
}
```

---

## 🔐 관리자 인증 추가 (선택사항)

### 간단한 방법: localStorage 체크

```javascript
// admin/member-management.html 상단
window.addEventListener('load', function() {
  const userData = localStorage.getItem('userData');
  
  if (!userData) {
    alert('로그인이 필요합니다');
    window.location.href = '/login.html';
    return;
  }
  
  try {
    const user = JSON.parse(userData);
    
    // 관리자 권한 체크 (나중에 Supabase에서 확인)
    if (user.user_type !== 'admin') {
      alert('관리자 권한이 필요합니다');
      window.location.href = '/index.html';
      return;
    }
    
    // 정상 진행
    loadMembers();
    
  } catch (e) {
    console.error('로그인 정보 오류:', e);
    window.location.href = '/login.html';
  }
});
```

### 서버 측 검증 (더 안전)

```javascript
// server.js - 관리자 권한 체크 미들웨어
function requireAdmin(req, res, next) {
  // TODO: JWT 토큰 또는 세션에서 사용자 정보 추출
  const userId = req.user?.id; // 임시
  
  if (!userId) {
    return res.status(401).json({ 
      success: false, 
      error: '로그인이 필요합니다' 
    });
  }
  
  // Supabase에서 사용자 권한 확인
  supabase
    .from('profiles')
    .select('user_type')
    .eq('id', userId)
    .single()
    .then(({ data, error }) => {
      if (error || data.user_type !== 'admin') {
        return res.status(403).json({ 
          success: false, 
          error: '관리자 권한이 필요합니다' 
        });
      }
      next();
    })
    .catch(err => {
      res.status(500).json({ 
        success: false, 
        error: '서버 오류' 
      });
    });
}

// 사용 예시
app.get('/api/admin/members', requireAdmin, async (req, res) => {
  // ... 기존 코드
});
```

---

## ✅ 연동 체크리스트

### 1단계: 준비 확인
- [ ] 블로그 작업 완료 확인
- [ ] `Blog-Editor.html` 수정사항 commit 완료
- [ ] server.js에 충돌 없는지 확인

### 2단계: server.js 수정
- [ ] Supabase 클라이언트 초기화 확인
- [ ] 회원 목록 API 추가 (`GET /api/admin/members`)
- [ ] 회원 등급 변경 API 추가 (`PUT /api/admin/members/:id`)
- [ ] 회원 상세 조회 API 추가 (`GET /api/admin/members/:id`)
- [ ] 회원 삭제 API 추가 (선택)
- [ ] 에러 처리 확인

### 3단계: 프론트엔드 수정
- [ ] Mock 데이터 제거
- [ ] API 호출 함수로 교체 (`loadMembers()`)
- [ ] 등급 변경 기능 연동
- [ ] 검색/필터 기능 연동
- [ ] 에러 메시지 표시

### 4단계: 테스트
- [ ] 로컬 서버 실행 (`node server.js`)
- [ ] `/admin/member-management.html` 접속
- [ ] 회원 목록 정상 표시 확인
- [ ] 등급 변경 테스트
- [ ] 검색 기능 테스트
- [ ] 에러 처리 확인

### 5단계: 배포
- [ ] Git commit
- [ ] Vercel/Render 배포
- [ ] 프로덕션 테스트

---

## 🐛 예상 문제 및 해결

### 문제 1: CORS 오류
**증상**: `Access-Control-Allow-Origin` 오류

**해결**:
```javascript
// server.js (이미 설정되어 있을 것)
const cors = require('cors');
app.use(cors());
```

### 문제 2: Supabase 권한 오류
**증상**: `new row violates row-level security policy`

**해결**:
```sql
-- Supabase SQL Editor에서 실행
-- RLS 정책을 개발 모드로 변경 (임시)
DROP POLICY IF EXISTS "profiles_select_policy" ON profiles;
CREATE POLICY "profiles_select_policy" ON profiles
  FOR SELECT USING (true);
```

### 문제 3: 페이징 안 됨
**증상**: 모든 회원이 한 번에 표시됨

**해결**:
```javascript
// { count: 'exact' } 옵션 확인
const { data, error, count } = await supabase
  .from('profiles')
  .select('*', { count: 'exact' }) // 이 부분 필수!
```

---

## 📚 참고 자료

### 프로젝트 문서
- `docs/AI_LOG.md` - 회원 등급 체계 기록 (2025-10-22)
- `docs/데이터베이스ai작업.md` - 데이터베이스 구조 상세
- `supabase-schema-final.sql` - 테이블 스키마

### Supabase 문서
- [JavaScript Client](https://supabase.com/docs/reference/javascript/introduction)
- [Select](https://supabase.com/docs/reference/javascript/select)
- [Update](https://supabase.com/docs/reference/javascript/update)
- [Delete](https://supabase.com/docs/reference/javascript/delete)

### 기존 코드 참고
- `admin/rank-report.html` - 어드민 페이지 디자인 참고
- `review.html` - API 호출 패턴 참고
- `server.js` - 기존 API 구조 참고

---

## 📊 회원 상세보기 기능 (2025-10-28 추가)

### 기능 개요
회원별 상세 활동 내역을 조회하는 기능이 추가되었습니다.

**포함된 정보:**
1. 회원 기본 정보 (이름, 이메일, 유형, 등급, 가입일)
2. 이번 달 사용량 통계 (리뷰/블로그)
3. 최근 리뷰 답글 내역 (최근 10개)
4. 최근 블로그 포스팅 내역 (최근 10개)

### 현재 구현 (A안)

**JavaScript 함수:**
```javascript
// 회원 상세정보 조회
async function showMemberDetail(memberId) {
  // profiles 테이블 조회
  const { data: member } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', memberId)
    .single();
  
  // 리뷰 내역 조회 (별도 함수)
  loadMemberReviews(memberId);
  
  // 블로그 내역 조회 (별도 함수)
  loadMemberBlogs(memberId);
}

// 리뷰 내역 조회
async function loadMemberReviews(memberId) {
  const { data: reviews } = await supabase
    .from('review_responses')
    .select('*')
    .eq('user_id', memberId)
    .order('created_at', { ascending: false })
    .limit(10);
}

// 블로그 내역 조회
async function loadMemberBlogs(memberId) {
  const { data: blogs } = await supabase
    .from('blog_posts')
    .select('*')
    .eq('user_id', memberId)
    .order('created_at', { ascending: false })
    .limit(10);
}
```

### B안 전환 시 수정 사항

#### 1. server.js에 API 추가

```javascript
// 회원 상세정보 조회
app.get('/api/admin/members/:id/detail', async (req, res) => {
  const { id } = req.params;
  
  try {
    // 회원 정보
    const { data: member, error: memberError } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', id)
      .single();
    
    if (memberError) throw memberError;
    
    // 리뷰 내역
    const { data: reviews, error: reviewError } = await supabase
      .from('review_responses')
      .select('*')
      .eq('user_id', id)
      .order('created_at', { ascending: false })
      .limit(10);
    
    // 블로그 내역
    const { data: blogs, error: blogError } = await supabase
      .from('blog_posts')
      .select('*')
      .eq('user_id', id)
      .order('created_at', { ascending: false })
      .limit(10);
    
    res.json({
      success: true,
      member,
      reviews: reviews || [],
      blogs: blogs || []
    });
    
  } catch (error) {
    console.error('회원 상세정보 조회 실패:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});
```

#### 2. 프론트엔드 수정 (A안 → B안)

**Before (A안):**
```javascript
async function showMemberDetail(memberId) {
  // Supabase 직접 호출
  const { data: member } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', memberId)
    .single();
  
  loadMemberReviews(memberId);
  loadMemberBlogs(memberId);
}
```

**After (B안):**
```javascript
async function showMemberDetail(memberId) {
  // server.js API 호출
  const response = await fetch(`/api/admin/members/${memberId}/detail`);
  const data = await response.json();
  
  if (!data.success) throw new Error(data.error);
  
  const member = data.member;
  const reviews = data.reviews;
  const blogs = data.blogs;
  
  // UI 업데이트 (동일)
  // ...
  
  // 데이터를 직접 렌더링 (별도 API 호출 불필요)
  renderReviews(reviews);
  renderBlogs(blogs);
}

// 별도 함수로 분리
function renderReviews(reviews) {
  const container = document.getElementById('detail-reviews-container');
  // reviews 렌더링
}

function renderBlogs(blogs) {
  const container = document.getElementById('detail-blogs-container');
  // blogs 렌더링
}
```

### 변경 범위 요약

**수정 필요:**
- `showMemberDetail()` 함수 (20줄)
- `loadMemberReviews()` 함수 제거, `renderReviews()` 로 대체
- `loadMemberBlogs()` 함수 제거, `renderBlogs()` 로 대체

**수정 불필요:**
- HTML 구조
- CSS 스타일
- 모달 열기/닫기 함수

**예상 소요 시간:** 15-20분

---

## 🎯 최종 목표

**완성되면 이렇게 됩니다:**
1. 관리자가 `/admin/member-management.html` 접속
2. Supabase에서 실시간 회원 목록 조회
3. 드롭다운으로 등급 변경 → 즉시 DB 업데이트
4. 검색/필터로 원하는 회원 찾기
5. 페이징으로 많은 회원 관리

**예상 소요 시간**:
- server.js 수정: 30-60분
- 프론트엔드 연동: 15-30분
- 테스트: 30분
- **총 1-2시간**

---

**작성자**: AI Assistant  
**마지막 업데이트**: 2025-10-28  
**다음 작업**: `admin/member-management.html` 프론트엔드 개발

