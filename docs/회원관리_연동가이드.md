# íšŒì› ê´€ë¦¬ ì‹œìŠ¤í…œ ì—°ë™ ê°€ì´ë“œ

> ğŸ“… ì‘ì„±ì¼: 2025-10-28  
> ğŸ¯ ëª©ì : í”„ë¡ íŠ¸ì—”ë“œ(admin/member-management.html)ì™€ ë°±ì—”ë“œ(server.js) ì—°ë™  
> âš ï¸ ì£¼ì˜: ë¸”ë¡œê·¸ ì‘ì—… ì™„ë£Œ í›„ server.js ìˆ˜ì • ì‹œì‘!

---

## ğŸ“‹ í˜„ì¬ ìƒí™©

### ì™„ë£Œëœ ì‘ì—…
- âœ… Supabase ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¶• ì™„ë£Œ (`profiles` í…Œì´ë¸”)
- âœ… íšŒì› ë“±ê¸‰ ì²´ê³„ ì„¤ê³„ ì™„ë£Œ
- âœ… ì‹¤ì œ íšŒì› 8ëª… Supabaseì— ì €ì¥ë¨
- âœ… `admin/member-management.html` í”„ë¡ íŠ¸ì—”ë“œ ì™„ì„± (**Aì•ˆ: Supabase ì§ì ‘ í˜¸ì¶œ**)
- âœ… ì‹¤ì œ íšŒì› 8ëª… ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
- âœ… ë“±ê¸‰ ë³€ê²½ ê¸°ëŠ¥ ì‘ë™
- âœ… ê²€ìƒ‰/í•„í„° ê¸°ëŠ¥ ì‘ë™
- âœ… **íšŒì› ìƒì„¸ë³´ê¸° ê¸°ëŠ¥ ì¶”ê°€** (2025-10-28)
  - íšŒì›ë³„ ë¦¬ë·° ë‹µê¸€ ë‚´ì—­ ì¡°íšŒ (ìµœê·¼ 10ê°œ)
  - íšŒì›ë³„ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ… ë‚´ì—­ ì¡°íšŒ (ìµœê·¼ 10ê°œ)
  - ì‚¬ìš©ëŸ‰ í†µê³„ ì‹œê°í™”
  - ê°€ì…ì¼/ë§ˆì§€ë§‰ ìˆ˜ì •ì¼ í‘œì‹œ

### ëŒ€ê¸° ì¤‘ì¸ ì‘ì—…
- â³ ë¸”ë¡œê·¸ ì‘ì—…ìê°€ `Blog-Editor.html` ì‘ì—… ì¤‘
- â³ ë¸”ë¡œê·¸ ì‘ì—… ì™„ë£Œ í›„ Aì•ˆ â†’ Bì•ˆ ì „í™˜ ì˜ˆì • (5-10ë¶„)

### ë‚¨ì€ ì‘ì—…
- âŒ server.jsì— API ë¼ìš°íŠ¸ ì¶”ê°€ (ë¸”ë¡œê·¸ ì™„ë£Œ í›„)
- âŒ Aì•ˆ â†’ Bì•ˆ ì „í™˜ (í”„ë¡ íŠ¸ì—”ë“œ Supabase ì§ì ‘ â†’ server.js API)
- âŒ ê´€ë¦¬ì ì¸ì¦ ì¶”ê°€ (ì„ íƒì‚¬í•­)

---

## ğŸ¯ íšŒì› ë“±ê¸‰ ì²´ê³„ (ì°¸ê³ )

### Owner (ì‹ë‹¹ ëŒ€í‘œ)
| ë“±ê¸‰ | ì½”ë“œ | ì›” ë¦¬ë·° ì œí•œ | ì›” ë¸”ë¡œê·¸ ì œí•œ |
|------|------|-------------|---------------|
| ì”¨ì•— | `seed` | 10ê°œ | 2ê°œ |
| íŒŒì›Œ | `power` | 50ê°œ | 10ê°œ |
| ë¹…íŒŒì›Œ | `big_power` | 200ê°œ | 30ê°œ |
| í”„ë¦¬ë¯¸ì—„ | `premium` | ë¬´ì œí•œ | 100ê°œ |

### Agency (ëŒ€í–‰ì‚¬/ë¸”ë¡œê±°)
| ë“±ê¸‰ | ì½”ë“œ | ì›” ë¦¬ë·° ì œí•œ | ì›” ë¸”ë¡œê·¸ ì œí•œ |
|------|------|-------------|---------------|
| ì—˜ë¦¬íŠ¸ | `elite` | 100ê°œ | 50ê°œ |
| ì „ë¬¸ê°€ | `expert` | 500ê°œ | 200ê°œ |
| ë§ˆìŠ¤í„° | `master` | 2000ê°œ | 500ê°œ |
| í”Œë˜í‹°ë„˜ | `platinum` | ë¬´ì œí•œ | ë¬´ì œí•œ |

### Admin (ê´€ë¦¬ì)
| ë“±ê¸‰ | ì½”ë“œ | ì œí•œ |
|------|------|------|
| ê´€ë¦¬ì | `admin` | ë¬´ì œí•œ |

---

## ğŸ—‚ï¸ Supabase í…Œì´ë¸” êµ¬ì¡°

### `profiles` í…Œì´ë¸”

```sql
CREATE TABLE profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  kakao_id TEXT UNIQUE,
  name TEXT NOT NULL,
  email TEXT UNIQUE,
  phone TEXT,
  business_name TEXT,
  
  -- íšŒì› ë“±ê¸‰
  user_type TEXT NOT NULL DEFAULT 'owner', -- 'owner', 'agency', 'admin'
  membership_level TEXT NOT NULL DEFAULT 'seed',
  
  -- ì‚¬ìš©ëŸ‰ ì¶”ì 
  monthly_review_count INTEGER DEFAULT 0,
  monthly_blog_count INTEGER DEFAULT 0,
  
  -- ë‚ ì§œ
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

### ë“±ê¸‰ë³„ ì œí•œ í™•ì¸ ë°©ë²•

```javascript
const LIMITS = {
  owner: {
    seed: { review: 10, blog: 2 },
    power: { review: 50, blog: 10 },
    big_power: { review: 200, blog: 30 },
    premium: { review: null, blog: 100 } // null = ë¬´ì œí•œ
  },
  agency: {
    elite: { review: 100, blog: 50 },
    expert: { review: 500, blog: 200 },
    master: { review: 2000, blog: 500 },
    platinum: { review: null, blog: null }
  },
  admin: {
    admin: { review: null, blog: null }
  }
};

// ì‚¬ìš© ì˜ˆì‹œ
const limit = LIMITS[userType][membershipLevel].review;
```

---

## ğŸ”Œ í•„ìš”í•œ API ì—”ë“œí¬ì¸íŠ¸

### 1. íšŒì› ëª©ë¡ ì¡°íšŒ
**ì—”ë“œí¬ì¸íŠ¸**: `GET /api/admin/members`

**Query íŒŒë¼ë¯¸í„°**:
- `user_type` (ì„ íƒ): `owner`, `agency`, `admin`
- `search` (ì„ íƒ): ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼ ê²€ìƒ‰
- `page` (ì„ íƒ): í˜ì´ì§€ ë²ˆí˜¸ (ê¸°ë³¸: 1)
- `limit` (ì„ íƒ): í˜ì´ì§€ë‹¹ ê°œìˆ˜ (ê¸°ë³¸: 20)

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "members": [
    {
      "id": "uuid-1",
      "name": "ê¹€ì‚¬ì¥",
      "email": "kim@test.com",
      "user_type": "owner",
      "membership_level": "premium",
      "monthly_review_count": 23,
      "monthly_blog_count": 5,
      "created_at": "2025-10-01T00:00:00Z"
    }
  ],
  "total": 150,
  "page": 1,
  "limit": 20
}
```

### 2. íšŒì› ë“±ê¸‰ ë³€ê²½
**ì—”ë“œí¬ì¸íŠ¸**: `PUT /api/admin/members/:id`

**Request Body**:
```json
{
  "membership_level": "power",
  "reset_usage": false // trueë©´ ì‚¬ìš©ëŸ‰ ì´ˆê¸°í™”
}
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "member": {
    "id": "uuid-1",
    "membership_level": "power",
    "monthly_review_count": 12
  }
}
```

### 3. íšŒì› ìƒì„¸ ì¡°íšŒ
**ì—”ë“œí¬ì¸íŠ¸**: `GET /api/admin/members/:id`

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "member": {
    "id": "uuid-1",
    "name": "ê¹€ì‚¬ì¥",
    "email": "kim@test.com",
    "phone": "010-1234-5678",
    "business_name": "ë‘ì°œ ëª…ì¥ì ",
    "user_type": "owner",
    "membership_level": "premium",
    "monthly_review_count": 23,
    "monthly_blog_count": 5,
    "created_at": "2025-10-01T00:00:00Z",
    "updated_at": "2025-10-28T00:00:00Z"
  }
}
```

### 4. íšŒì› ì‚­ì œ
**ì—”ë“œí¬ì¸íŠ¸**: `DELETE /api/admin/members/:id`

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "message": "íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤"
}
```

---

## ğŸ’» server.jsì— ì¶”ê°€í•  ì½”ë“œ

### 1ë‹¨ê³„: Supabase í´ë¼ì´ì–¸íŠ¸ í™•ì¸

```javascript
// server.js ìƒë‹¨ (ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸)
const { createClient } = require('@supabase/supabase-js');

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY // ê´€ë¦¬ì ê¶Œí•œ
);
```

### 2ë‹¨ê³„: íšŒì› ëª©ë¡ ì¡°íšŒ API

```javascript
// íšŒì› ëª©ë¡ ì¡°íšŒ (ê´€ë¦¬ìë§Œ)
app.get('/api/admin/members', async (req, res) => {
  try {
    const { user_type, search, page = 1, limit = 20 } = req.query;
    
    // ê¸°ë³¸ ì¿¼ë¦¬
    let query = supabase
      .from('profiles')
      .select('*', { count: 'exact' });
    
    // í•„í„°ë§
    if (user_type) {
      query = query.eq('user_type', user_type);
    }
    
    if (search) {
      query = query.or(`name.ilike.%${search}%,email.ilike.%${search}%`);
    }
    
    // í˜ì´ì§•
    const offset = (page - 1) * limit;
    query = query
      .order('created_at', { ascending: false })
      .range(offset, offset + limit - 1);
    
    // ì‹¤í–‰
    const { data, error, count } = await query;
    
    if (error) {
      console.error('íšŒì› ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
      return res.status(500).json({ 
        success: false, 
        error: error.message 
      });
    }
    
    res.json({
      success: true,
      members: data,
      total: count,
      page: parseInt(page),
      limit: parseInt(limit)
    });
    
  } catch (error) {
    console.error('íšŒì› ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
    res.status(500).json({ 
      success: false, 
      error: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤' 
    });
  }
});
```

### 3ë‹¨ê³„: íšŒì› ë“±ê¸‰ ë³€ê²½ API

```javascript
// íšŒì› ë“±ê¸‰ ë³€ê²½ (ê´€ë¦¬ìë§Œ)
app.put('/api/admin/members/:id', async (req, res) => {
  try {
    const { id } = req.params;
    const { membership_level, reset_usage } = req.body;
    
    // ìœ íš¨ì„± ê²€ì‚¬
    const validLevels = [
      'seed', 'power', 'big_power', 'premium',
      'elite', 'expert', 'master', 'platinum',
      'admin'
    ];
    
    if (!validLevels.includes(membership_level)) {
      return res.status(400).json({
        success: false,
        error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ë“±ê¸‰ì…ë‹ˆë‹¤'
      });
    }
    
    // ì—…ë°ì´íŠ¸í•  ë°ì´í„°
    const updateData = {
      membership_level,
      updated_at: new Date().toISOString()
    };
    
    // ì‚¬ìš©ëŸ‰ ì´ˆê¸°í™” ì˜µì…˜
    if (reset_usage) {
      updateData.monthly_review_count = 0;
      updateData.monthly_blog_count = 0;
    }
    
    // ì‹¤í–‰
    const { data, error } = await supabase
      .from('profiles')
      .update(updateData)
      .eq('id', id)
      .select()
      .single();
    
    if (error) {
      console.error('íšŒì› ë“±ê¸‰ ë³€ê²½ ì˜¤ë¥˜:', error);
      return res.status(500).json({ 
        success: false, 
        error: error.message 
      });
    }
    
    res.json({
      success: true,
      member: data
    });
    
  } catch (error) {
    console.error('íšŒì› ë“±ê¸‰ ë³€ê²½ ì‹¤íŒ¨:', error);
    res.status(500).json({ 
      success: false, 
      error: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤' 
    });
  }
});
```

### 4ë‹¨ê³„: íšŒì› ìƒì„¸ ì¡°íšŒ API

```javascript
// íšŒì› ìƒì„¸ ì¡°íšŒ (ê´€ë¦¬ìë§Œ)
app.get('/api/admin/members/:id', async (req, res) => {
  try {
    const { id } = req.params;
    
    const { data, error } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', id)
      .single();
    
    if (error) {
      console.error('íšŒì› ì¡°íšŒ ì˜¤ë¥˜:', error);
      return res.status(404).json({ 
        success: false, 
        error: 'íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' 
      });
    }
    
    res.json({
      success: true,
      member: data
    });
    
  } catch (error) {
    console.error('íšŒì› ì¡°íšŒ ì‹¤íŒ¨:', error);
    res.status(500).json({ 
      success: false, 
      error: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤' 
    });
  }
});
```

### 5ë‹¨ê³„: íšŒì› ì‚­ì œ API

```javascript
// íšŒì› ì‚­ì œ (ê´€ë¦¬ìë§Œ)
app.delete('/api/admin/members/:id', async (req, res) => {
  try {
    const { id } = req.params;
    
    // ì‚­ì œ (ON DELETE CASCADEë¡œ ì—°ê´€ ë°ì´í„°ë„ ìë™ ì‚­ì œ)
    const { error } = await supabase
      .from('profiles')
      .delete()
      .eq('id', id);
    
    if (error) {
      console.error('íšŒì› ì‚­ì œ ì˜¤ë¥˜:', error);
      return res.status(500).json({ 
        success: false, 
        error: error.message 
      });
    }
    
    res.json({
      success: true,
      message: 'íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤'
    });
    
  } catch (error) {
    console.error('íšŒì› ì‚­ì œ ì‹¤íŒ¨:', error);
    res.status(500).json({ 
      success: false, 
      error: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤' 
    });
  }
});
```

---

## ğŸ”„ Aì•ˆ â†’ Bì•ˆ ì „í™˜ ê°€ì´ë“œ (ì¤‘ìš”!)

> ğŸ“Œ **ì „í™˜ ê²°ì •**: Aì•ˆ(í”„ë¡ íŠ¸ì—”ë“œ ì§ì ‘)ìœ¼ë¡œ ì‹œì‘ â†’ ë‚˜ì¤‘ì— Bì•ˆ(ì„œë²„ API)ìœ¼ë¡œ ì „í™˜  
> â±ï¸ **ì†Œìš” ì‹œê°„**: ì•½ 5-10ë¶„  
> ğŸ¯ **ì´ìœ **: ë¸”ë¡œê·¸ ì‘ì—…ê³¼ ì¶©ëŒ ë°©ì§€, ì§€ê¸ˆ ë°”ë¡œ ì‹¤ì œ íšŒì› 8ëª… ì¡°íšŒ ê°€ëŠ¥

### Aì•ˆê³¼ Bì•ˆ ë¹„êµ

| êµ¬ë¶„ | Aì•ˆ (í”„ë¡ íŠ¸ì—”ë“œ ì§ì ‘) | Bì•ˆ (ì„œë²„ API) |
|------|---------------------|---------------|
| ì¥ì  | âœ… ì§€ê¸ˆ ë°”ë¡œ ì‘ë™<br>âœ… server.js ìˆ˜ì • ë¶ˆí•„ìš”<br>âœ… ì¶©ëŒ 0% | âœ… ë³´ì•ˆ ê°•í™”<br>âœ… ê³„ì¸µ ë¶„ë¦¬<br>âœ… í™•ì¥ ìš©ì´ |
| ë‹¨ì  | âš ï¸ Anon Key ë…¸ì¶œ<br>âš ï¸ RLS ì •ì±… ì˜ì¡´ | âš ï¸ server.js ìˆ˜ì • í•„ìš”<br>âš ï¸ ë¸”ë¡œê·¸ ì‘ì—…ê³¼ ì¡°ìœ¨ |
| ì‚¬ìš© | ğŸ”µ í˜„ì¬ (ì„ì‹œ) | ğŸŸ¢ ë‚˜ì¤‘ì— (ìµœì¢…) |

---

## ğŸ”„ Aì•ˆ â†’ Bì•ˆ ì „í™˜ ë°©ë²• (5-10ë¶„)

### ë³€ê²½ë˜ëŠ” ë¶€ë¶„ (5%)

**1. íšŒì› ëª©ë¡ ì¡°íšŒ**

**Aì•ˆ (í˜„ì¬):**
```javascript
// admin/member-management.html
async function loadMembers(userType = '', search = '', page = 1) {
  try {
    showLoading(true);
    
    // Supabase ì§ì ‘ í˜¸ì¶œ
    let query = supabase
      .from('profiles')
      .select('*', { count: 'exact' });
    
    if (userType) query = query.eq('user_type', userType);
    if (search) query = query.or(`name.ilike.%${search}%,email.ilike.%${search}%`);
    
    const offset = (page - 1) * 20;
    query = query
      .order('created_at', { ascending: false })
      .range(offset, offset + 19);
    
    const { data, error, count } = await query;
    
    if (error) throw new Error(error.message);
    
    renderMembers(data);
    renderPagination(page, count, 20);
    
  } catch (error) {
    showError(error.message);
  } finally {
    showLoading(false);
  }
}
```

**Bì•ˆ (ë‚˜ì¤‘ì— - ì´ê²ƒë§Œ êµì²´):**
```javascript
// admin/member-management.html
async function loadMembers(userType = '', search = '', page = 1) {
  try {
    showLoading(true);
    
    // API í˜¸ì¶œë¡œ ë³€ê²½ (3ì¤„ë§Œ!)
    const params = new URLSearchParams({ page, limit: 20 });
    if (userType) params.append('user_type', userType);
    if (search) params.append('search', search);
    
    const response = await fetch(`/api/admin/members?${params}`);
    const result = await response.json();
    
    if (!result.success) throw new Error(result.error);
    
    renderMembers(result.members); // ë™ì¼!
    renderPagination(result.page, result.total, result.limit);
    
  } catch (error) {
    showError(error.message);
  } finally {
    showLoading(false);
  }
}
```

---

**2. íšŒì› ë“±ê¸‰ ë³€ê²½**

**Aì•ˆ (í˜„ì¬):**
```javascript
async function updateMemberLevel(memberId, newLevel, resetUsage = false) {
  try {
    const updateData = {
      membership_level: newLevel,
      updated_at: new Date().toISOString()
    };
    
    if (resetUsage) {
      updateData.monthly_review_count = 0;
      updateData.monthly_blog_count = 0;
    }
    
    // Supabase ì§ì ‘ í˜¸ì¶œ
    const { error } = await supabase
      .from('profiles')
      .update(updateData)
      .eq('id', memberId);
    
    if (error) throw new Error(error.message);
    
    alert('ë“±ê¸‰ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
    loadMembers(); // ìƒˆë¡œê³ ì¹¨
    
  } catch (error) {
    alert('ë³€ê²½ ì‹¤íŒ¨: ' + error.message);
  }
}
```

**Bì•ˆ (ë‚˜ì¤‘ì—):**
```javascript
async function updateMemberLevel(memberId, newLevel, resetUsage = false) {
  try {
    // API í˜¸ì¶œë¡œ ë³€ê²½
    const response = await fetch(`/api/admin/members/${memberId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        membership_level: newLevel,
        reset_usage: resetUsage 
      })
    });
    
    const result = await response.json();
    
    if (!result.success) throw new Error(result.error);
    
    alert('ë“±ê¸‰ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
    loadMembers(); // ìƒˆë¡œê³ ì¹¨ (ë™ì¼)
    
  } catch (error) {
    alert('ë³€ê²½ ì‹¤íŒ¨: ' + error.message);
  }
}
```

---

**3. íšŒì› ì‚­ì œ**

**Aì•ˆ (í˜„ì¬):**
```javascript
async function deleteMember(memberId, memberName) {
  if (!confirm(`${memberName} íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  
  try {
    // Supabase ì§ì ‘ í˜¸ì¶œ
    const { error } = await supabase
      .from('profiles')
      .delete()
      .eq('id', memberId);
    
    if (error) throw new Error(error.message);
    
    alert('íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
    loadMembers();
    
  } catch (error) {
    alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
  }
}
```

**Bì•ˆ (ë‚˜ì¤‘ì—):**
```javascript
async function deleteMember(memberId, memberName) {
  if (!confirm(`${memberName} íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  
  try {
    // API í˜¸ì¶œë¡œ ë³€ê²½
    const response = await fetch(`/api/admin/members/${memberId}`, {
      method: 'DELETE'
    });
    
    const result = await response.json();
    
    if (!result.success) throw new Error(result.error);
    
    alert('íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
    loadMembers(); // ë™ì¼
    
  } catch (error) {
    alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
  }
}
```

---

### ë³€ê²½ë˜ì§€ ì•ŠëŠ” ë¶€ë¶„ (95%)

âœ… **ê·¸ëŒ€ë¡œ ìœ ì§€:**
- HTML êµ¬ì¡° ì „ì²´
- CSS ìŠ¤íƒ€ì¼ ì „ì²´
- `renderMembers()` í•¨ìˆ˜
- `renderPagination()` í•¨ìˆ˜
- ê²€ìƒ‰/í•„í„° UI
- ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
- ë¡œë”©/ì—ëŸ¬ í‘œì‹œ í•¨ìˆ˜

---

### ì „í™˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ë¸”ë¡œê·¸ ì‘ì—… ì™„ë£Œ í›„ ì§„í–‰:**

```markdown
âœ… ì¤€ë¹„ ë‹¨ê³„
- [ ] ë¸”ë¡œê·¸ ì‘ì—… ì™„ë£Œ í™•ì¸
- [ ] server.jsì— API ë¼ìš°íŠ¸ ì¶”ê°€ ì™„ë£Œ
- [ ] ë¡œì»¬ ì„œë²„ ì‹¤í–‰ ë° API í…ŒìŠ¤íŠ¸

ğŸ”„ ì „í™˜ ì‘ì—… (5-10ë¶„)
- [ ] admin/member-management.html ì—´ê¸°
- [ ] loadMembers() í•¨ìˆ˜ êµì²´ (2ë¶„)
- [ ] updateMemberLevel() í•¨ìˆ˜ êµì²´ (2ë¶„)
- [ ] deleteMember() í•¨ìˆ˜ êµì²´ (1ë¶„)
- [ ] Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì½”ë“œ ì œê±° (1ë¶„)

âœ… í…ŒìŠ¤íŠ¸
- [ ] íšŒì› ëª©ë¡ ì¡°íšŒ í™•ì¸
- [ ] ë“±ê¸‰ ë³€ê²½ í…ŒìŠ¤íŠ¸
- [ ] ê²€ìƒ‰/í•„í„° í…ŒìŠ¤íŠ¸
- [ ] íšŒì› ì‚­ì œ í…ŒìŠ¤íŠ¸
- [ ] ì—ëŸ¬ ì²˜ë¦¬ í™•ì¸

ğŸš€ ë°°í¬
- [ ] Git commit
- [ ] Vercel/Render ë°°í¬
- [ ] í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸
```

---

### ì˜ˆìƒ ë¬¸ì œ ë° í•´ê²°

**ë¬¸ì œ 1: APIê°€ 404 ì—ëŸ¬**
```
ì¦ìƒ: fetch('/api/admin/members') â†’ 404 Not Found
í•´ê²°: server.jsì— ë¼ìš°íŠ¸ ì¶”ê°€ í™•ì¸
```

**ë¬¸ì œ 2: CORS ì˜¤ë¥˜**
```
ì¦ìƒ: Access-Control-Allow-Origin ì˜¤ë¥˜
í•´ê²°: server.jsì˜ CORS ì„¤ì • í™•ì¸ (ì´ë¯¸ ìˆì„ ê²ƒ)
```

**ë¬¸ì œ 3: ë°ì´í„° í˜•ì‹ ë¶ˆì¼ì¹˜**
```
ì¦ìƒ: result.membersê°€ undefined
í•´ê²°: server.js ì‘ë‹µ í˜•ì‹ í™•ì¸ ({ success, members })
```

---

## ğŸ”„ Mock ë°ì´í„° â†’ ì‹¤ì œ API êµì²´ (ì°¸ê³ ìš©)

### admin/member-management.html ìˆ˜ì •

**í˜„ì¬ (Mock ë°ì´í„° - ì‚¬ìš© ì•ˆ í•¨)**:
```javascript
const mockMembers = [...];
renderMembers(mockMembers);
```

**êµì²´ í›„ (ì‹¤ì œ API)**:
```javascript
async function loadMembers(userType = '', search = '', page = 1) {
  try {
    showLoading(true);
    
    const params = new URLSearchParams({
      page,
      limit: 20
    });
    
    if (userType) params.append('user_type', userType);
    if (search) params.append('search', search);
    
    const response = await fetch(`/api/admin/members?${params}`);
    const data = await response.json();
    
    if (!data.success) {
      throw new Error(data.error || 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    }
    
    renderMembers(data.members);
    renderPagination(data.page, data.total, data.limit);
    
  } catch (error) {
    console.error('íšŒì› ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
    showError(error.message);
  } finally {
    showLoading(false);
  }
}
```

---

## ğŸ” ê´€ë¦¬ì ì¸ì¦ ì¶”ê°€ (ì„ íƒì‚¬í•­)

### ê°„ë‹¨í•œ ë°©ë²•: localStorage ì²´í¬

```javascript
// admin/member-management.html ìƒë‹¨
window.addEventListener('load', function() {
  const userData = localStorage.getItem('userData');
  
  if (!userData) {
    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
    window.location.href = '/login.html';
    return;
  }
  
  try {
    const user = JSON.parse(userData);
    
    // ê´€ë¦¬ì ê¶Œí•œ ì²´í¬ (ë‚˜ì¤‘ì— Supabaseì—ì„œ í™•ì¸)
    if (user.user_type !== 'admin') {
      alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤');
      window.location.href = '/index.html';
      return;
    }
    
    // ì •ìƒ ì§„í–‰
    loadMembers();
    
  } catch (e) {
    console.error('ë¡œê·¸ì¸ ì •ë³´ ì˜¤ë¥˜:', e);
    window.location.href = '/login.html';
  }
});
```

### ì„œë²„ ì¸¡ ê²€ì¦ (ë” ì•ˆì „)

```javascript
// server.js - ê´€ë¦¬ì ê¶Œí•œ ì²´í¬ ë¯¸ë“¤ì›¨ì–´
function requireAdmin(req, res, next) {
  // TODO: JWT í† í° ë˜ëŠ” ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
  const userId = req.user?.id; // ì„ì‹œ
  
  if (!userId) {
    return res.status(401).json({ 
      success: false, 
      error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' 
    });
  }
  
  // Supabaseì—ì„œ ì‚¬ìš©ì ê¶Œí•œ í™•ì¸
  supabase
    .from('profiles')
    .select('user_type')
    .eq('id', userId)
    .single()
    .then(({ data, error }) => {
      if (error || data.user_type !== 'admin') {
        return res.status(403).json({ 
          success: false, 
          error: 'ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤' 
        });
      }
      next();
    })
    .catch(err => {
      res.status(500).json({ 
        success: false, 
        error: 'ì„œë²„ ì˜¤ë¥˜' 
      });
    });
}

// ì‚¬ìš© ì˜ˆì‹œ
app.get('/api/admin/members', requireAdmin, async (req, res) => {
  // ... ê¸°ì¡´ ì½”ë“œ
});
```

---

## âœ… ì—°ë™ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 1ë‹¨ê³„: ì¤€ë¹„ í™•ì¸
- [ ] ë¸”ë¡œê·¸ ì‘ì—… ì™„ë£Œ í™•ì¸
- [ ] `Blog-Editor.html` ìˆ˜ì •ì‚¬í•­ commit ì™„ë£Œ
- [ ] server.jsì— ì¶©ëŒ ì—†ëŠ”ì§€ í™•ì¸

### 2ë‹¨ê³„: server.js ìˆ˜ì •
- [ ] Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” í™•ì¸
- [ ] íšŒì› ëª©ë¡ API ì¶”ê°€ (`GET /api/admin/members`)
- [ ] íšŒì› ë“±ê¸‰ ë³€ê²½ API ì¶”ê°€ (`PUT /api/admin/members/:id`)
- [ ] íšŒì› ìƒì„¸ ì¡°íšŒ API ì¶”ê°€ (`GET /api/admin/members/:id`)
- [ ] íšŒì› ì‚­ì œ API ì¶”ê°€ (ì„ íƒ)
- [ ] ì—ëŸ¬ ì²˜ë¦¬ í™•ì¸

### 3ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì •
- [ ] Mock ë°ì´í„° ì œê±°
- [ ] API í˜¸ì¶œ í•¨ìˆ˜ë¡œ êµì²´ (`loadMembers()`)
- [ ] ë“±ê¸‰ ë³€ê²½ ê¸°ëŠ¥ ì—°ë™
- [ ] ê²€ìƒ‰/í•„í„° ê¸°ëŠ¥ ì—°ë™
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ

### 4ë‹¨ê³„: í…ŒìŠ¤íŠ¸
- [ ] ë¡œì»¬ ì„œë²„ ì‹¤í–‰ (`node server.js`)
- [ ] `/admin/member-management.html` ì ‘ì†
- [ ] íšŒì› ëª©ë¡ ì •ìƒ í‘œì‹œ í™•ì¸
- [ ] ë“±ê¸‰ ë³€ê²½ í…ŒìŠ¤íŠ¸
- [ ] ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ì—ëŸ¬ ì²˜ë¦¬ í™•ì¸

### 5ë‹¨ê³„: ë°°í¬
- [ ] Git commit
- [ ] Vercel/Render ë°°í¬
- [ ] í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸

---

## ğŸ› ì˜ˆìƒ ë¬¸ì œ ë° í•´ê²°

### ë¬¸ì œ 1: CORS ì˜¤ë¥˜
**ì¦ìƒ**: `Access-Control-Allow-Origin` ì˜¤ë¥˜

**í•´ê²°**:
```javascript
// server.js (ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆì„ ê²ƒ)
const cors = require('cors');
app.use(cors());
```

### ë¬¸ì œ 2: Supabase ê¶Œí•œ ì˜¤ë¥˜
**ì¦ìƒ**: `new row violates row-level security policy`

**í•´ê²°**:
```sql
-- Supabase SQL Editorì—ì„œ ì‹¤í–‰
-- RLS ì •ì±…ì„ ê°œë°œ ëª¨ë“œë¡œ ë³€ê²½ (ì„ì‹œ)
DROP POLICY IF EXISTS "profiles_select_policy" ON profiles;
CREATE POLICY "profiles_select_policy" ON profiles
  FOR SELECT USING (true);
```

### ë¬¸ì œ 3: í˜ì´ì§• ì•ˆ ë¨
**ì¦ìƒ**: ëª¨ë“  íšŒì›ì´ í•œ ë²ˆì— í‘œì‹œë¨

**í•´ê²°**:
```javascript
// { count: 'exact' } ì˜µì…˜ í™•ì¸
const { data, error, count } = await supabase
  .from('profiles')
  .select('*', { count: 'exact' }) // ì´ ë¶€ë¶„ í•„ìˆ˜!
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### í”„ë¡œì íŠ¸ ë¬¸ì„œ
- `docs/AI_LOG.md` - íšŒì› ë“±ê¸‰ ì²´ê³„ ê¸°ë¡ (2025-10-22)
- `docs/ë°ì´í„°ë² ì´ìŠ¤aiì‘ì—….md` - ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ìƒì„¸
- `supabase-schema-final.sql` - í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ

### Supabase ë¬¸ì„œ
- [JavaScript Client](https://supabase.com/docs/reference/javascript/introduction)
- [Select](https://supabase.com/docs/reference/javascript/select)
- [Update](https://supabase.com/docs/reference/javascript/update)
- [Delete](https://supabase.com/docs/reference/javascript/delete)

### ê¸°ì¡´ ì½”ë“œ ì°¸ê³ 
- `admin/rank-report.html` - ì–´ë“œë¯¼ í˜ì´ì§€ ë””ìì¸ ì°¸ê³ 
- `review.html` - API í˜¸ì¶œ íŒ¨í„´ ì°¸ê³ 
- `server.js` - ê¸°ì¡´ API êµ¬ì¡° ì°¸ê³ 

---

## ğŸ“Š íšŒì› ìƒì„¸ë³´ê¸° ê¸°ëŠ¥ (2025-10-28 ì¶”ê°€)

### ê¸°ëŠ¥ ê°œìš”
íšŒì›ë³„ ìƒì„¸ í™œë™ ë‚´ì—­ì„ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

**í¬í•¨ëœ ì •ë³´:**
1. íšŒì› ê¸°ë³¸ ì •ë³´ (ì´ë¦„, ì´ë©”ì¼, ìœ í˜•, ë“±ê¸‰, ê°€ì…ì¼)
2. ì´ë²ˆ ë‹¬ ì‚¬ìš©ëŸ‰ í†µê³„ (ë¦¬ë·°/ë¸”ë¡œê·¸)
3. ìµœê·¼ ë¦¬ë·° ë‹µê¸€ ë‚´ì—­ (ìµœê·¼ 10ê°œ)
4. ìµœê·¼ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ… ë‚´ì—­ (ìµœê·¼ 10ê°œ)

### í˜„ì¬ êµ¬í˜„ (Aì•ˆ)

**JavaScript í•¨ìˆ˜:**
```javascript
// íšŒì› ìƒì„¸ì •ë³´ ì¡°íšŒ
async function showMemberDetail(memberId) {
  // profiles í…Œì´ë¸” ì¡°íšŒ
  const { data: member } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', memberId)
    .single();
  
  // ë¦¬ë·° ë‚´ì—­ ì¡°íšŒ (ë³„ë„ í•¨ìˆ˜)
  loadMemberReviews(memberId);
  
  // ë¸”ë¡œê·¸ ë‚´ì—­ ì¡°íšŒ (ë³„ë„ í•¨ìˆ˜)
  loadMemberBlogs(memberId);
}

// ë¦¬ë·° ë‚´ì—­ ì¡°íšŒ
async function loadMemberReviews(memberId) {
  const { data: reviews } = await supabase
    .from('review_responses')
    .select('*')
    .eq('user_id', memberId)
    .order('created_at', { ascending: false })
    .limit(10);
}

// ë¸”ë¡œê·¸ ë‚´ì—­ ì¡°íšŒ
async function loadMemberBlogs(memberId) {
  const { data: blogs } = await supabase
    .from('blog_posts')
    .select('*')
    .eq('user_id', memberId)
    .order('created_at', { ascending: false })
    .limit(10);
}
```

### Bì•ˆ ì „í™˜ ì‹œ ìˆ˜ì • ì‚¬í•­

#### 1. server.jsì— API ì¶”ê°€

```javascript
// íšŒì› ìƒì„¸ì •ë³´ ì¡°íšŒ
app.get('/api/admin/members/:id/detail', async (req, res) => {
  const { id } = req.params;
  
  try {
    // íšŒì› ì •ë³´
    const { data: member, error: memberError } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', id)
      .single();
    
    if (memberError) throw memberError;
    
    // ë¦¬ë·° ë‚´ì—­
    const { data: reviews, error: reviewError } = await supabase
      .from('review_responses')
      .select('*')
      .eq('user_id', id)
      .order('created_at', { ascending: false })
      .limit(10);
    
    // ë¸”ë¡œê·¸ ë‚´ì—­
    const { data: blogs, error: blogError } = await supabase
      .from('blog_posts')
      .select('*')
      .eq('user_id', id)
      .order('created_at', { ascending: false })
      .limit(10);
    
    res.json({
      success: true,
      member,
      reviews: reviews || [],
      blogs: blogs || []
    });
    
  } catch (error) {
    console.error('íšŒì› ìƒì„¸ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});
```

#### 2. í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì • (Aì•ˆ â†’ Bì•ˆ)

**Before (Aì•ˆ):**
```javascript
async function showMemberDetail(memberId) {
  // Supabase ì§ì ‘ í˜¸ì¶œ
  const { data: member } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', memberId)
    .single();
  
  loadMemberReviews(memberId);
  loadMemberBlogs(memberId);
}
```

**After (Bì•ˆ):**
```javascript
async function showMemberDetail(memberId) {
  // server.js API í˜¸ì¶œ
  const response = await fetch(`/api/admin/members/${memberId}/detail`);
  const data = await response.json();
  
  if (!data.success) throw new Error(data.error);
  
  const member = data.member;
  const reviews = data.reviews;
  const blogs = data.blogs;
  
  // UI ì—…ë°ì´íŠ¸ (ë™ì¼)
  // ...
  
  // ë°ì´í„°ë¥¼ ì§ì ‘ ë Œë”ë§ (ë³„ë„ API í˜¸ì¶œ ë¶ˆí•„ìš”)
  renderReviews(reviews);
  renderBlogs(blogs);
}

// ë³„ë„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬
function renderReviews(reviews) {
  const container = document.getElementById('detail-reviews-container');
  // reviews ë Œë”ë§
}

function renderBlogs(blogs) {
  const container = document.getElementById('detail-blogs-container');
  // blogs ë Œë”ë§
}
```

### ë³€ê²½ ë²”ìœ„ ìš”ì•½

**ìˆ˜ì • í•„ìš”:**
- `showMemberDetail()` í•¨ìˆ˜ (20ì¤„)
- `loadMemberReviews()` í•¨ìˆ˜ ì œê±°, `renderReviews()` ë¡œ ëŒ€ì²´
- `loadMemberBlogs()` í•¨ìˆ˜ ì œê±°, `renderBlogs()` ë¡œ ëŒ€ì²´

**ìˆ˜ì • ë¶ˆí•„ìš”:**
- HTML êµ¬ì¡°
- CSS ìŠ¤íƒ€ì¼
- ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° í•¨ìˆ˜

**ì˜ˆìƒ ì†Œìš” ì‹œê°„:** 15-20ë¶„

---

## ğŸ¯ ìµœì¢… ëª©í‘œ

**ì™„ì„±ë˜ë©´ ì´ë ‡ê²Œ ë©ë‹ˆë‹¤:**
1. ê´€ë¦¬ìê°€ `/admin/member-management.html` ì ‘ì†
2. Supabaseì—ì„œ ì‹¤ì‹œê°„ íšŒì› ëª©ë¡ ì¡°íšŒ
3. ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë“±ê¸‰ ë³€ê²½ â†’ ì¦‰ì‹œ DB ì—…ë°ì´íŠ¸
4. ê²€ìƒ‰/í•„í„°ë¡œ ì›í•˜ëŠ” íšŒì› ì°¾ê¸°
5. í˜ì´ì§•ìœ¼ë¡œ ë§ì€ íšŒì› ê´€ë¦¬

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**:
- server.js ìˆ˜ì •: 30-60ë¶„
- í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™: 15-30ë¶„
- í…ŒìŠ¤íŠ¸: 30ë¶„
- **ì´ 1-2ì‹œê°„**

---

**ì‘ì„±ì**: AI Assistant  
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-10-28  
**ë‹¤ìŒ ì‘ì—…**: `admin/member-management.html` í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ

