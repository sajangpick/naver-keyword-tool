# 정책지원금 실제 데이터 테스트 가이드

## 🚀 빠른 시작

### 1단계: 서버 실행
```bash
# 서버 시작
node server.js

# 또는 개발 모드
npm run dev
```

### 2단계: 관리자 페이지 접속
1. 브라우저에서 `/admin/policy-management.html` 접속
2. 관리자 계정으로 로그인
3. 빨간색 "실제 데이터 가져오기" 버튼 클릭

### 3단계: 데이터 확인
1. 사용자 페이지 `/policy-support.html` 접속
2. 수집된 정책 데이터 확인

## 📊 데이터 소스

### 현재 활성화된 소스

1. **공공데이터포털 API** (기업마당)
   - API 키: 환경변수 `PUBLIC_DATA_KEY` 또는 기본값
   - 엔드포인트: `https://api.odcloud.kr/api/...`
   - 필터링: 소상공인 관련 키워드만 추출

2. **정책브리핑 RSS**
   - URL: `https://www.korea.kr/rss/policy.xml`
   - 인증: 불필요
   - 필터링: 소상공인/중소기업 관련 정책만 추출

3. **백업 데이터** (API 실패 시)
   - 내장된 6개 샘플 정책 데이터
   - 항상 시스템이 작동하도록 보장

## 🔍 테스트 방법

### 방법 1: 관리자 페이지에서 테스트

```javascript
// 브라우저 콘솔에서 직접 실행
fetch('http://localhost:5000/api/fetch-real-policies', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({ save: false })  // 저장 안 함, 조회만
})
.then(res => res.json())
.then(data => {
  console.log('수집된 정책 수:', data.count);
  console.log('정책 목록:', data.data);
});
```

### 방법 2: API 직접 호출 테스트

```bash
# GET: 데이터 조회만
curl http://localhost:5000/api/fetch-real-policies

# POST: 데이터 수집 (저장은 클라이언트에서)
curl -X POST http://localhost:5000/api/fetch-real-policies \
  -H "Content-Type: application/json" \
  -d '{"save": false}'
```

## 🐛 트러블슈팅

### 문제 1: "수집된 정책 데이터가 없습니다"

**원인:**
- API 키가 유효하지 않음
- API 엔드포인트 변경
- 네트워크 오류

**해결:**
1. 서버 콘솔에서 에러 메시지 확인
2. API 키 확인: `console.log(process.env.PUBLIC_DATA_KEY)`
3. 공공데이터포털에서 API 키 재발급

### 문제 2: "데이터 저장 실패"

**원인:**
- 인증 토큰 만료
- 데이터베이스 연결 오류
- 필수 필드 누락

**해결:**
1. 관리자 로그인 확인
2. Supabase 연결 확인
3. 콘솔에서 상세 에러 확인

### 문제 3: 중복 데이터 저장

**원인:**
- 중복 체크 로직 실패
- 제목이 약간 다른 경우

**해결:**
- 중복 체크는 제목 기준으로 작동
- 약간 다른 제목은 별도 항목으로 저장됨 (정상)

## 📈 데이터 수집 현황

### 예상 수집량

- **공공데이터포털**: 10~100개 (키워드 필터링 후)
- **RSS 피드**: 5~20개 (관련 정책만)
- **총합**: 15~120개 (실시간 변동)

### 필터링 키워드

다음 키워드가 포함된 정책만 수집됩니다:
- 소상공인
- 중소기업
- 자영업
- 창업
- 지원금
- 보조금
- 융자
- 바우처

## 🔄 자동 업데이트

### 수동 업데이트 (현재)
- 관리자 페이지에서 "실제 데이터 가져오기" 버튼 클릭
- 필요할 때마다 수동으로 실행

### 자동 업데이트 (향후)
- 크론 작업으로 매일 자동 수집
- 새 정책만 추가 (중복 제거)

## 📝 로그 확인

### 서버 로그
```bash
# 서버 콘솔에서 확인
✅ 15개의 실제 정책 데이터를 가져왔습니다.
✅ RSS에서 8개의 정책을 가져왔습니다.
```

### 브라우저 콘솔
```javascript
// 관리자 페이지에서 확인
// 데이터 수집 중... → 데이터 저장 중... (5/15) → 완료
```

## ✅ 체크리스트

테스트 전 확인사항:
- [ ] 서버가 실행 중인가?
- [ ] 환경변수 `PUBLIC_DATA_KEY` 설정되었는가? (선택사항)
- [ ] 관리자 계정으로 로그인했는가?
- [ ] Supabase 연결이 정상인가?
- [ ] 네트워크 연결이 정상인가?

## 🎯 성공 기준

정상 작동 시:
1. ✅ "데이터 수집 완료!" 메시지 표시
2. ✅ "새로 추가: X개" 표시
3. ✅ 사용자 페이지에서 정책 목록 확인 가능
4. ✅ 정책 상세 정보 표시 정상

## 📞 지원

문제가 발생하면:
1. 서버 콘솔 로그 확인
2. 브라우저 개발자 도구 콘솔 확인
3. 네트워크 탭에서 API 응답 확인
4. `docs/정책지원금_API_설정_가이드.md` 참고

