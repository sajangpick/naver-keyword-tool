# '사장픽' 시스템 기술 명세서 (API 워크플로우 V3 - 사용자 경험 중심)

> **최종 목표:** 식당 대표가 **스타일을 선택하고 사진+키워드를 입력**하면, '사장픽'이 자동으로 **프로페셔널한 쇼츠 영상을 생성**한다. (블로그 에디터 수준의 간편함)

---

## 🎬 사용자 경험 (UX) 플로우 - V3

### **Step 1: 샘플 영상 감상 (영감 단계)**
식당 대표가 '사장픽' 쇼츠 생성 페이지에 접속하면:
1. **사전 제작된 샘플 영상 3-5개 표시** (홍보/광고 스타일)
   - 예: "럭셔리 감성", "빠른 서빙", "정성있는 조리 과정" 등
   - 각 샘플은 영상으로 플레이되며 "이 스타일로 만들기" 버튼 제공

### **Step 2: 영상 스타일 선택 (톤 설정)**
사용자가 원하는 스타일을 선택합니다:
- 🎬 **럭셔리**: 고급스러운 음식 영상 (느린 줌, 조명 강조)
- ⚡ **빠른 리듬**: 빠른 편집, 트렌디한 효과
- 👨‍🍳 **셰프의 손**: 조리 과정, 손 작업 강조
- 🍽️ **플레이팅**: 완성된 요리의 아름다움
- 🌟 **심플 클래식**: 깔끔하고 프로페셔널

### **Step 3: 재료 입력 (콘텐츠 작성)**
선택한 스타일의 템플릿에 맞게 입력:
1. **사진 업로드** (1-3장)
   - 음식 사진 (주)
   - 재료 또는 과정 사진 (선택)
2. **키워드/텍스트 입력**
   - 메뉴명 (예: "새우 파스타")
   - 핵심 특징 (예: "신선한 새우, 수제 파스타")
   - 가격 정보 (선택)
3. **배경음악 선택** (자동 제공)
   - 스타일별 추천 음악 목록

### **결과: 완성된 쇼츠 영상**
- 길이: 9-15초 (숏폼 최적화)
- 품질: 1080p 이상
- 다운로드 가능 (SNS 직업로드 가능)

---

## 🎯 구현 검토 및 의사결정 (2025.11.08)

### 질문 1️⃣: Creatomate 템플릿 5개 생성
**사용자 답변**: "너 만들 수 있어? 일단 샘플로"
- ✅ **담당**: AI가 샘플 템플릿 구조 설계 및 가이드 제공
- 📝 **다음 단계**: Creatomate 대시보드 API 분석 후 샘플 템플릿 설계안 작성

### 질문 2️⃣: 배경음악 소스
**사용자 답변**: "너가 알아봐줘"
- 📊 **조사 완료**: 로열티프리 음악 소스 비교 분석
- 🎵 **추천 솔루션**:

#### 후보 1: **YouTube Audio Library** ⭐ 추천
- ✅ **장점**: 완전 무료, 저작권 이슈 없음, 한국어 지원, 웹 기반
- ✅ **용도**: 상업용 영상 가능
- ✅ **선곡**: 음식/요리 테마 음악 풍부
- ❌ **단점**: API 없음 (수동 다운로드 필요)
- 📌 **비용**: $0

#### 후보 2: **Epidemic Sound**
- ✅ **장점**: API 지원, 자동화 가능, 고품질 음악
- ✅ **용도**: 상업용 영상 가능
- ❌ **단점**: 구독 필수 ($9.99/월 이상)
- 📌 **비용**: $120/년

#### 후보 3: **Artlist**
- ✅ **장점**: API 지원, 로열티프리, 고품질
- ✅ **용도**: 상업용 영상 가능
- ❌ **단점**: 구독 필수 ($14.99/월 이상)
- 📌 **비용**: $180/년

#### 후보 4: **Pexels Music** (구Pexels)
- ✅ **장점**: 완전 무료, API 지원 가능
- ✅ **용도**: 상업용 영상 가능
- ⚠️ **단점**: API 공식 지원 없음 (크롤링 필요)
- 📌 **비용**: $0

#### 최종 선정 전략:
```
Phase 1 (무료): YouTube Audio Library 
  → 사용자 선택형 인터페이스 (다운로드 후 수동 업로드)

Phase 2 (자동화): Pexels Music API 연동
  → 자동 음악 선택 기능 (스타일별 추천)

Phase 3 (고급): Epidemic Sound 구독
  → 프리미엄 음악 라이브러리 (선택사항)
```

### 질문 3️⃣: API 비용 정책
**사용자 답변**: "유료만 진행해야지 등급(예: 식당대표 최고등급만)"
- 💰 **결정**: 유료 기능 (최고등급 사용자만)
- 📊 **참고**: 현재 구독 시스템 (docs/05_결제_토큰시스템/)과 연계 필요

### 질문 4️⃣: 처리 시간 안내
**사용자 이해**: "영상길이(시간)을 정해야 할것 같아"
- ⏱️ **권장 길이 정책**:
  - 광고용: **10초 권장** (TikTok/Instagram Reels 표준)
  - 프로모션: **15초 권장** (YouTube Shorts 표준)
  - 스토리: **5-8초 권장** (빠른 스크롤 대응)
  - 사용자 선택: 최소 5초 ~ 최대 30초 (자유 설정)
- 🎬 **UI**: 스타일 선택 시 권장 길이 표시 + 사용자 커스텀 가능

---

## 📋 준비 작업 계획서 (작업 시작 전 필수)

### 🎯 Phase 0: 사전 준비 및 조사 (작업 미실시)

#### Task 1️⃣: Creatomate 템플릿 5개 설계안 작성
**상태**: ⏳ 준비 중
**담당**: AI
**산출물**: 각 스타일별 템플릿 구조 및 파라미터 문서
```
Template 1: 럭셔리 (Luxury)
- 프롬프트: 느린 줌인, 조명 강조, 고급스러운 음악
- 길이: 15초 권장
- 요소: 메인 영상(중앙), 메뉴명(상단), 가격(하단), 로고(모서리)

Template 2: 빠른 리듬 (Fast Paced)
- 프롬프트: 빠른 전환, 트렌디 효과, 비트감있는 음악
- 길이: 10초 권장
- 요소: 다중 영상(분할), 텍스트 애니메이션, 특수 효과

Template 3: 셰프의 손 (Chef's Hand)
- 프롬프트: 조리 과정, 손 작업 강조, 부드러운 음악
- 길이: 12초 권장
- 요소: 상단 영상, 하단 텍스트, 진행률 표시

Template 4: 플레이팅 (Plating)
- 프롬프트: 완성된 요리, 아름다운 앵글, 우아한 음악
- 길이: 8초 권장
- 요소: 풀스크린 영상, 중앙 텍스트, 배경 오버레이

Template 5: 심플 클래식 (Simple Classic)
- 프롬프트: 미니멀 디자인, 깔끔한 폰트, 프로페셔널 음악
- 길이: 10초 권장
- 요소: 중앙 영상, 흰색 배경, 블랙 텍스트, 미니멀 로고
```

#### Task 2️⃣: 배경음악 통합 전략 확정
**상태**: ⏳ 준비 중
**담당**: AI + 사용자 확정 필요
**선택 필요**:
- [ ] Phase 1로 YouTube Audio Library만 시작?
- [ ] Phase 2로 Pexels Music API 바로 도입?
- [ ] Phase 3로 Epidemic Sound 구독 고려?
**산출물**: 선택된 음악 소스별 연동 가이드

#### Task 3️⃣: 구독 등급 연계 정책 확정
**상태**: ⏳ 확인 필요
**담당**: 사용자 확정 필요
**확인사항**:
- [ ] 최고등급 사용자만 쇼츠 생성 가능?
- [ ] 일일 생성 제한이 있나? (예: 3회/일)
- [ ] 크레딧 시스템? 아니면 무제한?
- [ ] 가격 책정? (예: 월 5,000원 추가?)
**산출물**: 구독 정책 문서 (문서 참고: docs/05_결제_토큰시스템/)

#### Task 4️⃣: 동영상 길이 가이드라인 확정
**상태**: ✅ 완료 (파일 상단 참조)
**결정사항**:
- 광고용: **10초 권장** (TikTok/Instagram Reels)
- 프로모션: **15초 권장** (YouTube Shorts)
- 스토리: **5-8초 권장** (빠른 스크롤)
- 사용자 선택: 5~30초 자유 설정
**산출물**: UI 가이드에 반영됨

---

## 📊 준비 작업 체크리스트

### Before Coding (코딩 전 필수)

#### 기술 조사
- [ ] Creatomate API 문서 분석
- [ ] 런웨이 API 이미지→영상 엔드포인트 확인
- [ ] 선택된 음악 API 문서 검토
- [ ] 구독 시스템과의 연계 방식 확인

#### 설계 문서 작성
- [ ] Creatomate 템플릿 5개 상세 설계
- [ ] 런웨이 프롬프트 템플릿 5개 작성
- [ ] 음악 선택 로직 플로우차트
- [ ] 사용자 입력 폼 Wireframe
- [ ] DB 스키마 설계

#### 외부 서비스 설정
- [ ] Creatomate 대시보드에 템플릿 5개 생성 (또는 생성 계획)
- [ ] 음악 소스 선택 및 라이센스 확인
- [ ] 구독 정책 최종 확정
- [ ] 비용 예산 검토

#### 문서화
- [ ] API 통합 가이드 작성
- [ ] 사용자 가이드 작성
- [ ] 개발자 문서 작성

---

## 🚀 준비 완료 후 다음 단계

1. **구현 로드맵** 작성
2. **프론트엔드** 개발 시작 (HTML/CSS/JS)
3. **백엔드 API** 개발 (Node.js)
4. **테스트 및 배포**

---

## 🔧 기술 구현 명세 (V2 유지)

## 1. 사용자 (식당 대표): 프론트엔드 입력

1.  **플랫폼 접속:** 사용자가 '사장픽' 프론트엔드(웹 또는 앱)에 접속합니다.
2.  **데이터 입력:** 'AI 쇼츠 생성' 페이지에서 다음 데이터를 입력하고 '생성' 버튼을 클릭합니다.
    * `[음식 사진 1장]` (예: `pasta.jpg`)
    * `[메뉴 텍스트]` (예: "새우 파스타")
    * `[가격 텍스트]` (예: "18,000원")

## 2. 사장픽 서버 (백엔드): 1차 API 호출 준비

1.  **데이터 수신:** '사장픽' 백엔드 서버가 프론트엔드로부터 이미지 파일과 텍스트 데이터를 수신합니다.
2.  **파일 저장:** 수신된 `pasta.jpg`를 AWS S3 등 클라우드 스토리지에 업로드하고, 공개 접근 가능한 URL을 확보합니다. (예: `https://s3.sajangpick.com/uploads/pasta.jpg`)

## 3. [1차 API 호출] 사장픽 서버 → 런웨이(Runway) API

> **[전략: 안정]** '핵심 퀄리티(마법)' 담당. NVIDIA, SoftBank 등이 투자한 대규모 기업(기업가치 4조원)으로, '사장픽' 운영 기간 내 서비스 중단 위험이 극히 낮아 **안정적인 파트너**로 신뢰할 수 있습니다.

1.  **API 호출:** '사장픽' 서버가 '런웨이'의 'Image-to-Video' 엔드포인트(Endpoint)를 호출합니다.
2.  **Request (요청):** 이미지 URL과 생성 옵션을 담아 POST 요청을 전송합니다.
    * **요청 내용:** "이 이미지(`pasta.jpg`)에 '김이 모락모락 나는' 효과와 '느린 줌인' 모션을 추가하여 3초짜리 영상 클립으로 변환하라."
    * **JSON Body (예시):**
        ```json
        {
          "image": "[https://s3.sajangpick.com/uploads/pasta.jpg](https://s3.sajangpick.com/uploads/pasta.jpg)",
          "prompt": "Steam rising from hot pasta, slow zoom in, cinematic.",
          "duration_seconds": 3
        }
        ```
3.  **처리 대기:** '런웨이'는 비동기(Asynchronous)로 작동합니다. 요청 즉시 `job_id`를 반환하며, '사장픽' 서버는 Webhook 또는 Polling(주기적 상태 확인) 방식으로 작업 완료를 기다립니다.

## 4. [1차 API 응답] 런웨이 API → 사장픽 서버

1.  **작업 완료:** '런웨이'가 AI 영상 클립 생성을 완료합니다.
2.  **Webhook 수신:** '사장픽' 서버가 '런웨이'로부터 작업 완료 Webhook을 수신합니다.
3.  **결과물 확보:** Webhook 데이터 또는 `job_id` 조회를 통해 생성된 **`[영상 클립 URL]`**을 확보합니다.
    * **결과 (예):** `https://runway-cdn.com/clips/generated_clip.mp4`

## 5. [2차 API 호출] 사장픽 서버 → 크리에이토메이트(Creatomate) API

> **[전략: 유연성]** '단순 조립(편집)' 담당. 투자를 받지 않은 2인 소규모 기업으로, '런웨이' 대비 서비스 안정성이 낮습니다. **(아래 8번 전략 참조)**

1.  **API 호출:** '사장픽' 서버가 '크리에이토메이트'의 'Render Video' 엔드포인트를 호출합니다.
2.  **Request (요청):** 미리 Creatomate 대시보드에서 디자인한 `[템플릿 ID]`와, 템플릿의 각 요소를 대체할 **'Modifications'** 데이터를 전송합니다.
3.  **JSON Body (예시):**
    ```json
    {
      "template_id": "sajangpick_shorts_template_v1",
      "modifications": {
        "main_video_layer": "[https://runway-cdn.com/clips/generated_clip.mp4](https://runway-cdn.com/clips/generated_clip.mp4)",
        "menu_text_layer": "새우 파스타",
        "price_text_layer": "18,000원",
        "logo_image_layer": "[https://s3.sajangpick.com/logos/user_logo.png](https://s3.sajangpick.com/logos/user_logo.png)",
        "bgm_track": "[https://s3.sajangpick.com/music/upbeat_v1.mp3](https://s3.sajangpick.com/music/upbeat_v1.mp3)"
      }
    }
    ```
4.  **처리 대기:** '크리에이토메이트' 역시 비동기(Asynchronous)로 작동하며, '사장픽' 서버는 Webhook 또는 Polling으로 렌더링 완료를 기다립니다.

## 6. [2차 API 응답] 크리에이토메이트 API → 사장픽 서버

1.  **작업 완료:** '크리에이토메이트'가 모든 재료를 조립하여 최종 영상 렌더링을 완료합니다.
2.  **Webhook 수신:** '사장픽' 서버가 '크리에이토메이트'로부터 작업 완료 Webhook을 수신합니다.
3.  **결과물 확보:** Webhook을 통해 **`[최종 쇼츠 영상 URL]`**을 확보합니다.
    * **결과 (예):** `https://creatomate-cdn.com/renders/final_short_123.mp4`

## 7. 사용자 (식당 대표): 프론트엔드 결과 확인

1.  **DB 저장:** '사장픽' 서버는 `[최종 쇼츠 영상 URL]`을 사용자 계정의 DB에 저장합니다.
2.  **알림/업데이트:** '사장픽' 서버가 프론트엔드로 '영상 제작 완료' 알림(예: WebSocket)을 보냅니다.
3.  **영상 재생:** 사용자는 '사장픽' 프론트엔드 화면에서 최종 완성된 쇼츠 영상을 즉시 확인하고 다운로드할 수 있습니다.

---

## 8. [중요] 개발 전략: '조립' API의 유연성 확보

> 이 섹션은 대준형의 '서비스 중단 염려'를 해결하기 위한 핵심 개발 전략입니다.

1.  **현황 (Risk):**
    * '마법' API인 '런웨이'는 안정적입니다.
    * '조립' API인 '크리에이토메이트'는 2인 기업(부트스트랩)이므로, 서비스 중단, 급격한 가격 인상, 기술 지원 중단 등의 운영 리스크가 '런웨이'보다 상대적으로 높습니다.

2.  **대응 전략 (Strategy):**
    * '사장픽' 백엔드 시스템은 **특정 '조립' API(크리에이토메이트)에 종속되지 않도록 설계**해야 합니다.
    * '영상 조립' 기능을 **별도의 모듈(Module) 또는 인터페이스(Interface)로 분리**하여 개발합니다.

3.  **구현 방안 (Action Plan):**
    * `IVideoEditorService` 같은 인터페이스를 정의합니다.
    * `CreatomateService` 클래스가 이 인터페이스를 구현하도록 만듭니다.
    * '사장픽'의 메인 로직은 `CreatomateService`를 직접 호출하는 것이 아니라, `IVideoEditorService` 인터페이스를 통해 호출합니다.

4.  **비상 계획 (Contingency Plan):**
    * 만약 '크리에이토메이트'에 문제가 발생하면, **'샷스택(Shotstack)'** 등 다른 경쟁 API의 키를 발급받습니다.
    * `ShotstackService`라는 새 클래스를 만들어서 `IVideoEditorService` 인터페이스를 똑같이 구현합니다.
    * '사장픽' 백엔드 설정 파일에서 `CreatomateService`를 `ShotstackService`로 **교체(Swap)하기만 하면** '사장픽' 서비스 중단 없이 '조립' 기능을 즉시 복구할 수 있습니다.