# '사장픽' 시스템의 기술적 순서 (API 워크플로우)

## 1. 사용자 (식당 대표): 프론트엔드 입력

1.  **플랫폼 접속:** 사용자가 '사장픽' 프론트엔드(웹 또는 앱)에 접속합니다.
2.  **데이터 입력:** 'AI 쇼츠 생성' 페이지에서 다음 데이터를 입력하고 '생성' 버튼을 클릭합니다.
    * `[음식 사진 1장]` (예: `pasta.jpg`)
    * `[메뉴 텍스트]` (예: "새우 파스타")
    * `[가격 텍스트]` (예: "18,000원")

## 2. 사장픽 서버 (백엔드): 1차 API 호출 준비

1.  **데이터 수신:** '사장픽' 백엔드 서버가 프론트엔드로부터 이미지 파일과 텍스트 데이터를 수신합니다.
2.  **파일 저장:** 수신된 `pasta.jpg`를 AWS S3 등 클라우드 스토리지에 업로드하고, 공개 접근 가능한 URL을 확보합니다. (예: `https://s3.sajangpick.com/uploads/pasta.jpg`)

## 3. [1차 API 호출] 사장픽 서버 → 런웨이(Runway) API

1.  **API 호출:** '사장픽' 서버가 '런웨이'의 'Image-to-Video' 엔드포인트(Endpoint)를 호출합니다.
2.  **Request (요청):** 이미지 URL과 생성 옵션을 담아 POST 요청을 전송합니다.
    * **요청 내용:** "이 이미지(`pasta.jpg`)에 '김이 모락모락 나는' 효과와 '느린 줌인' 모션을 추가하여 3초짜리 영상 클립으로 변환하라."
    * **JSON Body (예시):**
        ```json
        {
          "image": "[https://s3.sajangpick.com/uploads/pasta.jpg](https://s3.sajangpick.com/uploads/pasta.jpg)",
          "prompt": "Steam rising from hot pasta, slow zoom in, cinematic.",
          "duration_seconds": 3
        }
        ```
3.  **처리 대기:** '런웨이'는 비동기(Asynchronous)로 작동합니다. 요청 즉시 `job_id`를 반환하며, '사장픽' 서버는 Webhook 또는 Polling(주기적 상태 확인) 방식으로 작업 완료를 기다립니다.

## 4. [1차 API 응답] 런웨이 API → 사장픽 서버

1.  **작업 완료:** '런웨이'가 AI 영상 클립 생성을 완료합니다.
2.  **Webhook 수신:** '사장픽' 서버가 '런웨이'로부터 작업 완료 Webhook을 수신합니다.
3.  **결과물 확보:** Webhook 데이터 또는 `job_id` 조회를 통해 생성된 **`[영상 클립 URL]`**을 확보합니다.
    * **결과 (예):** `https://runway-cdn.com/clips/generated_clip.mp4`

## 5. [2차 API 호출] 사장픽 서버 → 크리에이토메이트(Creatomate) API

1.  **API 호출:** '사장픽' 서버가 '크리에이토메이트'의 'Render Video' 엔드포인트를 호출합니다.
2.  **Request (요청):** 미리 Creatomate 대시보드에서 디자인한 `[템플릿 ID]`와, 템플릿의 각 요소를 대체할 **'Modifications'** 데이터를 전송합니다.
3.  **JSON Body (예시):**
    ```json
    {
      "template_id": "sajangpick_shorts_template_v1",
      "modifications": {
        "main_video_layer": "[https://runway-cdn.com/clips/generated_clip.mp4](https://runway-cdn.com/clips/generated_clip.mp4)",
        "menu_text_layer": "새우 파스타",
        "price_text_layer": "18,000원",
        "logo_image_layer": "[https://s3.sajangpick.com/logos/user_logo.png](https://s3.sajangpick.com/logos/user_logo.png)",
        "bgm_track": "[https://s3.sajangpick.com/music/upbeat_v1.mp3](https://s3.sajangpick.com/music/upbeat_v1.mp3)"
      }
    }
    ```
4.  **처리 대기:** '크리에이토메이트' 역시 비동기(Asynchronous)로 작동하며, '사장픽' 서버는 Webhook 또는 Polling으로 렌더링 완료를 기다립니다.

## 6. [2차 API 응답] 크리에이토메이트 API → 사장픽 서버

1.  **작업 완료:** '크리에이토메이트'가 모든 재료를 조립하여 최종 영상 렌더링을 완료합니다.
2.  **Webhook 수신:** '사장픽' 서버가 '크리에이토메이트'로부터 작업 완료 Webhook을 수신합니다.
3.  **결과물 확보:** Webhook을 통해 **`[최종 쇼츠 영상 URL]`**을 확보합니다.
    * **결과 (예):** `https://creatomate-cdn.com/renders/final_short_123.mp4`

## 7. 사용자 (식당 대표): 프론트엔드 결과 확인

1.  **DB 저장:** '사장픽' 서버는 `[최종 쇼츠 영상 URL]`을 사용자 계정의 DB에 저장합니다.
2.  **알림/업데이트:** '사장픽' 서버가 프론트엔드로 '영상 제작 완료' 알림(예: WebSocket)을 보냅니다.
3.  **영상 재생:** 사용자는 '사장픽' 프론트엔드 화면에서 최종 완성된 쇼츠 영상을 즉시 확인하고 다운로드할 수 있습니다.