# μ „ν™”λ²νΈ μ•”νΈν™” μ‹μ¤ν… κ°€μ΄λ“

## π“‹ κ°μ”

μ‚¬μ¥ν”½ ν”„λ΅μ νΈμ λ¨λ“  μ „ν™”λ²νΈλ” **AES-256-GCM** μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•μ—¬ μ•”νΈν™”λμ–΄ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥λ©λ‹λ‹¤.

μ΄ μ‹μ¤ν…μ€ ν•΄μ»¤κ°€ λ°μ΄ν„°λ² μ΄μ¤λ¥Ό ν„Έμ–΄κ°€λ„ μ „ν™”λ²νΈλ¥Ό μ½μ„ μ μ—†λ„λ΅ λ³΄νΈν•©λ‹λ‹¤.

---

## π” μ•”νΈν™” λ°©μ‹

### μ‚¬μ© κΈ°μ 
- **μ•κ³ λ¦¬μ¦**: AES-256-GCM (Advanced Encryption Standard 256λΉ„νΈ, Galois/Counter Mode)
- **ν‚¤ κΈΈμ΄**: 256λΉ„νΈ (32λ°”μ΄νΈ)
- **μΈμ¦ νƒκ·Έ**: 16λ°”μ΄νΈ (λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ¦)

### μ‘λ™ μ›λ¦¬

1. **μ €μ¥ μ‹ (μ•”νΈν™”)**
   ```
   μ›λ³Έ: 010-6664-3744
   β†“ (AES-256-GCM μ•”νΈν™”)
   μ•”νΈν™”: gAAAAABk... (Base64 μΈμ½”λ”©λ μ™Έκ³„μ–΄)
   β†“ (DB μ €μ¥)
   λ°μ΄ν„°λ² μ΄μ¤: gAAAAABk...
   ```

2. **μ΅°ν μ‹ (λ³µνΈν™”)**
   ```
   λ°μ΄ν„°λ² μ΄μ¤: gAAAAABk...
   β†“ (AES-256-GCM λ³µνΈν™”)
   μ›λ³Έ: 010-6664-3744
   β†“ (μ‚¬μ©μμ—κ² ν‘μ‹)
   ν™”λ©΄: 010-6664-3744
   ```

---

## β™οΈ ν™κ²½λ³€μ μ„¤μ •

### ν•„μ ν™κ²½λ³€μ

**`ENCRYPTION_KEY`** - μ•”νΈν™”/λ³µνΈν™”μ— μ‚¬μ©ν•λ” λΉ„λ°€ν‚¤

#### λ΅μ»¬ κ°λ° ν™κ²½ (.env νμΌ)

```bash
# .env νμΌμ— μ¶”κ°€
ENCRYPTION_KEY=your-super-secret-key-32-characters-long
```

**β οΈ μ¤‘μ”**: 
- ν‚¤λ” **μµμ† 32μ μ΄μƒ**μ΄μ–΄μ•Ό ν•©λ‹λ‹¤
- ν‚¤λ” **μ λ€ κ³µκ°ν•μ§€ λ§μ„Έμ”** (GitHubμ— μ»¤λ°‹ν•μ§€ λ§μ„Έμ”)
- ν‚¤λ¥Ό μƒμ–΄λ²„λ¦¬λ©΄ μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό λ³µκµ¬ν•  μ μ—†μµλ‹λ‹¤

#### ν‚¤ μƒμ„± λ°©λ²•

**λ°©λ²• 1: μ¨λΌμΈ μƒμ„±κΈ° μ‚¬μ©**
```bash
# 64μ λλ¤ λ¬Έμμ—΄ μƒμ„± (32λ°”μ΄νΈ = 256λΉ„νΈ)
openssl rand -hex 32
```

**λ°©λ²• 2: Node.jsλ΅ μƒμ„±**
```javascript
const crypto = require('crypto');
console.log(crypto.randomBytes(32).toString('hex'));
```

**λ°©λ²• 3: κ°„λ‹¨ν• ν‚¤ (κ°λ°μ©)**
```
ENCRYPTION_KEY=sajangpick-secret-key-2024-very-long-key-for-encryption
```

#### λ°°ν¬ ν™κ²½ μ„¤μ •

**Render (λ°±μ—”λ“ μ„λ²„)**
1. Render λ€μ‹λ³΄λ“ β†’ μ„λΉ„μ¤ μ„ νƒ
2. Environment β†’ Add Environment Variable
3. Key: `ENCRYPTION_KEY`
4. Value: μƒμ„±ν• ν‚¤ μ…λ ¥
5. Save Changes

**Vercel (ν”„λ΅ νΈμ—”λ“)**
- Vercelμ€ μ„λ²„λ¦¬μ¤ ν™κ²½μ΄λ―€λ΅ μ•”νΈν™”λ” Renderμ—μ„λ§ μν–‰λ©λ‹λ‹¤
- Vercel ν™κ²½λ³€μ μ„¤μ •μ€ λ¶ν•„μ”ν•©λ‹λ‹¤

---

## π“ νμΌ κµ¬μ΅°

### μ•”νΈν™” μ„λΉ„μ¤
```
lib/
β””β”€β”€ cipher-service.js    # μ•”νΈν™”/λ³µνΈν™” ν•µμ‹¬ λ΅μ§
```

### μ μ©λ API νμΌ
```
api/
β”β”€β”€ store-info.js              # κ°€κ² μ •λ³΄ μ €μ¥/μ΅°ν (store_phone_number)
β”β”€β”€ kakao-alimtalk.js          # μΉ΄μΉ΄μ¤ μ•λ¦Όν†΅ λ°μ†΅ (phone_number λ³µνΈν™”)
β”β”€β”€ policy-support.js          # μ •μ±…μ§€μ›κΈ κ΄€λ¦¬ (phone_number)
β”β”€β”€ fetch-real-policy-data.js  # μ •μ±… λ°μ΄ν„° μμ§‘ (phone_number μ•”νΈν™”)
β””β”€β”€ chatgpt-blog.js           # λΈ”λ΅κ·Έ μƒμ„± (place_crawl_cache)
```

---

## π”§ μ‚¬μ© λ°©λ²•

### κΈ°λ³Έ μ‚¬μ©λ²•

```javascript
const cipher = require('./lib/cipher-service');

// μ•”νΈν™”
const encrypted = cipher.encrypt('010-6664-3744');
// κ²°κ³Ό: 'gAAAAABk...' (μ•”νΈν™”λ λ¬Έμμ—΄)

// λ³µνΈν™”
const decrypted = cipher.decrypt(encrypted);
// κ²°κ³Ό: '010-6664-3744' (μ›λ λ²νΈ)
```

### κ°μ²΄ ν•„λ“ μ•”νΈν™”/λ³µνΈν™”

```javascript
// μ—¬λ¬ ν•„λ“ ν• λ²μ— μ•”νΈν™”
const encryptedData = cipher.encryptFields(
  { 
    name: 'ν™κΈΈλ™', 
    phone: '010-6664-3744',
    store_phone: '02-1234-5678' 
  },
  ['phone', 'store_phone']  // μ•”νΈν™”ν•  ν•„λ“λ…
);

// μ—¬λ¬ ν•„λ“ ν• λ²μ— λ³µνΈν™”
const decryptedData = cipher.decryptFields(
  encryptedData,
  ['phone', 'store_phone']  // λ³µνΈν™”ν•  ν•„λ“λ…
);
```

---

## π—„οΈ λ°μ΄ν„°λ² μ΄μ¤ ν…μ΄λΈ”

### μ•”νΈν™”κ°€ μ μ©λ μ»¬λΌ

1. **`profiles` ν…μ΄λΈ”**
   - `phone_number` - νμ› μ—°λ½μ²
   - `store_phone_number` - κ°€κ² μ „ν™”λ²νΈ

2. **`policy_supports` ν…μ΄λΈ”**
   - `phone_number` - μ •μ±… λ¬Έμ μ „ν™”λ²νΈ

3. **`place_crawl_cache` ν…μ΄λΈ”**
   - `phone_number` - ν¬λ΅¤λ§ν• κ°€κ² μ „ν™”λ²νΈ

---

## π¨ μ£Όμμ‚¬ν•­

### 1. ν‚¤ κ΄€λ¦¬
- β… **μ λ€ GitHubμ— μ»¤λ°‹ν•μ§€ λ§μ„Έμ”**
- β… **.env νμΌμ€ .gitignoreμ— ν¬ν•¨λμ–΄ μλ”μ§€ ν™•μΈ**
- β… **ν‚¤λ¥Ό μƒμ–΄λ²„λ¦¬λ©΄ λ°μ΄ν„° λ³µκµ¬ λ¶κ°€λ¥**

### 2. κΈ°μ΅΄ λ°μ΄ν„° νΈν™μ„±
- μ•”νΈν™” ν‚¤κ°€ μ„¤μ •λκΈ° μ „μ— μ €μ¥λ λ°μ΄ν„°λ” λ³µνΈν™” μ‹λ„ ν›„ μ‹¤ν¨ν•λ©΄ μ›λ³Έ κ·Έλ€λ΅ λ°ν™λ©λ‹λ‹¤
- κΈ°μ΅΄ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•λ ¤λ©΄ λ§μ΄κ·Έλ μ΄μ… μ¤ν¬λ¦½νΈκ°€ ν•„μ”ν•©λ‹λ‹¤

### 3. μ„±λ¥
- μ•”νΈν™”/λ³µνΈν™”λ” λ§¤μ° λΉ λ¥΄μ§€λ§ (1ms λ―Έλ§), λ€λ‰ λ°μ΄ν„° μ²λ¦¬ μ‹ μ•½κ°„μ μ§€μ—°μ΄ λ°μƒν•  μ μμµλ‹λ‹¤
- μΊμ‹λ¥Ό ν™μ©ν•μ—¬ μ„±λ¥μ„ μµμ ν™”ν–μµλ‹λ‹¤

### 4. ENCRYPTION_KEYκ°€ μ—†μ„ λ•
- ν‚¤κ°€ μ—†μΌλ©΄ κ²½κ³  λ©”μ‹μ§€κ°€ μ¶λ ¥λκ³ , μ „ν™”λ²νΈκ°€ μ•”νΈν™”λμ§€ μ•μ€ μƒνƒλ΅ μ €μ¥λ©λ‹λ‹¤
- **ν”„λ΅λ•μ… ν™κ²½μ—μ„λ” λ°λ“μ‹ ν‚¤λ¥Ό μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤**

---

## π” λ¬Έμ  ν•΄κ²°

### λ¬Έμ  1: "ENCRYPTION_KEYκ°€ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤" κ²½κ³ 

**μ›μΈ**: ν™κ²½λ³€μκ°€ μ„¤μ •λμ§€ μ•μ

**ν•΄κ²°**:
1. `.env` νμΌμ— `ENCRYPTION_KEY` μ¶”κ°€
2. Render ν™κ²½λ³€μμ— `ENCRYPTION_KEY` μ¶”κ°€
3. μ„λ²„ μ¬μ‹μ‘

### λ¬Έμ  2: λ³µνΈν™” μ‹¤ν¨

**μ›μΈ**: 
- ν‚¤κ°€ λ³€κ²½λ¨
- μ•”νΈν™”λμ§€ μ•μ€ λ°μ΄ν„°λ¥Ό λ³µνΈν™” μ‹λ„

**ν•΄κ²°**:
- λ³µνΈν™” μ‹¤ν¨ μ‹ μ›λ³Έ κ°’μ΄ κ·Έλ€λ΅ λ°ν™λ©λ‹λ‹¤ (κΈ°μ΅΄ λ°μ΄ν„° νΈν™μ„±)
- μƒλ΅μ΄ λ°μ΄ν„°λ” μ¬λ°”λ¥Έ ν‚¤λ΅ μ•”νΈν™”λ©λ‹λ‹¤

### λ¬Έμ  3: μ „ν™”λ²νΈκ°€ μ—¬μ „ν ν‰λ¬ΈμΌλ΅ λ³΄μ„

**μ›μΈ**: 
- ν™κ²½λ³€μκ°€ μ λ€λ΅ λ΅λ“λμ§€ μ•μ
- API νμΌμ—μ„ μ•”νΈν™” λ΅μ§μ΄ μ μ©λμ§€ μ•μ

**ν•΄κ²°**:
1. ν™κ²½λ³€μ ν™•μΈ: `console.log(process.env.ENCRYPTION_KEY)`
2. API νμΌμ— `cipher.encrypt()` νΈμ¶μ΄ μλ”μ§€ ν™•μΈ
3. μ„λ²„ μ¬μ‹μ‘

---

## π“ λ³΄μ• μμ¤€

### AES-256-GCMμ λ³΄μ•μ„±
- **κµ°μ‚¬κΈ‰ μ•”νΈν™”**: λ―Έκµ­ μ •λ¶€ ν‘μ¤€ (FIPS 140-2)
- **μ–‘μ μ»΄ν“¨ν„° λ€μ‘**: 256λΉ„νΈ ν‚¤λ” μ–‘μ μ»΄ν“¨ν„°λ΅λ„ κΉ¨κΈ° μ–΄λ ¤μ›€
- **λ¬΄κ²°μ„± κ²€μ¦**: GCM λ¨λ“λ” λ°μ΄ν„° λ³€μ΅°λ„ κ°μ§€

### ν•΄μ»¤κ°€ DBλ¥Ό ν„Έμ–΄κ°€λ©΄?
- β… μ „ν™”λ²νΈλ” **μ λ€ μ½μ„ μ μ—†μ** (ν‚¤ μ—†μ΄λ” λ¶κ°€λ¥)
- β… ν‚¤λ” ν™κ²½λ³€μμ—λ§ μ €μ¥ (μ½”λ“μ— ν•λ“μ½”λ”© μ• ν•¨)
- β… ν‚¤λ¥Ό μƒμ–΄λ²„λ¦¬λ©΄ λ³µκµ¬ λ¶κ°€λ¥ (μλ„λ λ³΄μ• μ„¤κ³„)

---

## π“ μ²΄ν¬λ¦¬μ¤νΈ

λ°°ν¬ μ „ ν™•μΈμ‚¬ν•­:

- [ ] `.env` νμΌμ— `ENCRYPTION_KEY` μ„¤μ •
- [ ] Render ν™κ²½λ³€μμ— `ENCRYPTION_KEY` μ„¤μ •
- [ ] `.env` νμΌμ΄ `.gitignore`μ— ν¬ν•¨λμ–΄ μλ”μ§€ ν™•μΈ
- [ ] μ„λ²„ μ¬μ‹μ‘ ν›„ μ•”νΈν™” μ‘λ™ ν™•μΈ
- [ ] DBμ— μ €μ¥λ μ „ν™”λ²νΈκ°€ μ•”νΈν™”λμ–΄ μλ”μ§€ ν™•μΈ
- [ ] ν™”λ©΄μ—μ„ μ „ν™”λ²νΈκ°€ μ •μƒμ μΌλ΅ ν‘μ‹λλ”μ§€ ν™•μΈ

---

## π”— κ΄€λ ¨ λ¬Έμ„

- [Node.js crypto λ¨λ“ κ³µμ‹ λ¬Έμ„](https://nodejs.org/api/crypto.html)
- [AES μ•”νΈν™” μ„ν‚¤ν”Όλ””μ•„](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard)
- [GCM λ¨λ“ μ„¤λ…](https://en.wikipedia.org/wiki/Galois/Counter_Mode)

---

**μ‘μ„±μΌ**: 2025-01-25  
**λ²„μ „**: 1.0.0  
**μ‘μ„±μ**: μ‚¬μ¥ν”½ κ°λ°ν€

