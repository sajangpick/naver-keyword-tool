# 🔍 리뷰 모니터링 시스템 사용 가이드

> 식당 사장님을 위한 네이버 플레이스 리뷰 자동 수집 및 알림 시스템

---

## 📖 목차

1. [개요](#개요)
2. [설치 및 설정](#설치-및-설정)
3. [회원 사용법](#회원-사용법)
4. [관리자 사용법](#관리자-사용법)
5. [카카오톡 알림 설정](#카카오톡-알림-설정)
6. [FAQ](#faq)

---

## 🎯 개요

### 주요 기능

1. **자동 리뷰 수집**
   - 네이버 플레이스 리뷰를 자동으로 크롤링
   - 매일 3회 실행 (오전 9시, 오후 2시, 저녁 8시)
   - 새소식, 영수증 리뷰, 블로그 리뷰 포함

2. **즉시 알림**
   - 1-2점 저평점 리뷰 → 긴급 알림
   - 5점 고평점 리뷰 → 칭찬 알림
   - 특정 키워드 감지 → 키워드 알림

3. **카카오톡 푸시**
   - 실시간 카카오톡 알림
   - 일일 요약 리포트
   - 템플릿 기반 전문적인 메시지

4. **관리 대시보드**
   - 실시간 통계 확인
   - 과거 리뷰 조회
   - 크롤링 로그 확인

---

## 🚀 설치 및 설정

### 1단계: Supabase 테이블 생성

**관리자가 1회 실행**

1. Supabase Dashboard 접속: https://app.supabase.com
2. 프로젝트 선택: **사장픽**
3. SQL Editor 열기
4. 다음 파일 내용을 복사해서 실행:
   ```
   database/schemas/features/review/review-monitoring.sql
   ```
5. ✅ 완료! 테이블 생성됨

자세한 내용: [SUPABASE_REVIEW_MONITORING_SETUP.md](./SUPABASE_REVIEW_MONITORING_SETUP.md)

### 2단계: Vercel 배포

**자동 배포**

- Git Push 시 자동으로 Vercel에 배포
- Cron도 자동으로 설정됨
- 확인: https://vercel.com/dashboard

### 3단계: Render 서버 확인

**서버 작동 확인**

- Render Dashboard: https://dashboard.render.com
- 서버 상태: Running ✅
- 로그 확인: 최근 활동 확인

---

## 👤 회원 사용법

### 마이페이지에서 설정

1. **로그인**
   - 카카오톡 로그인 필수 (알림 발송을 위해)

2. **가게 정보 입력**
   ```
   내 가게 정보 섹션:
   - 가게명: 맛있는 식당
   - 플레이스 URL: https://m.place.naver.com/restaurant/1234567890
   - (저장 버튼 클릭)
   ```

3. **리뷰 모니터링 활성화**
   ```
   리뷰 자동 모니터링 섹션:
   - 활성화 버튼 클릭
   - 알림 설정:
     ✅ 저평점 리뷰 알림 (1-2점)
     ✅ 고평점 리뷰 알림 (5점)
     ✅ 키워드 감지 알림
   - 키워드 입력: 불친절, 위생, 맛없다 (쉼표로 구분)
   - 저장 버튼 클릭
   ```

4. **완료!**
   - 즉시 첫 크롤링 시작
   - 이후 매일 3회 자동 크롤링
   - 긴급 리뷰 발생 시 즉시 카카오톡 알림

### 최근 리뷰 확인

- 마이페이지 하단에서 최근 수집된 리뷰 확인
- 평점, 내용, 작성자, 시간 표시
- 긴급 리뷰는 빨간색 배지 표시

---

## 🔧 관리자 사용법

### 어드민 대시보드 접속

```
URL: https://www.sajangpick.co.kr/admin/review-monitoring.html
```

### 통계 카드

- **활성 모니터링**: 현재 작동 중인 회원 수
- **긴급 리뷰**: 최근 24시간 내 1-2점 리뷰
- **고평점 리뷰**: 최근 24시간 내 5점 리뷰
- **총 수집 리뷰**: 누적 리뷰 수

### 모니터링 현황 탭

- 회원별 모니터링 상태 조회
- 가게명, 플레이스 URL, 마지막 크롤링 시간
- 알림 설정 확인

### 최근 리뷰 탭

- 전체 회원의 최근 수집 리뷰 (최대 100개)
- 시간, 회원, 가게명, 평점, 내용, 긴급 여부
- 실시간 업데이트

### 크롤링 로그 탭

- 크롤링 실행 기록 (성공/실패)
- 수집 리뷰 수, 신규 리뷰 수, 소요 시간
- 에러 메시지 확인

### 수동 크롤링 실행

- **수동 크롤링 실행** 버튼 클릭
- 모든 활성 모니터링을 즉시 크롤링
- 1-2분 소요
- 결과: 성공/실패 건수, 신규 리뷰 수

---

## 📱 카카오톡 알림 설정

### 현재 상태

✅ **카카오톡 로그인** 구현 완료  
⏳ **카카오 알림톡** 템플릿 승인 대기 (사용자 작업)

### 설정 방법

자세한 가이드: [KAKAO_ALIMTALK_SETUP.md](./KAKAO_ALIMTALK_SETUP.md)

#### 1. 카카오 비즈니스 채널 생성

- 이미 생성됨 ✅

#### 2. 알림톡 템플릿 등록

**3가지 템플릿 필요:**

**① 긴급 리뷰 알림 (저평점 1-2점)**
```
[사장픽] 긴급 리뷰 알림 🚨

#{store_name}에 #{rating}점 리뷰가 등록되었습니다.

📝 리뷰 내용:
#{review_content}

👤 작성자: #{reviewer_name}
📅 작성 시간: #{reviewed_at}

즉시 확인하고 대응하세요!
#{place_url}
```

**② 고평점 리뷰 알림 (5점)**
```
[사장픽] 칭찬 리뷰 도착! 🎉

#{store_name}에 #{rating}점 리뷰가 등록되었습니다.

📝 리뷰 내용:
#{review_content}

👤 작성자: #{reviewer_name}
📅 작성 시간: #{reviewed_at}

감사 댓글을 남겨보세요!
#{place_url}
```

**③ 일일 요약 리포트**
```
[사장픽] 오늘의 리뷰 요약 📊

#{store_name}
기간: #{start_date} ~ #{end_date}

📈 통계:
- 총 리뷰: #{total_count}개
- 평균 평점: #{avg_rating}점
- 긴급 리뷰: #{urgent_count}개
- 고평점 리뷰: #{high_rating_count}개

자세히 보기: #{url}
```

#### 3. 템플릿 승인 대기

- 카카오 검수팀 승인까지 **1-3일** 소요
- 승인 후 자동으로 알림 발송 시작

#### 4. API 키 설정

템플릿 승인 후, `.env` 파일에 추가:
```env
KAKAO_REST_API_KEY=your_rest_api_key
KAKAO_SENDER_KEY=your_sender_key
KAKAO_TEMPLATE_URGENT=your_urgent_template_code
KAKAO_TEMPLATE_HIGH_RATING=your_high_rating_template_code
KAKAO_TEMPLATE_DAILY_SUMMARY=your_daily_summary_template_code
```

---

## ❓ FAQ

### Q1. 크롤링이 작동하지 않아요

**체크리스트:**
- [ ] Supabase 테이블 생성 완료?
- [ ] 마이페이지에서 모니터링 활성화?
- [ ] 플레이스 URL 정확히 입력?
- [ ] Render 서버 작동 중?
- [ ] Vercel Cron 설정 완료?

### Q2. 카카오톡 알림이 오지 않아요

**원인:**
- 템플릿 승인 대기 중 ⏳
- 승인 후 자동으로 발송 시작
- 현재: 개발 완료, 템플릿 등록 필요

### Q3. 수동으로 크롤링하고 싶어요

**방법:**
1. 어드민 대시보드 접속
2. "수동 크롤링 실행" 버튼 클릭
3. 1-2분 대기
4. 결과 확인

### Q4. 크롤링 주기를 변경하고 싶어요

**현재:** 매일 3회 (9시, 14시, 20시)

**변경 방법:**
1. `vercel.json` 파일 수정
2. `schedule` 값 변경 (Cron 표현식)
3. Git Push → 자동 배포

**예시:**
```json
"schedule": "0 9,14,20 * * *"  // 현재: 9시, 14시, 20시
"schedule": "0 */4 * * *"      // 변경: 4시간마다
"schedule": "0 9,12,15,18 * * *"  // 변경: 9시, 12시, 15시, 18시
```

### Q5. 키워드 알림이 너무 많아요

**해결:**
1. 마이페이지 → 리뷰 모니터링 섹션
2. 키워드 목록 수정 (불필요한 키워드 제거)
3. 저장 버튼 클릭

### Q6. 비용이 얼마나 드나요?

**현재 구조:**
- Vercel: 무료 (Hobby Plan)
- Render: 무료 (Free Plan)
- Supabase: 무료 (Free Plan)
- 카카오 알림톡: 메시지당 **8-15원** (예상)

**예상 비용:**
- 회원 100명, 하루 10개 알림 = 1,000개/일
- 1,000개 × 10원 = **10,000원/일**
- 월 약 **30만원** (회원 100명 기준)

---

## 📞 문의

**기술 지원:**
- 이메일: support@sajangpick.co.kr
- 카카오톡: @사장픽

**관련 문서:**
- [배포 가이드](./DEPLOY_GUIDE.md)
- [카카오 알림톡 설정](./KAKAO_ALIMTALK_SETUP.md)
- [Supabase 설정](./SUPABASE_REVIEW_MONITORING_SETUP.md)

---

**작성일:** 2025-10-30  
**버전:** 1.0.0  
**업데이트:** 리뷰 모니터링 시스템 Phase 1-3 완료

