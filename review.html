<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI ë¦¬ë·° ê´€ë¦¬ - ì‚¬ì¥í”½</title>
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%2303c75a'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-size='28' font-family='Arial' fill='white'%3ESP%3C/text%3E%3C/svg%3E"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="https://cdn.jsdelivr.net/gh/webfontworld/score/SCoreDream.css" rel="stylesheet">
    <script src="/assets/common-header.js?v=20251022" defer></script>
    <style>
      :root {
        --primary-green: #03C75A;
        --primary-white: #FFFFFF;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'SCoreDream', -apple-system, BlinkMacSystemFont, "Segoe UI",
          "Noto Sans KR", Arial, sans-serif;
        background: #FFFFFF;
        min-height: 100vh;
        color: #03C75A;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-tap-highlight-color: transparent;
      }

      .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 50;
        background: var(--primary-white);
        box-shadow: 0 2px 10px rgba(3, 199, 90, 0.1);
        transition: transform 0.3s ease;
      }

      .header-inner {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center;
        padding: 20px 40px;
        max-width: 1400px;
        margin: 0 auto;
        gap: 20px;
      }
      @media (max-width: 768px) {
        .header-inner {
          display: flex;
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
          padding: 8px 12px;
          gap: 8px;
        }
      }

      .logo-container {
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        text-decoration: none;
      }
      .logo-icon {
        font-size: 48px;
        color: #000;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .logo-text {
        font-weight: 800;
        font-size: 20px;
        color: #000;
        letter-spacing: -0.5px;
      }
      .header-slogan {
        text-align: center;
        font-size: 24px;
        font-weight: 700;
        color: #000;
        white-space: nowrap;
      }
      @media (max-width: 768px) {
        .logo-container {
          gap: 6px;
        }
        .logo-icon {
          font-size: 24px;
        }
        .logo-text {
          font-size: 14px;
        }
        .header-slogan {
          display: none;
        }
      }

      .header-auth {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 12px;
      }
      .home-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 50px;
        padding: 0 32px;
        border-radius: 8px;
        font-weight: 700;
        font-size: 16px;
        gap: 8px;
        border: none;
        background: var(--primary-green);
        color: var(--primary-white);
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .home-btn:hover {
        background: #02a84a;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(3, 199, 90, 0.3);
      }

      .auth-buttons {
        display: flex;
        align-items: center;
        gap: 0;
      }
      .auth-user {
        display: none;
        align-items: center;
        gap: 12px;
        padding: 12px 24px;
        border-radius: 8px;
        background: var(--primary-green);
        color: var(--primary-white);
      }
      .auth-user__avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--primary-white);
        color: var(--primary-green);
        font-weight: 800;
        display: flex;
        align-items: center;
        justify-content: center;
        letter-spacing: -0.02em;
        text-transform: uppercase;
      }
      .auth-user__meta {
        display: flex;
        flex-direction: column;
        line-height: 1.3;
      }
      .auth-user__label {
        font-size: 11px;
        font-weight: 600;
        color: var(--primary-white);
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }
      .auth-user__email {
        font-size: 14px;
        font-weight: 600;
        color: var(--primary-white);
      }
      .auth-user__logout {
        height: 36px;
        padding: 0 16px;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.3);
        background: transparent;
        color: var(--primary-white);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }
      .auth-user__logout:hover {
        background: rgba(255,255,255,0.1);
      }
      .auth-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 50px;
        padding: 0 32px;
        border-radius: 8px;
        font-weight: 700;
        font-size: 16px;
        gap: 8px;
        border: none;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .auth-btn--primary {
        background: var(--primary-green);
        color: var(--primary-white);
      }
      .auth-btn--primary:hover {
        background: #02a84a;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(3, 199, 90, 0.3);
      }
      .auth-btn--ghost {
        display: none;
      }
      @media (max-width: 768px) {
        .auth-user {
          padding: 4px 8px;
          gap: 6px;
        }
        .auth-user__avatar {
          width: 24px;
          height: 24px;
          font-size: 10px;
        }
        .auth-user__label {
          font-size: 8px;
          white-space: nowrap;
        }
        .auth-user__email {
          font-size: 9px;
          white-space: nowrap;
        }
        .auth-user__logout {
          height: 24px;
          padding: 0 8px;
          font-size: 9px;
        }
        .auth-btn {
          height: 28px;
          padding: 0 12px;
          font-size: 11px;
        }
        .home-btn {
          height: 28px;
          padding: 0 12px;
          font-size: 11px;
        }
      }

      /* Hide old nav elements */
      .nav-container, .nav-menu, .top-nav, .user-actions {
        display: none !important;
      }

      .old-nav-container {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px 20px;
        gap: 20px;
      }

      .top-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        position: relative;
      }

      .logo {
        font-size: 32px;
        font-weight: 800;
        color: #111827;
        cursor: pointer;
        transition: all 0.3s ease;
        letter-spacing: -1px;
      }

      .logo:hover {
        transform: scale(1.05);
        color: var(--naver-green);
      }

      .nav-menu {
        display: flex;
        list-style: none;
        gap: 20px;
        flex-wrap: wrap;
        justify-content: center;
        position: relative;
      }

      .nav-menu li {
        position: relative;
      }

      .nav-menu a {
        text-decoration: none;
        color: #333;
        font-weight: 600;
        font-size: 15px;
        transition: all 0.3s ease;
        padding: 12px 18px;
        display: block;
        border-radius: 8px;
        position: relative;
      }

      .nav-menu a:hover {
        color: var(--naver-green);
        background: var(--naver-green-50);
        transform: translateY(-1px);
      }

      .nav-menu a.active {
        color: white;
        background: var(--naver-green);
        font-weight: 700;
        box-shadow: 0 3px 10px rgba(3, 199, 90, 0.25);
      }

      .user-actions {
        display: flex;
        gap: 15px;
        align-items: center;
        position: absolute;
        right: 0;
      }

      .login-btn,
      .signup-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
      }

      .login-btn {
        background: var(--naver-green);
        color: white;
        box-shadow: 0 3px 10px rgba(3, 199, 90, 0.25);
      }

      .signup-btn {
        background: transparent;
        color: var(--naver-green);
        border: 2px solid var(--naver-green);
      }

      .login-btn:hover,
      .signup-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(3, 199, 90, 0.35);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 50px 20px;
      }
      @media (max-width: 768px) {
        body {
          padding-top: 60px;
        }
      }

      .page-header {
        text-align: center;
        margin-bottom: 50px;
        color: #2c3e50;
      }

      .page-header h1 {
        font-size: 2.8rem;
        margin-bottom: 15px;
        font-weight: 700;
        letter-spacing: -1px;
      }

      .page-header p {
        font-size: 1.1rem;
        color: #7f8c8d;
        font-weight: 400;
      }

      .review-container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 30px;
      }

      .review-header {
        display: none;
      }

      .review-content {
        padding: 40px;
      }

      .form-group {
        margin-bottom: 30px;
      }

      .form-group label {
        display: block;
        margin-bottom: 12px;
        color: #374151;
        font-weight: 600;
        font-size: 16px;
      }

      .form-group label i {
        margin-right: 8px;
        color: var(--naver-green);
      }

      .input-field,
      .form-group input[type="text"] {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 15px;
        transition: all 0.3s ease;
        font-family: inherit;
        -webkit-appearance: none;
        appearance: none;
      }

      .textarea-field,
      .form-group textarea {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 15px;
        transition: all 0.3s ease;
        font-family: inherit;
        resize: vertical;
        min-height: 180px;
        line-height: 1.6;
        -webkit-appearance: none;
        appearance: none;
      }

      .textarea-field.owner-tips {
        min-height: 90px;
      }

      .input-field:focus,
      .textarea-field:focus,
      .form-group input[type="text"]:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--naver-green);
        box-shadow: 0 0 0 3px rgba(3, 199, 90, 0.15);
      }

      .button-group {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 30px;
      }

      .btn {
        padding: 15px 30px;
        border: 2px solid var(--primary-green);
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        font-size: 15px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        white-space: nowrap;
        background: var(--primary-white);
        color: var(--primary-green);
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(3, 199, 90, 0.2);
        background: var(--primary-green);
        color: var(--primary-white);
      }

      .btn:active {
        transform: translateY(0);
        box-shadow: 0 3px 10px rgba(3, 199, 90, 0.2);
      }

      .btn.primary {
        background: var(--primary-green);
        color: var(--primary-white);
        border-color: var(--primary-green);
      }

      .btn.primary:hover {
        box-shadow: 0 6px 20px rgba(3, 199, 90, 0.35);
        background: var(--primary-white);
        color: var(--primary-green);
      }

      .btn.primary:active {
        box-shadow: 0 3px 10px rgba(3, 199, 90, 0.25);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .result-section {
        background: #f8fafc;
        padding: 30px;
        border-radius: 15px;
        border: 1px solid #e2e8f0;
        min-height: 200px;
      }

      .result-section h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .result-content {
        background: white;
        padding: 25px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        white-space: pre-wrap;
        line-height: 1.8;
        color: #374151;
        font-size: 15px;
      }

      .result-content:empty::before {
        content: "ìƒì„±ëœ ë‹µê¸€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...";
        color: #9ca3af;
        font-style: italic;
      }

      .result-content.error {
        background: #fff1f2;
        border-color: #fecaca;
        color: #991b1b;
      }

      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #e2e8f0;
        border-top: 4px solid var(--naver-green);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .hidden {
        display: none;
      }

      /* í™ë³´ í¬ì¸íŠ¸ íƒœê·¸ ìŠ¤íƒ€ì¼ */
      .promo-tag {
        display: inline-block;
        padding: 8px 16px;
        background: white;
        border: 2px solid #ddd;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
        user-select: none;
      }

      .promo-tag:hover {
        border-color: #2196F3;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);
      }

      .promo-tag.selected {
        background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        color: white;
        border-color: #2196F3;
        font-weight: 600;
      }

      .place-info-status {
        background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
        border: 2px solid #81c784;
        border-radius: 12px;
        padding: 16px 20px;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 12px;
        color: #2e7d32;
        font-weight: 600;
        font-size: 15px;
        animation: fadeIn 0.3s ease-in-out;
      }

      .place-info-status i {
        font-size: 20px;
        color: #43a047;
      }

      .place-info-status.loading {
        background: linear-gradient(135deg, #fff3e0, #ffe0b2);
        border-color: #ffb74d;
        color: #e65100;
      }

      .place-info-status.loading i {
        color: #fb8c00;
        animation: spin 1s linear infinite;
      }

      .place-info-status.loading #placeInfoText::after {
        content: '';
        animation: dots 1.5s steps(4, end) infinite;
      }

      @keyframes dots {
        0%, 20% { content: ''; }
        40% { content: '.'; }
        60% { content: '..'; }
        80%, 100% { content: '...'; }
      }

      .place-info-status.warning {
        background: linear-gradient(135deg, #fff3e0, #ffe0b2);
        border-color: #ff9800;
        color: #e65100;
      }

      .place-info-status.warning i {
        color: #f57c00;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .info-box {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 12px;
        padding: 20px;
        margin-top: 30px;
      }

      .info-box h4 {
        color: #1976d2;
        margin-bottom: 12px;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .info-box ul {
        color: #1565c0;
        font-size: 14px;
        line-height: 1.8;
        margin-left: 20px;
      }

      @media (max-width: 768px) {
        .top-nav {
          flex-direction: column;
          gap: 10px;
        }
        .user-actions {
          position: static;
          right: auto;
          width: 100%;
          display: flex;
          justify-content: center;
          gap: 8px;
          flex-wrap: wrap;
        }
        .nav-menu {
          justify-content: flex-start;
          overflow-x: auto;
          white-space: nowrap;
          padding: 5px 0;
          scrollbar-width: none;
          -ms-overflow-style: none;
        }

        .nav-menu::-webkit-scrollbar {
          display: none;
        }

        .nav-menu li {
          flex-shrink: 0;
        }

        .nav-menu a {
          font-size: 12px;
          padding: 8px 12px;
          white-space: nowrap;
        }

        .page-header h1 {
          font-size: 1.5rem;
          margin-bottom: 6px;
        }
        .page-header p {
          font-size: 0.9rem;
        }
        .page-header {
          margin-bottom: 16px;
          margin-top: 5px;
        }
        .container[style*="margin-top"] {
          margin-top: 20px !important;
        }
        input[type="text"], textarea {
          font-size: 0.77rem !important;
          padding: 10px !important;
        }
        button {
          font-size: 11px;
          padding: 9px 14px;
        }
        label {
          font-size: 0.9rem;
        }
        p, small, .form-group label {
          font-size: 0.88rem;
        }

        .review-header h2 {
          font-size: 1.44rem;
        }

        .review-header p {
          font-size: 0.9rem;
        }

        .review-container h3 {
          font-size: 0.95rem;
        }

        .place-info-status {
          font-size: 0.8rem;
        }

        .result-section h3 {
          font-size: 0.95rem;
        }

        .review-content {
          padding: 20px 15px;
        }

        .form-group {
          margin-bottom: 25px;
        }

        .form-group label {
          font-size: 16px;
          margin-bottom: 10px;
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .form-group label i {
          font-size: 18px;
        }

        .input-field,
        .textarea-field,
        .form-group input[type="text"],
        .form-group textarea {
          font-size: 16px !important; /* iOS ì¤Œ ë°©ì§€ */
          padding: 14px 16px;
          border-width: 2px;
          border-radius: 10px;
        }

        .textarea-field,
        .form-group textarea {
          min-height: 140px;
        }

        .textarea-field.owner-tips {
          min-height: 110px;
        }

        .form-group small {
          font-size: 13px;
          line-height: 1.5;
          margin-top: 10px;
        }

        .button-group {
          flex-direction: column;
          gap: 12px;
        }

        .btn {
          width: 100%;
          justify-content: center;
          padding: 10px 16px;
          font-size: 11px;
          min-height: 40px;
          border-radius: 10px;
          gap: 4px;
        }

        .btn i {
          font-size: 13px;
        }

        .place-info-status {
          font-size: 14px;
          padding: 14px 16px;
          flex-wrap: wrap;
        }

        .place-info-status i {
          font-size: 18px;
        }

        .result-section h3 {
          font-size: 1.2rem;
          margin-bottom: 15px;
        }

        .result-content {
          font-size: 15px;
          padding: 20px 16px;
          line-height: 1.7;
        }

        .info-box {
          padding: 16px;
          margin-top: 25px;
        }

        .info-box h4 {
          font-size: 1rem;
          margin-bottom: 10px;
        }

        .info-box ul {
          font-size: 13px;
          line-height: 1.7;
        }

        .info-box li {
          margin-bottom: 10px;
        }

        .container {
          padding: 30px 15px;
        }

        .review-container {
          border-radius: 15px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
      }

      /* ì¶”ê°€: ì•„ì£¼ ì‘ì€ í™”ë©´ (360px ì´í•˜) */
      @media (max-width: 360px) {
        .page-header h1 {
          font-size: 1.8rem;
        }

        .review-header h2 {
          font-size: 1.4rem;
        }

        .form-group label {
          font-size: 15px;
        }

        .btn {
          padding: 9px 16px;
          font-size: 10px;
          min-height: 38px;
        }

        .container {
          padding: 20px 10px;
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-inner">
        <a href="/" class="logo-container">
          <div class="logo-icon">
            <i class="fa-solid fa-thumbtack"></i>
          </div>
          <span class="logo-text">sajang pick</span>
        </a>
        
        <h1 class="header-slogan">ì„¼ìŠ¤ìˆëŠ” ì‚¬ì¥ë‹˜ë“¤ì˜ ì„ íƒ</h1>
        
        <div class="header-auth">
          <a href="/" class="home-btn">
            <i class="fa-solid fa-home"></i>
            <span>í™ˆ</span>
          </a>
          <div class="auth-buttons" id="authButtons">
            <div class="auth-user" id="authUser" style="display: none;">
              <div class="auth-user__avatar" id="userAvatar">U</div>
              <div class="auth-user__meta">
                <a href="/mypage.html" class="auth-user__label" style="cursor: pointer; text-decoration: none;">ë‚˜ì˜ í˜ì´ì§€</a>
                <a href="/mypage.html" class="auth-user__email" id="userEmail" style="cursor: pointer; text-decoration: none;"></a>
              </div>
              <button class="auth-user__logout" id="logoutBtn" type="button">
                <i class="fa-solid fa-right-from-bracket"></i>
                ë¡œê·¸ì•„ì›ƒ
              </button>
            </div>
            <a href="/login.html" class="auth-btn auth-btn--primary" id="loginBtn">
              <i class="fa-solid fa-arrow-right-to-bracket"></i>
              <span>ë¡œê·¸ì¸</span>
            </a>
            <a href="/join.html" class="auth-btn auth-btn--ghost" id="signupBtn">
              <i class="fa-solid fa-user-plus"></i>
              <span>íšŒì›ê°€ì…</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <div class="container" style="margin-top: 80px;">
      <div class="page-header">
        <h1>AI ë¦¬ë·° ê´€ë¦¬</h1>
        <p>ê³ ê° ë¦¬ë·°ë¥¼ ë¶„ì„í•˜ê³  ì „ë¬¸ì ì¸ ë‹µê¸€ì„ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤</p>
      </div>

      <div class="review-container">
        <div class="review-header">
          <h2>ğŸ¯ ë¦¬ë·° ë¶„ì„ & ë‹µê¸€ ìƒì„±</h2>
          <p>ê³ ê°ì˜ ë¦¬ë·°ë¥¼ ì…ë ¥í•˜ë©´ AIê°€ ìë™ìœ¼ë¡œ ë¶„ì„í•˜ê³  ë‹µê¸€ì„ ì‘ì„±í•´ë“œë¦½ë‹ˆë‹¤</p>
        </div>

        <div class="review-content">
          <!-- ê°€ê²Œ ì •ë³´ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ì•ˆë‚´ -->
          <div style="background: var(--primary-white); border: 2px solid var(--primary-green); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
            <p style="margin: 0; color: var(--primary-green); font-size: 14px; margin-bottom: 10px;">
              ğŸ’¡ <strong>ì•Œë¦¼:</strong> ê°€ê²Œ ì •ë³´ë¥¼ í•œ ë²ˆ ì €ì¥í•˜ë©´ ë‹¤ìŒë¶€í„° ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì§‘ë‹ˆë‹¤!
            </p>
            <div style="display: flex; gap: 10px;">
              <button type="button" id="loadStoreInfoBtn" class="btn" style="flex: 1; background: var(--primary-green); color: var(--primary-white); border: 2px solid var(--primary-green);">
                ğŸ“¥ ì €ì¥ëœ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
              </button>
              <button type="button" id="saveStoreInfoBtn" class="btn" style="flex: 1; background: var(--primary-white); color: var(--primary-green); border: 2px solid var(--primary-green);">
                ğŸ“Œ ê°€ê²Œ ì •ë³´ ì €ì¥í•˜ê¸°
              </button>
            </div>
          </div>

          <!-- ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ URL ì…ë ¥ -->
          <div class="form-group">
            <label for="placeUrl">
              <i class="fa-solid fa-map-location-dot"></i>
              ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ URL (ì„ íƒì‚¬í•­)
            </label>
            <input
              type="text"
              id="placeUrl"
              class="input-field"
              placeholder="ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ URL ë˜ëŠ” place_id ì…ë ¥ (ì˜ˆ: https://m.place.naver.com/restaurant/1390003666)"
            />
            <small style="color: #6b7280; display: block; margin-top: 8px;">
              <i class="fa-solid fa-info-circle"></i>
              í”Œë ˆì´ìŠ¤ URLì„ ì…ë ¥í•˜ë©´ ì‹ë‹¹ ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ë”ìš± ì •í™•í•œ ë‹µê¸€ì„ ìƒì„±í•©ë‹ˆë‹¤.
            </small>
          </div>

          <!-- ì‚¬ì¥ë‹˜ ì¶”ì²œ ì •ë³´ ì…ë ¥ -->
          <div class="form-group">
            <label for="ownerTips">
              <i class="fa-solid fa-lightbulb"></i>
              ì‚¬ì¥ë‹˜ ì¶”ì²œ í¬ì¸íŠ¸ (ì„ íƒì‚¬í•­)
            </label>
            <textarea
              id="ownerTips"
              class="textarea-field owner-tips"
              placeholder="ê°•ì¡°í•˜ê³  ì‹¶ì€ ë©”ë‰´, ë¶„ìœ„ê¸°, íŠ¹ì§• ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.&#10;&#10;ì˜ˆì‹œ:&#10;- ì‹œê·¸ë‹ˆì²˜ ë©”ë‰´: ëƒ‰ë©´, ê°ˆë¹„íƒ•&#10;- ë¶„ìœ„ê¸°: ê°€ì¡± ëª¨ì„ì— ì¢‹ì€ ë„“ì€ í™€&#10;- íŠ¹ì§•: ì§ì ‘ ë§Œë“  ìœ¡ìˆ˜, ì£¼ì°¨ ê°€ëŠ¥&#10;- ì¶”ì²œ: ê³ ê¸°ì™€ ëƒ‰ë©´ì˜ ì¡°í•©ì´ ì¼í’ˆ"
            ></textarea>
            <button type="button" id="aiPromoBtn" class="btn" style="margin-top: 10px; background: var(--primary-green); color: var(--primary-white); border: 2px solid var(--primary-green);">
              <i class="fa-solid fa-magic"></i>
              ğŸ¤– AI í™ë³´ í¬ì¸íŠ¸ ìë™ ì¶”ì²œ
            </button>
            <small style="color: #6b7280; display: block; margin-top: 8px;">
              <i class="fa-solid fa-star" style="color: #fbbf24;"></i>
              <strong>ğŸ’¡ Tip:</strong> AIê°€ ë¦¬ë·°ë¥¼ ë¶„ì„í•´ì„œ ë‹µê¸€ì— ì¶”ê°€í•˜ë©´ ì¢‹ì„ í™ë³´ í¬ì¸íŠ¸ë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤!
            </small>

            <!-- AI ì¶”ì²œ í™ë³´ í¬ì¸íŠ¸ ì˜ì—­ -->
            <div id="aiPromoArea" style="display: none; margin-top: 15px;">
              <div style="background: var(--primary-white); border: 2px solid var(--primary-green); border-radius: 10px; padding: 15px;">
                <p style="margin: 0 0 10px 0; color: var(--primary-green); font-weight: 600;">
                  ğŸ¯ AI ì¶”ì²œ í™ë³´ í¬ì¸íŠ¸ (í´ë¦­í•´ì„œ ì„ íƒ/í•´ì œ)
                </p>
                <div id="aiPromoTags" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
              </div>
            </div>
          </div>

          <!-- ë¦¬ë·° ì›ë¬¸ ì…ë ¥ -->
          <div class="form-group">
            <label for="reviewText">
              <i class="fa-solid fa-message"></i>
              ê³ ê° ë¦¬ë·° ì›ë¬¸
            </label>
            <textarea
              id="reviewText"
              placeholder="ê³ ê°ì´ ì‘ì„±í•œ ë¦¬ë·° ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...&#10;&#10;ì˜ˆì‹œ:&#10;ìŒì‹ì´ ì •ë§ ë§›ìˆì—ˆì–´ìš”! íŠ¹íˆ ë¶ˆê³ ê¸°ê°€ ì¼í’ˆì´ì—ˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ëŒ€ê¸° ì‹œê°„ì´ ì¢€ ê¸¸ì—ˆë˜ ê²Œ ì•„ì‰¬ì›Œìš”. ì§ì›ë¶„ë“¤ì€ ì¹œì ˆí•˜ì…¨ìŠµë‹ˆë‹¤."
            ></textarea>
          </div>

          <!-- ë‹µê¸€ ìŠ¤íƒ€ì¼ ì„ íƒ ì•ˆë‚´ -->
          <div style="background: var(--primary-white); border: 2px solid var(--primary-green); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
            <p style="margin: 0 0 10px 0; color: var(--primary-green); font-weight: 600;">
              <i class="fa-solid fa-palette"></i> ë‹µê¸€ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•˜ì„¸ìš” (ì ì¬ ê³ ê°ì—ê²Œ ë³´ì´ëŠ” í™ë³´ íš¨ê³¼ë¥¼ ê³ ë ¤)
            </p>
            <p style="margin: 0; color: var(--primary-green); font-size: 14px; opacity: 0.8;">
              ğŸ’¡ ë¦¬ë·° ë‹µê¸€ì€ ì²˜ìŒ ë°©ë¬¸ì„ ê³ ë ¤í•˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ì½ìŠµë‹ˆë‹¤!
            </p>
          </div>

          <div class="button-group" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <button class="btn" id="replyPromoBtn" style="background: var(--primary-green); color: var(--primary-white); border: 2px solid var(--primary-green);">
              <i class="fa-solid fa-bullhorn"></i>
              ğŸ“¢ í™ë³´í˜• (ì¶”ì²œ!)
            </button>
            <button class="btn" id="replyProfessionalBtn" style="background: var(--primary-white); color: var(--primary-green); border: 2px solid var(--primary-green);">
              <i class="fa-solid fa-award"></i>
              ğŸ’¼ ì „ë¬¸ê°€í˜•
            </button>
            <button class="btn" id="replyFriendlyBtn" style="background: var(--primary-white); color: var(--primary-green); border: 2px solid var(--primary-green);">
              <i class="fa-solid fa-heart"></i>
              ğŸ’š ì¹œê·¼í˜•
            </button>
          </div>

          <div style="background: var(--primary-white); border: 2px solid var(--primary-green); border-radius: 8px; padding: 12px; margin-top: 15px;">
            <p style="margin: 0; color: var(--primary-green); font-size: 13px; line-height: 1.6;">
              <strong>ğŸ“¢ í™ë³´í˜•:</strong> ë‹¤ë¥¸ ë©”ë‰´, ì£¼ì°¨, ì˜ˆì•½ ë“± ì¶”ê°€ ì •ë³´ë¥¼ ì ê·¹ ì–¸ê¸‰ (ë°©ë¬¸ ìœ ë„ ìµœëŒ€í™”)<br>
              <strong>ğŸ’¼ ì „ë¬¸ê°€í˜•:</strong> ì¬ë£Œ, ì¡°ë¦¬ë²• ì„¤ëª…ìœ¼ë¡œ ì „ë¬¸ì„±ê³¼ ì‹ ë¢°ê° ê°•ì¡°<br>
              <strong>ğŸ’š ì¹œê·¼í˜•:</strong> ë”°ëœ»í•˜ê³  ë¶€ë“œëŸ¬ìš´ í†¤ìœ¼ë¡œ ë‹¨ê³¨ ê³ ê° ë§Œë“¤ê¸°
            </p>
          </div>

          <!-- ì‹ë‹¹ ì •ë³´ ìƒíƒœ í‘œì‹œ ì˜ì—­ -->
          <div id="placeInfoStatus" class="place-info-status hidden">
            <i class="fa-solid fa-check-circle"></i>
            <span id="placeInfoText">ì‹ë‹¹ ì •ë³´ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>
          </div>

          <div class="result-section">
            <h3>
              <i class="fa-solid fa-comment-dots"></i>
              ìƒì„±ëœ ë‹µê¸€
            </h3>
            <div id="reviewOutput" class="result-content"></div>
          </div>

          <div class="info-box">
            <h4>
              <i class="fa-solid fa-info-circle"></i>
              ê¸°ëŠ¥ ì•ˆë‚´
            </h4>
            <ul>
              <li>
                <strong>ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ URL (ì„ íƒ):</strong> ì‹ë‹¹ì˜ í”Œë ˆì´ìŠ¤ URLì„ ì…ë ¥í•˜ë©´, 
                ì‹ë‹¹ ì´ë¦„, ì—…ì¢…, ìœ„ì¹˜, ë©”ë‰´ ë“±ì„ ìë™ìœ¼ë¡œ íŒŒì•…í•˜ì—¬ ë”ìš± ë§ì¶¤í™”ëœ ë‹µê¸€ì„ ìƒì„±í•©ë‹ˆë‹¤.
              </li>
              <li>
                <strong>ğŸŒŸ ì‚¬ì¥ë‹˜ ì¶”ì²œ í¬ì¸íŠ¸ (ì„ íƒ):</strong> ê°•ì¡°í•˜ê³  ì‹¶ì€ ë©”ë‰´, ë¶„ìœ„ê¸°, íŠ¹ì§•ì„ ì§ì ‘ ì…ë ¥í•˜ë©´
                AIê°€ ì´ë¥¼ ìš°ì„  ë°˜ì˜í•˜ì—¬ ë‹µê¸€ì„ ì‘ì„±í•©ë‹ˆë‹¤. í¬ë¡¤ë§ ì •ë³´ë³´ë‹¤ ì‚¬ì¥ë‹˜ì˜ ì˜ê²¬ì´ ìš°ì„ ë©ë‹ˆë‹¤!
              </li>
              <li>
                <strong>âœ¨ ë‹µê¸€ ìƒì„±í•˜ê¸°:</strong> ì‹ë‹¹ ì •ë³´ì™€ ì‚¬ì¥ë‹˜ ì¶”ì²œ ì •ë³´ë¥¼ ë°˜ì˜í•˜ì—¬ ì „ë¬¸ì ì´ê³ 
                ê³µì†í•œ ë‹µê¸€ì„ ìë™ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤. ìƒˆë¡œìš´ ê³ ê°ë“¤ì´ ë³´ëŠ” ë‹µê¸€ì´ë¯€ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ í™ë³´ íš¨ê³¼ë„ ìˆìŠµë‹ˆë‹¤!
              </li>
              <li>
                ğŸ’¡ <strong>Tip:</strong> ë¦¬ë·°ì—ì„œ ê³ ê°ì´ ê¶ê¸ˆí•´í•˜ëŠ” ë‹¤ë¥¸ ë©”ë‰´ê°€ ìˆë‹¤ë©´, 
                AIê°€ ì‹ë‹¹ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìë™ìœ¼ë¡œ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.
              </li>
              <li>ìƒì„±ëœ ë‹µê¸€ì€ ììœ ë¡­ê²Œ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/assets/auth-state.js?v=202410"></script>
    <script>
      // ë°±ì—”ë“œ ì„œë²„ ì„¤ì •: ìƒëŒ€ ê²½ë¡œ(`/api`) ì‚¬ìš©
      console.log("Using backend URL:", "/api");

      // DOM ìš”ì†Œ
      const placeUrl = document.getElementById("placeUrl");
      const ownerTips = document.getElementById("ownerTips");
      const reviewText = document.getElementById("reviewText");
      const replyPromoBtn = document.getElementById("replyPromoBtn");
      const replyProfessionalBtn = document.getElementById("replyProfessionalBtn");
      const replyFriendlyBtn = document.getElementById("replyFriendlyBtn");
      const reviewOutput = document.getElementById("reviewOutput");
      const placeInfoStatus = document.getElementById("placeInfoStatus");
      const placeInfoText = document.getElementById("placeInfoText");
      const loadStoreInfoBtn = document.getElementById("loadStoreInfoBtn");
      const saveStoreInfoBtn = document.getElementById("saveStoreInfoBtn");
      const aiPromoBtn = document.getElementById("aiPromoBtn");
      const aiPromoArea = document.getElementById("aiPromoArea");
      const aiPromoTags = document.getElementById("aiPromoTags");

      // í¬ë¡¤ë§ëœ ì‹ë‹¹ ì •ë³´ë¥¼ ì €ì¥í•  ë³€ìˆ˜
      let placeInfo = null;
      
      // ì„ íƒëœ í™ë³´ í¬ì¸íŠ¸ë¥¼ ì €ì¥í•  ë³€ìˆ˜
      let selectedPromoPoints = [];

      // í”„ë¡œëª¨ì…˜ ë°ì´í„° ì „ì—­ ë³€ìˆ˜
      let globalPromotionData = null;
      let globalHasPromotion = false;

      // ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
      function setLoading(el, isLoading, textWhenLoading = "ì²˜ë¦¬ ì¤‘...") {
        if (!el) return;
        el.dataset._originalText = el.dataset._originalText || el.textContent;
        el.disabled = !!isLoading;
        if (isLoading) {
          el.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> ${textWhenLoading}`;
        } else {
          el.textContent = el.dataset._originalText;
        }
      }

      // ì‹ë‹¹ ì •ë³´ ìƒíƒœ í‘œì‹œ í•¨ìˆ˜
      function showPlaceInfoStatus(message, status = "success") {
        // status: "loading", "success", "warning"
        placeInfoStatus.classList.remove("hidden", "loading", "warning");
        placeInfoText.textContent = message;
        
        const icon = placeInfoStatus.querySelector("i");
        
        if (status === "loading") {
          placeInfoStatus.classList.add("loading");
          icon.className = "fa-solid fa-spinner fa-spin";
        } else if (status === "warning") {
          placeInfoStatus.classList.add("warning");
          icon.className = "fa-solid fa-exclamation-triangle";
        } else {
          icon.className = "fa-solid fa-check-circle";
        }
      }

      function hidePlaceInfoStatus() {
        placeInfoStatus.classList.add("hidden");
      }

      // URLì—ì„œ place_id ì¶”ì¶œ í•¨ìˆ˜
      function extractPlaceId(url) {
        // URL í˜•ì‹: https://m.place.naver.com/restaurant/1390003666
        //          https://pcmap.place.naver.com/restaurant/1390003666
        //          https://place.map.naver.com/restaurant/1390003666
        const match = url.match(/\/restaurant\/(\d+)/);
        if (match && match[1]) {
          return match[1];
        }
        
        // ìˆ«ìë§Œ ì…ë ¥í•œ ê²½ìš°
        if (/^\d+$/.test(url.trim())) {
          return url.trim();
        }
        
        return null;
      }

      // í”Œë ˆì´ìŠ¤ URL í¬ë¡¤ë§ í•¨ìˆ˜
      async function crawlPlaceUrl(url) {
        try {
          // URLì—ì„œ place_id ì¶”ì¶œ
          const placeId = extractPlaceId(url);
          
          if (!placeId) {
            throw new Error("ì˜¬ë°”ë¥¸ ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ URLì´ ì•„ë‹™ë‹ˆë‹¤. URLì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
          }

          // íƒ€ì„ì•„ì›ƒ ì„¤ì • (15ì´ˆ)
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 15000);

          try {
            const res = await fetch(`/api/place-detail-crawl`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ place_id: placeId }),
              signal: controller.signal
            });

            clearTimeout(timeoutId);

            const data = await readJsonSafely(res);

            if (!res.ok || data.success === false) {
              throw new Error(data.error || "í¬ë¡¤ë§ ì‹¤íŒ¨");
            }

            return data.data || data;
          } catch (fetchError) {
            clearTimeout(timeoutId);
            if (fetchError.name === 'AbortError') {
              throw new Error("í¬ë¡¤ë§ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. URL ì—†ì´ ì§„í–‰í•©ë‹ˆë‹¤.");
            }
            throw fetchError;
          }
        } catch (e) {
          console.error("í¬ë¡¤ë§ ì˜¤ë¥˜:", e);
          throw e;
        }
      }

      async function readJsonSafely(res) {
        const contentType = res.headers.get("content-type") || "";
        if (contentType.includes("application/json")) {
          try {
            return await res.json();
          } catch (_) {
            return { error: "JSON íŒŒì‹± ì‹¤íŒ¨", status: res.status };
          }
        }
        try {
          const text = await res.text();
          return text
            ? { error: text, status: res.status }
            : { status: res.status };
        } catch (_) {
          return { error: "ì‘ë‹µ ë³¸ë¬¸ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", status: res.status };
        }
      }

      function showOutput(data) {
        reviewOutput.classList.remove("error");
        try {
          if (typeof data === "string") {
            reviewOutput.textContent = data.trim();
          } else {
            reviewOutput.textContent = JSON.stringify(data, null, 2);
          }
        } catch (e) {
          reviewOutput.textContent = String(data);
        }
      }

      function showError(err) {
        reviewOutput.classList.add("error");
        
        // ì—ëŸ¬ ìƒì„¸ ì •ë³´ë¥¼ ì½˜ì†”ì— ì¶œë ¥
        console.error("ìƒì„¸ ì—ëŸ¬ ì •ë³´:", err);
        
        let errorMessage = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        
        // ë‹¤ì–‘í•œ ì—ëŸ¬ í˜•ì‹ì—ì„œ ë©”ì‹œì§€ ì¶”ì¶œ
        if (err?.error) {
          errorMessage = err.error;
        } else if (err?.message) {
          errorMessage = err.message;
        } else if (err?.raw) {
          errorMessage = err.raw;
        } else if (err?.errorText) {
          errorMessage = err.errorText;
        } else if (typeof err === 'string') {
          errorMessage = err;
        }
        
        // TypeError: Failed to fetch ë“±ì˜ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì²˜ë¦¬
        if (errorMessage.includes("Failed to fetch") || errorMessage.includes("NetworkError")) {
          errorMessage = "ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
        }
        
        reviewOutput.textContent = errorMessage;
      }

      // ê°€ê²Œ ì •ë³´ ì €ì¥ ê¸°ëŠ¥
      async function saveStoreInfo() {
        try {
          const userData = JSON.parse(localStorage.getItem('userData') || '{}');
          if (!userData.id) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            return;
          }

          const storeInfo = {
            placeUrl: placeUrl.value.trim(),
            companyName: '', // review.htmlì—ëŠ” ì—…ì²´ëª… í•„ë“œê°€ ì—†ìœ¼ë¯€ë¡œ ë¹ˆ ê°’
            companyAddress: '',
            businessHours: '',
            phoneNumber: '',
            mainMenu: '',
            landmarks: '',
            keywords: ownerTips.value.trim() // ì‚¬ì¥ë‹˜ ì¶”ì²œ í¬ì¸íŠ¸ë¥¼ keywordsë¡œ ì €ì¥
          };

          const response = await fetch('/api/store-info', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId: userData.id, storeInfo })
          });

          if (!response.ok) {
            throw new Error('ì €ì¥ ì‹¤íŒ¨');
          }

          const result = await response.json();
          if (result.success) {
            alert('âœ… ê°€ê²Œ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
          } else {
            throw new Error(result.error || 'ì €ì¥ ì‹¤íŒ¨');
          }
        } catch (error) {
          console.error('ê°€ê²Œ ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', error);
          alert('âŒ ê°€ê²Œ ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n' + error.message);
        }
      }

      // ê°€ê²Œ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥
      async function loadStoreInfo() {
        try {
          const userData = JSON.parse(localStorage.getItem('userData') || '{}');
          if (!userData.id) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            return;
          }

          // í†µí•© ì •ë³´ API í˜¸ì¶œ
          const response = await fetch(`/api/store-info-all?userId=${userData.id}`);
          if (!response.ok) {
            throw new Error('ì¡°íšŒ ì‹¤íŒ¨');
          }

          const result = await response.json();
          if (!result.success || !result.data) {
            alert('ì €ì¥ëœ ê°€ê²Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }

          const data = result.data.basic; // ê¸°ë³¸ ì •ë³´
          if (data.store_place_url) placeUrl.value = data.store_place_url;
          if (data.store_keywords) ownerTips.value = data.store_keywords;

          // í”„ë¡œëª¨ì…˜ ì •ë³´ ì €ì¥
          globalPromotionData = result.data.promotion;
          globalHasPromotion = result.hasPromotion;

          // í”„ë¡œëª¨ì…˜ ì•Œë¦¼
          let message = 'âœ… ì €ì¥ëœ ê°€ê²Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!';
          if (globalHasPromotion && globalPromotionData) {
            message += `\n\nğŸ‰ ë‚´ ê°€ê²Œ ì•Œë¦¬ê¸° ì •ë³´ë„ ìë™ ì ìš©ë©ë‹ˆë‹¤!\nì‘ì„± í•­ëª©: ${result.filledCount} / ${result.totalCount}`;
          }

          alert(message);
        } catch (error) {
          console.error('ê°€ê²Œ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
          alert('âŒ ê°€ê²Œ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n' + error.message);
        }
      }

      // ê°€ê²Œ ì •ë³´ ì €ì¥ ë²„íŠ¼
      saveStoreInfoBtn.addEventListener('click', async function() {
        this.disabled = true;
        this.textContent = 'ì €ì¥ ì¤‘...';
        try {
          await saveStoreInfo();
        } finally {
          this.disabled = false;
          this.textContent = 'ğŸ“Œ ê°€ê²Œ ì •ë³´ ì €ì¥í•˜ê¸°';
        }
      });

      // ê°€ê²Œ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼
      loadStoreInfoBtn.addEventListener('click', async function() {
        this.disabled = true;
        this.textContent = 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
        try {
          await loadStoreInfo();
        } finally {
          this.disabled = false;
          this.textContent = 'ğŸ“¥ ì €ì¥ëœ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°';
        }
      });

      // AI í™ë³´ í¬ì¸íŠ¸ ì¶”ì²œ ë²„íŠ¼
      aiPromoBtn.addEventListener('click', async function() {
        const review = reviewText.value.trim();
        if (!review) {
          alert('ë¦¬ë·° ì›ë¬¸ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        this.disabled = true;
        this.textContent = 'ğŸ¤– AI ë¶„ì„ ì¤‘...';

        try {
          // í”Œë ˆì´ìŠ¤ ì •ë³´ê°€ ì—†ìœ¼ë©´ ë¨¼ì € í¬ë¡¤ë§ ì‹œë„
          const url = placeUrl.value.trim();
          if (url && !placeInfo) {
            try {
              placeInfo = await crawlPlaceUrl(url);
            } catch (e) {
              console.warn('í¬ë¡¤ë§ ì‹¤íŒ¨, ê³„ì† ì§„í–‰:', e);
            }
          }

          const response = await fetch('/api/generate-reply', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              reviewText: review,
              placeInfo: placeInfo,
              ownerTips: ownerTips.value.trim(),
              action: 'recommend-promo-points'
            })
          });

          if (!response.ok) {
            throw new Error('í™ë³´ í¬ì¸íŠ¸ ì¶”ì²œ ì‹¤íŒ¨');
          }

          const result = await response.json();
          const promoPoints = result.data?.promoPoints || [];

          if (promoPoints.length === 0) {
            throw new Error('ì¶”ì²œëœ í™ë³´ í¬ì¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤');
          }

          // í™ë³´ í¬ì¸íŠ¸ íƒœê·¸ ìƒì„±
          aiPromoTags.innerHTML = '';
          promoPoints.forEach(point => {
            const tag = document.createElement('span');
            tag.className = 'promo-tag';
            tag.textContent = point;
            tag.dataset.point = point;
            
            tag.addEventListener('click', function() {
              this.classList.toggle('selected');
              updateSelectedPromoPoints();
            });

            aiPromoTags.appendChild(tag);
          });

          aiPromoArea.style.display = 'block';
          alert('âœ… AIê°€ í™ë³´ í¬ì¸íŠ¸ë¥¼ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤! ì›í•˜ëŠ” í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.');

        } catch (error) {
          console.error('í™ë³´ í¬ì¸íŠ¸ ì¶”ì²œ ì˜¤ë¥˜:', error);
          alert('âŒ í™ë³´ í¬ì¸íŠ¸ ì¶”ì²œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n' + error.message);
        } finally {
          this.disabled = false;
          this.textContent = 'ğŸ¤– AI í™ë³´ í¬ì¸íŠ¸ ìë™ ì¶”ì²œ';
        }
      });

      // ì„ íƒëœ í™ë³´ í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
      function updateSelectedPromoPoints() {
        const selectedTags = aiPromoTags.querySelectorAll('.promo-tag.selected');
        selectedPromoPoints = Array.from(selectedTags).map(tag => tag.dataset.point);
        console.log('ì„ íƒëœ í™ë³´ í¬ì¸íŠ¸:', selectedPromoPoints);
      }

      // ë‹µê¸€ ìƒì„± ê³µí†µ í•¨ìˆ˜ (ìŠ¤íƒ€ì¼ë³„)
      async function generateReply(style, buttonElement) {
        const text = reviewText.value.trim();
        const url = placeUrl.value.trim();
        const tips = ownerTips.value.trim();

        if (!text) {
          showError({ message: "ë¦¬ë·° ì›ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”." });
          return;
        }

        setLoading(buttonElement, true, "ìƒì„± ì¤‘...");
        reviewOutput.textContent = "";
        hidePlaceInfoStatus();

        try {
          // 1ë‹¨ê³„: URLì´ ìˆê³  ì•„ì§ í¬ë¡¤ë§ ì•ˆí–ˆìœ¼ë©´ ë¨¼ì € í¬ë¡¤ë§
          if (url && !placeInfo) {
            showPlaceInfoStatus("ğŸ” ì‹ë‹¹ ì •ë³´ ìˆ˜ì§‘ ì¤‘ (ì•½ 10~15ì´ˆ ì†Œìš”)", "loading");
            try {
              placeInfo = await crawlPlaceUrl(url);
              showPlaceInfoStatus("âœ… ì‹ë‹¹ ì •ë³´ ìˆ˜ì§‘ ì™„ë£Œ! ë‹µê¸€ ìƒì„± ì¤‘", "success");
            } catch (crawlError) {
              console.error("í¬ë¡¤ë§ ì‹¤íŒ¨:", crawlError);
              if (crawlError.message.includes("ì‹œê°„ì´ ì´ˆê³¼")) {
                showPlaceInfoStatus("â±ï¸ ì‹œê°„ ì´ˆê³¼! ì…ë ¥í•˜ì‹  ì •ë³´ë¡œ ë‹µê¸€ ìƒì„± ì¤‘", "warning");
              } else {
                showPlaceInfoStatus("âš ï¸ ì‹ë‹¹ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì…ë ¥í•˜ì‹  ì •ë³´ë¡œ ë‹µê¸€ ìƒì„± ì¤‘", "warning");
              }
              placeInfo = null;
            }
          } else if (!url && !placeInfo) {
            showPlaceInfoStatus("ğŸ’­ ë‹µê¸€ ìƒì„± ì¤‘", "loading");
          }

          // 2ë‹¨ê³„: ë‹µê¸€ ìƒì„± (ìŠ¤íƒ€ì¼ í¬í•¨)
          const requestBody = {
            reviewText: text,
            replyStyle: style // 'promo', 'professional', 'friendly'
          };

          if (placeInfo) {
            requestBody.placeInfo = placeInfo;
          }

          if (tips) {
            requestBody.ownerTips = tips;
          }

          // ì„ íƒëœ í™ë³´ í¬ì¸íŠ¸ê°€ ìˆìœ¼ë©´ í•¨ê»˜ ì „ë‹¬
          if (selectedPromoPoints.length > 0) {
            requestBody.selectedPromoPoints = selectedPromoPoints;
          }

          // í”„ë¡œëª¨ì…˜ ì •ë³´ ì¶”ê°€
          if (globalHasPromotion && globalPromotionData) {
            requestBody.promotionData = globalPromotionData;
            requestBody.hasPromotion = true;
          }

          const replyController = new AbortController();
          const replyTimeoutId = setTimeout(() => replyController.abort(), 15000);
          
          let res;
          try {
            res = await fetch(`/api/generate-reply`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(requestBody),
              signal: replyController.signal
            });
            clearTimeout(replyTimeoutId);
          } catch (fetchError) {
            clearTimeout(replyTimeoutId);
            
            if (fetchError.name === 'AbortError') {
              throw new Error("ë‹µê¸€ ìƒì„± ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
            
            throw new Error("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
          }

          const data = await readJsonSafely(res);

          if (!res.ok || data.success === false) {
            if (res.status === 405) {
              throw new Error("ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            } else if (res.status === 500) {
              throw new Error(data.error || "ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            } else if (res.status === 400) {
              throw new Error(data.error || "ì…ë ¥ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            } else {
              throw new Error(data.error || data.message || `ì„œë²„ ì˜¤ë¥˜ (${res.status})`);
            }
          }

          showOutput(data.data?.reply || data.reply || data);
          
          // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
          const styleNames = {
            'promo': 'í™ë³´í˜•',
            'professional': 'ì „ë¬¸ê°€í˜•',
            'friendly': 'ì¹œê·¼í˜•'
          };
          const styleName = styleNames[style] || style;
          
          let successMessage = `âœ… ${styleName} ë‹µê¸€ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`;
          if (selectedPromoPoints.length > 0) {
            successMessage += ` (í™ë³´ í¬ì¸íŠ¸ ${selectedPromoPoints.length}ê°œ ë°˜ì˜)`;
          }
          
          showPlaceInfoStatus(successMessage, "success");
          setTimeout(() => hidePlaceInfoStatus(), 5000);
          
        } catch (e) {
          console.error("ë‹µê¸€ ìƒì„± ì˜¤ë¥˜:", e);
          showError(e);
          hidePlaceInfoStatus();
        } finally {
          setLoading(buttonElement, false);
        }
      }

      // 3ê°œì˜ ë‹µê¸€ ìŠ¤íƒ€ì¼ ë²„íŠ¼ ì´ë²¤íŠ¸
      replyPromoBtn.addEventListener("click", async () => {
        await generateReply('promo', replyPromoBtn);
      });

      replyProfessionalBtn.addEventListener("click", async () => {
        await generateReply('professional', replyProfessionalBtn);
      });

      replyFriendlyBtn.addEventListener("click", async () => {
        await generateReply('friendly', replyFriendlyBtn);
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      window.addEventListener("load", function () {
        reviewText.focus();
        ensureAuthenticated();
      });

      function updateAuthUI() {
        const isLoggedIn = localStorage.getItem("isLoggedIn");
        const userData = localStorage.getItem("userData");

        const loginBtn = document.querySelector(".login-btn");
        const signupBtns = document.querySelectorAll(".signup-btn");

        if (isLoggedIn === "true" && userData) {
          try {
            const user = JSON.parse(userData);

            // ë¡œê·¸ì¸ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            if (loginBtn) loginBtn.style.display = "none";

            // íšŒì›ê°€ì… ë²„íŠ¼ì€ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
            if (signupBtns.length > 0) {
              signupBtns[0].textContent = "ë¡œê·¸ì•„ì›ƒ";
              signupBtns[0].onclick = async function (e) {
                e.preventDefault();
                if (!confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
                try {
                  if (window.authState?.signOut) {
                    await window.authState.signOut();
                  } else {
                    localStorage.removeItem("isLoggedIn");
                    localStorage.removeItem("userData");
                  }
                } finally {
                  location.href = "login.html";
                }
              };
            }
          } catch (e) {
            console.error("ë¡œê·¸ì¸ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:", e);
            localStorage.removeItem("isLoggedIn");
            localStorage.removeItem("userData");
          }
        } else {
          // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìƒíƒœ
          if (loginBtn) loginBtn.style.display = "inline-block";
          signupBtns.forEach((btn) => {
            btn.style.display = "inline-block";
            btn.onclick = null;
          });
        }
      }

      function buildRedirectUrl() {
        const current =
          window.location.pathname +
          window.location.search +
          window.location.hash;
        return `login.html?redirect=${encodeURIComponent(current)}`;
      }

      function redirectToLogin() {
        window.location.replace(buildRedirectUrl());
      }

      async function ensureAuthenticated() {
        if (localStorage.getItem("isLoggedIn") === "true") {
          updateAuthUI();
          return;
        }
        if (window.authState?.syncSession) {
          try {
            const session = await window.authState.syncSession();
            updateAuthUI();
            if (session) return;
          } catch (error) {
            console.warn("ì„¸ì…˜ ë™ê¸°í™” ì‹¤íŒ¨:", error);
          }
        } else {
          updateAuthUI();
        }
        redirectToLogin();
      }

      window.addEventListener("auth:state-changed", () => {
        updateAuthUI();
        if (localStorage.getItem("isLoggedIn") === "true") return;
        redirectToLogin();
      });
    </script>

    <!-- ì¶”ì  ë° ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/assets/analytics.js"></script>
    <script src="/assets/error-logger.js"></script>
    <script src="/assets/performance-tracker.js"></script>

    <script>
      // ë¡œê·¸ì¸ ìƒíƒœ UI ì—…ë°ì´íŠ¸
      function updateAuthUI() {
        const authUser = document.getElementById("authUser");
        const loginBtn = document.getElementById("loginBtn");
        const signupBtn = document.getElementById("signupBtn");
        const userAvatar = document.getElementById("userAvatar");
        const userEmailSpan = document.getElementById("userEmail");
        const logoutBtn = document.getElementById("logoutBtn");

        const isLoggedIn = localStorage.getItem("isLoggedIn");
        const userData = localStorage.getItem("userData");

        if (isLoggedIn === "true" && userData) {
          try {
            const user = JSON.parse(userData);

            // ë¡œê·¸ì¸ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            if (loginBtn) loginBtn.style.display = "none";
            if (signupBtn) signupBtn.style.display = "none";

            // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
            if (authUser) authUser.style.display = "flex";
            if (userEmailSpan) {
              userEmailSpan.textContent = "ë§ˆì´í˜ì´ì§€";
              userEmailSpan.title = "í´ë¦­í•˜ì—¬ ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™";
            }
            if (userAvatar) {
              const base = user.displayName || user.email || "U";
              userAvatar.textContent = (base.trim()[0] || "U").toUpperCase();
            }
            if (logoutBtn) {
              logoutBtn.style.display = "inline-flex";
              logoutBtn.onclick = async function () {
                if (!confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
                try {
                  if (window.authState?.signOut) {
                    await window.authState.signOut();
                  } else {
                    localStorage.removeItem("isLoggedIn");
                    localStorage.removeItem("userData");
                  }
                } finally {
                  location.href = "/login.html";
                }
              };
            }
          } catch (e) {
            console.error("ë¡œê·¸ì¸ ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:", e);
            localStorage.removeItem("isLoggedIn");
            localStorage.removeItem("userData");
          }
        } else {
          // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìƒíƒœ
          if (authUser) authUser.style.display = "none";
          if (loginBtn) loginBtn.style.display = "inline-flex";
          if (signupBtn) signupBtn.style.display = "inline-flex";
          if (logoutBtn) logoutBtn.style.display = "none";
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
      updateAuthUI();
      window.addEventListener("auth:state-changed", updateAuthUI);
      if (window.authState?.syncSession) {
        window.authState.syncSession();
      }
    </script>

    <!-- ê³µí†µ ì¸ì¦ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/assets/auth-state.js"></script>
  </body>
</html>
