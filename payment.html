<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://*.supabase.co https://naver-keyword-tool.onrender.com wss://*.supabase.co; img-src 'self' data: https:; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; font-src 'self' data:; frame-ancestors 'self'; base-uri 'self'; form-action 'self'" />
  <meta name="referrer" content="no-referrer" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <title>ê²°ì œí•˜ê¸° - ì‚¬ì¥í”½</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%23ff7b54'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-size='28' font-family='Arial' fill='white'%3ESP%3C/text%3E%3C/svg%3E" />
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
  <style>
    /* ì‚¬ì¥í”½ ë¸Œëœë“œ ìƒ‰ìƒ ë³€ìˆ˜ */
    :root {
      --accent-color: #ff7b54;
      --accent-dark: #e56548;
      --bg-color: #fff7f0;
      --text-primary: #201a17;
      --text-secondary: #7a6a60;
      --secondary: #ffe8d9;
      --white: #ffffff;
      --border: rgba(0, 0, 0, 0.08);
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.12);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans KR", Arial, sans-serif;
      background: var(--bg-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .payment-container {
      background: var(--white);
      border-radius: 24px;
      padding: 40px;
      max-width: 500px;
      width: 100%;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
      flex: 1;
      margin-bottom: 20px;
    }
    .payment-container#planSelectionContainer {
      max-width: 1200px;
      padding: 50px 40px 30px 40px;
    }
    
    .plan-selection-header {
      margin-bottom: 50px;
    }
    
    .plan-selection-title {
      font-size: 32px;
      font-weight: 800;
      color: var(--text-primary);
      margin: 0 0 8px 0;
      letter-spacing: -0.5px;
    }
    
    .plan-selection-subtitle {
      font-size: 16px;
      color: var(--text-secondary);
      margin: 0;
      font-weight: 500;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 10px;
      color: var(--text-primary);
      font-weight: 800;
      letter-spacing: -0.5px;
    }
    .subtitle {
      color: var(--text-secondary);
      margin-bottom: 30px;
      font-weight: 500;
    }
    .plan-info {
      background: var(--secondary);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 30px;
      border: 1px solid var(--border);
    }
    .plan-name {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent-color);
      margin-bottom: 10px;
    }
    .plan-details {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      color: var(--text-primary);
      font-weight: 500;
    }
    .price {
      font-size: 32px;
      font-weight: 800;
      color: var(--text-primary);
      margin: 20px 0;
    }
    .payment-methods {
      margin-bottom: 30px;
    }
    .payment-method {
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--white);
    }
    .payment-method:hover {
      border-color: var(--accent-color);
      box-shadow: var(--shadow-sm);
    }
    .payment-method.selected {
      border-color: var(--accent-color);
      background: var(--secondary);
    }
    .payment-method input[type="radio"] {
      width: 20px;
      height: 20px;
    }
    .btn-payment {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: var(--shadow-md);
    }
    .btn-payment:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    .btn-payment:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .terms {
      font-size: 12px;
      color: var(--text-secondary);
      text-align: center;
      margin-top: 20px;
    }
    .terms a {
      color: var(--accent-color);
      text-decoration: none;
    }
    .terms a:hover {
      text-decoration: underline;
    }
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--accent-color);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .payment-container {
        padding: 30px 20px;
        border-radius: 16px;
      }

      h1 {
        font-size: 24px;
      }

      .subtitle {
        font-size: 14px;
      }

      .plan-info {
        padding: 16px;
      }

      .plan-name {
        font-size: 18px;
      }

      .price {
        font-size: 28px;
      }

      .btn-payment {
        padding: 14px;
        font-size: 16px;
      }

      /* ëª¨ë°”ì¼ì—ì„œ í”Œëœ ì¹´ë“œ ì„¸ë¡œ ë°°ì¹˜ */
      #planSelectionGrid {
        flex-direction: column;
        align-items: stretch;
      }

      .plan-card {
        max-width: 100% !important;
        min-width: 100% !important;
      }
      
      .plan-selection-header {
        margin-bottom: 30px;
      }
      
      .plan-selection-title {
        font-size: 24px;
      }
      
      .plan-selection-subtitle {
        font-size: 14px;
      }
      
      .payment-container#planSelectionContainer {
        padding: 30px 20px 20px 20px;
      }
      
      /* ëª¨ë°”ì¼ì—ì„œ ê°„í¸ ê²°ì œ ê·¸ë¦¬ë“œ ì¡°ì • */
      .payment-methods > div[style*="grid-template-columns"] {
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 8px !important;
      }
      
      .payment-methods > div[style*="grid-template-columns"] label {
        padding: 12px 4px !important;
      }
      
      .payment-methods > div[style*="grid-template-columns"] label div {
        width: 36px !important;
        height: 36px !important;
        font-size: 16px !important;
      }
      
      .payment-methods > div[style*="grid-template-columns"] label span {
        font-size: 11px !important;
      }
    }

    @media (max-width: 360px) {
      body {
        padding: 5px;
      }

      .payment-container {
        padding: 20px 15px;
        border-radius: 12px;
      }

      h1 {
        font-size: 20px;
      }

      .subtitle {
        font-size: 12px;
      }

      .plan-info {
        padding: 12px;
      }

      .plan-name {
        font-size: 16px;
      }

      .price {
        font-size: 24px;
      }

      .btn-payment {
        padding: 12px;
        font-size: 14px;
      }

      .payment-method {
        padding: 12px;
      }
      
      /* ëª¨ë°”ì¼ì—ì„œ ê°„í¸ ê²°ì œ ê·¸ë¦¬ë“œ ì¡°ì • */
      .payment-methods .payment-method[style*="grid-template-columns"] {
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 8px !important;
      }
      
      .payment-methods .payment-method[style*="grid-template-columns"] label {
        padding: 12px 8px !important;
      }
      
      .payment-methods .payment-method[style*="grid-template-columns"] label div {
        width: 40px !important;
        height: 40px !important;
      }
    }

    /* í”Œëœ ì„ íƒ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .plan-card {
      transition: all 0.3s ease;
      box-shadow: var(--shadow-md);
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .plan-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-lg);
    }

    .plan-card:active {
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
    }

    /* í‘¸í„° ìŠ¤íƒ€ì¼ */
    .site-footer {
      background: var(--white);
      border-top: 1px solid var(--border);
      padding: 30px 20px;
      margin-top: auto;
      color: var(--text-secondary);
      width: 100%;
    }

    .footer-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0;
      font-size: 14px;
      line-height: 1.6;
      align-items: center;
    }

    .footer-item {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 4px;
      margin-right: 20px;
    }

    .footer-label {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 13px;
      white-space: nowrap;
    }

    .footer-value {
      color: var(--text-secondary);
      font-size: 13px;
    }

    .footer-value a {
      color: var(--accent-color);
      text-decoration: none;
      transition: opacity 0.2s ease;
    }

    .footer-value a:hover {
      opacity: 0.8;
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .site-footer {
        padding: 10px 8px;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 30;
        margin-top: 0;
      }

      .footer-content {
        gap: 5px;
        font-size: 8px;
        flex-direction: row;
        flex-wrap: wrap;
        line-height: 1.4;
      }

      .footer-item {
        flex-direction: row;
        align-items: center;
        gap: 3px;
        margin-right: 0;
        margin-bottom: 0;
      }

      .footer-label {
        font-size: 8px;
      }

      .footer-value {
        font-size: 8px;
      }
    }
  </style>
  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '823098897158597');
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=823098897158597&ev=PageView&noscript=1"
  /></noscript>
  <!-- End Meta Pixel Code -->
</head>
<body>
  <!-- í”Œëœ ì„ íƒ í™”ë©´ -->
  <div class="payment-container" id="planSelectionContainer">
    <div class="plan-selection-header" style="display: flex; align-items: center; gap: 15px;">
      <button onclick="goBack()" style="background: none; border: none; font-size: 24px; color: var(--text-primary); cursor: pointer; padding: 8px; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; transition: all 0.3s; font-weight: 600; flex-shrink: 0;" 
              onmouseover="this.style.background='var(--secondary)'; this.style.color='var(--accent-color)'" 
              onmouseout="this.style.background='none'; this.style.color='var(--text-primary)'"
              title="ì´ì „ í™”ë©´ìœ¼ë¡œ">
        â†
      </button>
      <div style="flex: 1;">
        <h1 class="plan-selection-title" style="display: flex; align-items: center; gap: 10px;">
          í”Œëœ ì„ íƒ
          <span id="excessInfoIcon_header" style="cursor: pointer; width: 24px; height: 24px; border-radius: 50%; background: var(--accent-color); color: white; display: inline-flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; transition: all 0.3s; flex-shrink: 0;" 
                onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 2px 8px rgba(255, 123, 84, 0.4)'" 
                onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'"
                onclick="showExcessInfo(event, 'header')">?</span>
        </h1>
        <p class="plan-selection-subtitle">ì›í•˜ëŠ” í”Œëœì„ ì„ íƒí•˜ê³  ê²°ì œí•˜ì„¸ìš”</p>
      </div>
    </div>
    
    <div id="planSelectionGrid" style="display: flex; flex-wrap: wrap; gap: 24px; justify-content: center; align-items: stretch;">
      <!-- í”Œëœ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
      <div class="loading" id="planLoadingSpinner" style="width: 100%; text-align: center; padding: 40px;">
        <div class="spinner"></div>
        <p style="margin-top: 15px; color: var(--text-secondary);">í”Œëœ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>
    
    <!-- í™˜ë¶ˆì•½ê´€ ì•ˆë‚´ -->
    <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid var(--border); text-align: center;">
      <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6; margin: 0;">
        ê²°ì œ ì „ <a href="/refund-policy.html" style="color: var(--accent-color); text-decoration: none; font-weight: 600;">í™˜ë¶ˆì•½ê´€</a>ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
      </p>
    </div>
  </div>

  <!-- ê²°ì œ í™”ë©´ -->
  <div class="payment-container" id="paymentContainer" style="display: none;">
    <h1>êµ¬ë… í”Œëœ ê²°ì œ</h1>
    <p class="subtitle">ë” ë§ì€ AI ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”</p>
    
    <div class="plan-info">
      <div class="plan-name" id="planName">ìŠ¤íƒ ë‹¤ë“œ í”Œëœ</div>
      <div class="plan-details">
        <span>ì›” ìµœì†Œ ì´ìš©ë£Œ</span>
        <strong id="priceAmount">30,000ì›</strong>
      </div>
      <div class="plan-details">
        <span>ì‘ì—… í¬ë ˆë”§</span>
        <strong id="creditAmount">37,500 í¬ë ˆë”§</strong>
      </div>
      <div class="plan-details" style="padding: 12px; background: rgba(255, 123, 84, 0.1); border-radius: 8px; margin-top: 12px; display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="font-weight: 600; color: var(--accent-color);">ì´ˆê³¼ ì‘ì—… í¬ë ˆë”§ë‹¹ ë‹¨ê°€</span>
          <span id="excessInfoIcon_payment" style="cursor: pointer; width: 20px; height: 20px; border-radius: 50%; background: var(--accent-color); color: white; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; transition: all 0.3s;" 
                onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 2px 8px rgba(255, 123, 84, 0.4)'" 
                onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'"
                onclick="showExcessInfo(event, 'payment')">?</span>
        </div>
        <strong style="color: var(--accent-color);" id="excessRateDisplay">0.8ì›/í¬ë ˆë”§</strong>
      </div>
      <div style="margin-top: 12px; padding: 10px; background: rgba(255, 193, 7, 0.1); border-left: 3px solid #ffc107; border-radius: 4px; font-size: 13px; color: var(--text-secondary);">
        <strong style="color: #856404;">ğŸ’¡ ì•ˆë‚´:</strong> ì›” ìµœì†Œ ì´ìš©ë£Œì™€ ì‹¤ì œ ì‚¬ìš© ê¸ˆì•¡ ì¤‘ ë” í° ê¸ˆì•¡ì´ ì²­êµ¬ë©ë‹ˆë‹¤. ì‹¤ì œ ì‚¬ìš© ê¸ˆì•¡ = (ì´ ì‚¬ìš© í¬ë ˆë”§) Ã— (ì´ˆê³¼ ì‘ì—… í¬ë ˆë”§ë‹¹ ë‹¨ê°€)
      </div>
    </div>

    <div class="price">
      <span id="priceAmountDisplay">30,000</span>ì›
      <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px; font-weight: 400;">
        (ì›” ìµœì†Œ ì´ìš©ë£Œ, ì´ˆê³¼ ì‹œ ì¶”ê°€ ì²­êµ¬)
      </div>
    </div>

    <!-- ì£¼ë¬¸ì ì •ë³´ ì…ë ¥ (ì¹´ì¹´ì˜¤í˜ì´ í…ŒìŠ¤íŠ¸ìš©) -->
    <div style="background: var(--white); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 30px;">
      <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 700; color: var(--text-primary);">
        <i class="fas fa-user"></i> ì£¼ë¬¸ì ì •ë³´
      </h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 14px;">ì´ë¦„</label>
          <input type="text" id="ordererName" placeholder="í™ê¸¸ë™" 
                 style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                 onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'">
        </div>
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 14px;">ì „í™”ë²ˆí˜¸</label>
          <input type="tel" id="ordererPhone" placeholder="010-1234-5678" 
                 style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                 onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'">
        </div>
      </div>
      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 14px;">ì´ë©”ì¼</label>
        <input type="email" id="ordererEmail" placeholder="example@email.com" 
               style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
               onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'">
      </div>
    </div>

    <div class="payment-methods">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3 style="margin: 0; font-size: 16px;">ê²°ì œ ë°©ë²• ì„ íƒ</h3>
        <button id="registerCardBtn" class="btn-register-card" onclick="openCardRegisterModal()" style="padding: 8px 16px; background: var(--secondary); color: var(--accent-color); border: 1px solid var(--accent-color); border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
          <i class="fas fa-link"></i> í˜ì´ ì—°ë™í•˜ê¸°
        </button>
      </div>
      
      <!-- ë“±ë¡ëœ ì¹´ë“œ ëª©ë¡ -->
      <div id="registeredCards" style="margin-bottom: 15px;">
        <!-- ì¹´ë“œ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
      </div>
      
      <!-- ê°„í¸ ê²°ì œ ë°©ë²• -->
      <div style="margin-bottom: 20px;">
        <h4 style="margin: 0 0 12px 0; font-size: 14px; color: var(--text-secondary); font-weight: 600;">ê°„í¸ ê²°ì œ</h4>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
          <label class="payment-method" style="margin: 0; flex-direction: column; align-items: center; padding: 16px; text-align: center;">
            <input type="radio" name="method" value="toss">
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #0064FF 0%, #0052CC 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; box-shadow: 0 2px 8px rgba(0, 100, 255, 0.3);">
              <span style="color: white; font-size: 20px; font-weight: 700;">T</span>
            </div>
            <span style="font-size: 13px; font-weight: 600; color: #333;">í† ìŠ¤í˜ì´</span>
          </label>
          
          <label class="payment-method" style="margin: 0; flex-direction: column; align-items: center; padding: 16px; text-align: center;">
            <input type="radio" name="method" value="kakao">
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #FEE500 0%, #FDD835 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; box-shadow: 0 2px 8px rgba(254, 229, 0, 0.3);">
              <span style="color: #3C1E1E; font-size: 20px; font-weight: 700;">K</span>
            </div>
            <span style="font-size: 13px; font-weight: 600; color: #333;">ì¹´ì¹´ì˜¤í˜ì´</span>
          </label>
          
          <label class="payment-method" style="margin: 0; flex-direction: column; align-items: center; padding: 16px; text-align: center;">
            <input type="radio" name="method" value="naver">
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #03C75A 0%, #02B14F 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; box-shadow: 0 2px 8px rgba(3, 199, 90, 0.3);">
              <span style="color: white; font-size: 20px; font-weight: 700;">N</span>
            </div>
            <span style="font-size: 13px; font-weight: 600; color: #333;">ë„¤ì´ë²„í˜ì´</span>
          </label>
        </div>
      </div>
      
      <!-- ì¼ë°˜ ê²°ì œ ë°©ë²• -->
      <div id="generalPaymentMethods">
        <h4 style="margin: 0 0 12px 0; font-size: 14px; color: var(--text-secondary); font-weight: 600;">ì¼ë°˜ ê²°ì œ</h4>
        <label class="payment-method">
          <input type="radio" name="method" value="card">
          <span>ğŸ’³ ì‹ ìš©/ì²´í¬ì¹´ë“œ (ì¼íšŒì„±)</span>
        </label>
        
        <label class="payment-method">
          <input type="radio" name="method" value="transfer">
          <span>ğŸ¦ ê³„ì¢Œì´ì²´</span>
        </label>
        
        <label class="payment-method">
          <input type="radio" name="method" value="phone">
          <span>ğŸ“± íœ´ëŒ€í° ê²°ì œ</span>
        </label>
      </div>
    </div>

    <!-- ì´ˆê³¼ ì‚¬ìš©ë¶„ ì„¤ëª… ëª¨ë‹¬ -->
    <div id="excessInfoModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
      <div style="background: var(--white); border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg); position: relative;">
        <button onclick="closeExcessInfoModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; color: var(--text-secondary); cursor: pointer; transition: color 0.3s; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%;" 
                onmouseover="this.style.background='var(--secondary)'; this.style.color='var(--accent-color)'" 
                onmouseout="this.style.background='none'; this.style.color='var(--text-secondary)'">&times;</button>
        <h2 style="margin: 0 0 20px 0; font-size: 22px; color: var(--text-primary); font-weight: 800;">ì´ˆê³¼ ì‚¬ìš©ë¶„ ê²°ì œ ì‹œìŠ¤í…œ</h2>
        <div style="color: var(--text-primary); line-height: 1.8; font-size: 15px;">
          <p style="margin-bottom: 16px;">
            <strong style="color: var(--accent-color);">ì‚¬ì¥í”½ì˜ ê²°ì œ ì‹œìŠ¤í…œ</strong>ì€ ì‚¬ìš©í•œ ë§Œí¼ë§Œ ì§€ë¶ˆí•˜ëŠ” <strong>ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ê³¼ê¸ˆ</strong> ë°©ì‹ì…ë‹ˆë‹¤.
          </p>
          
          <div style="background: var(--secondary); padding: 16px; border-radius: 12px; margin-bottom: 16px; border-left: 4px solid var(--accent-color);">
            <p style="margin: 0 0 12px 0; font-weight: 700; color: var(--accent-color);">ğŸ’¡ ê²°ì œ ë°©ì‹</p>
            <p style="margin: 0; font-size: 14px;">
              <strong>ì›” ìµœì†Œ ì´ìš©ë£Œ</strong>ì™€ <strong>ì‹¤ì œ ì‚¬ìš© ê¸ˆì•¡</strong> ì¤‘ <strong>ë” í° ê¸ˆì•¡</strong>ì´ ì²­êµ¬ë©ë‹ˆë‹¤.
            </p>
          </div>
          
          <div style="margin-bottom: 16px;">
            <p style="margin: 0 0 8px 0; font-weight: 700;">ğŸ“Š ì‹¤ì œ ì‚¬ìš© ê¸ˆì•¡ ê³„ì‚°</p>
            <p style="margin: 0; font-size: 14px; background: rgba(255, 123, 84, 0.05); padding: 12px; border-radius: 8px;">
              ì‹¤ì œ ì‚¬ìš© ê¸ˆì•¡ = (ì´ ì‚¬ìš© í¬ë ˆë”§) Ã— (ì´ˆê³¼ ì‘ì—… í¬ë ˆë”§ë‹¹ ë‹¨ê°€)
            </p>
          </div>
          
          <div style="margin-bottom: 16px;">
            <p style="margin: 0 0 8px 0; font-weight: 700;">ğŸ“ ì˜ˆì‹œ</p>
            <div style="font-size: 14px; background: rgba(255, 123, 84, 0.05); padding: 12px; border-radius: 8px;">
              <p style="margin: 0 0 8px 0;"><strong>ìŠ¤íƒ ë‹¤ë“œ í”Œëœ (30,000ì›)</strong></p>
              <p style="margin: 0 0 4px 0;">â€¢ í¬í•¨ í¬ë ˆë”§: 37,500 í¬ë ˆë”§</p>
              <p style="margin: 0 0 4px 0;">â€¢ ì´ˆê³¼ ë‹¨ê°€: 0.8ì›/í¬ë ˆë”§</p>
              <p style="margin: 0 0 8px 0;">â€¢ ì‹¤ì œ ì‚¬ìš©: 50,000 í¬ë ˆë”§</p>
              <p style="margin: 0; padding-top: 8px; border-top: 1px solid var(--border);">
                <strong>ì²­êµ¬ ê¸ˆì•¡:</strong> 50,000 Ã— 0.8ì› = 40,000ì›<br>
                (ì›” ìµœì†Œ ì´ìš©ë£Œ 30,000ì›ë³´ë‹¤ í¬ë¯€ë¡œ 40,000ì› ì²­êµ¬)
              </p>
            </div>
          </div>
          
          <div style="background: rgba(255, 193, 7, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #ffc107; margin-top: 16px;">
            <p style="margin: 0; font-size: 13px; color: #856404;">
              <strong>ğŸ’¡ íŒ:</strong> í¬í•¨ëœ í¬ë ˆë”§ì„ ì´ˆê³¼í•˜ì§€ ì•Šìœ¼ë©´ ì›” ìµœì†Œ ì´ìš©ë£Œë§Œ ì²­êµ¬ë©ë‹ˆë‹¤. ì´ˆê³¼ ì‚¬ìš© ì‹œì—ë§Œ ì¶”ê°€ ìš”ê¸ˆì´ ë°œìƒí•©ë‹ˆë‹¤.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- ì¹´ë“œ ê²°ì œì°½ ëª¨ë‹¬ (ì¹´ì¹´ì˜¤í˜ì´ í…ŒìŠ¤íŠ¸ìš©) -->
    <div id="cardPaymentModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001; align-items: center; justify-content: center;">
      <div style="background: var(--white); border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; font-size: 22px; color: var(--text-primary); font-weight: 800;">ì¹´ë“œ ê²°ì œ</h2>
          <button onclick="closeCardPaymentModal()" style="background: none; border: none; font-size: 24px; color: var(--text-secondary); cursor: pointer; transition: color 0.3s;" onmouseover="this.style.color='var(--accent-color)'" onmouseout="this.style.color='var(--text-secondary)'">&times;</button>
        </div>
        
        <div style="background: var(--secondary); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="color: var(--text-secondary); font-size: 14px;">ê²°ì œ ê¸ˆì•¡</span>
            <strong style="color: var(--text-primary); font-size: 20px;" id="cardPaymentAmount">30,000ì›</strong>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span style="color: var(--text-secondary); font-size: 14px;">í”Œëœ</span>
            <span style="color: var(--text-primary); font-size: 14px;" id="cardPaymentPlan">ìŠ¤íƒ ë‹¤ë“œ í”Œëœ</span>
          </div>
        </div>
        
        <form id="cardPaymentForm" onsubmit="submitCardPayment(event)">
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">ì¹´ë“œë²ˆí˜¸</label>
            <input type="text" id="paymentCardNumber" placeholder="1234-5678-9012-3456" 
                   maxlength="19" style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                   onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'" required>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">ìœ íš¨ê¸°ê°„</label>
              <input type="text" id="paymentCardExpiry" placeholder="MM/YY" maxlength="5"
                     style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                     onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'" required>
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">CVC</label>
              <input type="text" id="paymentCardCvc" placeholder="123" maxlength="4"
                     style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                     onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'" required>
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">ì¹´ë“œ ë¹„ë°€ë²ˆí˜¸ ì• 2ìë¦¬</label>
            <input type="password" id="paymentCardPassword" placeholder="**" maxlength="2"
                   style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                   onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'" required>
          </div>
          
          <div style="display: flex; gap: 10px;">
            <button type="button" onclick="closeCardPaymentModal()" 
                    style="flex: 1; padding: 14px; background: var(--secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;"
                    onmouseover="this.style.background='var(--border)'" onmouseout="this.style.background='var(--secondary)'">
              ì·¨ì†Œ
            </button>
            <button type="submit" 
                    style="flex: 1; padding: 14px; background: linear-gradient(135deg, var(--accent-color), var(--accent-dark)); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: var(--shadow-sm);"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-md)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-sm)'">
              ê²°ì œí•˜ê¸°
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- ì¹´ë“œ ë“±ë¡ ëª¨ë‹¬ -->
    <div id="cardRegisterModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
      <div style="background: var(--white); border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; font-size: 22px; color: var(--text-primary); font-weight: 800;">ì¹´ë“œ ë“±ë¡í•˜ê¸°</h2>
          <button onclick="closeCardRegisterModal()" style="background: none; border: none; font-size: 24px; color: var(--text-secondary); cursor: pointer; transition: color 0.3s;" onmouseover="this.style.color='var(--accent-color)'" onmouseout="this.style.color='var(--text-secondary)'">&times;</button>
        </div>
        
        <form id="cardRegisterForm" onsubmit="registerCard(event)">
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">ì¹´ë“œ ë³„ì¹­</label>
            <input type="text" id="cardAlias" placeholder="ì˜ˆ: ì£¼ ì¹´ë“œ, íšŒì‚¬ ì¹´ë“œ" 
                   style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                   onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'" required>
            <small style="color: var(--text-secondary); font-size: 12px;">ë‚˜ì¤‘ì— ì‰½ê²Œ êµ¬ë¶„í•  ìˆ˜ ìˆë„ë¡ ë³„ì¹­ì„ ì…ë ¥í•˜ì„¸ìš”</small>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">ì¹´ë“œë²ˆí˜¸</label>
            <input type="text" id="cardNumber" placeholder="1234-5678-9012-3456" 
                   maxlength="19" style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                   onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'" required>
            <small style="color: var(--text-secondary); font-size: 12px;">í•˜ì´í”ˆ(-) ì—†ì´ ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš”</small>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">ìœ íš¨ê¸°ê°„</label>
              <input type="text" id="cardExpiry" placeholder="MM/YY" maxlength="5"
                     style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                     onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'" required>
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">CVC</label>
              <input type="text" id="cardCvc" placeholder="123" maxlength="4"
                     style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                     onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'" required>
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">ì¹´ë“œ ë¹„ë°€ë²ˆí˜¸ ì• 2ìë¦¬</label>
            <input type="password" id="cardPassword" placeholder="**" maxlength="2"
                   style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" 
                   onfocus="this.style.borderColor='var(--accent-color)'" onblur="this.style.borderColor='var(--border)'" required>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="setAsDefault" style="width: 18px; height: 18px; accent-color: var(--accent-color);">
              <span style="font-size: 14px; color: var(--text-primary);">ê¸°ë³¸ ì¹´ë“œë¡œ ì„¤ì •</span>
            </label>
          </div>
          
          <div style="display: flex; gap: 10px;">
            <button type="button" onclick="closeCardRegisterModal()" 
                    style="flex: 1; padding: 14px; background: var(--secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;"
                    onmouseover="this.style.background='var(--border)'" onmouseout="this.style.background='var(--secondary)'">
              ì·¨ì†Œ
            </button>
            <button type="submit" 
                    style="flex: 1; padding: 14px; background: linear-gradient(135deg, var(--accent-color), var(--accent-dark)); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: var(--shadow-sm);"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-md)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-sm)'">
              ë“±ë¡í•˜ê¸°
            </button>
          </div>
        </form>
      </div>
    </div>

    <button class="btn-payment" onclick="processPayment()">
      ê²°ì œí•˜ê¸°
    </button>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p style="margin-top: 15px;">ê²°ì œ ì²˜ë¦¬ ì¤‘...</p>
    </div>

    <p class="terms">
      ê²°ì œí•˜ê¸°ë¥¼ í´ë¦­í•˜ë©´ <a href="/terms">ì´ìš©ì•½ê´€</a>, 
      <a href="/privacy">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a> ë° 
      <a href="/refund-policy.html">í™˜ë¶ˆì•½ê´€</a>ì— ë™ì˜í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
    </p>
  </div>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js" integrity="sha384-GFr3yTh5lJznCbZfpTtXnwboFsxqtTQoeTZCRHhE0579KrRmlCzen5AA8ohaB5ug" crossorigin="anonymous"></script>
  <script src="/assets/demo-mode.js?v=20241125"></script>
  <script src="/assets/auth-state.js?v=202410" defer></script>
  
  <script>
    // URL íŒŒë¼ë¯¸í„°ì—ì„œ í”Œëœ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    const urlParams = new URLSearchParams(window.location.search);
    let plan = urlParams.get('plan');
    // ë°ëª¨ ëª¨ë“œ í™•ì¸ (URL íŒŒë¼ë¯¸í„° ë˜ëŠ” localStorage)
    const isDemoMode = urlParams.get('demo') === 'true' || (window.isDemoMode && window.isDemoMode());
    
    let pricingData = null; // subscription-settings.htmlì—ì„œ ì„¤ì •í•œ ê°€ê²© ë° í¬ë ˆë”§ ì •ë³´
    let currentUserPlan = null; // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í”Œëœ
    
    // ë°ëª¨ ëª¨ë“œ ë°°ë„ˆ ì¶”ê°€
    if (isDemoMode) {
      const demoBanner = document.createElement('div');
      demoBanner.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #ff7b54, #e56548); color: white; padding: 12px; text-align: center; font-weight: 600; font-size: 14px; z-index: 10000; box-shadow: 0 2px 8px rgba(0,0,0,0.2);';
      demoBanner.innerHTML = 'ğŸ” ë°ëª¨ ëª¨ë“œ: í…ŒìŠ¤íŠ¸ í˜ì´ì§€ì…ë‹ˆë‹¤. ì‹¤ì œ ê²°ì œëŠ” ì§„í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
      document.body.insertBefore(demoBanner, document.body.firstChild);
    }
    
    // ì¦‰ì‹œ ì´ˆê¸° í™”ë©´ ì„¤ì • (ë¡œë”© ì „ì—)
    (function() {
      if (plan) {
        // plan íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ê²°ì œ í™”ë©´ í‘œì‹œ
        document.getElementById('planSelectionContainer').style.display = 'none';
        document.getElementById('paymentContainer').style.display = 'block';
      } else {
        // plan íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ í”Œëœ ì„ íƒ í™”ë©´ë§Œ í‘œì‹œ (ë Œë”ë§ì€ ë°ì´í„° ë¡œë“œ í›„)
        document.getElementById('planSelectionContainer').style.display = 'block';
        document.getElementById('paymentContainer').style.display = 'none';
      }
    })();
    
    // í˜ì´ì§€ ì´ˆê¸°í™” - ë°ì´í„° ë¡œë“œ í›„ ë Œë”ë§
    window.addEventListener('load', async function() {
      // ë°ëª¨ ëª¨ë“œ ì¬í™•ì¸ (í˜ì´ì§€ ë¡œë“œ í›„ localStorageë„ ì²´í¬)
      const finalDemoMode = isDemoMode || (window.isDemoMode && window.isDemoMode());
      
      // ë°ëª¨ ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ ë¡œê·¸ì¸ ì²´í¬
      if (!finalDemoMode) {
        // Supabase ì´ˆê¸°í™” ëŒ€ê¸°
        while (!window.authState?.supabase) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        const supabase = window.authState.supabase;
        const { data: { session } } = await supabase.auth.getSession();
        
        if (!session) {
          window.location.href = '/login.html?redirect=' + encodeURIComponent(window.location.pathname + window.location.search);
          return;
        }
      }
      
      // plan íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ ë°ì´í„° ë¡œë“œ í›„ í”Œëœ ì¹´ë“œ ë Œë”ë§
      if (!plan) {
        // ê°€ê²© ë° í† í° ì„¤ì • ë¡œë“œ (ë°ëª¨ ëª¨ë“œë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
        if (finalDemoMode) {
          // ë°ëª¨ ëª¨ë“œ: ì‘ì—… í¬ë ˆë”§ ê¸°ë°˜ ê¸°ë³¸ê°’ (2025-11-25 ì—…ë°ì´íŠ¸)
          pricingData = {
            owner_seed_price: 0,
            owner_seed_minimum_fee: 0,
            owner_seed_included_credits: 0,
            owner_seed_excess_rate: 1.2,
            owner_power_price: 30000,
            owner_power_minimum_fee: 30000,
            owner_power_included_credits: 37500,
            owner_power_excess_rate: 0.8,
            owner_bigpower_price: 50000,
            owner_bigpower_minimum_fee: 50000,
            owner_bigpower_included_credits: 83333,
            owner_bigpower_excess_rate: 0.6,
            owner_premium_price: 100000,
            owner_premium_minimum_fee: 100000,
            owner_premium_included_credits: 200000,
            owner_premium_excess_rate: 0.5
          };
        } else {
        await loadPlanSettings();
        }
        
        // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í”Œëœ ì •ë³´ ë¡œë“œ (ë°ëª¨ ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ)
        if (!finalDemoMode) {
        await loadCurrentUserPlan();
        }
        
        // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ í”Œëœ ì¹´ë“œ ë Œë”ë§
        renderPlanSelection();
      } else {
        // plan íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ê²°ì œ í™”ë©´ìš© ë°ì´í„° ë¡œë“œ
        if (finalDemoMode) {
          // ë°ëª¨ ëª¨ë“œ: ì‘ì—… í¬ë ˆë”§ ê¸°ë°˜ ê¸°ë³¸ê°’ (2025-11-25 ì—…ë°ì´íŠ¸)
          pricingData = {
            owner_seed_price: 0,
            owner_seed_minimum_fee: 0,
            owner_seed_included_credits: 0,
            owner_seed_excess_rate: 1.2,
            owner_power_price: 30000,
            owner_power_minimum_fee: 30000,
            owner_power_included_credits: 37500,
            owner_power_excess_rate: 0.8,
            owner_bigpower_price: 50000,
            owner_bigpower_minimum_fee: 50000,
            owner_bigpower_included_credits: 83333,
            owner_bigpower_excess_rate: 0.6,
            owner_premium_price: 100000,
            owner_premium_minimum_fee: 100000,
            owner_premium_included_credits: 200000,
            owner_premium_excess_rate: 0.5
          };
        } else {
        await loadPlanSettings();
        }
        showPaymentScreen(plan);
      }
      
      // ë“±ë¡ëœ ì¹´ë“œ ëª©ë¡ ë¡œë“œ (ë°ëª¨ ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ)
      if (!finalDemoMode) {
      await loadRegisteredCards();
      } else {
        // ë°ëª¨ ëª¨ë“œ: ì¹´ë“œ ëª©ë¡ ë¹„ìš°ê¸°
        document.getElementById('registeredCards').innerHTML = '';
      }
      
      // ì£¼ë¬¸ì ì •ë³´ ìë™ ì…ë ¥ (ë°ëª¨ ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ)
      if (!finalDemoMode) {
        await fillOrdererInfo();
      } else {
        // ë°ëª¨ ëª¨ë“œ: ìƒ˜í”Œ ë°ì´í„° ì…ë ¥
        document.getElementById('ordererName').value = 'í™ê¸¸ë™';
        document.getElementById('ordererPhone').value = '010-1234-5678';
        document.getElementById('ordererEmail').value = 'test@example.com';
      }
      
      // ë°ëª¨ ëª¨ë“œì¼ ë•Œ ì•ˆë‚´ ë©”ì‹œì§€ ì¶”ê°€ (ê²°ì œëŠ” ê°€ëŠ¥í•˜ë„ë¡)
      if (finalDemoMode) {
        // ê²°ì œ í™”ë©´ì— ë°ëª¨ ì•ˆë‚´ ì¶”ê°€
        const paymentContainer = document.getElementById('paymentContainer');
        if (paymentContainer && plan) {
          const demoNotice = document.createElement('div');
          demoNotice.style.cssText = 'background: #fff3cd; border: 1px solid #ffc107; border-radius: 12px; padding: 16px; margin-bottom: 20px; text-align: center;';
          demoNotice.innerHTML = '<strong style="color: #856404;">âš ï¸ ë°ëª¨ ëª¨ë“œ</strong><br><span style="color: #856404; font-size: 14px;">ì´ í˜ì´ì§€ëŠ” í…ŒìŠ¤íŠ¸ í˜ì´ì§€ì…ë‹ˆë‹¤. ê²°ì œ í”Œë¡œìš°ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆì§€ë§Œ ì‹¤ì œ ê²°ì œëŠ” ì§„í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>';
          paymentContainer.insertBefore(demoNotice, paymentContainer.querySelector('.plan-info'));
        }
      }
    });

    // í”Œëœ ì„¤ì • ë¡œë“œ (ê°€ê²© ë° í¬ë ˆë”§ - subscription-settings.htmlì—ì„œ ì„¤ì •í•œ ê°’ ì‚¬ìš©)
    async function loadPlanSettings() {
      try {
        console.log('ğŸ”„ í”Œëœ ì„¤ì • ë¡œë“œ ì‹œì‘...');
        const pricingRes = await fetch('/api/subscription/pricing-config');
        const pricingResult = await pricingRes.json();

        if (pricingResult.success) {
          pricingData = pricingResult.pricing;
          console.log('âœ… í”Œëœ ì„¤ì • ë¡œë“œ ì™„ë£Œ:', pricingData);
          
          // ë””ë²„ê¹…: subscription-settings.htmlì—ì„œ ì„¤ì •í•˜ëŠ” í•„ë“œë“¤ì´ ìˆëŠ”ì§€ í™•ì¸
          const checkFields = [
            'owner_seed_price', 'owner_seed_included_credits',
            'owner_power_price', 'owner_power_included_credits',
            'owner_bigpower_price', 'owner_bigpower_included_credits',
            'owner_premium_price', 'owner_premium_included_credits'
          ];
          const missingFields = checkFields.filter(field => pricingData[field] === undefined);
          if (missingFields.length > 0) {
            console.warn('âš ï¸ ë‹¤ìŒ í•„ë“œë“¤ì´ pricingDataì— ì—†ìŠµë‹ˆë‹¤:', missingFields);
          }
        } else {
          console.error('âŒ í”Œëœ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', pricingResult.error);
        }
      } catch (error) {
        console.error('âŒ í”Œëœ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í”Œëœ ì •ë³´ ë¡œë“œ
    async function loadCurrentUserPlan() {
      try {
        // Supabase ì´ˆê¸°í™” ëŒ€ê¸°
        while (!window.authState?.supabase) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        const supabase = window.authState.supabase;
        const { data: { session } } = await supabase.auth.getSession();
        
        if (!session) {
          return; // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš°
        }

        const response = await fetch('/api/subscription/user-dashboard?action=dashboard', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${session.access_token}`
          }
        });

        if (response.ok) {
          const result = await response.json();
          if (result.success && result.data?.profile?.membership_level) {
            // membership_levelì„ í”Œëœ í‚¤ë¡œ ë³€í™˜
            const level = result.data.profile.membership_level.toLowerCase();
            // 'free'ëŠ” 'seed'ë¡œ ë³€í™˜
            currentUserPlan = level === 'free' ? 'seed' : level;
            console.log('í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í”Œëœ:', currentUserPlan);
          }
        }
      } catch (error) {
        console.error('í˜„ì¬ í”Œëœ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // í”Œëœ ì„ íƒ í™”ë©´ í‘œì‹œ
    function showPlanSelectionScreen() {
      document.getElementById('planSelectionContainer').style.display = 'block';
      document.getElementById('paymentContainer').style.display = 'none';
      
      renderPlanSelection();
    }

    // ê²°ì œ í™”ë©´ í‘œì‹œ
    function showPaymentScreen(selectedPlan) {
      document.getElementById('planSelectionContainer').style.display = 'none';
      document.getElementById('paymentContainer').style.display = 'block';
      
      // í”Œëœ ì •ë³´ í‘œì‹œ
      const planInfo = getPlanInfo(selectedPlan);
      if (planInfo) {
        document.getElementById('planName').textContent = planInfo.name;
        document.getElementById('priceAmount').textContent = planInfo.price === 0 ? 'ë¬´ë£Œ' : planInfo.price.toLocaleString() + 'ì›';
        document.getElementById('priceAmountDisplay').textContent = planInfo.price === 0 ? 'ë¬´ë£Œ' : planInfo.price.toLocaleString();
        document.getElementById('creditAmount').textContent = planInfo.credits.toLocaleString() + ' í¬ë ˆë”§';
        
        // ì´ˆê³¼ ë‹¨ê°€ í‘œì‹œ (subscription-settings.htmlì—ì„œ ì„¤ì •í•œ ê°’)
        const excessRateElement = document.getElementById('excessRateDisplay');
        if (excessRateElement) {
          excessRateElement.textContent = planInfo.excessRate + 'ì›/í¬ë ˆë”§';
        }
      }
    }

    // í”Œëœ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (subscription-settings.htmlì—ì„œ ì„¤ì •í•œ ê°’ ì‚¬ìš©)
    function getPlanInfo(planKey) {
      // í”Œëœ ì´ë¦„ ë§¤í•‘
      const planNames = {
        seed: 'ë¼ì´íŠ¸ í”Œëœ',
        power: 'ìŠ¤íƒ ë‹¤ë“œ í”Œëœ',
        bigpower: 'í”„ë¡œ í”Œëœ',
        premium: 'í”„ë¦¬ë¯¸ì—„ í”Œëœ'
      };

      // subscription-settings.htmlì—ì„œ ì„¤ì •í•œ í•„ë“œëª…
      const priceKey = `owner_${planKey}_price`;
      const minimumFeeKey = `owner_${planKey}_minimum_fee`;
      const includedCreditsKey = `owner_${planKey}_included_credits`;
      const excessRateKey = `owner_${planKey}_excess_rate`;
      
      // pricingDataê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
      if (!pricingData) {
        console.warn('âš ï¸ pricingDataê°€ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.');
        const defaults = {
          seed: { name: 'ë¼ì´íŠ¸ í”Œëœ', price: 0, credits: 0, excessRate: 1.2 },
          power: { name: 'ìŠ¤íƒ ë‹¤ë“œ í”Œëœ', price: 30000, credits: 37500, excessRate: 0.8 },
          bigpower: { name: 'í”„ë¡œ í”Œëœ', price: 50000, credits: 83333, excessRate: 0.6 },
          premium: { name: 'í”„ë¦¬ë¯¸ì—„ í”Œëœ', price: 100000, credits: 200000, excessRate: 0.5 }
        };
        return defaults[planKey] || null;
      }

      // ë””ë²„ê¹…: ì‹¤ì œ ë°ì´í„° í™•ì¸
      console.log(`ğŸ“Š [${planKey}] í”Œëœ ì •ë³´ ë¡œë“œ:`, {
        priceKey,
        priceValue: pricingData[priceKey],
        minimumFeeKey,
        minimumFeeValue: pricingData[minimumFeeKey],
        includedCreditsKey,
        includedCreditsValue: pricingData[includedCreditsKey],
        excessRateKey,
        excessRateValue: pricingData[excessRateKey]
      });
      
      // ê°€ê²©: minimum_feeê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ price ì‚¬ìš©
      const price = pricingData[priceKey] !== undefined ? pricingData[priceKey] : 0;
      const minimumFee = pricingData[minimumFeeKey] !== undefined && pricingData[minimumFeeKey] !== null ? pricingData[minimumFeeKey] : price;
      
      // í¬í•¨ í¬ë ˆë”§: subscription-settings.htmlì—ì„œ ì„¤ì •í•œ ê°’ ì‚¬ìš©
      const includedCredits = pricingData[includedCreditsKey] !== undefined && pricingData[includedCreditsKey] !== null ? pricingData[includedCreditsKey] : 0;
      
      // ì´ˆê³¼ ë‹¨ê°€: subscription-settings.htmlì—ì„œ ì„¤ì •í•œ ê°’ ì‚¬ìš© (ê¸°ë³¸ê°’ 1.2)
      const excessRate = pricingData[excessRateKey] !== undefined && pricingData[excessRateKey] !== null ? pricingData[excessRateKey] : 1.2;

      const planInfo = {
        name: planNames[planKey] || planKey,
        price: minimumFee, // ìµœì†Œ ì´ìš©ë£Œ
        credits: includedCredits, // í¬í•¨ í¬ë ˆë”§
        excessRate: excessRate // ì´ˆê³¼ ë‹¨ê°€ (ì›/í¬ë ˆë”§)
      };
      
      console.log(`âœ… [${planKey}] ìµœì¢… í”Œëœ ì •ë³´:`, planInfo);
      
      return planInfo;
    }

    // í”Œëœ ì„ íƒ ì¹´ë“œ ë Œë”ë§
    function renderPlanSelection() {
      const container = document.getElementById('planSelectionGrid');
      if (!container) return;

      // ë¡œë”© ìŠ¤í”¼ë„ˆ ìˆ¨ê¸°ê¸°
      const loadingSpinner = document.getElementById('planLoadingSpinner');
      if (loadingSpinner) {
        loadingSpinner.style.display = 'none';
      }

      const ownerPlans = [
        { key: 'seed', name: 'ë¼ì´íŠ¸', icon: 'ğŸŒ±', color: '#ff7b54', gradient: 'linear-gradient(135deg, #ff7b54 0%, #ff9d7a 100%)' },
        { key: 'power', name: 'ìŠ¤íƒ ë‹¤ë“œ', icon: 'âš¡', color: '#ff7b54', gradient: 'linear-gradient(135deg, #ff7b54 0%, #ff8a65 100%)' },
        { key: 'bigpower', name: 'í”„ë¡œ', icon: 'ğŸ’ª', color: '#e56548', gradient: 'linear-gradient(135deg, #e56548 0%, #ff7b54 100%)' },
        { key: 'premium', name: 'í”„ë¦¬ë¯¸ì—„', icon: 'â­', color: '#e56548', gradient: 'linear-gradient(135deg, #d4543a 0%, #e56548 100%)' }
      ];

      container.innerHTML = ownerPlans.map(plan => {
        const planInfo = getPlanInfo(plan.key);
        const priceText = planInfo.price === 0 ? 'ë¬´ë£Œ' : `${planInfo.price.toLocaleString()}ì›`;
        const isCurrentPlan = currentUserPlan === plan.key;
        
        return `
          <div class="plan-card" onclick="selectPlan('${plan.key}')" 
               style="background: linear-gradient(135deg, rgba(255, 123, 84, 0.1), rgba(255, 123, 84, 0.05)); 
                      border: 1px solid var(--border);
                      border-radius: 16px; 
                      padding: 28px 24px; 
                      cursor: pointer; 
                      transition: all 0.3s;
                      text-align: center;
                      flex: 1;
                      min-width: 220px;
                      max-width: 260px;
                      position: relative;
                      box-shadow: var(--shadow-md);">
            ${isCurrentPlan ? `
            <div style="position: absolute; top: 10px; right: 10px; background: var(--accent-color); 
                        color: white; padding: 5px 10px; border-radius: 16px; font-size: 11px; 
                        font-weight: 700; box-shadow: var(--shadow-sm); z-index: 10;">
              í˜„ì¬ ì‚¬ìš©ì¤‘
            </div>
            ` : ''}
            <div style="font-size: 48px; margin-bottom: 12px;">${plan.icon}</div>
            <h3 style="font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">${plan.name}</h3>
            <div style="font-size: 28px; font-weight: 700; color: var(--accent-color); margin-bottom: 12px;">
              ${priceText}
            </div>
            <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">
              ${planInfo.credits.toLocaleString()} í¬ë ˆë”§
            </div>
            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 20px; padding: 8px; background: rgba(255, 123, 84, 0.05); border-radius: 8px;">
              ì´ˆê³¼: ${planInfo.excessRate}ì›/í¬ë ˆë”§
            </div>
            <button style="width: 100%; padding: 12px; background: ${isCurrentPlan ? 'var(--secondary)' : plan.gradient}; color: ${isCurrentPlan ? 'var(--accent-color)' : 'white'};
                          border: ${isCurrentPlan ? '1px solid var(--accent-color)' : 'none'}; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: ${isCurrentPlan ? 'default' : 'pointer'};
                          transition: all 0.3s; box-shadow: ${isCurrentPlan ? 'none' : 'var(--shadow-sm)'};"
                    ${!isCurrentPlan ? `onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-md)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-sm)'"` : ''}>
              ${isCurrentPlan ? 'í˜„ì¬ í”Œëœ' : 'ì„ íƒí•˜ê¸°'}
            </button>
          </div>
        `;
      }).join('');
    }

    // í”Œëœ ì„ íƒ
    function selectPlan(planKey) {
      // ë°ëª¨ ëª¨ë“œ í™•ì¸ (í•¨ìˆ˜ ì‹¤í–‰ ì‹œì ì—ë„ ì²´í¬)
      const currentDemoMode = isDemoMode || (window.isDemoMode && window.isDemoMode());
      // ë°ëª¨ ëª¨ë“œì—ì„œëŠ” URLì— demo íŒŒë¼ë¯¸í„° ìœ ì§€
      const demoParam = currentDemoMode ? '&demo=true' : '';
      
      // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í”Œëœì´ë©´ ì„ íƒ ë¶ˆê°€ (ë°ëª¨ ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ)
      if (!currentDemoMode && currentUserPlan === planKey) {
        alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ í”Œëœì…ë‹ˆë‹¤.');
        return;
      }
      window.location.href = `/payment.html?plan=${planKey}${demoParam}`;
    }

    // ì´ì „ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
    function goBack() {
      // ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™
      window.location.href = '/mypage.html';
    }

    // ì´ˆê³¼ ì‚¬ìš©ë¶„ ì„¤ëª… ëª¨ë‹¬ í‘œì‹œ
    function showExcessInfo(event, planKey) {
      event.stopPropagation(); // í”Œëœ ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€
      document.getElementById('excessInfoModal').style.display = 'flex';
    }

    // ì´ˆê³¼ ì‚¬ìš©ë¶„ ì„¤ëª… ëª¨ë‹¬ ë‹«ê¸°
    function closeExcessInfoModal() {
      document.getElementById('excessInfoModal').style.display = 'none';
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener('DOMContentLoaded', function() {
      const excessInfoModal = document.getElementById('excessInfoModal');
      if (excessInfoModal) {
        excessInfoModal.addEventListener('click', function(e) {
          if (e.target === excessInfoModal) {
            closeExcessInfoModal();
          }
        });
      }
    });
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë“±ë¡ëœ ì¹´ë“œ ëª©ë¡ ë¡œë“œ
    let registeredCards = [];
    let currentUserId = null;

    window.addEventListener('load', async function() {
      await loadRegisteredCards();
    });

    // ë“±ë¡ëœ ì¹´ë“œ ëª©ë¡ ë¡œë“œ
    async function loadRegisteredCards() {
      try {
        // Supabase ì´ˆê¸°í™” ëŒ€ê¸°
        while (!window.authState?.supabase) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        const supabase = window.authState.supabase;
        const { data: { session } } = await supabase.auth.getSession();
        
        if (!session) {
          return;
        }

        currentUserId = session.user.id;

        const response = await fetch('/api/payment/cards', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${session.access_token}`
          }
        });

        if (response.ok) {
          const result = await response.json();
          if (result.success) {
            registeredCards = result.cards || [];
            renderRegisteredCards();
          }
        }
      } catch (error) {
        console.error('ì¹´ë“œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // ë“±ë¡ëœ ì¹´ë“œ ë Œë”ë§
    function renderRegisteredCards() {
      const container = document.getElementById('registeredCards');
      if (!container) return;

      if (registeredCards.length === 0) {
        container.innerHTML = '';
        return;
      }

      container.innerHTML = registeredCards.map((card, index) => `
        <label class="payment-method ${card.is_default ? 'selected' : ''}" style="position: relative;">
          <input type="radio" name="method" value="saved_card_${card.id}" ${card.is_default ? 'checked' : ''}>
          <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
            <div>
              <span>ğŸ’³ ${card.card_alias || 'ë“±ë¡ëœ ì¹´ë“œ'}</span>
              <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                ${card.card_number || '****-****-****-****'} ${card.card_company ? 'Â· ' + card.card_company : ''}
                ${card.is_default ? '<span style="background: var(--accent-color); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 8px;">ê¸°ë³¸</span>' : ''}
              </div>
            </div>
            <button onclick="deleteCard('${card.id}', event)" 
                    style="background: none; border: none; color: #ef4444; cursor: pointer; padding: 4px 8px; font-size: 12px;">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </label>
      `).join('');

      // ê²°ì œ ë°©ë²• ì„ íƒ ì´ë²¤íŠ¸ ë‹¤ì‹œ ë°”ì¸ë”©
      document.querySelectorAll('.payment-method').forEach(method => {
        method.addEventListener('click', function() {
          document.querySelectorAll('.payment-method').forEach(m => {
            m.classList.remove('selected');
          });
          this.classList.add('selected');
          const input = this.querySelector('input');
          if (input) input.checked = true;
        });
      });
    }

    // ì¹´ë“œ ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
    function openCardRegisterModal() {
      document.getElementById('cardRegisterModal').style.display = 'flex';
    }

    // ì¹´ë“œ ë“±ë¡ ëª¨ë‹¬ ë‹«ê¸°
    function closeCardRegisterModal() {
      document.getElementById('cardRegisterModal').style.display = 'none';
      document.getElementById('cardRegisterForm').reset();
    }

    // ì¹´ë“œ ë“±ë¡
    async function registerCard(event) {
      event.preventDefault();

      try {
        // Supabase ì´ˆê¸°í™” ëŒ€ê¸°
        while (!window.authState?.supabase) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        const supabase = window.authState.supabase;
        const { data: { session } } = await supabase.auth.getSession();
        
        if (!session) {
          alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
          return;
        }

        const cardData = {
          card_alias: document.getElementById('cardAlias').value.trim(),
          card_number: document.getElementById('cardNumber').value.replace(/-/g, ''),
          card_expiry: document.getElementById('cardExpiry').value,
          card_cvc: document.getElementById('cardCvc').value,
          card_password: document.getElementById('cardPassword').value,
          is_default: document.getElementById('setAsDefault').checked
        };

        // ì¹´ë“œë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ (ê°„ë‹¨í•œ ì²´í¬)
        if (cardData.card_number.length < 13 || cardData.card_number.length > 19) {
          alert('ì˜¬ë°”ë¥¸ ì¹´ë“œë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        const response = await fetch('/api/payment/cards', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${session.access_token}`
          },
          body: JSON.stringify(cardData)
        });

        const result = await response.json();

        if (result.success) {
          alert('ì¹´ë“œê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
          closeCardRegisterModal();
          await loadRegisteredCards();
        } else {
          throw new Error(result.error || 'ì¹´ë“œ ë“±ë¡ ì‹¤íŒ¨');
        }
      } catch (error) {
        console.error('ì¹´ë“œ ë“±ë¡ ì˜¤ë¥˜:', error);
        alert('ì¹´ë“œ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }

    // ì£¼ë¬¸ì ì •ë³´ ìë™ ì…ë ¥
    async function fillOrdererInfo() {
      try {
        // Supabase ì´ˆê¸°í™” ëŒ€ê¸°
        while (!window.authState?.supabase) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        const supabase = window.authState.supabase;
        const { data: { session } } = await supabase.auth.getSession();
        
        if (!session) {
          return;
        }
        
        const user = session.user;
        const userEmail = user.email || '';
        const userName = user.user_metadata?.name || '';
        
        // í”„ë¡œí•„ ì •ë³´ ì¡°íšŒ
        const { data: profile } = await supabase
          .from('profiles')
          .select('phone_number, store_phone_number')
          .eq('id', user.id)
          .single();
        
        // ì£¼ë¬¸ì ì •ë³´ ì…ë ¥ í•„ë“œì— ìë™ ì…ë ¥
        if (document.getElementById('ordererName') && userName) {
          document.getElementById('ordererName').value = userName;
        }
        if (document.getElementById('ordererEmail') && userEmail) {
          document.getElementById('ordererEmail').value = userEmail;
        }
        if (document.getElementById('ordererPhone')) {
          const phone = profile?.phone_number || profile?.store_phone_number || '';
          if (phone) {
            document.getElementById('ordererPhone').value = phone;
          }
        }
      } catch (error) {
        console.error('ì£¼ë¬¸ì ì •ë³´ ìë™ ì…ë ¥ ì‹¤íŒ¨:', error);
      }
    }
    
    // ì¹´ë“œ ì‚­ì œ
    async function deleteCard(cardId, event) {
      event.stopPropagation();
      
      if (!confirm('ë“±ë¡ëœ ì¹´ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }

      try {
        // Supabase ì´ˆê¸°í™” ëŒ€ê¸°
        while (!window.authState?.supabase) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        const supabase = window.authState.supabase;
        const { data: { session } } = await supabase.auth.getSession();
        
        if (!session) {
          alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
          return;
        }

        const response = await fetch(`/api/payment/cards/${cardId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${session.access_token}`
          }
        });

        const result = await response.json();

        if (result.success) {
          alert('ì¹´ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          await loadRegisteredCards();
        } else {
          throw new Error(result.error || 'ì¹´ë“œ ì‚­ì œ ì‹¤íŒ¨');
        }
      } catch (error) {
        console.error('ì¹´ë“œ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ì¹´ë“œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }

      // ì¹´ë“œë²ˆí˜¸ ìë™ í¬ë§·íŒ…
    document.addEventListener('DOMContentLoaded', function() {
      // ì¹´ë“œ ë“±ë¡ ëª¨ë‹¬ìš©
      const cardNumberInput = document.getElementById('cardNumber');
      if (cardNumberInput) {
        cardNumberInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          let formatted = value.match(/.{1,4}/g)?.join('-') || value;
          if (formatted.length > 19) formatted = formatted.substring(0, 19);
          e.target.value = formatted;
        });
      }

      const cardExpiryInput = document.getElementById('cardExpiry');
      if (cardExpiryInput) {
        cardExpiryInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          if (value.length >= 2) {
            value = value.substring(0, 2) + '/' + value.substring(2, 4);
          }
          e.target.value = value;
        });
      }

      const cardCvcInput = document.getElementById('cardCvc');
      if (cardCvcInput) {
        cardCvcInput.addEventListener('input', function(e) {
          e.target.value = e.target.value.replace(/\D/g, '');
        });
      }

      const cardPasswordInput = document.getElementById('cardPassword');
      if (cardPasswordInput) {
        cardPasswordInput.addEventListener('input', function(e) {
          e.target.value = e.target.value.replace(/\D/g, '');
        });
      }
      
      // ì¹´ë“œ ê²°ì œì°½ ëª¨ë‹¬ìš© (ì¹´ì¹´ì˜¤í˜ì´ í…ŒìŠ¤íŠ¸ìš©)
      const paymentCardNumberInput = document.getElementById('paymentCardNumber');
      if (paymentCardNumberInput) {
        paymentCardNumberInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          let formatted = value.match(/.{1,4}/g)?.join('-') || value;
          if (formatted.length > 19) formatted = formatted.substring(0, 19);
          e.target.value = formatted;
        });
      }

      const paymentCardExpiryInput = document.getElementById('paymentCardExpiry');
      if (paymentCardExpiryInput) {
        paymentCardExpiryInput.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          if (value.length >= 2) {
            value = value.substring(0, 2) + '/' + value.substring(2, 4);
          }
          e.target.value = value;
        });
      }

      const paymentCardCvcInput = document.getElementById('paymentCardCvc');
      if (paymentCardCvcInput) {
        paymentCardCvcInput.addEventListener('input', function(e) {
          e.target.value = e.target.value.replace(/\D/g, '');
        });
      }

      const paymentCardPasswordInput = document.getElementById('paymentCardPassword');
      if (paymentCardPasswordInput) {
        paymentCardPasswordInput.addEventListener('input', function(e) {
          e.target.value = e.target.value.replace(/\D/g, '');
        });
      }
    });

    // ê²°ì œ ë°©ë²• ì„ íƒ
    document.querySelectorAll('.payment-method').forEach(method => {
      method.addEventListener('click', function() {
        document.querySelectorAll('.payment-method').forEach(m => {
          m.classList.remove('selected');
        });
        this.classList.add('selected');
        const input = this.querySelector('input');
        if (input) input.checked = true;
        
        // ì¹´ë“œ ê²°ì œ ì„ íƒ ì‹œ ì¹´ë“œ ê²°ì œì°½ ëª¨ë‹¬ í‘œì‹œ (ì¹´ì¹´ì˜¤í˜ì´ í…ŒìŠ¤íŠ¸ìš©)
        if (input && input.value === 'card') {
          openCardPaymentModal();
        }
      });
    });
    
    // ì¹´ë“œ ê²°ì œì°½ ëª¨ë‹¬ ì—´ê¸°
    function openCardPaymentModal() {
      const planInfo = getPlanInfo(plan);
      if (planInfo) {
        document.getElementById('cardPaymentAmount').textContent = planInfo.price === 0 ? 'ë¬´ë£Œ' : planInfo.price.toLocaleString() + 'ì›';
        document.getElementById('cardPaymentPlan').textContent = planInfo.name;
      }
      document.getElementById('cardPaymentModal').style.display = 'flex';
    }
    
    // ì¹´ë“œ ê²°ì œì°½ ëª¨ë‹¬ ë‹«ê¸°
    function closeCardPaymentModal() {
      document.getElementById('cardPaymentModal').style.display = 'none';
      document.getElementById('cardPaymentForm').reset();
    }
    
    // ì¹´ë“œ ê²°ì œ ì œì¶œ (ì¹´ì¹´ì˜¤í˜ì´ í…ŒìŠ¤íŠ¸ìš©)
    async function submitCardPayment(event) {
      event.preventDefault();
      
      // ë°ëª¨ ëª¨ë“œ í™•ì¸
      const currentDemoMode = isDemoMode || (window.isDemoMode && window.isDemoMode());
      
      // ë°ëª¨ ëª¨ë“œì—ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜ë§Œ
      if (currentDemoMode) {
        alert('ë°ëª¨ ëª¨ë“œ: ì¹´ë“œ ê²°ì œê°€ ì‹œë®¬ë ˆì´ì…˜ë˜ì—ˆìŠµë‹ˆë‹¤.\nì‹¤ì œ ê²°ì œëŠ” ì§„í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        closeCardPaymentModal();
        return;
      }
      
      // ì‹¤ì œ ê²°ì œ ì²˜ë¦¬
      await processPayment();
      closeCardPaymentModal();
    }
    
    // ê²°ì œ ì²˜ë¦¬
    async function processPayment() {
      if (!plan) {
        alert('í”Œëœì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      const methodInput = document.querySelector('input[name="method"]:checked');
      if (!methodInput) {
        alert('ê²°ì œ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const method = methodInput.value;
      const selectedCardId = method.startsWith('saved_card_') ? method.replace('saved_card_', '') : null;
      
      // ì¹´ë“œ ê²°ì œì¸ ê²½ìš° ì¹´ë“œ ê²°ì œì°½ ëª¨ë‹¬ì´ ì´ë¯¸ ì—´ë ¤ìˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
      if (method === 'card' && !selectedCardId) {
        // ì¹´ë“œ ê²°ì œì°½ ëª¨ë‹¬ì—ì„œ ì²˜ë¦¬ë¨
        return;
      }
      
      // ë¡œë”© í‘œì‹œ
      document.getElementById('loading').style.display = 'block';
      document.querySelector('.btn-payment').disabled = true;
      
      try {
        // Supabase ì´ˆê¸°í™” ëŒ€ê¸° (auth-state.jsì—ì„œ ì•ˆì „í•˜ê²Œ ì´ˆê¸°í™”)
        while (!window.authState?.supabase) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        const supabase = window.authState.supabase;
        
        // ì‚¬ìš©ì ì„¸ì…˜ í™•ì¸
        const { data: { session } } = await supabase.auth.getSession();
        
        if (!session) {
          window.location.href = '/login.html?redirect=/payment.html?plan=' + plan;
          return;
        }
        
        const user = session.user;
        
        // ê²°ì œ ìš”ì²­ ìƒì„±
        // ì¤‘ìš”: ì„œë²„ì—ì„œ í”Œëœ ì •ë³´ì™€ ê°€ê²©ì„ ë‹¤ì‹œ ê²€ì¦í•¨
        // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ë‚¸ ì •ë³´ëŠ” ì‹ ë¢°í•˜ì§€ ì•ŠìŒ
        const response = await fetch('/api/payment/payment-handler', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${session.access_token}`
          },
          body: JSON.stringify({
            action: 'create-payment',
            userId: user.id,
            planType: plan,  // ì„œë²„ì—ì„œ ê²€ì¦ë¨
            paymentMethod: selectedCardId ? 'saved_card' : method,
            cardId: selectedCardId || null
          })
        });
        
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.error || 'ê²°ì œ ìš”ì²­ ì‹¤íŒ¨');
        }
        
        // ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™ (ë˜ëŠ” í…ŒìŠ¤íŠ¸ ëª¨ë“œ)
        if (result.paymentUrl.includes('test-success')) {
          // í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ìë™ ì™„ë£Œ
          alert('í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ê²°ì œê°€ ìë™ìœ¼ë¡œ ì™„ë£Œë©ë‹ˆë‹¤');
          window.location.href = `/payment-success.html?orderId=${result.orderId}`;
        } else {
          // ì‹¤ì œ PGì‚¬ ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™
          window.location.href = result.paymentUrl;
        }
        
      } catch (error) {
        console.error('ê²°ì œ ì˜¤ë¥˜:', error);
        alert('ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        
        // ë¡œë”© ìˆ¨ê¸°ê¸°
        document.getElementById('loading').style.display = 'none';
        document.querySelector('.btn-payment').disabled = false;
      }
    }
  </script>

  <!-- í‘¸í„° -->
  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-item">
        <span class="footer-label">ìƒí˜¸ëª…</span>
        <span class="footer-value">ì‚¬ì¥í”½</span>
      </div>
      <div class="footer-item">
        <span class="footer-label">ëŒ€í‘œìëª…</span>
        <span class="footer-value">ì˜¤ëŒ€ì¤€</span>
      </div>
      <div class="footer-item">
        <span class="footer-label">ì‚¬ì—…ì¥ ì£¼ì†Œì§€</span>
        <span class="footer-value">ë¶€ì‚°ê´‘ì—­ì‹œ ë¶êµ¬ ë°±ì–‘ëŒ€ë¡œ 1003 5ë™307í˜¸</span>
      </div>
      <div class="footer-item">
        <span class="footer-label">ì‚¬ì—…ì ë²ˆí˜¸</span>
        <span class="footer-value">441-31-01878</span>
      </div>
      <div class="footer-item">
        <span class="footer-label">ì´ë©”ì¼ ì£¼ì†Œ</span>
        <span class="footer-value">
          <a href="mailto:ohdaejun@naver.com">ohdaejun@naver.com</a>
        </span>
      </div>
      <div class="footer-item">
        <span class="footer-label">ì „í™”ë²ˆí˜¸</span>
        <span class="footer-value">
          <a href="tel:010-6664-3744">010-6664-3744</a>
        </span>
      </div>
    </div>
  </footer>
</body>
</html>
