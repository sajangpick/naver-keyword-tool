# 🚀 배포 전 체크리스트

## ✅ 완료된 작업

1. **AI 레시피 생성 2단계 시스템 구현**
   - ✅ Backend API (`suggest-dishes`, `generate-recipe`)
   - ✅ Frontend UI (STEP 1/2 분리)
   - ✅ JavaScript 함수 5개 추가
   - ✅ 데이터 구조 수정 (`data` 객체)

2. **공공 데이터 API 통합 (3개 API)**
   - ✅ 레시피 기본정보 (Grid_20150827000000000226_1)
   - ✅ 재료정보 (Grid_20150827000000000227_1)
   - ✅ 과정정보 (Grid_20150827000000000228_1)

3. **사용자 경험 개선**
   - ✅ 로그인 없이도 사용 가능 (`userId || null`)
   - ✅ 에러 처리 강화
   - ✅ 린트 에러 없음

---

## ⚠️ 배포 전 필수 확인 사항

### 1. 환경변수 설정 (Render)

**Render 대시보드**에서 다음 환경변수들이 설정되어 있는지 확인하세요:

```env
# OpenAI API (AI 레시피 생성용)
OPENAI_API_KEY=sk-proj-...

# 공공 데이터 API (레시피 검색용)
RECIPE_API_KEY=4385f42b...80a2
RECIPE_API_URL=http://211.237.50.150:7080/openapi/4385f42b...80a2/json/Grid_20150827000000000226_1
RECIPE_INGREDIENT_API_URL=http://211.237.50.150:7080/openapi/4385f42b...80a2/json/Grid_20150827000000000227_1
RECIPE_PROCESS_API_URL=http://211.237.50.150:7080/openapi/4385f42b...80a2/json/Grid_20150827000000000228_1

# Supabase (데이터베이스)
NEXT_PUBLIC_SUPABASE_URL=...
SUPABASE_SERVICE_ROLE_KEY=...

# JWT Secret
JWT_SECRET=...

# 기타 필요한 환경변수들
NAVER_CUSTOMER_ID=...
NAVER_API_KEY=...
NAVER_SECRET_KEY=...
```

### 2. 로컬 테스트 (필수!)

배포 전에 **반드시** 로컬에서 다음 기능들을 테스트하세요:

#### 📝 테스트 체크리스트

- [ ] **레시피 검색**
  - [ ] 키워드로 검색 (예: "김치")
  - [ ] 카테고리로 검색 (예: "한식")
  - [ ] 공공 API 데이터가 나타나는지 확인
  - [ ] 레시피 상세보기 클릭 시 정상 작동

- [ ] **AI 레시피 생성 (1단계)**
  - [ ] 재료 입력 (예: "감자, 양파")
  - [ ] "만들 수 있는 요리 제안받기" 클릭
  - [ ] 5가지 요리 제안이 나타나는지 확인
  - [ ] 요리 카드 호버 효과 확인

- [ ] **AI 레시피 생성 (2단계)**
  - [ ] 요리 선택 (예: "감자스프")
  - [ ] STEP 2로 자동 스크롤 확인
  - [ ] 스타일/시간 설정 (선택)
  - [ ] "상세 레시피 생성하기" 클릭
  - [ ] 완전한 레시피가 생성되는지 확인
  - [ ] "다른 요리 선택하기" 버튼 작동 확인

- [ ] **에러 처리**
  - [ ] 로그인 없이도 작동하는지 확인
  - [ ] OpenAI API 호출 실패 시 에러 메시지 확인
  - [ ] 공공 API 호출 실패 시 샘플 데이터 표시 확인

### 3. 서버 로그 확인

로컬 테스트 시 터미널에서 다음을 확인하세요:

```bash
# 정상 로그 예시
[요리 제안] 시작: { userId: 'anonymous', ingredients: '감자, 양파' }
[요리 제안] 완료: [ { name: '감자샐러드', description: '...' }, ... ]
[레시피 생성] 시작: { userId: 'anonymous', dishName: '감자스프', ... }
```

**에러가 없어야 합니다!**

### 4. 브라우저 콘솔 확인

- [ ] F12 → Console 탭
- [ ] 빨간색 에러 메시지가 없는지 확인
- [ ] Network 탭에서 API 호출 상태 확인
  - `/api/chatgpt` → 200 OK
  - `/api/recipes/search` → 200 OK

---

## 🚨 알려진 제한사항

### 1. OpenAI API 비용
- AI 레시피 생성은 OpenAI API를 사용합니다
- 토큰 사용량에 따라 비용이 발생합니다
- **토큰 한도 초과 시 서비스 중단 가능**

**해결책**: 
- 토큰 사용량 모니터링 설정
- 사용자당 일일 한도 설정
- 또는 userId가 null일 때 제한 추가

### 2. 공공 API 안정성
- 공공 데이터 API는 외부 서비스입니다
- 간헐적으로 응답이 느리거나 실패할 수 있습니다

**해결책**: 
- ✅ 이미 구현됨: API 실패 시 샘플 데이터 제공
- ✅ 타임아웃 설정 (5초)

### 3. CORS 이슈
- 로컬: `http://127.0.0.1:3003`
- 배포: Vercel (프론트엔드) + Render (백엔드)

**해결책**:
- ✅ 이미 구현됨: `API_BASE_URL` 동적 설정
- ✅ `vercel.json`에서 API 프록시 설정

---

## 🎯 배포 순서

### 1단계: 최종 로컬 테스트
```bash
# 서버 시작
node server.js

# 브라우저 테스트
http://localhost:3003/recipe-manager.html
```

**모든 기능이 정상 작동하는지 확인!**

### 2단계: Git 커밋 & 푸시
```bash
git add .
git commit -m "feat: AI 레시피 생성 2단계 시스템 구현 + 공공API 통합"
git push origin main
```

### 3단계: Render 배포
- Render 대시보드에서 자동 배포 확인
- 환경변수가 모두 설정되어 있는지 재확인
- 로그에서 에러 없는지 확인

### 4단계: Vercel 배포
- Vercel 대시보드에서 자동 배포 확인
- `vercel.json` 설정 확인
- 프로덕션 URL 테스트

### 5단계: 프로덕션 테스트
```
https://your-app.vercel.app/recipe-manager.html
```

**위의 테스트 체크리스트를 다시 실행!**

---

## 🔧 배포 후 문제 발생 시

### 문제 1: "검색 중 오류가 발생했습니다"
**원인**: API 키가 Render에 설정되지 않음  
**해결**: Render 대시보드 → Environment Variables 확인

### 문제 2: AI 레시피 생성 실패
**원인**: OPENAI_API_KEY 없음 또는 토큰 한도 초과  
**해결**: 
1. Render 환경변수 확인
2. OpenAI 대시보드에서 사용량 확인

### 문제 3: CORS 에러
**원인**: `vercel.json` 설정 문제  
**해결**: 
```json
{
  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "https://naver-keyword-tool.onrender.com/api/:path*"
    }
  ]
}
```

### 문제 4: 레시피 상세보기 안 됨
**원인**: 공공 API 응답 지연 또는 실패  
**해결**: 
- 이미 타임아웃 처리되어 있음
- 샘플 데이터로 폴백됨
- 로그 확인 필요

---

## 📊 모니터링 (배포 후)

### 1. 서버 로그 모니터링
```bash
# Render 대시보드 → Logs
# 다음 로그 확인:
[요리 제안] 시작
[요리 제안] 완료
[레시피 생성] 시작
```

### 2. API 응답 시간
- OpenAI API: 10-30초 정상
- 공공 API: 1-5초 정상

### 3. 에러율
- 에러율 10% 미만: 정상
- 에러율 50% 이상: 긴급 대응 필요

---

## ✅ 최종 체크

배포 전에 다음을 확인하세요:

- [ ] 로컬에서 모든 기능 테스트 완료
- [ ] 환경변수 목록 확인 (Render)
- [ ] Git 커밋 & 푸시 완료
- [ ] 린트 에러 없음
- [ ] 문서 업데이트 완료 (`07_레시피관리_AI생성시스템.md`)
- [ ] 배포 후 프로덕션 URL 테스트 예정

---

## 🎉 준비 완료!

위의 체크리스트를 모두 확인하셨다면 배포하셔도 됩니다!

**문제 발생 시 이 문서를 참고하세요!** 😊

