<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>íšŒì› ë§ì¶¤ ì„¤ì • - ì‚¬ì¥í”½ ê´€ë¦¬ì</title>
    
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      rel="stylesheet"
    />
    
    <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="/admin/assets/admin-common.css" />
    
    <style>
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px;
      }

      .subtitle {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 24px;
      }

      .card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        margin-bottom: 24px;
      }

      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px;
        border-bottom: 1px solid #f3f4f6;
        background: #fafafa;
      }

      .card-header .title {
        font-size: 18px;
        font-weight: 700;
        color: #111827;
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .card-body {
        padding: 24px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group:last-child {
        margin-bottom: 0;
      }

      label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
      }

      input[type="text"],
      input[type="email"],
      input[type="number"],
      select,
      textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(52, 144, 220, 0.1);
      }

      .input-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }

      .input-group {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .input-group input {
        flex: 1;
      }

      .input-unit {
        color: #6b7280;
        font-weight: 600;
        min-width: 50px;
      }

      .btn {
        padding: 10px 16px;
        border: 1px solid var(--border);
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s;
        color: #374151;
      }

      .btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      .btn.primary {
        background: var(--accent);
        border-color: var(--accent);
        color: white;
        width: 100%;
      }

      .btn.primary:hover {
        opacity: 0.9;
      }

      .btn-group {
        display: flex;
        gap: 8px;
        margin-top: 24px;
      }

      .btn-group .btn {
        flex: 1;
      }

      .member-info {
        background: #f0f9ff;
        border: 1px solid #bfdbfe;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 20px;
      }

      .member-info h3 {
        margin: 0 0 8px 0;
        font-size: 14px;
        font-weight: 600;
        color: #1e40af;
      }

      .member-info p {
        margin: 4px 0;
        font-size: 13px;
        color: #1e40af;
      }

      .info-text {
        font-size: 12px;
        color: #6b7280;
        margin-top: 8px;
      }

      .section-divider {
        height: 1px;
        background: var(--border);
        margin: 24px 0;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #6b7280;
      }

      .error {
        padding: 16px;
        background: #fee2e2;
        border: 1px solid #fca5a5;
        border-radius: 8px;
        color: #dc2626;
        margin-bottom: 16px;
      }

      .success {
        padding: 16px;
        background: #dcfce7;
        border: 1px solid #86efac;
        border-radius: 8px;
        color: #16a34a;
        margin-bottom: 16px;
      }

      .search-results {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-top: 8px;
      }

      .search-result-item {
        padding: 12px;
        border-bottom: 1px solid var(--border);
        cursor: pointer;
        transition: background 0.2s;
      }

      .search-result-item:hover {
        background: #f9fafb;
      }

      .search-result-item:last-child {
        border-bottom: none;
      }

      .result-name {
        font-weight: 600;
        color: #111827;
      }

      .result-email {
        font-size: 12px;
        color: #6b7280;
      }

      .result-type {
        display: inline-block;
        padding: 2px 8px;
        background: var(--accent);
        color: white;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        margin-top: 4px;
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .checkbox-group input[type="checkbox"] {
        width: auto;
      }

      .form-section {
        margin-bottom: 32px;
      }

      /* ë“±ê¸‰ë³„ íƒ­ ìŠ¤íƒ€ì¼ */
      .level-tabs {
        display: flex;
        gap: 4px;
        margin-bottom: 20px;
        background: #f5f5f5;
        border-radius: 12px;
        padding: 4px;
        overflow-x: auto;
        flex-wrap: wrap;
      }

      .level-tab {
        padding: 8px 16px;
        background: none;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        color: #6b7280;
        transition: all 0.2s;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .level-tab:hover {
        background: white;
      }

      .level-tab.active {
        background: white;
        color: var(--accent);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .level-tab .badge {
        background: #e5e5e5;
        color: #666;
        padding: 2px 6px;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 700;
      }

      .level-tab.active .badge {
        background: var(--accent);
        color: white;
      }

      /* íšŒì› ìœ í˜•ë³„ ë“±ê¸‰ íƒ­ ìƒ‰ìƒ */
      .level-tab.owner-color {
        background: linear-gradient(135deg, #fef3c7 0%, #fde047 100%);
        border-color: #fbbf24;
        color: #854d0e;
      }

      .level-tab.agency-color {
        background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);
        border-color: #a78bfa;
        color: #5b21b6;
      }

      .level-tab.manager-color {
        background: linear-gradient(135deg, #bfdbfe 0%, #93c5fd 100%);
        border-color: #60a5fa;
        color: #1e3a8a;
      }

      .level-tab.admin-color {
        background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
        border-color: #f87171;
        color: #991b1b;
      }

      .level-tab.owner-color.active,
      .level-tab.agency-color.active,
      .level-tab.manager-color.active,
      .level-tab.admin-color.active {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transform: translateY(-2px);
        border-width: 2px;
      }

      .level-tab.owner-color .badge,
      .level-tab.agency-color .badge,
      .level-tab.manager-color .badge,
      .level-tab.admin-color .badge {
        background: rgba(0, 0, 0, 0.15);
        color: inherit;
      }

      .level-tab.owner-color.active .badge,
      .level-tab.agency-color.active .badge,
      .level-tab.manager-color.active .badge,
      .level-tab.admin-color.active .badge {
        background: rgba(0, 0, 0, 0.25);
        color: inherit;
      }

      /* íšŒì› í…Œì´ë¸” */
      .members-table-container {
        background: white;
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 20px;
      }

      .members-table {
        width: 100%;
        border-collapse: collapse;
      }

      .members-table thead {
        background: #f9fafb;
        border-bottom: 2px solid var(--border);
      }

      .members-table th {
        padding: 12px 16px;
        text-align: left;
        font-size: 13px;
        font-weight: 700;
        color: #374151;
        white-space: nowrap;
      }

      .members-table tbody tr {
        border-bottom: 1px solid #f3f4f6;
        cursor: pointer;
        transition: background 0.2s;
      }

      .members-table tbody tr:hover {
        background: #f9fafb;
      }

      .members-table tbody tr.selected {
        background: #f0f9ff;
        border-left: 3px solid var(--accent);
      }

      .members-table td {
        padding: 12px 16px;
        font-size: 14px;
        color: #374151;
      }

      .member-name-cell {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .member-avatar-sm {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--accent);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 13px;
        flex-shrink: 0;
      }

      .pagination {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        background: white;
        border-top: 1px solid var(--border);
      }

      .pagination-info {
        font-size: 14px;
        color: #6b7280;
      }

      .pagination-controls {
        display: flex;
        gap: 8px;
      }

      .pagination-btn {
        padding: 6px 12px;
        border: 1px solid var(--border);
        background: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.2s;
      }

      .pagination-btn:hover:not(:disabled) {
        background: #f9fafb;
        border-color: var(--accent);
      }

      .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .pagination-btn.active {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }

      .member-card {
        background: white;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
      }

      .member-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        border-color: var(--accent);
      }

      .member-card.selected {
        border-color: var(--accent);
        border-width: 2px;
        background: #f0f9ff;
      }

      .member-card-header {
        display: flex;
        align-items: start;
        justify-content: space-between;
        margin-bottom: 12px;
      }

      .member-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--accent);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 16px;
      }

      .member-info {
        flex: 1;
        margin-left: 12px;
      }

      .member-name {
        font-weight: 700;
        color: #111827;
        font-size: 15px;
        margin-bottom: 2px;
      }

      .member-email {
        color: #6b7280;
        font-size: 12px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .member-badges {
        display: flex;
        gap: 4px;
        margin-top: 8px;
      }

      .member-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
      }

      .member-badge.level {
        background: #fef3c7;
        color: #92400e;
      }

      .member-badge.type {
        font-weight: 700;
        font-size: 12px;
        padding: 5px 12px;
        border-radius: 6px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .member-badge.type.owner {
        background: linear-gradient(135deg, #fef3c7 0%, #fde047 100%);
        color: #854d0e;
        border: 1px solid #fbbf24;
      }

      .member-badge.type.agency {
        background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);
        color: #5b21b6;
        border: 1px solid #a78bfa;
      }

      .member-badge.type.manager {
        background: linear-gradient(135deg, #bfdbfe 0%, #93c5fd 100%);
        color: #1e3a8a;
        border: 1px solid #60a5fa;
      }

      .member-badge.type.admin {
        background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
        color: #991b1b;
        border: 1px solid #f87171;
      }

      .member-badge.custom {
        background: #fce7f3;
        color: #831843;
      }

      /* íšŒì› ìœ í˜• í•„í„° ìŠ¤íƒ€ì¼ */
      .type-filter {
        transition: all 0.2s;
        opacity: 0.7;
      }

      .type-filter:hover {
        opacity: 1;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .type-filter.active {
        opacity: 1;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transform: scale(1.05);
      }

      .member-stats {
        display: flex;
        gap: 12px;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid #f3f4f6;
        font-size: 12px;
      }

      .member-stat {
        display: flex;
        align-items: center;
        gap: 4px;
        color: #6b7280;
      }

      .member-stat i {
        color: var(--accent);
        font-size: 10px;
      }

      /* ë¹ ë¥¸ ê²€ìƒ‰ */
      .quick-search {
        position: relative;
        margin-bottom: 16px;
      }

      .quick-search input {
        width: 100%;
        padding: 12px 16px 12px 44px;
        border: 1px solid var(--border);
        border-radius: 12px;
        font-size: 14px;
        background: white;
      }

      .quick-search i {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
      }

      .search-clear {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: #e5e5e5;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        color: #666;
        font-size: 12px;
      }

      .search-clear:hover {
        background: #d4d4d4;
      }

      /* í†µê³„ ì¹´ë“œ */
      .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        padding: 16px;
        color: white;
      }

      .stat-card.seed {
        background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
      }

      .stat-card.power {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      }

      .stat-card.big-power {
        background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
      }

      .stat-card.premium {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      }

      .stat-label {
        font-size: 12px;
        opacity: 0.9;
        margin-bottom: 4px;
      }

      .stat-value {
        font-size: 24px;
        font-weight: 700;
      }

      /* ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ */
      .skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
      }

      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }

      .no-members {
        text-align: center;
        padding: 40px;
        color: #6b7280;
      }

      .no-members i {
        font-size: 48px;
        color: #d1d5db;
        margin-bottom: 12px;
      }

      /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
      @media (max-width: 768px) {
        .container {
          padding: 12px;
        }

        .members-table th,
        .members-table td {
          padding: 8px;
          font-size: 12px;
        }

        .member-avatar-sm {
          width: 28px;
          height: 28px;
          font-size: 12px;
        }

        .member-badge {
          font-size: 11px;
          padding: 3px 8px;
        }

        .member-badge.type {
          font-size: 11px;
          padding: 4px 8px;
          white-space: nowrap;
        }

        .pagination {
          flex-direction: column;
          gap: 12px;
          align-items: stretch;
        }

        .pagination-controls {
          justify-content: center;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ì´ë©”ì¼ ì—´ ìˆ¨ê¹€ */
        .members-table th:nth-child(2),
        .members-table td:nth-child(2) {
          display: none;
        }

        .level-tabs {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .level-tab {
          font-size: 12px;
          padding: 6px 12px;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ìœ í˜• ë²”ë¡€ ì„¸ë¡œ ë°°ì¹˜ */
        .member-type-legend {
          flex-direction: column !important;
          align-items: flex-start !important;
          gap: 8px !important;
        }
      }

      @media (max-width: 480px) {
        .members-table th,
        .members-table td {
          padding: 6px 4px;
          font-size: 11px;
        }

        .member-badge.type {
          font-size: 10px;
          padding: 3px 6px;
        }

        h1 {
          font-size: 20px !important;
        }

        .subtitle {
          font-size: 12px;
        }
      }
    </style>
  </head>
  <body class="admin-body">
    <!-- ì‚¬ì´ë“œë°” -->
    <div id="admin-sidebar"></div>

    <!-- í—¤ë” -->
    <div id="header"></div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
      <div class="container">
        <!-- í˜ì´ì§€ íƒ€ì´í‹€ -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
          <h1 style="margin: 0; display: flex; align-items: center; gap: 12px; font-size: 28px; color: #111827;">
            <i class="fas fa-user-edit" style="color: var(--accent);"></i>
            íšŒì› ë§ì¶¤ ì„¤ì •
          </h1>
        </div>
        <div class="subtitle">íŠ¹ì • íšŒì›ì˜ ê°€ê²©ê³¼ í† í° í•œë„ë¥¼ ë§ì¶¤ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤</div>

        <!-- ìƒíƒœ ë©”ì‹œì§€ -->
        <div id="statusMessage" style="display: none;"></div>

        <!-- íšŒì› ëª©ë¡ -->
        <section class="card">
          <div class="card-header">
            <div class="title">
              <i class="fas fa-users" style="color: var(--accent);"></i>
              íšŒì› ëª©ë¡
            </div>
            <div style="display: flex; gap: 8px; align-items: center;">
              <span style="font-size: 14px; color: #6b7280;">ì „ì²´ íšŒì›</span>
              <span style="background: var(--accent); color: white; padding: 2px 8px; border-radius: 12px; font-size: 13px; font-weight: 700;" id="totalMemberCount">0</span>
            </div>
          </div>
          <div class="card-body">
            <!-- ë¹ ë¥¸ ê²€ìƒ‰ -->
            <div class="quick-search">
              <i class="fas fa-search"></i>
              <input 
                type="text" 
                id="quickSearchInput" 
                placeholder="ì´ë¦„, ì´ë©”ì¼, ìœ í˜•ìœ¼ë¡œ ë¹ ë¥¸ ê²€ìƒ‰..."
                onkeyup="quickSearch()"
              />
              <button class="search-clear" id="searchClear" onclick="clearSearch()">
                <i class="fas fa-times"></i>
              </button>
            </div>

            <!-- íšŒì› ìœ í˜• í•„í„° -->
            <div class="member-type-legend" style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; padding: 12px; background: #f9fafb; border-radius: 8px;">
              <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                <span style="font-size: 13px; font-weight: 700; color: #374151;">íšŒì› ìœ í˜•:</span>
                <span class="member-badge type-filter active" style="font-size: 11px; cursor: pointer; background: #e5e7eb; color: #374151; border: 1px solid #9ca3af;" onclick="filterByUserType('all')" id="filter-all">
                  âœ¨ ì „ì²´
                </span>
                <span class="member-badge type owner type-filter" style="font-size: 11px; cursor: pointer;" onclick="filterByUserType('owner')" id="filter-owner">
                  ğŸ½ï¸ ì‹ë‹¹ ëŒ€í‘œ
                </span>
                <span class="member-badge type agency type-filter" style="font-size: 11px; cursor: pointer;" onclick="filterByUserType('agency')" id="filter-agency">
                  ğŸ¢ ëŒ€í–‰ì‚¬
                </span>
                <span class="member-badge type manager type-filter" style="font-size: 11px; cursor: pointer;" onclick="filterByUserType('manager')" id="filter-manager">
                  ğŸ‘” ë§¤ë‹ˆì €
                </span>
                <span class="member-badge type admin type-filter" style="font-size: 11px; cursor: pointer;" onclick="filterByUserType('admin')" id="filter-admin">
                  ğŸ‘‘ ê´€ë¦¬ì
                </span>
              </div>
            </div>

            <div class="level-tabs" id="levelTabs">
              <button class="level-tab active" onclick="filterByLevel('all')">
                ì „ì²´ <span class="badge" id="count-all">0</span>
              </button>
              <button class="level-tab" onclick="filterByLevel('seed')">
                ğŸŒ± ì”¨ì•— <span class="badge" id="count-seed">0</span>
              </button>
              <button class="level-tab" onclick="filterByLevel('power')">
                âš¡ íŒŒì›Œ <span class="badge" id="count-power">0</span>
              </button>
              <button class="level-tab" onclick="filterByLevel('big_power')">
                ğŸ’ª ë¹…íŒŒì›Œ <span class="badge" id="count-big_power">0</span>
              </button>
              <button class="level-tab" onclick="filterByLevel('premium')">
                â­ í”„ë¦¬ë¯¸ì—„ <span class="badge" id="count-premium">0</span>
              </button>
              <button class="level-tab" onclick="filterByLevel('elite')">
                ğŸ† ì—˜ë¦¬íŠ¸ <span class="badge" id="count-elite">0</span>
              </button>
              <button class="level-tab" onclick="filterByLevel('expert')">
                ğŸ¯ ì „ë¬¸ê°€ <span class="badge" id="count-expert">0</span>
              </button>
              <button class="level-tab" onclick="filterByLevel('master')">
                ğŸ‘‘ ë§ˆìŠ¤í„° <span class="badge" id="count-master">0</span>
              </button>
              <button class="level-tab" onclick="filterByLevel('platinum')">
                ğŸ’ í”Œë˜í‹°ë„˜ <span class="badge" id="count-platinum">0</span>
              </button>
            </div>

            <!-- íšŒì› í…Œì´ë¸” -->
            <div class="members-table-container">
              <table class="members-table">
                <thead>
                  <tr>
                    <th>íšŒì›ëª…</th>
                    <th>ì´ë©”ì¼</th>
                    <th>ìœ í˜•</th>
                    <th>ë“±ê¸‰</th>
                    <th>ë§ì¶¤ì„¤ì •</th>
                    <th>ê°€ì…ì¼</th>
                  </tr>
                </thead>
                <tbody id="membersTableBody">
                  <tr>
                    <td colspan="6" style="text-align: center; padding: 40px;">
                      <i class="fas fa-spinner fa-spin"></i> íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="pagination">
                <div class="pagination-info">
                  <span id="paginationInfo">0ëª… ì¤‘ 0-0ëª… í‘œì‹œ</span>
                </div>
                <div class="pagination-controls">
                  <button class="pagination-btn" id="prevPageBtn" onclick="changePage(-1)" disabled>
                    <i class="fas fa-chevron-left"></i> ì´ì „
                  </button>
                  <span id="pageNumbers"></span>
                  <button class="pagination-btn" id="nextPageBtn" onclick="changePage(1)" disabled>
                    ë‹¤ìŒ <i class="fas fa-chevron-right"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- ë§ì¶¤ ì„¤ì • -->
        <section class="card" id="customizationCard" style="display: none;">
          <div class="card-header">
            <div class="title">
              <i class="fas fa-cog" style="color: var(--accent);"></i>
              ë§ì¶¤ ì„¤ì •
            </div>
          </div>
          <div class="card-body">
            <!-- íšŒì› ì •ë³´ -->
            <div class="member-info">
              <h3>ì„ íƒëœ íšŒì›</h3>
              <p><strong>ì´ë¦„:</strong> <span id="memberName">-</span></p>
              <p><strong>ì´ë©”ì¼:</strong> <span id="memberEmail">-</span></p>
              <p><strong>íšŒì› ìœ í˜•:</strong> <span id="memberType">-</span></p>
              <p><strong>ë“±ê¸‰:</strong> <span id="memberLevel">-</span></p>
            </div>

            <!-- ë§ì¶¤ ê°€ê²© ì„¹ì…˜ -->
            <div class="form-section">
              <h3 style="font-size: 16px; font-weight: 700; color: #111827; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-tag" style="color: var(--accent);"></i>
                ë§ì¶¤ ê°€ê²© ì„¤ì •
              </h3>
              
              <div class="form-group">
                <label>ë§ì¶¤ ê°€ê²© (ì›)</label>
                <div class="input-group">
                  <input type="number" id="customPrice" placeholder="ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš” (ê³µë°± ì‹œ ê¸°ë³¸ ê°€ê²© ì ìš©)" min="0" />
                  <span class="input-unit">ì›</span>
                </div>
                <div class="info-text">ê°’ì„ ì…ë ¥í•˜ë©´ í•´ë‹¹ íšŒì›ì—ê²Œ ë§ì¶¤ ê°€ê²©ì´ ì ìš©ë©ë‹ˆë‹¤. ê³µë°±ìœ¼ë¡œ ë‘ë©´ ê¸°ë³¸ ë“±ê¸‰ë³„ ê°€ê²©ì´ ì ìš©ë©ë‹ˆë‹¤.</div>
              </div>

              <div class="form-group">
                <label>í• ì¸/ì¸ìƒ ì‚¬ìœ </label>
                <textarea 
                  id="discountReason" 
                  placeholder="ì˜ˆ: VIP í• ì¸, í”„ë¡œëª¨ì…˜, ì‹ ê·œ ê°€ì…ì ë“±"
                  rows="3"
                ></textarea>
              </div>
            </div>

            <div class="section-divider"></div>

            <!-- ë§ì¶¤ í† í° ì„¹ì…˜ -->
            <div class="form-section">
              <h3 style="font-size: 16px; font-weight: 700; color: #111827; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-coins" style="color: var(--accent);"></i>
                ë§ì¶¤ í† í° í•œë„ ì„¤ì •
              </h3>
              
              <div class="form-group">
                <label>ë§ì¶¤ í† í° í•œë„ (í† í°/ì›”)</label>
                <div class="input-group">
                  <input type="number" id="customToken" placeholder="í† í° í•œë„ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ê³µë°± ì‹œ ê¸°ë³¸ í•œë„ ì ìš©)" min="0" />
                  <span class="input-unit">í† í°/ì›”</span>
                </div>
                <div class="info-text">ê°’ì„ ì…ë ¥í•˜ë©´ í•´ë‹¹ íšŒì›ì—ê²Œ ë§ì¶¤ í† í° í•œë„ê°€ ì ìš©ë©ë‹ˆë‹¤. ê³µë°±ìœ¼ë¡œ ë‘ë©´ ê¸°ë³¸ ë“±ê¸‰ë³„ í•œë„ê°€ ì ìš©ë©ë‹ˆë‹¤.</div>
              </div>

              <div class="form-group">
                <label>ì‚¬ìœ </label>
                <textarea 
                  id="tokenReason" 
                  placeholder="ì˜ˆ: ì´ë²¤íŠ¸ í”„ë¡œëª¨ì…˜, VIP í˜œíƒ ë“±"
                  rows="3"
                ></textarea>
              </div>
            </div>

            <!-- ë²„íŠ¼ ê·¸ë£¹ -->
            <div class="btn-group">
              <button class="btn" onclick="resetForm()">
                <i class="fas fa-undo"></i> ì´ˆê¸°í™”
              </button>
              <button class="btn primary" onclick="saveMemberCustomization()">
                <i class="fas fa-save"></i> ì €ì¥
              </button>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
    <script src="/admin/assets/admin-bootstrap.js" defer></script>

    <script>
      // ==================== ì„¤ì • ====================
      
      let supabase;
      let allMembers = [];
      let selectedMember = null;
      let currentLevel = 'all';
      let currentUserType = 'all'; // íšŒì› ìœ í˜• í•„í„°
      let customMembers = new Set(); // ë§ì¶¤ ì„¤ì •ì´ ìˆëŠ” íšŒì› ID ì €ì¥
      
      // í˜ì´ì§€ë„¤ì´ì…˜ ì„¤ì •
      let currentPage = 1;
      let itemsPerPage = 50; // í•œ í˜ì´ì§€ì— 50ëª…ì”©
      let totalPages = 1;

      // ==================== ì´ˆê¸°í™” ====================

      window.addEventListener('load', async function() {
        try {
          console.log('ğŸ”„ í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘...');
          
          supabase = await AdminBootstrap.getSupabaseClient();
          console.log('âœ… Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”:', supabase);
          
          await AdminBootstrap.initializeHeader();
          console.log('âœ… í—¤ë” ì´ˆê¸°í™” ì™„ë£Œ');
          
          await AdminBootstrap.initializeSidebar();
          console.log('âœ… ì‚¬ì´ë“œë°” ì´ˆê¸°í™” ì™„ë£Œ');
          
          await loadAllMembers();
          console.log('âœ… íšŒì› ëª©ë¡ ë¡œë“œ ì™„ë£Œ');
          
        } catch (error) {
          console.error('âŒ í˜ì´ì§€ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
          showMessage('í˜ì´ì§€ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message, 'error');
        }
      });

      // ==================== íšŒì› ì¡°íšŒ ====================

      async function loadAllMembers() {
        try {
          console.log('ğŸ‘¥ íšŒì› ëª©ë¡ ì¡°íšŒ ì‹œì‘...');
          
          // íšŒì› ëª©ë¡ ì¡°íšŒ
          const { data, error } = await supabase
            .from('profiles')
            .select('id, name, email, user_type, membership_level, created_at')
            .order('created_at', { ascending: false });

          console.log('ğŸ‘¥ profiles ì¡°íšŒ ê²°ê³¼:', { data, error });
          
          if (error) throw error;

          allMembers = data || [];
          console.log(`âœ… ì´ ${allMembers.length}ëª…ì˜ íšŒì› ë¡œë“œ`);

          // ë§ì¶¤ ì„¤ì •ì´ ìˆëŠ” íšŒì› í™•ì¸
          const { data: customPricing, error: pricingError } = await supabase
            .from('member_custom_pricing')
            .select('member_id');
          
          console.log('ğŸ’° ë§ì¶¤ ê°€ê²© ì¡°íšŒ:', { customPricing, pricingError });
          
          const { data: customTokens, error: tokenError } = await supabase
            .from('member_token_limits')
            .select('member_id');

          console.log('ğŸŸï¸ ë§ì¶¤ í† í° ì¡°íšŒ:', { customTokens, tokenError });

          customMembers = new Set([
            ...(customPricing || []).map(p => p.member_id),
            ...(customTokens || []).map(t => t.member_id)
          ]);

          console.log(`âœ… ë§ì¶¤ ì„¤ì • íšŒì› ìˆ˜: ${customMembers.size}`);

          // íšŒì› ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
          updateMemberCounts();
          // íšŒì› í‘œì‹œ
          displayMembers();
          // ë“±ê¸‰ íƒ­ ìƒ‰ìƒ ì´ˆê¸°í™”
          updateLevelTabsColor();
        } catch (error) {
          console.error('âŒ íšŒì› ì¡°íšŒ ì‹¤íŒ¨:', error);
          console.error('âŒ ì—ëŸ¬ ìƒì„¸:', error.stack);
          showMessage('íšŒì› ì¡°íšŒ ì‹¤íŒ¨: ' + error.message, 'error');
        }
      }

      // ==================== íšŒì› í‘œì‹œ (í…Œì´ë¸”) ====================

      function displayMembers(members = null) {
        const tbody = document.getElementById('membersTableBody');
        const displayList = members || getFilteredMembers();

        // í˜ì´ì§€ë„¤ì´ì…˜ ê³„ì‚°
        totalPages = Math.ceil(displayList.length / itemsPerPage);
        const startIdx = (currentPage - 1) * itemsPerPage;
        const endIdx = Math.min(startIdx + itemsPerPage, displayList.length);
        const pageMembers = displayList.slice(startIdx, endIdx);

        if (displayList.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">
                <i class="fas fa-users-slash" style="font-size: 32px; margin-bottom: 8px; display: block;"></i>
                í•´ë‹¹ ì¡°ê±´ì˜ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤
              </td>
            </tr>
          `;
          updatePagination(0, 0, 0);
          return;
        }

        tbody.innerHTML = pageMembers.map(member => {
          const initial = member.name ? member.name[0].toUpperCase() : 'U';
          const hasCustom = customMembers.has(member.id);
          const createdDate = member.created_at ? new Date(member.created_at).toLocaleDateString('ko-KR') : '-';
          const isSelected = selectedMember?.id === member.id;
          
          return `
            <tr class="${isSelected ? 'selected' : ''}" onclick="selectMemberFromTable('${member.id}')">
              <td>
                <div class="member-name-cell">
                  <div class="member-avatar-sm">${initial}</div>
                  <span style="font-weight: 600;">${member.name || 'ì´ë¦„ ì—†ìŒ'}</span>
                </div>
              </td>
              <td style="color: #6b7280; font-size: 13px;">${member.email}</td>
              <td>
                <span class="member-badge type ${member.user_type}">
                  ${getUserTypeIcon(member.user_type)} ${getUserTypeLabel(member.user_type)}
                </span>
              </td>
              <td>
                <span style="padding: 4px 10px; background: #fef3c7; color: #92400e; border-radius: 6px; font-size: 12px; font-weight: 600;">
                  ${getLevelIcon(member.membership_level)} ${getLevelText(member.membership_level)}
                </span>
              </td>
              <td style="text-align: center;">
                ${hasCustom ? '<span style="color: #dc2626; font-weight: 600;">â—</span>' : '<span style="color: #d1d5db;">-</span>'}
              </td>
              <td style="color: #6b7280; font-size: 13px;">${createdDate}</td>
            </tr>
          `;
        }).join('');

        updatePagination(displayList.length, startIdx + 1, endIdx);
      }

      // ==================== í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸ ====================

      function updatePagination(total, start, end) {
        document.getElementById('paginationInfo').textContent = 
          total > 0 ? `${total}ëª… ì¤‘ ${start}-${end}ëª… í‘œì‹œ` : '0ëª…';

        document.getElementById('prevPageBtn').disabled = currentPage === 1;
        document.getElementById('nextPageBtn').disabled = currentPage === totalPages || totalPages === 0;

        // í˜ì´ì§€ ë²ˆí˜¸ í‘œì‹œ
        const pageNumbers = document.getElementById('pageNumbers');
        const maxPagesToShow = 5;
        let pages = [];

        if (totalPages <= maxPagesToShow) {
          pages = Array.from({ length: totalPages }, (_, i) => i + 1);
        } else {
          if (currentPage <= 3) {
            pages = [1, 2, 3, 4, 5];
          } else if (currentPage >= totalPages - 2) {
            pages = [totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages];
          } else {
            pages = [currentPage - 2, currentPage - 1, currentPage, currentPage + 1, currentPage + 2];
          }
        }

        pageNumbers.innerHTML = pages.map(page => `
          <button class="pagination-btn ${page === currentPage ? 'active' : ''}" 
                  onclick="goToPage(${page})">${page}</button>
        `).join('');
      }

      // ==================== í˜ì´ì§€ ì´ë™ ====================

      function changePage(delta) {
        const newPage = currentPage + delta;
        if (newPage >= 1 && newPage <= totalPages) {
          currentPage = newPage;
          displayMembers();
        }
      }

      function goToPage(page) {
        if (page >= 1 && page <= totalPages) {
          currentPage = page;
          displayMembers();
        }
      }

      // ==================== í•„í„°ë§ ====================

      function getFilteredMembers() {
        let filtered = allMembers;

        // íšŒì› ìœ í˜• í•„í„°
        if (currentUserType !== 'all') {
          filtered = filtered.filter(m => m.user_type === currentUserType);
        }

        // ë“±ê¸‰ í•„í„°
        if (currentLevel !== 'all') {
          filtered = filtered.filter(m => {
            // free ë“±ê¸‰ì„ seedë¡œ ë³€í™˜í•˜ì—¬ í•„í„°ë§
            const level = (m.membership_level === 'free' || !m.membership_level) ? 'seed' : m.membership_level;
            return level === currentLevel;
          });
        }

        // ê²€ìƒ‰ì–´ í•„í„°
        const searchQuery = document.getElementById('quickSearchInput')?.value.toLowerCase();
        if (searchQuery) {
          filtered = filtered.filter(m => 
            m.name?.toLowerCase().includes(searchQuery) || 
            m.email?.toLowerCase().includes(searchQuery) ||
            getUserTypeText(m.user_type).toLowerCase().includes(searchQuery) ||
            getLevelText(m.membership_level).toLowerCase().includes(searchQuery)
          );
        }

        return filtered;
      }

      // ==================== ë¹ ë¥¸ ê²€ìƒ‰ ====================

      function quickSearch() {
        const input = document.getElementById('quickSearchInput');
        const clearBtn = document.getElementById('searchClear');
        
        if (input.value) {
          clearBtn.style.display = 'flex';
        } else {
          clearBtn.style.display = 'none';
        }

        currentPage = 1; // ê²€ìƒ‰ ì‹œ ì²« í˜ì´ì§€ë¡œ
        displayMembers();
      }

      function clearSearch() {
        document.getElementById('quickSearchInput').value = '';
        document.getElementById('searchClear').style.display = 'none';
        currentPage = 1; // ì²« í˜ì´ì§€ë¡œ
        displayMembers();
      }

      // ==================== íšŒì› ìœ í˜•ë³„ í•„í„° ====================

      function filterByUserType(userType) {
        currentUserType = userType;
        currentPage = 1; // í•„í„° ë³€ê²½ ì‹œ ì²« í˜ì´ì§€ë¡œ
        
        // í•„í„° í™œì„±í™” ìƒíƒœ ë³€ê²½
        document.querySelectorAll('.type-filter').forEach(filter => {
          filter.classList.remove('active');
        });
        document.getElementById(`filter-${userType}`).classList.add('active');

        displayMembers();
        updateLevelTabsColor();
      }

      // ==================== ë“±ê¸‰ë³„ í•„í„° ====================

      function filterByLevel(level) {
        currentLevel = level;
        currentPage = 1; // í•„í„° ë³€ê²½ ì‹œ ì²« í˜ì´ì§€ë¡œ
        
        // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
        document.querySelectorAll('.level-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        event.target.closest('.level-tab').classList.add('active');

        displayMembers();
      }

      // ==================== íšŒì› ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ ====================

      function updateMemberCounts() {
        const levels = ['seed', 'power', 'big_power', 'premium', 'elite', 'expert', 'master', 'platinum'];
        
        // í˜„ì¬ í•„í„°ì— ë§ëŠ” íšŒì› ëª©ë¡
        let filteredForCount = allMembers;
        if (currentUserType !== 'all') {
          filteredForCount = filteredForCount.filter(m => m.user_type === currentUserType);
        }
        
        // ì „ì²´ ì¹´ìš´íŠ¸
        document.getElementById('count-all').textContent = filteredForCount.length;
        document.getElementById('totalMemberCount').textContent = allMembers.length;

        // ë“±ê¸‰ë³„ ì¹´ìš´íŠ¸
        levels.forEach(level => {
          const count = filteredForCount.filter(m => {
            // free ë“±ê¸‰ì„ seedë¡œ ë³€í™˜í•˜ì—¬ ì¹´ìš´íŠ¸
            const memberLevel = (m.membership_level === 'free' || !m.membership_level) ? 'seed' : m.membership_level;
            return memberLevel === level;
          }).length;
          const element = document.getElementById(`count-${level}`);
          if (element) element.textContent = count;
        });
      }

      // ==================== ë“±ê¸‰ íƒ­ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ====================

      function updateLevelTabsColor() {
        const levelTabs = document.querySelectorAll('.level-tab');
        
        // ëª¨ë“  ìƒ‰ìƒ í´ë˜ìŠ¤ ì œê±°
        levelTabs.forEach(tab => {
          tab.classList.remove('owner-color', 'agency-color', 'manager-color', 'admin-color');
        });

        // íšŒì› ìœ í˜•ì— ë”°ë¼ ìƒ‰ìƒ ì ìš©
        if (currentUserType === 'owner') {
          // ì‹ë‹¹ ëŒ€í‘œ ë“±ê¸‰: ì”¨ì•—, íŒŒì›Œ, ë¹…íŒŒì›Œ, í”„ë¦¬ë¯¸ì—„
          ['seed', 'power', 'big_power', 'premium'].forEach(level => {
            const tab = document.querySelector(`.level-tab[onclick*="'${level}'"]`);
            if (tab) tab.classList.add('owner-color');
          });
        } else if (currentUserType === 'agency') {
          // ëŒ€í–‰ì‚¬ ë“±ê¸‰: ì—˜ë¦¬íŠ¸, ì „ë¬¸ê°€, ë§ˆìŠ¤í„°, í”Œë˜í‹°ë„˜
          ['elite', 'expert', 'master', 'platinum'].forEach(level => {
            const tab = document.querySelector(`.level-tab[onclick*="'${level}'"]`);
            if (tab) tab.classList.add('agency-color');
          });
        }
        // ë§¤ë‹ˆì €ì™€ ê´€ë¦¬ìëŠ” ì¼ë°˜ ë“±ê¸‰ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ìƒ‰ìƒ ì ìš© ì•ˆ í•¨

        updateMemberCounts();
      }

      // ==================== ë“±ê¸‰ ì•„ì´ì½˜ ====================

      function getLevelIcon(level) {
        // free ë“±ê¸‰ì„ seedë¡œ ë³€í™˜
        if (level === 'free' || !level) {
          level = 'seed';
        }
        const icons = {
          'seed': 'ğŸŒ±',
          'power': 'âš¡',
          'big_power': 'ğŸ’ª',
          'premium': 'â­',
          'elite': 'ğŸ†',
          'expert': 'ğŸ¯',
          'master': 'ğŸ‘‘',
          'platinum': 'ğŸ’',
          'admin': 'ğŸ›¡ï¸'
        };
        return icons[level] || 'ğŸŒ±';
      }

      // ==================== íšŒì› ì„ íƒ (í…Œì´ë¸”) ====================

      function selectMemberFromTable(memberId) {
        const member = allMembers.find(m => m.id === memberId);
        if (!member) return;

        selectedMember = {
          id: member.id,
          name: member.name,
          email: member.email,
          userType: member.user_type,
          level: member.membership_level
        };

        // í…Œì´ë¸” í–‰ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        displayMembers();

        // ë§ì¶¤ ì„¤ì • ì¹´ë“œ í‘œì‹œ
        document.getElementById('customizationCard').style.display = 'block';
        document.getElementById('memberName').textContent = member.name || 'ì´ë¦„ ì—†ìŒ';
        document.getElementById('memberEmail').textContent = member.email;
        document.getElementById('memberType').textContent = getUserTypeText(member.user_type);
        document.getElementById('memberLevel').textContent = getLevelText(member.membership_level);

        // ë§ì¶¤ ì„¤ì • ì¹´ë“œë¡œ ìŠ¤í¬ë¡¤
        setTimeout(() => {
          document.getElementById('customizationCard').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
          });
        }, 100);

        loadMemberCustomization();
      }

      // ==================== íšŒì› ë§ì¶¤ ì„¤ì • ë¡œë“œ ====================

      async function loadMemberCustomization() {
        try {
          // ë§ì¶¤ ê°€ê²© ì¡°íšŒ
          const pricingResp = await fetch(`/api/subscription/member-pricing/${selectedMember.id}`);
          const pricingData = await pricingResp.json();

          // ë§ì¶¤ í† í° ì¡°íšŒ
          const tokenResp = await fetch(`/api/subscription/member-token-limit/${selectedMember.id}`);
          const tokenData = await tokenResp.json();

          // ê°€ê²© ì„¤ì •
          if (pricingData.custom_pricing) {
            document.getElementById('customPrice').value = pricingData.custom_pricing.custom_price || '';
            document.getElementById('discountReason').value = pricingData.custom_pricing.discount_reason || '';
          } else {
            document.getElementById('customPrice').value = '';
            document.getElementById('discountReason').value = '';
          }

          // í† í° ì„¤ì •
          if (tokenData.custom_limit) {
            document.getElementById('customToken').value = tokenData.custom_limit.custom_limit || '';
            document.getElementById('tokenReason').value = tokenData.custom_limit.reason || '';
          } else {
            document.getElementById('customToken').value = '';
            document.getElementById('tokenReason').value = '';
          }
        } catch (error) {
          console.error('âŒ ë§ì¶¤ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
        }
      }


      // ==================== ì €ì¥ ====================

      async function saveMemberCustomization() {
        if (!selectedMember) return;

        try {
          const promises = [];

          // ë§ì¶¤ ê°€ê²© ì €ì¥ (ê°’ì´ ì…ë ¥ëœ ê²½ìš°)
          const customPriceValue = document.getElementById('customPrice').value;
          if (customPriceValue && customPriceValue.trim() !== '') {
            const customPrice = parseInt(customPriceValue);
            const discountReason = document.getElementById('discountReason').value;

            promises.push(
              fetch('/api/subscription/member-pricing', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  member_id: selectedMember.id,
                  custom_price: customPrice,
                  discount_reason: discountReason
                })
              })
            );
          }

          // ë§ì¶¤ í† í° ì €ì¥ (ê°’ì´ ì…ë ¥ëœ ê²½ìš°)
          const customTokenValue = document.getElementById('customToken').value;
          if (customTokenValue && customTokenValue.trim() !== '') {
            const customToken = parseInt(customTokenValue);
            const tokenReason = document.getElementById('tokenReason').value;

            promises.push(
              fetch('/api/subscription/member-token-limit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  member_id: selectedMember.id,
                  custom_limit: customToken,
                  reason: tokenReason
                })
              })
            );
          }

          if (promises.length === 0) {
            showMessage('ë§ì¶¤ ê°€ê²© ë˜ëŠ” ë§ì¶¤ í† í° í•œë„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
            return;
          }

          const responses = await Promise.all(promises);
          const results = await Promise.all(responses.map(r => r.json()));

          for (const result of results) {
            if (!result.success) throw new Error(result.error);
          }

          showMessage(`${selectedMember.name} íšŒì›ì˜ ë§ì¶¤ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
          
          // ë§ì¶¤ ì„¤ì • íšŒì› ëª©ë¡ ì—…ë°ì´íŠ¸
          customMembers.add(selectedMember.id);
          displayMembers();
        } catch (error) {
          console.error('âŒ ì €ì¥ ì‹¤íŒ¨:', error);
          showMessage('ì €ì¥ ì‹¤íŒ¨: ' + error.message, 'error');
        }
      }

      // ==================== ì´ˆê¸°í™” ====================

      function resetForm() {
        if (!selectedMember) return;
        
        // ì¬ë¡œë“œ
        loadMemberCustomization();
      }

      // ==================== ìœ í‹¸ í•¨ìˆ˜ ====================

      function getUserTypeIcon(type) {
        const icons = {
          'owner': 'ğŸ½ï¸',
          'agency': 'ğŸ¢',
          'manager': 'ğŸ‘”',
          'admin': 'ğŸ‘‘'
        };
        return icons[type] || 'ğŸ‘¤';
      }

      function getUserTypeLabel(type) {
        const labels = {
          'owner': 'ì‹ë‹¹ ëŒ€í‘œ',
          'agency': 'ëŒ€í–‰ì‚¬',
          'manager': 'ë§¤ë‹ˆì €',
          'admin': 'ê´€ë¦¬ì'
        };
        return labels[type] || type;
      }

      function getUserTypeText(type) {
        return `${getUserTypeIcon(type)} ${getUserTypeLabel(type)}`;
      }

      function getLevelText(level) {
        // free ë“±ê¸‰ì„ seedë¡œ ë³€í™˜
        if (level === 'free' || !level) {
          level = 'seed';
        }
        const levels = {
          'seed': 'ì”¨ì•—',
          'power': 'íŒŒì›Œ',
          'big_power': 'ë¹…íŒŒì›Œ',
          'premium': 'í”„ë¦¬ë¯¸ì—„',
          'elite': 'ì—˜ë¦¬íŠ¸',
          'expert': 'ì „ë¬¸ê°€',
          'master': 'ë§ˆìŠ¤í„°',
          'platinum': 'í”Œë˜í‹°ë„˜',
          'admin': 'ê´€ë¦¬ì'
        };
        return levels[level] || 'ì”¨ì•—';
      }

      function showMessage(message, type) {
        const container = document.getElementById('statusMessage');
        container.className = type;
        container.innerHTML = `
          ${type === 'error' ? '<i class="fas fa-exclamation-circle"></i>' : '<i class="fas fa-check-circle"></i>'}
          ${message}
        `;
        container.style.display = 'block';

        setTimeout(() => {
          container.style.display = 'none';
        }, 5000);
      }
    </script>
    
    <!-- Admin ê³µí†µ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="../assets/admin-sidebar.js"></script>
    <script src="../assets/admin-header.js"></script>
    <script src="../assets/admin-common.js"></script>
  </body>
</html>
