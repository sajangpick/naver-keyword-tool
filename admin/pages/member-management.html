<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>íšŒì› ê´€ë¦¬ - ì‚¬ì¥í”½ ê´€ë¦¬ì</title>
    
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      rel="stylesheet"
    />
    
    <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="/admin/assets/admin-common.css" />
    
    <style>
      /* íšŒì› ê´€ë¦¬ ì „ìš© ìŠ¤íƒ€ì¼ */
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px;
      }

      .subtitle {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 24px;
      }

      .card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.06);
        overflow: hidden;
      }

      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px;
        border-bottom: 1px solid #f3f4f6;
        background: #fafafa;
      }

      .card-header .title {
        font-size: 18px;
        font-weight: 700;
        color: #111827;
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .card-body {
        padding: 24px;
      }

      /* í•„í„° */
      .filters {
        display: grid;
        grid-template-columns: 1fr 300px auto;
        gap: 12px;
        margin-bottom: 20px;
      }

      .filter-group {
        display: flex;
        gap: 8px;
      }

      .filter-btn {
        padding: 10px 16px;
        border: 1px solid var(--border);
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s;
        color: #374151;
      }

      .filter-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      .filter-btn.active {
        background: var(--accent);
        border-color: var(--accent);
        color: white;
      }

      input[type="text"],
      select {
        width: 100%;
        padding: 10px 14px;
        background: #fff;
        border: 1px solid var(--border);
        color: var(--text);
        border-radius: 8px;
        font-size: 14px;
      }

      input[type="text"]:focus,
      select:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(3, 199, 90, 0.1);
      }

      /* í…Œì´ë¸” */
      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 14px 12px;
        border-bottom: 1px solid #f3f4f6;
        font-size: 14px;
        text-align: left;
      }

      th {
        color: #6b7280;
        font-weight: 700;
        background: #fafafa;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      td {
        color: #374151;
      }

      tr:hover td {
        background: #f9fafb;
      }

      .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
      }

      .badge.owner {
        background: #dbeafe;
        color: #1e40af;
      }

      .badge.agency {
        background: #fef3c7;
        color: #92400e;
      }

      .badge.admin {
        background: #fee2e2;
        color: #991b1b;
      }

      .badge.seed {
        background: #e0e7ff;
        color: #3730a3;
      }

      .badge.power {
        background: #ddd6fe;
        color: #5b21b6;
      }

      .badge.big_power {
        background: #fce7f3;
        color: #9f1239;
      }

      .badge.premium {
        background: #dcfce7;
        color: #166534;
      }

      .badge.elite {
        background: #fef9c3;
        color: #713f12;
      }

      .badge.expert {
        background: #fed7aa;
        color: #7c2d12;
      }

      .badge.master {
        background: #fecaca;
        color: #7f1d1d;
      }

      .badge.platinum {
        background: #e9d5ff;
        color: #581c87;
      }

      /* ë²„íŠ¼ */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: white;
        color: #374151;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        transition: all 0.2s;
      }

      .btn:hover {
        border-color: var(--accent);
        color: var(--accent);
        transform: translateY(-1px);
      }

      .btn.primary {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }

      .btn.primary:hover {
        background: var(--naver-green-dark);
        transform: translateY(-1px);
      }

      .btn.danger {
        color: #dc2626;
        border-color: #fecaca;
      }

      .btn.danger:hover {
        background: #fee2e2;
        border-color: #dc2626;
      }

      /* ì‚¬ìš©ëŸ‰ ë°” */
      .usage-bar {
        width: 100%;
        height: 6px;
        background: #e5e7eb;
        border-radius: 3px;
        overflow: hidden;
        margin-top: 4px;
      }

      .usage-bar-fill {
        height: 100%;
        background: var(--accent);
        transition: width 0.3s;
      }

      .usage-bar-fill.warning {
        background: #f59e0b;
      }

      .usage-bar-fill.danger {
        background: #ef4444;
      }

      /* ë¡œë”© */
      .loading {
        text-align: center;
        padding: 60px 20px;
        color: var(--muted);
      }

      .spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid #e5e7eb;
        border-top: 4px solid var(--accent);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error {
        background: #fee2e2;
        color: #dc2626;
        padding: 16px;
        border-radius: 8px;
        margin: 20px 0;
        border: 1px solid #fecaca;
      }

      /* í˜ì´ì§€ë„¤ì´ì…˜ */
      .pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 24px;
      }

      .page-btn {
        padding: 8px 12px;
        border: 1px solid var(--border);
        background: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        transition: all 0.2s;
      }

      .page-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      .page-btn.active {
        background: var(--accent);
        border-color: var(--accent);
        color: white;
      }

      .page-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* í†µê³„ ì¹´ë“œ */
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--border);
      }

      .stat-card .label {
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 8px;
      }

      .stat-card .value {
        font-size: 32px;
        font-weight: 700;
        color: var(--text);
      }

      /* ë“œë¡­ë‹¤ìš´ */
      .dropdown {
        position: relative;
        display: inline-block;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        background: white;
        min-width: 200px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        border-radius: 8px;
        z-index: 1000;
        border: 1px solid var(--border);
        overflow: hidden;
      }

      .dropdown-content.show {
        display: block;
      }

      .dropdown-item {
        padding: 10px 16px;
        cursor: pointer;
        font-size: 13px;
        border-bottom: 1px solid #f3f4f6;
        transition: background 0.2s;
      }

      .dropdown-item:last-child {
        border-bottom: none;
      }

      .dropdown-item:hover {
        background: #f9fafb;
      }

      /* ëª¨ë‹¬ */
      .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
      }

      .modal.show {
        display: flex;
      }

      .modal-content {
        background: white;
        padding: 24px;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      .modal-header {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 16px;
      }

      .modal-body {
        margin-bottom: 20px;
      }

      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }

      .form-group {
        margin-bottom: 16px;
      }

      .form-group label {
        display: block;
        margin-bottom: 6px;
        font-size: 13px;
        font-weight: 600;
        color: #374151;
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 12px;
      }

      .checkbox-group input[type="checkbox"] {
        width: auto;
      }

      /* ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
      .modal-large {
        max-width: 900px;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        position: relative;
      }

      .close-btn {
        position: absolute;
        right: 0;
        top: -8px;
        background: none;
        border: none;
        font-size: 32px;
        cursor: pointer;
        color: #6b7280;
        line-height: 1;
      }

      .close-btn:hover {
        color: #111827;
      }

      .detail-section {
        margin-bottom: 32px;
        padding-bottom: 24px;
        border-bottom: 1px solid #e5e7eb;
      }

      .detail-section:last-child {
        border-bottom: none;
      }

      .detail-section h3 {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 16px;
        color: #111827;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }

      .info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .info-item label {
        font-size: 12px;
        font-weight: 600;
        color: #6b7280;
      }

      .info-item span {
        font-size: 14px;
        color: #111827;
      }

      .usage-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }

      .usage-card {
        background: #f9fafb;
        padding: 16px;
        border-radius: 8px;
      }

      .usage-label {
        font-size: 13px;
        font-weight: 600;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .usage-value {
        font-size: 24px;
        font-weight: 700;
        color: #111827;
        margin-bottom: 8px;
      }

      .usage-value .current {
        color: var(--accent);
      }

      .usage-value .limit {
        color: #9ca3af;
        font-size: 18px;
      }

      .usage-bar {
        width: 100%;
        height: 8px;
        background: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
      }

      .usage-bar-fill {
        height: 100%;
        background: var(--accent);
        transition: width 0.3s;
        border-radius: 4px;
      }

      .usage-bar-fill.warning {
        background: #f59e0b;
      }

      .usage-bar-fill.danger {
        background: #ef4444;
      }

      .activity-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .activity-item {
        background: #f9fafb;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 8px;
        border-left: 3px solid var(--accent);
      }

      .activity-item:last-child {
        margin-bottom: 0;
      }

      .activity-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .activity-title {
        font-size: 14px;
        font-weight: 600;
        color: #111827;
      }

      .activity-date {
        font-size: 12px;
        color: #9ca3af;
      }

      .activity-content {
        font-size: 13px;
        color: #6b7280;
        line-height: 1.5;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }

      .activity-meta {
        display: flex;
        gap: 12px;
        margin-top: 8px;
        font-size: 12px;
        color: #9ca3af;
      }

      .activity-empty {
        text-align: center;
        padding: 40px;
        color: #9ca3af;
      }

      .activity-empty i {
        font-size: 48px;
        opacity: 0.3;
        display: block;
        margin-bottom: 12px;
      }

      /* ë°˜ì‘í˜• */
      @media (max-width: 900px) {
        .filters {
          grid-template-columns: 1fr;
        }

        .stats {
          grid-template-columns: repeat(2, 1fr);
        }

        table {
          font-size: 12px;
        }

        th,
        td {
          padding: 10px 8px;
        }
      }
    </style>
  </head>
  <body>
    <main class="container">
      <h1><i class="fas fa-users"></i> íšŒì› ê´€ë¦¬</h1>
      <p class="subtitle">
        ì „ì²´ íšŒì› ëª©ë¡ ì¡°íšŒ ë° ë“±ê¸‰ ê´€ë¦¬ Â· 
        <strong>Aì•ˆ (í”„ë¡ íŠ¸ì—”ë“œ ì§ì ‘)</strong> Â· 
        ë‚˜ì¤‘ì— Bì•ˆ(ì„œë²„ API)ìœ¼ë¡œ ì „í™˜ ì˜ˆì •
      </p>

      <!-- í†µê³„ -->
      <div class="stats">
        <div class="stat-card">
          <div class="label">ì „ì²´ íšŒì›</div>
          <div class="value" id="stat-total">0</div>
        </div>
        <div class="stat-card">
          <div class="label">ì‹ë‹¹ ëŒ€í‘œ</div>
          <div class="value" id="stat-owner">0</div>
        </div>
        <div class="stat-card">
          <div class="label">ëŒ€í–‰ì‚¬/ë¸”ë¡œê±°</div>
          <div class="value" id="stat-agency">0</div>
        </div>
        <div class="stat-card">
          <div class="label">ê´€ë¦¬ì</div>
          <div class="value" id="stat-admin">0</div>
        </div>
      </div>

      <!-- ë©”ì¸ ì¹´ë“œ -->
      <section class="card">
        <div class="card-header">
          <div class="title">
            <i class="fas fa-list"></i>
            íšŒì› ëª©ë¡
          </div>
          <button class="btn primary" onclick="window.location.reload()">
            <i class="fas fa-sync"></i> ìƒˆë¡œê³ ì¹¨
          </button>
        </div>

        <div class="card-body">
          <!-- í•„í„° -->
          <div class="filters">
            <div class="filter-group">
              <button class="filter-btn active" data-type="" onclick="filterByType(this, '')">
                ì „ì²´
              </button>
              <button class="filter-btn" data-type="owner" onclick="filterByType(this, 'owner')">
                ì‹ë‹¹ ëŒ€í‘œ
              </button>
              <button class="filter-btn" data-type="agency" onclick="filterByType(this, 'agency')">
                ëŒ€í–‰ì‚¬/ë¸”ë¡œê±°
              </button>
              <button class="filter-btn" data-type="admin" onclick="filterByType(this, 'admin')">
                ê´€ë¦¬ì
              </button>
            </div>

            <input
              type="text"
              id="searchInput"
              placeholder="ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼ ê²€ìƒ‰..."
              onkeyup="handleSearch(event)"
            />

            <button class="btn primary" onclick="loadMembers()">
              <i class="fas fa-search"></i> ê²€ìƒ‰
            </button>
          </div>

          <!-- ë¡œë”©/ì—ëŸ¬ -->
          <div id="loadingContainer" class="loading" style="display: none">
            <div class="spinner"></div>
            <p style="margin-top: 16px">ë¡œë”© ì¤‘...</p>
          </div>

          <div id="errorContainer" style="display: none"></div>

          <!-- í…Œì´ë¸” -->
          <div id="tableContainer" style="max-height: 600px; overflow: auto">
            <table>
              <thead>
                <tr>
                  <th>íšŒì›ëª…</th>
                  <th>ì´ë©”ì¼</th>
                  <th>íšŒì› ìœ í˜•</th>
                  <th>ë“±ê¸‰</th>
                  <th>ê°€ì…ì¼</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="memberTableBody">
                <!-- JavaScriptë¡œ ì±„ì›Œì§ -->
              </tbody>
            </table>
          </div>

          <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
          <div class="pagination" id="pagination" style="display: none"></div>
        </div>
      </section>

      <!-- í”Œë ˆì´ìŠ¤ í¬ë¡¤ë§ ê¸°ë¡ -->
      <section class="card" style="margin-top: 24px;">
        <div class="card-header">
          <div class="title">
            <i class="fas fa-database" style="color: var(--accent);"></i>
            í”Œë ˆì´ìŠ¤ í¬ë¡¤ë§ ìºì‹œ
          </div>
          <button class="btn" onclick="loadPlaceCache()">
            <i class="fas fa-sync"></i> ìƒˆë¡œê³ ì¹¨
          </button>
        </div>
        <div class="card-body">
          <div class="table-container">
            <table id="placeCacheTable">
              <thead>
                <tr>
                  <th>ê°€ê²Œëª…</th>
                  <th>ì£¼ì†Œ</th>
                  <th>ì˜ì—…ì‹œê°„</th>
                  <th>í¬ë¡¤ë§ íšŸìˆ˜</th>
                  <th>ë§ˆì§€ë§‰ í¬ë¡¤ë§</th>
                  <th>ìƒì„±ì¼</th>
                </tr>
              </thead>
              <tbody id="placeCacheBody">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 40px; color: #999;">
                    <i class="fas fa-spinner fa-spin"></i> ë¡œë”© ì¤‘...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>

    <!-- ë“±ê¸‰ ë³€ê²½ ëª¨ë‹¬ -->
    <div id="levelModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">íšŒì› ë“±ê¸‰ ë° ìœ í˜• ë³€ê²½</div>
        <div class="modal-body">
          <div class="form-group">
            <label>íšŒì›ëª…</label>
            <input type="text" id="modal-member-name" readonly />
          </div>

          <div class="form-group">
            <label>ë“±ê¸‰ ì„ íƒ</label>
            <select id="modal-new-level">
              <option value="">ë¡œë”© ì¤‘...</option>
            </select>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="modal-reset-usage" />
            <label for="modal-reset-usage">ì‚¬ìš©ëŸ‰ ì´ˆê¸°í™”</label>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn" onclick="closeLevelModal()">ì·¨ì†Œ</button>
          <button class="btn primary" onclick="confirmLevelChange()">
            <i class="fas fa-check"></i> ë³€ê²½
          </button>
        </div>
      </div>
    </div>

    <!-- íšŒì› ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="detailModal" class="modal">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <span id="detail-member-name">íšŒì› ìƒì„¸ì •ë³´</span>
          <button class="close-btn" onclick="closeDetailModal()">&times;</button>
        </div>
        <div class="modal-body">
          <!-- íšŒì› ê¸°ë³¸ ì •ë³´ -->
          <section class="detail-section">
            <h3><i class="fas fa-user-circle"></i> íšŒì› ì •ë³´</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>ì´ë¦„</label>
                <span id="detail-name">-</span>
              </div>
              <div class="info-item">
                <label>ì´ë©”ì¼</label>
                <span id="detail-email">-</span>
              </div>
              <div class="info-item">
                <label>íšŒì› ìœ í˜•</label>
                <span id="detail-user-type">-</span>
              </div>
              <div class="info-item">
                <label>ë“±ê¸‰</label>
                <span id="detail-level">-</span>
              </div>
              <div class="info-item">
                <label>ê°€ì…ì¼</label>
                <span id="detail-created">-</span>
              </div>
              <div class="info-item">
                <label>ë§ˆì§€ë§‰ ìˆ˜ì •</label>
                <span id="detail-updated">-</span>
              </div>
            </div>
          </section>

          <!-- ê°€ê²Œ ì •ë³´ -->
          <section class="detail-section">
            <h3><i class="fas fa-store"></i> ê°€ê²Œ ì •ë³´</h3>
            <p style="color: #666; font-size: 13px; margin-bottom: 12px;">ë¸”ë¡œê·¸ ì‘ì„± ì‹œ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ëŠ” ì •ë³´</p>
            <div class="info-grid">
              <div class="info-item" style="grid-column: 1 / -1;">
                <label>í”Œë ˆì´ìŠ¤ URL</label>
                <span id="detail-store-url" style="word-break: break-all;">-</span>
              </div>
              <div class="info-item">
                <label>ê°€ê²Œ ì´ë¦„</label>
                <span id="detail-store-name">-</span>
              </div>
              <div class="info-item">
                <label>ê°€ê²Œ ì£¼ì†Œ</label>
                <span id="detail-store-address">-</span>
              </div>
              <div class="info-item">
                <label>ì˜ì—…ì‹œê°„</label>
                <span id="detail-store-hours">-</span>
              </div>
              <div class="info-item">
                <label>ê°€ê²Œ ì „í™”ë²ˆí˜¸</label>
                <span id="detail-store-phone">-</span>
              </div>
              <div class="info-item">
                <label>ëŒ€í‘œë©”ë‰´</label>
                <span id="detail-store-menu">-</span>
              </div>
              <div class="info-item">
                <label>ì£¼ë³€ ëœë“œë§ˆí¬</label>
                <span id="detail-store-landmarks">-</span>
              </div>
              <div class="info-item">
                <label>í‚¤ì›Œë“œ</label>
                <span id="detail-store-keywords">-</span>
              </div>
            </div>
          </section>

          <!-- ì´ë²ˆ ë‹¬ ì‚¬ìš©ëŸ‰ í†µê³„ -->
          <section class="detail-section">
            <h3><i class="fas fa-chart-bar"></i> ì´ë²ˆ ë‹¬ ì‚¬ìš©ëŸ‰</h3>
            <div class="usage-stats">
              <div class="usage-card">
                <div class="usage-label">ë¦¬ë·° ë‹µê¸€</div>
                <div class="usage-value">
                  <span class="current" id="detail-review-count">0</span> / 
                  <span class="limit" id="detail-review-limit">0</span>
                </div>
                <div class="usage-bar">
                  <div class="usage-bar-fill" id="detail-review-bar"></div>
                </div>
              </div>
              <div class="usage-card">
                <div class="usage-label">ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…</div>
                <div class="usage-value">
                  <span class="current" id="detail-blog-count">0</span> / 
                  <span class="limit" id="detail-blog-limit">0</span>
                </div>
                <div class="usage-bar">
                  <div class="usage-bar-fill" id="detail-blog-bar"></div>
                </div>
              </div>
            </div>
          </section>

          <!-- ë¦¬ë·° ë‹µê¸€ ë‚´ì—­ -->
          <section class="detail-section">
            <h3><i class="fas fa-comment-dots"></i> ìµœê·¼ ë¦¬ë·° ë‹µê¸€ (ìµœê·¼ 10ê°œ)</h3>
            <div id="detail-reviews-container" class="activity-list">
              <div class="loading-spinner">
                <div class="spinner"></div>
                ë¡œë”© ì¤‘...
              </div>
            </div>
          </section>

          <!-- ë¸”ë¡œê·¸ í¬ìŠ¤íŒ… ë‚´ì—­ -->
          <section class="detail-section">
            <h3><i class="fas fa-blog"></i> ìµœê·¼ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ… (ìµœê·¼ 10ê°œ)</h3>
            <div id="detail-blogs-container" class="activity-list">
              <div class="loading-spinner">
                <div class="spinner"></div>
                ë¡œë”© ì¤‘...
              </div>
            </div>
          </section>
        </div>

        <div class="modal-footer">
          <button class="btn" onclick="closeDetailModal()">ë‹«ê¸°</button>
        </div>
      </div>
    </div>

    <!-- Admin Bootstrap (Supabase ìë™ ë¡œë“œ) -->
    <script src="/admin/assets/admin-bootstrap.js?v=20251030" defer></script>

    <script>
      // ==================== ì„¤ì • ====================
      
      // TODO: ë¸”ë¡œê·¸ ì‘ì—… ì™„ë£Œ í›„ Bì•ˆìœ¼ë¡œ ì „í™˜
      // í˜„ì¬: Aì•ˆ (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ Supabase ì§ì ‘ í˜¸ì¶œ)
      // ë‚˜ì¤‘: Bì•ˆ (server.js API í˜¸ì¶œ)
      
      // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
      let supabase;
      
      async function ensureSupabase() {
        if (!supabase) {
          supabase = await AdminBootstrap.getSupabaseClient();
          console.log('âœ… Supabase ì´ˆê¸°í™” ì™„ë£Œ');
        }
        return supabase;
      }

      // íšŒì› ë“±ê¸‰ ì œí•œ ì •ë³´
      const LIMITS = {
        owner: {
          seed: { review: 10, blog: 2 },
          power: { review: 50, blog: 10 },
          big_power: { review: 200, blog: 30 },
          premium: { review: null, blog: 100 }
        },
        agency: {
          elite: { review: 100, blog: 50 },
          expert: { review: 500, blog: 200 },
          master: { review: 2000, blog: 500 },
          platinum: { review: null, blog: null }
        },
        admin: {
          admin: { review: null, blog: null }
        }
      };

      // ë“±ê¸‰ í•œê¸€ëª… (FREEë„ ë¼ì´íŠ¸ë¡œ í‘œì‹œ)
      const LEVEL_NAMES = {
        free: 'ë¼ì´íŠ¸',      // FREE ë“±ê¸‰ë„ ë¼ì´íŠ¸ë¡œ í‘œì‹œ
        seed: 'ë¼ì´íŠ¸',
        power: 'ìŠ¤íƒ ë‹¤ë“œ',
        big_power: 'í”„ë¡œ',
        premium: 'í”„ë¦¬ë¯¸ì—„',
        elite: 'ìŠ¤íƒ€í„°',
        expert: 'í”„ë¡œ',
        master: 'ì—”í„°í”„ë¼ì´ì¦ˆ',
        platinum: 'í”Œë˜í‹°ë„˜',
        admin: 'ê´€ë¦¬ì'
      };

      // ë“±ê¸‰ ì •ê·œí™” í•¨ìˆ˜: FREE/free/nullì„ seedë¡œ ë³€í™˜
      function normalizeMembershipLevel(level) {
        if (!level) {
          return 'seed';
        }
        const normalized = level.toLowerCase();
        // FREE ë˜ëŠ” freeë¥¼ seedë¡œ ë³€í™˜
        if (normalized === 'free') {
          return 'seed';
        }
        // big_powerë¥¼ bigpowerë¡œ ë³€í™˜
        if (normalized === 'big_power') {
          return 'bigpower';
        }
        return normalized;
      }

      // ìƒíƒœ ë³€ìˆ˜
      let currentFilter = '';
      let currentSearch = '';
      let currentPage = 1;
      let selectedMember = null;

      // ==================== ì´ˆê¸°í™” ====================

      // AdminUtilsê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ëŠ” í•¨ìˆ˜
      async function waitForAdminUtils() {
        let retries = 0;
        const maxRetries = 50; // 5ì´ˆ ëŒ€ê¸°
        
        while (retries < maxRetries) {
          if (typeof AdminUtils !== 'undefined' && AdminUtils.adminFetch) {
            return true;
          }
          await new Promise(resolve => setTimeout(resolve, 100));
          retries++;
        }
        
        console.error('âŒ AdminUtilsë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return false;
      }

      window.addEventListener('load', async function() {
        console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, AdminUtils ëŒ€ê¸° ì¤‘...');
        
        // AdminUtilsê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
        const utilsReady = await waitForAdminUtils();
        if (!utilsReady) {
          console.error('âŒ ê´€ë¦¬ì ìœ í‹¸ë¦¬í‹°ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        // ê¶Œí•œ ì²´í¬ëŠ” API í˜¸ì¶œ ì‹œ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì œê±°
        // API í˜¸ì¶œì´ 403ì„ ë°˜í™˜í•˜ë©´ ì—ëŸ¬ë§Œ í‘œì‹œí•˜ê³  ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ì§€ ì•ŠìŒ
        console.log('âœ… AdminUtils ë¡œë“œ ì™„ë£Œ, ê¶Œí•œ ì²´í¬ëŠ” API í˜¸ì¶œ ì‹œ ìˆ˜í–‰ë©ë‹ˆë‹¤');
        
        console.log('âœ… AdminUtils ë¡œë“œ ì™„ë£Œ, íšŒì› ëª©ë¡ ë¡œë“œ ì‹œì‘');
        // Bì•ˆ ì‚¬ìš© ì‹œ Supabase ì§ì ‘ í˜¸ì¶œ ë¶ˆí•„ìš” (APIë¥¼ í†µí•´ ì²˜ë¦¬)
        // ensureSupabase(); // ìƒì„¸ë³´ê¸°ì—ì„œë§Œ í•„ìš” ì‹œ í˜¸ì¶œ
        await loadLevelOptions(); // ë“±ê¸‰ ì˜µì…˜ ë¨¼ì € ë¡œë“œ
        await loadMembers();
      });

      // ==================== ë“±ê¸‰ ì˜µì…˜ ë¡œë“œ ====================

      async function loadLevelOptions() {
        try {
          console.log('ğŸ”„ ë“±ê¸‰ ì˜µì…˜ ë¡œë“œ ì‹œì‘...');
          
          // AdminUtils ëŒ€ê¸°
          await waitForAdminUtils();
          
          // ê°€ê²© ì„¤ì • ë¡œë“œ (ì‘ì—… í¬ë ˆë”§ ì‹œìŠ¤í…œ: pricing_configì˜ included_credits ì‚¬ìš©)
          const pricingResult = await AdminUtils.adminFetch('/api/subscription/pricing-config');

          if (!pricingResult.success) {
            throw new Error('ë“±ê¸‰ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
          }

          const pricingData = pricingResult.pricing || {};

          // ë“±ê¸‰ ë“œë¡­ë‹¤ìš´ ìƒì„±
          const select = document.getElementById('modal-new-level');
          select.innerHTML = '';

          // ì‹ë‹¹ ëŒ€í‘œ ë“±ê¸‰ (ì‘ì—… í¬ë ˆë”§ ì‹œìŠ¤í…œ: included_credits ì‚¬ìš©)
          const ownerGroup = document.createElement('optgroup');
          ownerGroup.label = 'ì‹ë‹¹ ëŒ€í‘œ (owner)';
          
          const ownerLevels = [
            { key: 'seed', label: 'ğŸŒ± ë¼ì´íŠ¸', creditsKey: 'owner_seed_included_credits', priceKey: 'owner_seed_price' },
            { key: 'power', label: 'âš¡ ìŠ¤íƒ ë‹¤ë“œ', creditsKey: 'owner_power_included_credits', priceKey: 'owner_power_price' },
            { key: 'bigpower', label: 'ğŸ’ª í”„ë¡œ', creditsKey: 'owner_bigpower_included_credits', priceKey: 'owner_bigpower_price' },
            { key: 'premium', label: 'â­ í”„ë¦¬ë¯¸ì—„', creditsKey: 'owner_premium_included_credits', priceKey: 'owner_premium_price' }
          ];

          ownerLevels.forEach(level => {
            // pricing_configì˜ included_credits ì‚¬ìš© (ì‘ì—… í¬ë ˆë”§ ì‹œìŠ¤í…œ)
            let creditsLimit = pricingData[level.creditsKey] || 0;
            const price = pricingData[level.priceKey] || 0;
            
            // 0ì´ë©´ ê¸°ë³¸ê°’ ì‚¬ìš© (ë“±ê¸‰ë³„ ê¸°ë³¸ í¬ë ˆë”§)
            if (creditsLimit === 0) {
              const defaultCredits = {
                'seed': 0,
                'power': 37500,
                'bigpower': 83333,
                'premium': 200000
              };
              creditsLimit = defaultCredits[level.key] || 0;
            }
            
            const option = document.createElement('option');
            option.value = `owner:member:${level.key}`;
            option.textContent = `${level.label} (${creditsLimit.toLocaleString()} í¬ë ˆë”§/ì›”, ${price.toLocaleString()}ì›/ì›”)`;
            ownerGroup.appendChild(option);
          });

          select.appendChild(ownerGroup);

          // ëŒ€í–‰ì‚¬ ë“±ê¸‰ (ì‘ì—… í¬ë ˆë”§ ì‹œìŠ¤í…œ: included_credits ì‚¬ìš©, ë“±ê¸‰ëª… ë§¤í•‘ í•„ìš”)
          const agencyGroup = document.createElement('optgroup');
          agencyGroup.label = 'ëŒ€í–‰ì‚¬/ë¸”ë¡œê±° (agency)';
          
          const agencyLevels = [
            { key: 'elite', label: 'ğŸ† ìŠ¤íƒ€í„°', creditsKey: 'agency_starter_included_credits', priceKey: 'agency_elite_price' },
            { key: 'expert', label: 'ğŸ¯ í”„ë¡œ', creditsKey: 'agency_pro_included_credits', priceKey: 'agency_expert_price' },
            { key: 'master', label: 'ğŸ‘‘ ì—”í„°í”„ë¼ì´ì¦ˆ', creditsKey: 'agency_enterprise_included_credits', priceKey: 'agency_master_price' }
          ];

          agencyLevels.forEach(level => {
            // pricing_configì˜ included_credits ì‚¬ìš© (ì‘ì—… í¬ë ˆë”§ ì‹œìŠ¤í…œ)
            let creditsLimit = pricingData[level.creditsKey] || 0;
            const price = pricingData[level.priceKey] || 0;
            
            // 0ì´ë©´ ê¸°ë³¸ê°’ ì‚¬ìš© (ë“±ê¸‰ë³„ ê¸°ë³¸ í¬ë ˆë”§)
            if (creditsLimit === 0) {
              const defaultCredits = {
                'elite': 100000,
                'expert': 600000,
                'master': 1666666
              };
              creditsLimit = defaultCredits[level.key] || 0;
            }
            
            const option = document.createElement('option');
            option.value = `agency:member:${level.key}`;
            option.textContent = `${level.label} (${creditsLimit.toLocaleString()} í¬ë ˆë”§/ì›”, ${price.toLocaleString()}ì›/ì›”)`;
            agencyGroup.appendChild(option);
          });

          select.appendChild(agencyGroup);

          // ë§¤ë‹ˆì € ë“±ê¸‰ (ê³ ì •)
          const managerGroup = document.createElement('optgroup');
          managerGroup.label = 'ë§¤ë‹ˆì € (manager)';
          
          const managerOption1 = document.createElement('option');
          managerOption1.value = 'manager:general:admin';
          managerOption1.textContent = 'ğŸ™‹ ì¼ë°˜ ë§¤ë‹ˆì € (ë·°ë§Œ ê°€ëŠ¥)';
          managerGroup.appendChild(managerOption1);
          
          const managerOption2 = document.createElement('option');
          managerOption2.value = 'manager:super:admin';
          managerOption2.textContent = 'ğŸ‘‘ ìˆ˜í¼ ë§¤ë‹ˆì € (ì œí•œëœ í¸ì§‘)';
          managerGroup.appendChild(managerOption2);
          
          select.appendChild(managerGroup);

          // ê´€ë¦¬ì ë“±ê¸‰ (ê³ ì •)
          const adminGroup = document.createElement('optgroup');
          adminGroup.label = 'ê´€ë¦¬ì (admin)';
          
          const adminOption1 = document.createElement('option');
          adminOption1.value = 'admin:general:admin';
          adminOption1.textContent = 'ğŸ‘” ì¼ë°˜ ê´€ë¦¬ì (ì˜¤ë„ˆê°€ ì œì•½)';
          adminGroup.appendChild(adminOption1);
          
          const adminOption2 = document.createElement('option');
          adminOption2.value = 'admin:owner:admin';
          adminOption2.textContent = 'ğŸ‘¨â€ğŸ’¼ ì˜¤ë„ˆ ê´€ë¦¬ì (ëª¨ë“  ê¶Œí•œ)';
          adminGroup.appendChild(adminOption2);
          
          select.appendChild(adminGroup);

          console.log('âœ… ë“±ê¸‰ ì˜µì…˜ ë¡œë“œ ì™„ë£Œ');
        } catch (error) {
          console.error('âŒ ë“±ê¸‰ ì˜µì…˜ ë¡œë“œ ì‹¤íŒ¨:', error);
          // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì˜µì…˜ í‘œì‹œ
          const select = document.getElementById('modal-new-level');
          select.innerHTML = '<option value="">ë“±ê¸‰ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</option>';
        }
      }

      // ==================== Bì•ˆ: Server API í˜¸ì¶œ ====================

      async function loadMembers(userType = currentFilter, search = currentSearch, page = currentPage) {
        try {
          console.log('ğŸ” íšŒì› ëª©ë¡ ë¡œë“œ ì‹œì‘...', { userType, search, page });
          showLoading(true);
          hideError();

          // Bì•ˆ: API í˜¸ì¶œ
          const params = new URLSearchParams({ page, limit: 20 });
          if (userType) params.append('user_type', userType);
          if (search) params.append('search', search);

          const apiUrl = `/api/admin/members?${params}`;
          console.log('ğŸ“¡ API í˜¸ì¶œ:', apiUrl);
          
          // AdminUtils ëŒ€ê¸°
          await waitForAdminUtils();
          
          // AdminUtils.adminFetch ì‚¬ìš© (ì¸ì¦ í† í° ìë™ í¬í•¨)
          const result = await AdminUtils.adminFetch(apiUrl);
          console.log('ğŸ“Š API ì‘ë‹µ ë°ì´í„°:', result);

          if (!result.success) {
            console.error('âŒ API ì‹¤íŒ¨ ì‘ë‹µ:', result);
            throw new Error(result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
          }

          // ë°ì´í„° ê²€ì¦
          if (!result.members) {
            console.warn('âš ï¸ members ë°ì´í„°ê°€ ì—†ìŒ, ë¹ˆ ë°°ì—´ë¡œ ì„¤ì •');
            result.members = [];
          }
          if (result.total === undefined || result.total === null) {
            console.warn('âš ï¸ total ë°ì´í„°ê°€ ì—†ìŒ, 0ìœ¼ë¡œ ì„¤ì •');
            result.total = 0;
          }

          console.log(`âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ: íšŒì› ${result.members.length}ëª…, ì „ì²´ ${result.total}ëª…`);

          // í†µê³„ ì—…ë°ì´íŠ¸ (ì „ì²´ í†µê³„ë¥¼ ìœ„í•´ ë³„ë„ API í˜¸ì¶œ í•„ìš”í•˜ì§€ë§Œ, ì¼ë‹¨ í˜„ì¬ í˜ì´ì§€ ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œ)
          updateStats(result.members, result.total);

          // í…Œì´ë¸” ë Œë”ë§
          console.log('ğŸ¨ í…Œì´ë¸” ë Œë”ë§ ì‹œì‘...');
          renderMembers(result.members);

          // í˜ì´ì§€ë„¤ì´ì…˜
          if (result.total > 20) {
            renderPagination(result.page, result.total, result.limit);
          } else {
            document.getElementById('pagination').style.display = 'none';
          }

          console.log(`âœ… íšŒì› ëª©ë¡ ë¡œë“œ ì™„ë£Œ!`);

        } catch (error) {
          console.error('âŒ íšŒì› ë¡œë“œ ì‹¤íŒ¨:', error);
          console.error('âŒ ì—ëŸ¬ ìŠ¤íƒ:', error.stack);
          
          // 403 ì—ëŸ¬ì¸ ê²½ìš° íŠ¹ë³„ ì²˜ë¦¬ (ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ì§€ ì•ŠìŒ)
          if (error.status === 403 || error.message.includes('403') || error.message.includes('ê¶Œí•œ')) {
            console.warn('âš ï¸ ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì—ëŸ¬ë§Œ í‘œì‹œí•˜ê³  ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            showError('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. í˜„ì¬ ê³„ì •ì— ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
            renderMembers([]);
            return;
          }
          
          // 401 ì—ëŸ¬ì¸ ê²½ìš° (ì„¸ì…˜ ë§Œë£Œ) - ë‹¨, noRedirect í”Œë˜ê·¸ê°€ ìˆìœ¼ë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ì§€ ì•ŠìŒ
          if ((error.status === 401 || error.message.includes('401') || error.message.includes('ë¡œê·¸ì¸')) && !error.noRedirect) {
            console.warn('âš ï¸ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
            const currentUrl = encodeURIComponent(window.location.pathname + window.location.search);
            window.location.replace(`/login.html?redirect=${currentUrl}`);
            return;
          }
          
          // noRedirect í”Œë˜ê·¸ê°€ ìˆìœ¼ë©´ ì—ëŸ¬ë§Œ í‘œì‹œ
          if (error.noRedirect) {
            console.warn('âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•˜ì§€ë§Œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            showError('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            renderMembers([]);
            return;
          }
          
          // ê¸°íƒ€ ì—ëŸ¬
          showError('íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
          // ì—ëŸ¬ ë°œìƒ ì‹œ ë¹ˆ í…Œì´ë¸” í‘œì‹œ
          renderMembers([]);
        } finally {
          showLoading(false);
        }
      }

      async function updateMemberLevel(memberId, memberName, currentLevel, currentUserType) {
        // ë“±ê¸‰ ì •ê·œí™”
        const normalizedLevel = normalizeMembershipLevel(currentLevel);
        selectedMember = { id: memberId, name: memberName, level: normalizedLevel, userType: currentUserType };
        
        document.getElementById('modal-member-name').value = memberName;
        
        // í˜„ì¬ ë“±ê¸‰ì„ ë“œë¡­ë‹¤ìš´ value í˜•ì‹ìœ¼ë¡œ ë³€í™˜: "user_type:role:membership_level"
        let dropdownValue = 'owner:member:seed'; // ê¸°ë³¸ê°’
        
        if (currentUserType === 'owner') {
          // ì‹ë‹¹ ëŒ€í‘œ ë“±ê¸‰: owner:member:seed, owner:member:power, owner:member:bigpower, owner:member:premium
          dropdownValue = `owner:member:${normalizedLevel}`;
        } else if (currentUserType === 'agency') {
          // ëŒ€í–‰ì‚¬/ë¸”ë¡œê±° ë“±ê¸‰: agency:member:elite, agency:member:expert, agency:member:master
          dropdownValue = `agency:member:${normalizedLevel}`;
        } else if (currentUserType === 'manager') {
          // ë§¤ë‹ˆì €: manager:general:admin ë˜ëŠ” manager:super:admin
          if (normalizedLevel === 'super' || normalizedLevel === 'super_admin') {
            dropdownValue = 'manager:super:admin';
          } else {
            dropdownValue = 'manager:general:admin';
          }
        } else if (currentUserType === 'admin') {
          // ê´€ë¦¬ì: admin:general:admin ë˜ëŠ” admin:owner:admin
          if (normalizedLevel === 'owner' || normalizedLevel === 'owner_admin') {
            dropdownValue = 'admin:owner:admin';
          } else {
            dropdownValue = 'admin:general:admin';
          }
        }
        
        // ë“œë¡­ë‹¤ìš´ì— í˜„ì¬ ë“±ê¸‰ ì„¤ì •
        const dropdown = document.getElementById('modal-new-level');
        dropdown.value = dropdownValue;
        
        // ë§Œì•½ ë“œë¡­ë‹¤ìš´ì— í•´ë‹¹ ê°’ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
        if (!dropdown.value || dropdown.value !== dropdownValue) {
          console.warn(`âš ï¸ ë“œë¡­ë‹¤ìš´ì— ${dropdownValue} ê°’ì´ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.`);
          dropdown.value = 'owner:member:seed';
        }
        
        document.getElementById('modal-reset-usage').checked = false;
        
        document.getElementById('levelModal').classList.add('show');
      }

      async function confirmLevelChange() {
        if (!selectedMember) return;

        const levelValue = document.getElementById('modal-new-level').value;
        const resetUsage = document.getElementById('modal-reset-usage').checked;
        
        // ì„ íƒëœ ê°’ì„ íŒŒì‹±: "user_type:role:membership_level"
        const [newUserType, newRole, newLevel] = levelValue.split(':');
        
        // selectedMemberë¥¼ ë¨¼ì € ì €ì¥ (closeLevelModalì´ nullë¡œ ë§Œë“¤ê¸° ì „ì—)
        const memberId = selectedMember.id;
        const memberName = selectedMember.name;

        try {
          showLoading(true);
          closeLevelModal();

          // AdminUtils ëŒ€ê¸°
          await waitForAdminUtils();
          
          // Bì•ˆ: API í˜¸ì¶œ (roleì€ profiles í…Œì´ë¸”ì— ì—†ìœ¼ë¯€ë¡œ ì „ì†¡í•˜ì§€ ì•ŠìŒ)
          const result = await AdminUtils.adminFetch(`/api/admin/members/${memberId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              user_type: newUserType,
              membership_level: newLevel,
              // role: newRole, // profiles í…Œì´ë¸”ì— role ì»¬ëŸ¼ì´ ì—†ìœ¼ë¯€ë¡œ ì „ì†¡í•˜ì§€ ì•ŠìŒ
              reset_usage: resetUsage 
            })
          });

          if (!result.success) throw new Error(result.error);

          alert(`${memberName} íšŒì›ì˜ ë“±ê¸‰ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
          await loadMembers();

        } catch (error) {
          console.error('âŒ ë“±ê¸‰ ë³€ê²½ ì‹¤íŒ¨:', error);
          alert('ë“±ê¸‰ ë³€ê²½ ì‹¤íŒ¨: ' + error.message);
        } finally {
          showLoading(false);
        }
      }

      // íšŒì› ìœ í˜•ì— ë”°ë¼ ì—­í•  ì˜µì…˜ ì—…ë°ì´íŠ¸ (ì œê±°ë¨ - ë” ì´ìƒ í•„ìš” ì—†ìŒ)
      // ì´ì „ updateRoleOptions() í•¨ìˆ˜ëŠ” ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.

      async function deleteMember(memberId, memberName) {
        if (!confirm(`${memberName} íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê´€ë ¨ëœ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.`)) {
          return;
        }

        try {
          showLoading(true);

          // AdminUtils ëŒ€ê¸°
          await waitForAdminUtils();

          // Bì•ˆ: API í˜¸ì¶œ
          const result = await AdminUtils.adminFetch(`/api/admin/members/${memberId}`, {
            method: 'DELETE'
          });

          if (!result.success) throw new Error(result.error);

          alert(`${memberName} íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
          await loadMembers();

        } catch (error) {
          console.error('âŒ íšŒì› ì‚­ì œ ì‹¤íŒ¨:', error);
          alert('íšŒì› ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
        } finally {
          showLoading(false);
        }
      }

      // ==================== íšŒì› ìƒì„¸ë³´ê¸° ====================
      // ì£¼ì˜: ìƒì„¸ë³´ê¸°ëŠ” ì•„ì§ Supabase ì§ì ‘ í˜¸ì¶œ ì‚¬ìš© (í–¥í›„ APIë¡œ ì „í™˜ ê°€ëŠ¥)

      async function showMemberDetail(memberId) {
        try {
          await ensureSupabase();
          // íšŒì› ì •ë³´ ì¡°íšŒ (ê°€ê²Œ ì •ë³´ í¬í•¨)
          const { data: member, error: memberError } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', memberId)
            .single();

          if (memberError) throw new Error(memberError.message);
          if (!member) throw new Error('íšŒì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

          // ëª¨ë‹¬ ì—´ê¸°
          document.getElementById('detailModal').classList.add('show');

          // íšŒì› ê¸°ë³¸ ì •ë³´ í‘œì‹œ
          document.getElementById('detail-member-name').textContent = `${member.name} íšŒì› ìƒì„¸ì •ë³´`;
          document.getElementById('detail-name').textContent = member.name || '-';
          document.getElementById('detail-email').textContent = member.email || '-';
          
          const userTypeText = member.user_type === 'owner' ? 'ì‹ë‹¹ ëŒ€í‘œ' : 
                               member.user_type === 'agency' ? 'ëŒ€í–‰ì‚¬/ë¸”ë¡œê±°' : 'ê´€ë¦¬ì';
          document.getElementById('detail-user-type').innerHTML = 
            `<span class="badge ${member.user_type}">${userTypeText}</span>`;
          
          // ë“±ê¸‰ ì •ê·œí™” (í•œ ë²ˆë§Œ ì„ ì–¸)
          const normalizedLevel = normalizeMembershipLevel(member.membership_level);
          const levelText = LEVEL_NAMES[normalizedLevel] || normalizedLevel;
          document.getElementById('detail-level').innerHTML = 
            `<span class="badge ${normalizedLevel}">${levelText}</span>`;
          
          document.getElementById('detail-created').textContent = 
            new Date(member.created_at).toLocaleDateString('ko-KR', { 
              year: 'numeric', month: 'long', day: 'numeric' 
            });
          
          document.getElementById('detail-updated').textContent = 
            new Date(member.updated_at).toLocaleDateString('ko-KR', { 
              year: 'numeric', month: 'long', day: 'numeric' 
            });

          // ê°€ê²Œ ì •ë³´ í‘œì‹œ
          document.getElementById('detail-store-url').textContent = member.store_place_url || '-';
          document.getElementById('detail-store-name').textContent = member.store_name || '-';
          document.getElementById('detail-store-address').textContent = member.store_address || '-';
          document.getElementById('detail-store-hours').textContent = member.store_business_hours || '-';
          document.getElementById('detail-store-phone').textContent = member.store_phone_number || '-';
          document.getElementById('detail-store-menu').textContent = member.store_main_menu || '-';
          document.getElementById('detail-store-landmarks').textContent = member.store_landmarks || '-';
          document.getElementById('detail-store-keywords').textContent = member.store_keywords || '-';

          // ì‚¬ìš©ëŸ‰ í†µê³„ (ë“±ê¸‰ ì •ê·œí™” ì ìš© - ì´ë¯¸ ì„ ì–¸ëœ normalizedLevel ì‚¬ìš©)
          const reviewLimit = LIMITS[member.user_type]?.[normalizedLevel]?.review;
          const blogLimit = LIMITS[member.user_type]?.[normalizedLevel]?.blog;
          
          const reviewUsage = member.monthly_review_count || 0;
          const blogUsage = member.monthly_blog_count || 0;
          
          document.getElementById('detail-review-count').textContent = reviewUsage;
          document.getElementById('detail-review-limit').textContent = reviewLimit || 'ë¬´ì œí•œ';
          document.getElementById('detail-blog-count').textContent = blogUsage;
          document.getElementById('detail-blog-limit').textContent = blogLimit || 'ë¬´ì œí•œ';
          
          // ì‚¬ìš©ëŸ‰ ë°”
          const reviewPercent = reviewLimit ? Math.min((reviewUsage / reviewLimit * 100), 100) : 0;
          const blogPercent = blogLimit ? Math.min((blogUsage / blogLimit * 100), 100) : 0;
          
          const reviewBar = document.getElementById('detail-review-bar');
          reviewBar.style.width = reviewPercent + '%';
          reviewBar.className = 'usage-bar-fill';
          if (reviewPercent >= 90) reviewBar.classList.add('danger');
          else if (reviewPercent >= 70) reviewBar.classList.add('warning');
          
          const blogBar = document.getElementById('detail-blog-bar');
          blogBar.style.width = blogPercent + '%';
          blogBar.className = 'usage-bar-fill';
          if (blogPercent >= 90) blogBar.classList.add('danger');
          else if (blogPercent >= 70) blogBar.classList.add('warning');

          // ë¦¬ë·° ë‚´ì—­ ì¡°íšŒ (ë¹„ë™ê¸°)
          loadMemberReviews(memberId);
          
          // ë¸”ë¡œê·¸ ë‚´ì—­ ì¡°íšŒ (ë¹„ë™ê¸°)
          loadMemberBlogs(memberId);

        } catch (error) {
          console.error('âŒ íšŒì› ìƒì„¸ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
          alert('íšŒì› ìƒì„¸ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ' + error.message);
        }
      }

      async function loadMemberReviews(memberId) {
        const container = document.getElementById('detail-reviews-container');
        
        try {
          await ensureSupabase();
          console.log('ğŸ” ë¦¬ë·° ë‚´ì—­ ì¡°íšŒ ì‹œì‘:', memberId);
          
          // íƒ€ì„ì•„ì›ƒ ì¶”ê°€ (10ì´ˆ)
          const timeoutPromise = new Promise((_, reject) => 
            setTimeout(() => reject(new Error('ìš”ì²­ ì‹œê°„ ì´ˆê³¼ (10ì´ˆ)')), 10000)
          );
          
          // Supabase ì¿¼ë¦¬ë¥¼ Promiseë¡œ ê°ì‹¸ê¸°
          const queryPromise = (async () => {
            return await supabase
              .from('review_responses')
              .select('*')
              .eq('user_id', memberId)
              .order('created_at', { ascending: false })
              .limit(10);
          })();
          
          // Race between timeout and query
          const { data: reviews, error } = await Promise.race([queryPromise, timeoutPromise]);
          
          console.log('ğŸ“Š ë¦¬ë·° ë°ì´í„°:', reviews, 'ì—ëŸ¬:', error);

          if (error) {
            console.error('âŒ Supabase ì—ëŸ¬:', error);
            throw new Error(error.message);
          }

          if (!reviews || reviews.length === 0) {
            console.log('â„¹ï¸ ë¦¬ë·° ë°ì´í„° ì—†ìŒ');
            container.innerHTML = `
              <div class="activity-empty">
                <i class="fas fa-inbox"></i>
                <div>ì‘ì„±í•œ ë¦¬ë·° ë‹µê¸€ì´ ì—†ìŠµë‹ˆë‹¤</div>
              </div>
            `;
            return;
          }

          console.log('âœ… ë¦¬ë·° ë°ì´í„° ë¡œë“œ ì„±ê³µ:', reviews.length + 'ê°œ');
          container.innerHTML = reviews.map(review => `
            <div class="activity-item">
              <div class="activity-header">
                <div class="activity-title">
                  ${review.place_id || 'í”Œë ˆì´ìŠ¤ ì •ë³´ ì—†ìŒ'}
                </div>
                <div class="activity-date">
                  ${new Date(review.created_at).toLocaleString('ko-KR', { 
                    year: 'numeric', 
                    month: '2-digit', 
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                  })}
                </div>
              </div>
              <div class="activity-content">
                ${review.customer_review ? review.customer_review.substring(0, 100) + '...' : '-'}
              </div>
              <div class="activity-meta">
                <span><i class="fas fa-comment"></i> ë¦¬ë·° ë‹µê¸€</span>
                ${review.ai_response ? '<span><i class="fas fa-check-circle"></i> ë‹µê¸€ ìƒì„±ë¨</span>' : '<span><i class="fas fa-clock"></i> ë‹µê¸€ ëŒ€ê¸°</span>'}
              </div>
            </div>
          `).join('');

        } catch (error) {
          console.error('âŒ ë¦¬ë·° ë‚´ì—­ ì¡°íšŒ ì‹¤íŒ¨:', error);
          container.innerHTML = `
            <div class="activity-empty">
              <i class="fas fa-exclamation-triangle"></i>
              <div>ë¦¬ë·° ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>
              <div style="font-size: 0.9em; color: #666; margin-top: 8px;">
                ${error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}
              </div>
            </div>
          `;
        }
      }

      async function loadMemberBlogs(memberId) {
        const container = document.getElementById('detail-blogs-container');
        
        try {
          await ensureSupabase();
          console.log('ğŸ” ë¸”ë¡œê·¸ ë‚´ì—­ ì¡°íšŒ ì‹œì‘:', memberId);
          
          // íƒ€ì„ì•„ì›ƒ ì¶”ê°€ (10ì´ˆ)
          const timeoutPromise = new Promise((_, reject) => 
            setTimeout(() => reject(new Error('ìš”ì²­ ì‹œê°„ ì´ˆê³¼ (10ì´ˆ)')), 10000)
          );
          
          // Supabase ì¿¼ë¦¬ë¥¼ Promiseë¡œ ê°ì‹¸ê¸°
          const queryPromise = (async () => {
            return await supabase
              .from('blog_posts')
              .select('*')
              .eq('user_id', memberId)
              .order('created_at', { ascending: false })
              .limit(10);
          })();
          
          // Race between timeout and query
          const { data: blogs, error } = await Promise.race([queryPromise, timeoutPromise]);
          
          console.log('ğŸ“Š ë¸”ë¡œê·¸ ë°ì´í„°:', blogs, 'ì—ëŸ¬:', error);

          if (error) {
            console.error('âŒ Supabase ì—ëŸ¬:', error);
            throw new Error(error.message);
          }

          if (!blogs || blogs.length === 0) {
            console.log('â„¹ï¸ ë¸”ë¡œê·¸ ë°ì´í„° ì—†ìŒ');
            container.innerHTML = `
              <div class="activity-empty">
                <i class="fas fa-inbox"></i>
                <div>ì‘ì„±í•œ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…ì´ ì—†ìŠµë‹ˆë‹¤</div>
              </div>
            `;
            return;
          }

          console.log('âœ… ë¸”ë¡œê·¸ ë°ì´í„° ë¡œë“œ ì„±ê³µ:', blogs.length + 'ê°œ');
          container.innerHTML = blogs.map(blog => {
            const statusText = blog.status === 'published' ? 'ë°œí–‰ë¨' : 
                              blog.status === 'scheduled' ? 'ì˜ˆì•½ë¨' : 'ì„ì‹œì €ì¥';
            const statusIcon = blog.status === 'published' ? 'check-circle' : 
                              blog.status === 'scheduled' ? 'clock' : 'save';
            
            return `
              <div class="activity-item">
                <div class="activity-header">
                  <div class="activity-title">
                    ${blog.blog_title || 'ì œëª© ì—†ìŒ'}
                  </div>
                  <div class="activity-date">
                    ${new Date(blog.created_at).toLocaleString('ko-KR', { 
                      year: 'numeric', 
                      month: '2-digit', 
                      day: '2-digit',
                      hour: '2-digit',
                      minute: '2-digit'
                    })}
                  </div>
                </div>
                <div class="activity-content">
                  ${blog.blog_content ? blog.blog_content.substring(0, 100) + '...' : '-'}
                </div>
                <div class="activity-meta">
                  <span><i class="fas fa-${statusIcon}"></i> ${statusText}</span>
                  ${blog.target_platform ? `<span><i class="fas fa-globe"></i> ${blog.target_platform}</span>` : ''}
                  ${blog.keywords && blog.keywords.length > 0 ? `<span><i class="fas fa-tags"></i> ${blog.keywords.slice(0, 3).join(', ')}</span>` : ''}
                </div>
              </div>
            `;
          }).join('');

        } catch (error) {
          console.error('âŒ ë¸”ë¡œê·¸ ë‚´ì—­ ì¡°íšŒ ì‹¤íŒ¨:', error);
          container.innerHTML = `
            <div class="activity-empty">
              <i class="fas fa-exclamation-triangle"></i>
              <div>ë¸”ë¡œê·¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>
              <div style="font-size: 0.9em; color: #666; margin-top: 8px;">
                ${error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}
              </div>
            </div>
          `;
        }
      }

      function closeDetailModal() {
        document.getElementById('detailModal').classList.remove('show');
      }

      // ==================== UI ë Œë”ë§ ====================

      function renderMembers(members) {
        const tbody = document.getElementById('memberTableBody');
        
        console.log('ğŸ¨ renderMembers í˜¸ì¶œë¨, íšŒì› ìˆ˜:', members?.length || 0);

        if (!members || members.length === 0) {
          console.log('â„¹ï¸ íšŒì›ì´ ì—†ìŒ, ë¹ˆ í…Œì´ë¸” í‘œì‹œ');
          tbody.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; padding: 60px; color: #6b7280;">
                <i class="fas fa-inbox" style="font-size: 48px; opacity: 0.3; display: block; margin-bottom: 16px;"></i>
                íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤
              </td>
            </tr>
          `;
          return;
        }

        try {
          tbody.innerHTML = members.map((member, index) => {
          // ë“±ê¸‰ ì •ê·œí™”
          const normalizedLevel = normalizeMembershipLevel(member.membership_level);

          // í‘œì‹œìš© ë“±ê¸‰ëª… (í•œê¸€)
          const levelDisplayName = LEVEL_NAMES[normalizedLevel] || normalizedLevel;
          // CSS í´ë˜ìŠ¤ìš© ë“±ê¸‰ (seed ì‚¬ìš©)
          const levelCssClass = normalizedLevel;

            // ì•ˆì „í•œ ë¬¸ìì—´ ì²˜ë¦¬ (ë”°ì˜´í‘œ, íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„)
            const safeName = (member.name || '-').replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            const safeEmail = (member.email || '-').replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            const memberId = member.id || '';
            
            return `
            <tr>
              <td><strong>${safeName}</strong></td>
              <td>${safeEmail}</td>
              <td>
                <span class="badge ${member.user_type || 'owner'}">
                  ${member.user_type === 'owner' ? 'ì‹ë‹¹ ëŒ€í‘œ' : 
                    member.user_type === 'agency' ? 'ëŒ€í–‰ì‚¬/ë¸”ë¡œê±°' : 'ê´€ë¦¬ì'}
                </span>
              </td>
              <td>
                <span class="badge ${levelCssClass}">
                  ${levelDisplayName}
                </span>
              </td>
              <td>${member.created_at ? new Date(member.created_at).toLocaleString('ko-KR', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
              }) : '-'}</td>
              <td>
                <button class="btn primary" onclick="showMemberDetail('${memberId}')" title="íšŒì› ìƒì„¸ì •ë³´">
                  <i class="fas fa-info-circle"></i> ìƒì„¸ë³´ê¸°
                </button>
                <button class="btn" onclick="updateMemberLevel('${memberId}', '${safeName}', '${normalizedLevel}', '${member.user_type || 'owner'}')" title="íšŒì› ë“±ê¸‰ ë° ìœ í˜• ë³€ê²½">
                  <i class="fas fa-edit"></i> ë“±ê¸‰ ë³€ê²½
                </button>
                <button class="btn danger" onclick="deleteMember('${memberId}', '${safeName}')" title="íšŒì› ì‚­ì œ">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          `;
          }).join('');
          
          console.log('âœ… í…Œì´ë¸” ë Œë”ë§ ì™„ë£Œ');
        } catch (error) {
          console.error('âŒ ë Œë”ë§ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
          tbody.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; padding: 60px; color: #dc2626;">
                <i class="fas fa-exclamation-triangle" style="font-size: 48px; display: block; margin-bottom: 16px;"></i>
                ë Œë”ë§ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}
              </td>
            </tr>
          `;
        }
      }

      async function updateStats(members, total) {
        // í˜„ì¬ í˜ì´ì§€ì˜ íšŒì› ìˆ˜ (í‘œì‹œìš©)
        const ownerCount = members.filter(m => m.user_type === 'owner').length;
        const agencyCount = members.filter(m => m.user_type === 'agency').length;
        const adminCount = members.filter(m => m.user_type === 'admin').length;

        // ì „ì²´ í†µê³„ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ë³„ë„ API í˜¸ì¶œ (í•„í„°ê°€ ì—†ì„ ë•Œë§Œ)
        if (!currentFilter && !currentSearch) {
          try {
            await waitForAdminUtils();
            const statsResult = await AdminUtils.adminFetch('/api/admin/members?limit=1000');
            if (statsResult.success && statsResult.members) {
              const allMembers = statsResult.members;
              document.getElementById('stat-total').textContent = statsResult.total || 0;
              document.getElementById('stat-owner').textContent = allMembers.filter(m => m.user_type === 'owner').length;
              document.getElementById('stat-agency').textContent = allMembers.filter(m => m.user_type === 'agency').length;
              document.getElementById('stat-admin').textContent = allMembers.filter(m => m.user_type === 'admin').length;
              return;
            }
          } catch (error) {
            console.warn('í†µê³„ ì¡°íšŒ ì‹¤íŒ¨, í˜„ì¬ í˜ì´ì§€ ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œ:', error);
          }
        }

        // í•„í„°ê°€ ìˆê±°ë‚˜ í†µê³„ ì¡°íšŒ ì‹¤íŒ¨ ì‹œ í˜„ì¬ í˜ì´ì§€ ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œ
        document.getElementById('stat-total').textContent = total || 0;
        document.getElementById('stat-owner').textContent = ownerCount;
        document.getElementById('stat-agency').textContent = agencyCount;
        document.getElementById('stat-admin').textContent = adminCount;
      }

      function renderPagination(currentPage, total, limit) {
        const totalPages = Math.ceil(total / limit);
        const pagination = document.getElementById('pagination');

        if (totalPages <= 1) {
          pagination.style.display = 'none';
          return;
        }

        pagination.style.display = 'flex';

        let html = '';

        // ì´ì „ ë²„íŠ¼
        html += `
          <button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} 
                  onclick="goToPage(${currentPage - 1})">
            <i class="fas fa-chevron-left"></i>
          </button>
        `;

        // í˜ì´ì§€ ë²ˆí˜¸
        for (let i = 1; i <= totalPages; i++) {
          if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
            html += `
              <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                      onclick="goToPage(${i})">
                ${i}
              </button>
            `;
          } else if (i === currentPage - 3 || i === currentPage + 3) {
            html += '<span style="padding: 8px;">...</span>';
          }
        }

        // ë‹¤ìŒ ë²„íŠ¼
        html += `
          <button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} 
                  onclick="goToPage(${currentPage + 1})">
            <i class="fas fa-chevron-right"></i>
          </button>
        `;

        pagination.innerHTML = html;
      }

      // ==================== ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ====================

      function filterByType(btn, type) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        currentFilter = type;
        currentPage = 1;
        loadMembers(currentFilter, currentSearch, currentPage);
      }

      function handleSearch(event) {
        if (event.key === 'Enter') {
          currentSearch = event.target.value.trim();
          currentPage = 1;
          loadMembers(currentFilter, currentSearch, currentPage);
        }
      }

      function goToPage(page) {
        currentPage = page;
        loadMembers(currentFilter, currentSearch, currentPage);
      }

      function closeLevelModal() {
        document.getElementById('levelModal').classList.remove('show');
        selectedMember = null;
      }

      // ==================== ìœ í‹¸ë¦¬í‹° ====================

      function showLoading(show) {
        document.getElementById('loadingContainer').style.display = show ? 'block' : 'none';
        document.getElementById('tableContainer').style.display = show ? 'none' : 'block';
      }

      function showError(message) {
        const container = document.getElementById('errorContainer');
        const tableContainer = document.getElementById('tableContainer');
        
        container.innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-triangle"></i> 
            <strong>ì˜¤ë¥˜ ë°œìƒ:</strong> ${message}
            <br><br>
            <small style="color: #666;">
              ğŸ’¡ í•´ê²° ë°©ë²•:<br>
              1. ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìì„¸í•œ ì˜¤ë¥˜ í™•ì¸<br>
              2. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸ (Render ì„œë²„)<br>
              3. ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ API ì‘ë‹µ í™•ì¸<br>
              4. ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ í´ë¦­í•´ ë‹¤ì‹œ ì‹œë„
            </small>
          </div>
        `;
        container.style.display = 'block';
        
        // í…Œì´ë¸”ì€ ìˆ¨ê¸°ê³  ì—ëŸ¬ë§Œ í‘œì‹œ
        if (tableContainer) {
          tableContainer.style.display = 'none';
        }
      }

      function hideError() {
        document.getElementById('errorContainer').style.display = 'none';
      }

      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
      window.addEventListener('click', function(event) {
        const modal = document.getElementById('levelModal');
        if (event.target === modal) {
          closeLevelModal();
        }
      });

      // ==================== í”Œë ˆì´ìŠ¤ í¬ë¡¤ë§ ìºì‹œ ====================

      // í”Œë ˆì´ìŠ¤ ìºì‹œ ë¡œë“œ
      async function loadPlaceCache() {
        const tbody = document.getElementById('placeCacheBody');
        
        try {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; padding: 40px; color: #999;">
                <i class="fas fa-spinner fa-spin"></i> ë¡œë”© ì¤‘...
              </td>
            </tr>
          `;

          await waitForAdminUtils();
          const result = await AdminUtils.adminFetch('/api/admin/place-cache');
          
          if (!result.success || !result.data || result.data.length === 0) {
            tbody.innerHTML = `
              <tr>
                <td colspan="6" style="text-align: center; padding: 40px; color: #999;">
                  <i class="fas fa-inbox"></i> í¬ë¡¤ë§ëœ í”Œë ˆì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤
                </td>
              </tr>
            `;
            return;
          }

          tbody.innerHTML = result.data.map(place => `
            <tr>
              <td><strong>${place.place_name || '-'}</strong></td>
              <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                ${place.place_address || '-'}
              </td>
              <td>${place.business_hours || '-'}</td>
              <td style="text-align: center;">
                <span class="badge ${place.crawl_count > 1 ? 'premium' : 'seed'}">
                  ${place.crawl_count}íšŒ
                </span>
              </td>
              <td>${formatDate(place.last_crawled_at)}</td>
              <td>${formatDate(place.created_at)}</td>
            </tr>
          `).join('');

        } catch (error) {
          console.error('í”Œë ˆì´ìŠ¤ ìºì‹œ ë¡œë“œ ì˜¤ë¥˜:', error);
          tbody.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; padding: 40px; color: #e74c3c;">
                <i class="fas fa-exclamation-triangle"></i> ë¡œë“œ ì‹¤íŒ¨: ${error.message}
              </td>
            </tr>
          `;
        }
      }

      // ë‚ ì§œ í¬ë§·
      function formatDate(dateString) {
        if (!dateString) return '-';
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${year}-${month}-${day} ${hours}:${minutes}`;
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ í”Œë ˆì´ìŠ¤ ìºì‹œ ìë™ ë¡œë“œ
      setTimeout(() => {
        loadPlaceCache();
      }, 1000);
    </script>

    <!-- ê³µí†µ ê´€ë¦¬ì ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/admin/assets/admin-sidebar.js?v=20251030" defer></script>
    <script src="/admin/assets/admin-header.js?v=20251030" defer></script>
    <script src="/admin/assets/admin-utils.js?v=20251030" defer></script>

    <script>
      // ê¶Œí•œ ì²´í¬ëŠ” window.addEventListener('load')ì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì œê±°
      // DOMContentLoadedì—ì„œ requireAdminì„ í˜¸ì¶œí•˜ë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë£¨í”„ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ
    </script>

    <!-- ì¶”ì  ë° ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/assets/analytics.js"></script>
    <script src="/assets/error-logger.js"></script>
    <script src="/assets/performance-tracker.js"></script>
  </body>
</html>

