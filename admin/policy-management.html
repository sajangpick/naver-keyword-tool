<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì •ì±…ì§€ì›ê¸ˆ ê´€ë¦¬ - ì‚¬ì¥í”½ ê´€ë¦¬ì</title>
    
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      rel="stylesheet"
    />
    
    <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="/admin/assets/admin-common.css" />
    
    <style>
      .policy-controls {
        display: flex;
        gap: 12px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }

      .category-filter {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .category-btn {
        padding: 8px 16px;
        border: 1px solid var(--border);
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
      }

      .category-btn:hover {
        background: rgba(3, 199, 90, 0.1);
        border-color: var(--accent);
      }

      .category-btn.active {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }

      .policy-grid {
        display: grid;
        gap: 16px;
      }

      .policy-card {
        background: white;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        display: flex;
        gap: 20px;
        transition: all 0.2s;
        position: relative;
      }

      .policy-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      }

      .policy-content {
        flex: 1;
        min-width: 0;
      }

      .policy-header {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 8px;
      }

      .policy-category {
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
      }

      .category-startup { background: #E8F5E9; color: #2E7D32; }
      .category-operation { background: #E3F2FD; color: #1565C0; }
      .category-employment { background: #FFF3E0; color: #EF6C00; }
      .category-facility { background: #F3E5F5; color: #7B1FA2; }
      .category-marketing { background: #FCE4EC; color: #C2185B; }
      .category-education { background: #FFF9C4; color: #F57F17; }
      .category-other { background: #F5F5F5; color: #616161; }

      .policy-status {
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
      }

      .status-active { background: #E8F5E9; color: #2E7D32; }
      .status-upcoming { background: #FFF3E0; color: #EF6C00; }
      .status-ended { background: #FFEBEE; color: #C62828; }

      .policy-featured {
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        background: #FFE082;
        color: #F57F17;
      }

      .policy-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text);
      }

      .policy-org {
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 8px;
      }

      .policy-amount {
        font-size: 16px;
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 8px;
      }

      .policy-summary {
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 12px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .policy-meta {
        display: flex;
        gap: 16px;
        font-size: 13px;
        color: var(--text-secondary);
        margin-bottom: 12px;
      }

      .policy-deadline {
        background: #FFF3E0;
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: 500;
      }

      .policy-deadline.urgent {
        background: #FFEBEE;
        color: #C62828;
      }

      .policy-actions {
        display: flex;
        gap: 8px;
      }

      .policy-btn {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
        border: 1px solid var(--border);
        background: white;
        cursor: pointer;
        transition: all 0.2s;
      }

      .policy-btn:hover {
        background: var(--bg);
      }

      .policy-btn.edit {
        color: var(--info);
        border-color: var(--info);
      }

      .policy-btn.edit:hover {
        background: rgba(59, 130, 246, 0.1);
      }

      .policy-btn.delete {
        color: var(--danger);
        border-color: var(--danger);
      }

      .policy-btn.delete:hover {
        background: rgba(239, 68, 68, 0.1);
      }

      /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 10000;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 1000px;
        max-height: 95vh;
        overflow-y: auto;
        padding: 24px;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .modal-title {
        font-size: 24px;
        font-weight: 700;
      }

      .modal-close {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: none;
        background: var(--bg);
        cursor: pointer;
        font-size: 18px;
        transition: all 0.2s;
      }

      .modal-close:hover {
        background: var(--border);
      }

      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 16px;
      }

      .form-group {
        margin-bottom: 16px;
      }

      .form-group.full-width {
        grid-column: 1 / -1;
      }

      .form-label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text);
      }

      .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s;
      }

      .form-textarea {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 14px;
        resize: vertical;
        min-height: 100px;
        font-family: inherit;
      }

      .form-input:focus,
      .form-textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(3, 199, 90, 0.1);
      }

      .form-select {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 14px;
        background: white;
        cursor: pointer;
      }

      .form-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 12px;
      }

      .form-checkbox input {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .tag-input-container {
        position: relative;
      }

      .tag-list {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 8px;
      }

      .tag-item {
        padding: 4px 10px;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 16px;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .tag-remove {
        cursor: pointer;
        color: var(--danger);
        font-weight: bold;
      }

      .modal-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
      }

      .btn {
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
      }

      .btn-primary {
        background: var(--accent);
        color: white;
      }

      .btn-primary:hover {
        background: #02b350;
      }

      .btn-secondary {
        background: var(--bg);
        color: var(--text);
      }

      .btn-secondary:hover {
        background: var(--border);
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
      }

      .pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 24px;
      }

      .page-btn {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: white;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
      }

      .page-btn:hover {
        background: var(--bg);
      }

      .page-btn.active {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }

      .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      .stat-card {
        background: white;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
      }

      .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 4px;
      }

      .stat-label {
        font-size: 14px;
        color: var(--text-secondary);
      }

      .help-text {
        font-size: 13px;
        color: var(--text-secondary);
        margin-top: 4px;
      }
    </style>
  </head>
  <body>
    <!-- ì‚¬ì´ë“œë°” ìë™ ìƒì„± -->
    
    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="admin-main">
      <!-- í—¤ë” ìë™ ìƒì„± -->
      
      <div class="content">
        <!-- í†µê³„ -->
        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-value" id="totalCount">0</div>
            <div class="stat-label">ì „ì²´ ì •ì±…</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="activeCount">0</div>
            <div class="stat-label">ì§„í–‰ì¤‘</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="upcomingCount">0</div>
            <div class="stat-label">ì˜ˆì •</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="endedCount">0</div>
            <div class="stat-label">ë§ˆê°</div>
          </div>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ -->
        <div class="policy-controls">
          <button class="btn btn-primary" onclick="openModal()">
            <i class="fas fa-plus"></i> ìƒˆ ì •ì±… ë“±ë¡
          </button>
          
          <button class="btn btn-primary" style="background: #ff6b6b;" onclick="fetchRealPolicies()">
            <i class="fas fa-download"></i> ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          </button>

          <div class="category-filter">
            <button class="category-btn active" data-category="all" onclick="filterCategory('all')">
              ì „ì²´
            </button>
            <button class="category-btn" data-category="startup" onclick="filterCategory('startup')">
              ì°½ì—…ì§€ì›
            </button>
            <button class="category-btn" data-category="operation" onclick="filterCategory('operation')">
              ìš´ì˜ì§€ì›
            </button>
            <button class="category-btn" data-category="employment" onclick="filterCategory('employment')">
              ì¸ê±´ë¹„ì§€ì›
            </button>
            <button class="category-btn" data-category="facility" onclick="filterCategory('facility')">
              ì‹œì„¤ê°œì„ 
            </button>
            <button class="category-btn" data-category="marketing" onclick="filterCategory('marketing')">
              ë§ˆì¼€íŒ…
            </button>
            <button class="category-btn" data-category="education" onclick="filterCategory('education')">
              êµìœ¡ì§€ì›
            </button>
            <button class="category-btn" data-category="other" onclick="filterCategory('other')">
              ê¸°íƒ€
            </button>
          </div>
        </div>

        <!-- ì •ì±… ëª©ë¡ -->
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">ğŸ’° ì •ì±…ì§€ì›ê¸ˆ ëª©ë¡</h2>
          </div>
          
          <div class="policy-grid" id="policyList">
            <div class="loading">
              <i class="fas fa-spinner fa-spin"></i>
              <div>ë¡œë”© ì¤‘...</div>
            </div>
          </div>

          <div class="pagination" id="pagination"></div>
        </div>
      </div>
    </main>

    <!-- ì •ì±… ì‘ì„±/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="policyModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="modalTitle">ìƒˆ ì •ì±… ë“±ë¡</h2>
          <button class="modal-close" onclick="closeModal()">Ã—</button>
        </div>

        <form id="policyForm">
          <input type="hidden" id="policyId" />

          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">ì§€ì›ê¸°ê´€ *</label>
              <input type="text" class="form-input" id="policyOrganization" required placeholder="ì˜ˆ: ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€" />
            </div>

            <div class="form-group">
              <label class="form-label">ì¹´í…Œê³ ë¦¬ *</label>
              <select class="form-select" id="policyCategory" required>
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="startup">ì°½ì—…ì§€ì›</option>
                <option value="operation">ìš´ì˜ì§€ì›</option>
                <option value="employment">ì¸ê±´ë¹„ì§€ì›</option>
                <option value="facility">ì‹œì„¤ê°œì„ </option>
                <option value="marketing">ë§ˆì¼€íŒ…</option>
                <option value="education">êµìœ¡ì§€ì›</option>
                <option value="other">ê¸°íƒ€</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label class="form-label">ì •ì±…ëª… *</label>
              <input type="text" class="form-input" id="policyTitle" required placeholder="ì •ì±…ì§€ì›ê¸ˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />
            </div>

            <div class="form-group">
              <label class="form-label">ì§€ì›ê¸ˆì•¡</label>
              <input type="text" class="form-input" id="policyAmount" placeholder="ì˜ˆ: ìµœëŒ€ 5,000ë§Œì›" />
            </div>

            <div class="form-group">
              <label class="form-label">ì§€ì›ìœ í˜•</label>
              <select class="form-select" id="policyType">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="grant">ë³´ì¡°ê¸ˆ</option>
                <option value="loan">ëŒ€ì¶œ</option>
                <option value="tax_benefit">ì„¸ì œí˜œíƒ</option>
                <option value="voucher">ë°”ìš°ì²˜</option>
                <option value="consulting">ì»¨ì„¤íŒ…</option>
                <option value="other">ê¸°íƒ€</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label class="form-label">ê°„ë‹¨ ì„¤ëª… *</label>
              <textarea class="form-textarea" id="policySummary" required placeholder="í•œ ì¤„ë¡œ ì •ì±…ì„ ì„¤ëª…í•˜ì„¸ìš”"></textarea>
            </div>

            <div class="form-group full-width">
              <label class="form-label">ìƒì„¸ ë‚´ìš© *</label>
              <textarea class="form-textarea" id="policyDescription" required placeholder="ì •ì±… ì§€ì› ë‚´ìš©ì„ ìì„¸íˆ ì„¤ëª…í•˜ì„¸ìš”" style="min-height: 150px;"></textarea>
            </div>

            <div class="form-group full-width">
              <label class="form-label">ì§€ì› ìê²© *</label>
              <textarea class="form-textarea" id="policyEligibility" required placeholder="ì§€ì› ëŒ€ìƒ ë° ìê²© ìš”ê±´ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>

            <div class="form-group full-width">
              <label class="form-label">í•„ìš” ì„œë¥˜</label>
              <textarea class="form-textarea" id="policyDocuments" placeholder="ì‹ ì²­ì— í•„ìš”í•œ ì„œë¥˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>

            <div class="form-group">
              <label class="form-label">ì‹ ì²­ ì‹œì‘ì¼</label>
              <input type="date" class="form-input" id="policyStartDate" />
            </div>

            <div class="form-group">
              <label class="form-label">ì‹ ì²­ ë§ˆê°ì¼</label>
              <input type="date" class="form-input" id="policyEndDate" />
            </div>

            <div class="form-group full-width">
              <label class="form-label">ì‹ ì²­ ë°©ë²•</label>
              <textarea class="form-textarea" id="policyMethod" placeholder="ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ì‹ ì²­ ë°©ë²•ì„ ì„¤ëª…í•˜ì„¸ìš”"></textarea>
            </div>

            <div class="form-group">
              <label class="form-label">ì‹ ì²­ URL</label>
              <input type="url" class="form-input" id="policyUrl" placeholder="https://example.com/apply" />
            </div>

            <div class="form-group">
              <label class="form-label">í™ˆí˜ì´ì§€</label>
              <input type="url" class="form-input" id="policyWebsite" placeholder="https://example.com" />
            </div>

            <div class="form-group">
              <label class="form-label">ì—°ë½ì²˜</label>
              <input type="text" class="form-input" id="policyPhone" placeholder="ì˜ˆ: 1357" />
            </div>

            <div class="form-group">
              <label class="form-label">ë¬¸ì˜ì²˜</label>
              <input type="text" class="form-input" id="policyContact" placeholder="ì˜ˆ: ì†Œìƒê³µì¸ì‹œì¥ì§„í¥ê³µë‹¨" />
            </div>

            <div class="form-group">
              <label class="form-label">ìƒíƒœ</label>
              <select class="form-select" id="policyStatus">
                <option value="active">ì ‘ìˆ˜ì¤‘</option>
                <option value="upcoming">ì ‘ìˆ˜ì˜ˆì •</option>
                <option value="ended">ë§ˆê°</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label class="form-label">ëŒ€ìƒ ì—…ì¢…</label>
              <div class="tag-input-container">
                <div class="tag-list" id="businessTypeTags"></div>
                <input type="text" class="form-input" id="businessTypeInput" placeholder="ì—…ì¢… ì…ë ¥ í›„ Enter (ì˜ˆ: ìŒì‹ì , ì¹´í˜, ì†Œë§¤ì—…)" />
              </div>
              <div class="help-text">Enter í‚¤ë¥¼ ëˆŒëŸ¬ ì—¬ëŸ¬ ì—…ì¢…ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
            </div>

            <div class="form-group full-width">
              <label class="form-label">ì§€ì› ì§€ì—­</label>
              <div class="tag-input-container">
                <div class="tag-list" id="targetAreaTags"></div>
                <input type="text" class="form-input" id="targetAreaInput" placeholder="ì§€ì—­ ì…ë ¥ í›„ Enter (ì˜ˆ: ì „êµ­, ì„œìš¸ì‹œ, ê²½ê¸°ë„)" />
              </div>
              <div class="help-text">Enter í‚¤ë¥¼ ëˆŒëŸ¬ ì—¬ëŸ¬ ì§€ì—­ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
            </div>

            <div class="form-group full-width">
              <label class="form-label">ê²€ìƒ‰ íƒœê·¸</label>
              <div class="tag-input-container">
                <div class="tag-list" id="searchTags"></div>
                <input type="text" class="form-input" id="searchTagInput" placeholder="íƒœê·¸ ì…ë ¥ í›„ Enter" />
              </div>
            </div>
          </div>

          <div class="form-checkbox">
            <input type="checkbox" id="policyFeatured" />
            <label for="policyFeatured">â­ ì¤‘ìš” ì •ì±…ìœ¼ë¡œ í‘œì‹œ</label>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
            <button type="submit" class="btn btn-primary">ì €ì¥</button>
          </div>
        </form>
      </div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/admin/assets/admin-sidebar.js"></script>
    <script src="/admin/assets/admin-header.js"></script>
    <script src="/admin/assets/admin-utils.js"></script>
    
    <script>
      // API ë² ì´ìŠ¤ URL ì„¤ì • (ë¡œì»¬/í”„ë¡œë•ì…˜ ìë™ ê°ì§€)
      const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
        ? 'http://localhost:5000'
        : 'https://naver-keyword-tool.onrender.com';
      
      console.log('ğŸ”— API ë² ì´ìŠ¤ URL:', API_BASE);

      let currentPage = 1;
      let currentCategory = 'all';
      let editingPolicyId = null;
      let businessTypes = [];
      let targetAreas = [];
      let searchTags = [];

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener('DOMContentLoaded', async () => {
        // Supabase ì„¸ì…˜ì´ ì¤€ë¹„ë  ë•Œê¹Œì§€ ì•½ê°„ ëŒ€ê¸° (ì¸ì¦ ì²´í¬ ë°©ì§€)
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // ë°ì´í„° ë¡œë“œ (í† í° ì—†ì´ë„ ì¡°íšŒ ê°€ëŠ¥)
        try {
          await loadPolicies();
          await loadStatistics();
        } catch (error) {
          console.error('ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
          // ì—ëŸ¬ê°€ ë°œìƒí•´ë„ í˜ì´ì§€ëŠ” ê³„ì† ì‘ë™
        }

        // í¼ ì œì¶œ
        const policyForm = document.getElementById('policyForm');
        if (policyForm) {
          policyForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            await savePolicy();
          });
        }

        // íƒœê·¸ ì…ë ¥ ì´ë²¤íŠ¸
        setupTagInput('businessTypeInput', 'businessTypeTags', businessTypes);
        setupTagInput('targetAreaInput', 'targetAreaTags', targetAreas);
        setupTagInput('searchTagInput', 'searchTags', searchTags);
      });

      // ì •ì±… ëª©ë¡ ë¡œë“œ
      async function loadPolicies(page = 1) {
        currentPage = page;
        const policyList = document.getElementById('policyList');
        
        try {
          const params = new URLSearchParams({
            page,
            limit: 10,
            status: 'all' // ê´€ë¦¬ìëŠ” ëª¨ë“  ìƒíƒœ ì¡°íšŒ
          });

          if (currentCategory !== 'all') {
            params.append('category', currentCategory);
          }

          const response = await fetch(`${API_BASE}/api/policy-support?${params}`);
          const result = await response.json();

          if (!result.success || !result.data) {
            throw new Error(result.error || 'ì •ì±…ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }

          if (result.data.length === 0) {
            policyList.innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">ğŸ’°</div>
                <div>ë“±ë¡ëœ ì •ì±…ì´ ì—†ìŠµë‹ˆë‹¤</div>
              </div>
            `;
            document.getElementById('pagination').innerHTML = '';
            return;
          }

          // ì •ì±… ì¹´ë“œ ìƒì„±
          policyList.innerHTML = result.data.map(policy => {
            const categoryLabels = {
              startup: 'ì°½ì—…ì§€ì›',
              operation: 'ìš´ì˜ì§€ì›',
              employment: 'ì¸ê±´ë¹„ì§€ì›',
              facility: 'ì‹œì„¤ê°œì„ ',
              marketing: 'ë§ˆì¼€íŒ…',
              education: 'êµìœ¡ì§€ì›',
              other: 'ê¸°íƒ€'
            };

            const statusLabels = {
              active: 'ì ‘ìˆ˜ì¤‘',
              upcoming: 'ì ‘ìˆ˜ì˜ˆì •',
              ended: 'ë§ˆê°'
            };

            const deadline = policy.application_end_date ? 
              calculateDeadline(policy.application_end_date) : null;

            return `
              <div class="policy-card">
                <div class="policy-content">
                  <div class="policy-header">
                    <span class="policy-category category-${policy.category}">
                      ${categoryLabels[policy.category] || policy.category}
                    </span>
                    <span class="policy-status status-${policy.status}">
                      ${statusLabels[policy.status] || policy.status}
                    </span>
                    ${policy.is_featured ? '<span class="policy-featured">â­ ì¤‘ìš”</span>' : ''}
                  </div>
                  <div class="policy-org">${policy.organization}</div>
                  <div class="policy-title">${policy.title}</div>
                  ${policy.support_amount ? `<div class="policy-amount">${policy.support_amount}</div>` : ''}
                  <div class="policy-summary">${policy.summary}</div>
                  
                  ${deadline && policy.status === 'active' ? `
                    <span class="policy-deadline ${deadline.days <= 7 ? 'urgent' : ''}">
                      ${deadline.days === 0 ? 'ì˜¤ëŠ˜ ë§ˆê°' : 
                        deadline.days > 0 ? `ë§ˆê° D-${deadline.days}` : 'ë§ˆê°'}
                    </span>
                  ` : ''}
                  
                  <div class="policy-meta">
                    <span><i class="fas fa-calendar"></i> ${new Date(policy.created_at).toLocaleDateString('ko-KR')}</span>
                    <span><i class="fas fa-eye"></i> ${policy.view_count}íšŒ</span>
                    ${policy.application_url ? '<span><i class="fas fa-link"></i> ì˜¨ë¼ì¸ ì‹ ì²­ ê°€ëŠ¥</span>' : ''}
                  </div>
                  
                  <div class="policy-actions">
                    <button class="policy-btn edit" onclick="editPolicy(${policy.id})">
                      <i class="fas fa-edit"></i> ìˆ˜ì •
                    </button>
                    <button class="policy-btn delete" onclick="deletePolicy(${policy.id})">
                      <i class="fas fa-trash"></i> ì‚­ì œ
                    </button>
                  </div>
                </div>
              </div>
            `;
          }).join('');

          // í˜ì´ì§€ë„¤ì´ì…˜
          renderPagination(result.pagination);

        } catch (error) {
          console.error('Load policies error:', error);
          policyList.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">âš ï¸</div>
              <div>ì •ì±…ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</div>
              <div style="font-size: 14px; margin-top: 8px;">${error.message}</div>
            </div>
          `;
        }
      }

      // í†µê³„ ë¡œë“œ
      async function loadStatistics() {
        try {
          const response = await fetch(`${API_BASE}/api/policy-support/categories`);
          const result = await response.json();
          
          if (result.success && result.data) {
            const total = Object.values(result.data).reduce((sum, count) => sum + count, 0);
            document.getElementById('totalCount').textContent = total;
            
            // ìƒíƒœë³„ ì¹´ìš´íŠ¸ (ì˜ˆì‹œ - ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
            // ì—¬ê¸°ì„œëŠ” ì„ì‹œë¡œ í‘œì‹œ
          }
        } catch (error) {
          console.error('Load statistics error:', error);
        }
      }

      // ë§ˆê°ì¼ ê³„ì‚°
      function calculateDeadline(endDate) {
        if (!endDate) return null;
        
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const end = new Date(endDate);
        end.setHours(0, 0, 0, 0);
        
        const diffTime = end - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        return { days: diffDays };
      }

      // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
      function renderPagination(pagination) {
        const paginationEl = document.getElementById('pagination');
        if (!pagination || pagination.totalPages <= 1) {
          paginationEl.innerHTML = '';
          return;
        }

        let html = '';
        
        // ì´ì „ ë²„íŠ¼
        if (pagination.page > 1) {
          html += `<button class="page-btn" onclick="loadPolicies(${pagination.page - 1})">â†</button>`;
        }

        // í˜ì´ì§€ ë²ˆí˜¸
        for (let i = 1; i <= pagination.totalPages; i++) {
          if (i === pagination.page) {
            html += `<button class="page-btn active">${i}</button>`;
          } else if (i === 1 || i === pagination.totalPages || Math.abs(i - pagination.page) <= 2) {
            html += `<button class="page-btn" onclick="loadPolicies(${i})">${i}</button>`;
          } else if (i === pagination.page - 3 || i === pagination.page + 3) {
            html += `<span style="padding: 8px;">...</span>`;
          }
        }

        // ë‹¤ìŒ ë²„íŠ¼
        if (pagination.page < pagination.totalPages) {
          html += `<button class="page-btn" onclick="loadPolicies(${pagination.page + 1})">â†’</button>`;
        }

        paginationEl.innerHTML = html;
      }

      // ì¹´í…Œê³ ë¦¬ í•„í„°
      function filterCategory(category) {
        currentCategory = category;
        
        // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ
        document.querySelectorAll('.category-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.category === category);
        });

        loadPolicies(1);
      }

      // íƒœê·¸ ì…ë ¥ ì„¤ì •
      function setupTagInput(inputId, tagListId, tagArray) {
        const input = document.getElementById(inputId);
        const tagList = document.getElementById(tagListId);

        input?.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            const value = input.value.trim();
            if (value && !tagArray.includes(value)) {
              tagArray.push(value);
              renderTags(tagListId, tagArray);
              input.value = '';
            }
          }
        });
      }

      // íƒœê·¸ ë Œë”ë§
      function renderTags(tagListId, tagArray) {
        const tagList = document.getElementById(tagListId);
        tagList.innerHTML = tagArray.map((tag, index) => `
          <div class="tag-item">
            ${tag}
            <span class="tag-remove" onclick="removeTag('${tagListId}', ${index})">Ã—</span>
          </div>
        `).join('');
      }

      // íƒœê·¸ ì œê±°
      function removeTag(tagListId, index) {
        let tagArray;
        if (tagListId === 'businessTypeTags') {
          tagArray = businessTypes;
        } else if (tagListId === 'targetAreaTags') {
          tagArray = targetAreas;
        } else if (tagListId === 'searchTags') {
          tagArray = searchTags;
        }
        
        tagArray.splice(index, 1);
        renderTags(tagListId, tagArray);
      }

      // ëª¨ë‹¬ ì—´ê¸°
      function openModal(policyId = null) {
        editingPolicyId = policyId;
        document.getElementById('policyModal').classList.add('active');
        
        // íƒœê·¸ ë°°ì—´ ì´ˆê¸°í™”
        businessTypes = [];
        targetAreas = [];
        searchTags = [];
        
        if (policyId) {
          document.getElementById('modalTitle').textContent = 'ì •ì±… ìˆ˜ì •';
          loadPolicyDetail(policyId);
        } else {
          document.getElementById('modalTitle').textContent = 'ìƒˆ ì •ì±… ë“±ë¡';
          document.getElementById('policyForm').reset();
          renderTags('businessTypeTags', businessTypes);
          renderTags('targetAreaTags', targetAreas);
          renderTags('searchTags', searchTags);
          editingPolicyId = null;
        }
      }

      // ëª¨ë‹¬ ë‹«ê¸°
      function closeModal() {
        document.getElementById('policyModal').classList.remove('active');
        document.getElementById('policyForm').reset();
        editingPolicyId = null;
        businessTypes = [];
        targetAreas = [];
        searchTags = [];
      }

      // ì •ì±… ìƒì„¸ ë¡œë“œ
      async function loadPolicyDetail(id) {
        try {
          const token = localStorage.getItem('access_token');
          const response = await fetch(`${API_BASE}/api/policy-support?id=${id}`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          const result = await response.json();

          if (result.success && result.data) {
            const policy = result.data;
            document.getElementById('policyId').value = policy.id;
            document.getElementById('policyTitle').value = policy.title;
            document.getElementById('policyOrganization').value = policy.organization;
            document.getElementById('policyCategory').value = policy.category;
            document.getElementById('policySummary').value = policy.summary;
            document.getElementById('policyDescription').value = policy.description;
            document.getElementById('policyAmount').value = policy.support_amount || '';
            document.getElementById('policyType').value = policy.support_type || '';
            document.getElementById('policyEligibility').value = policy.eligibility_criteria;
            document.getElementById('policyDocuments').value = policy.required_documents || '';
            document.getElementById('policyStartDate').value = policy.application_start_date || '';
            document.getElementById('policyEndDate').value = policy.application_end_date || '';
            document.getElementById('policyMethod').value = policy.application_method || '';
            document.getElementById('policyUrl').value = policy.application_url || '';
            document.getElementById('policyWebsite').value = policy.website_url || '';
            document.getElementById('policyPhone').value = policy.phone_number || '';
            document.getElementById('policyContact').value = policy.contact_info || '';
            document.getElementById('policyStatus').value = policy.status || 'active';
            document.getElementById('policyFeatured').checked = policy.is_featured;
            
            // íƒœê·¸ ì„¤ì •
            businessTypes = policy.business_type || [];
            targetAreas = policy.target_area || [];
            searchTags = policy.tags || [];
            
            renderTags('businessTypeTags', businessTypes);
            renderTags('targetAreaTags', targetAreas);
            renderTags('searchTags', searchTags);
          }
        } catch (error) {
          console.error('Load policy detail error:', error);
          alert('ì •ì±… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      }

      // ì •ì±… ì €ì¥
      async function savePolicy() {
        const title = document.getElementById('policyTitle').value.trim();
        const organization = document.getElementById('policyOrganization').value.trim();
        const category = document.getElementById('policyCategory').value;
        const summary = document.getElementById('policySummary').value.trim();
        const description = document.getElementById('policyDescription').value.trim();
        const eligibility_criteria = document.getElementById('policyEligibility').value.trim();

        if (!title || !organization || !category || !summary || !description || !eligibility_criteria) {
          alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        try {
          // ì¸ì¦ í† í° ê°€ì ¸ì˜¤ê¸° (Supabase ì„¸ì…˜ ìš°ì„ )
          let token = null;
          
          try {
            if (window.AdminBootstrap && typeof window.AdminBootstrap.getSupabaseClient === 'function') {
              const supabase = await window.AdminBootstrap.getSupabaseClient();
              const { data: { session } } = await supabase.auth.getSession();
              if (session?.access_token) {
                token = session.access_token;
              }
            }
          } catch (e) {
            // ë¬´ì‹œ
          }
          
          if (!token) {
            token = localStorage.getItem('access_token');
          }
          
          if (!token) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            return;
          }
          
          const method = editingPolicyId ? 'PUT' : 'POST';
          
          const body = {
            title,
            organization,
            category,
            summary,
            description,
            support_amount: document.getElementById('policyAmount').value.trim() || null,
            support_type: document.getElementById('policyType').value || null,
            eligibility_criteria,
            required_documents: document.getElementById('policyDocuments').value.trim() || null,
            business_type: businessTypes,
            target_area: targetAreas,
            application_start_date: document.getElementById('policyStartDate').value || null,
            application_end_date: document.getElementById('policyEndDate').value || null,
            application_method: document.getElementById('policyMethod').value.trim() || null,
            application_url: document.getElementById('policyUrl').value.trim() || null,
            website_url: document.getElementById('policyWebsite').value.trim() || null,
            phone_number: document.getElementById('policyPhone').value.trim() || null,
            contact_info: document.getElementById('policyContact').value.trim() || null,
            status: document.getElementById('policyStatus').value,
            is_featured: document.getElementById('policyFeatured').checked,
            tags: searchTags
          };

          if (editingPolicyId) {
            body.id = editingPolicyId;
          }

          const response = await fetch(`${API_BASE}/api/policy-support`, {
            method,
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(body)
          });

          const result = await response.json();

          if (!result.success) {
            throw new Error(result.error || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }

          alert(editingPolicyId ? 'ì •ì±…ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì •ì±…ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
          closeModal();
          loadPolicies(currentPage);
          loadStatistics();

        } catch (error) {
          console.error('Save policy error:', error);
          alert('ì •ì±… ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
      }

      // ì •ì±… ìˆ˜ì •
      function editPolicy(id) {
        openModal(id);
      }

      // ì •ì±… ì‚­ì œ
      async function deletePolicy(id) {
        if (!confirm('ì •ë§ ì´ ì •ì±…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          return;
        }

        try {
          // ì¸ì¦ í† í° ê°€ì ¸ì˜¤ê¸° (Supabase ì„¸ì…˜ ìš°ì„ )
          let token = null;
          
          try {
            if (window.AdminBootstrap && typeof window.AdminBootstrap.getSupabaseClient === 'function') {
              const supabase = await window.AdminBootstrap.getSupabaseClient();
              const { data: { session } } = await supabase.auth.getSession();
              if (session?.access_token) {
                token = session.access_token;
              }
            }
          } catch (e) {
            // ë¬´ì‹œ
          }
          
          if (!token) {
            token = localStorage.getItem('access_token');
          }
          
          if (!token) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            return;
          }
          
          const response = await fetch(`${API_BASE}/api/policy-support?id=${id}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          const result = await response.json();

          if (!result.success) {
            throw new Error(result.error || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }

          alert('ì •ì±…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          loadPolicies(currentPage);
          loadStatistics();

        } catch (error) {
          console.error('Delete policy error:', error);
          alert('ì •ì±… ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
      }

      // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeModal();
        }
      });

      // ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      async function fetchRealPolicies() {
        if (!confirm('ì‹¤ì œ ì •ë¶€ ì •ì±… ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê³µê³µë°ì´í„°í¬í„¸ê³¼ ì •ì±…ë¸Œë¦¬í•‘ì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.')) {
          return;
        }

        const btn = event.target;
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ë°ì´í„° ìˆ˜ì§‘ ì¤‘...';

        try {
          // 1. ì¸ì¦ í† í° ê°€ì ¸ì˜¤ê¸° (ì„ íƒì  - ì—†ì–´ë„ ì§„í–‰ ê°€ëŠ¥)
          let token = null;
          
          try {
            // Supabase ì„¸ì…˜ì—ì„œ í† í° ê°€ì ¸ì˜¤ê¸° (ìµœëŒ€ 1ì´ˆ ëŒ€ê¸°)
            if (window.AdminBootstrap && typeof window.AdminBootstrap.getSupabaseClient === 'function') {
              const supabase = await window.AdminBootstrap.getSupabaseClient();
              const { data: { session } } = await supabase.auth.getSession();
              if (session?.access_token) {
                token = session.access_token;
                console.log('âœ… Supabase ì„¸ì…˜ì—ì„œ í† í° ê°€ì ¸ì˜´');
              }
            }
          } catch (e) {
            // ë¬´ì‹œí•˜ê³  ê³„ì† ì§„í–‰
          }
          
          // Supabaseì—ì„œ ê°€ì ¸ì˜¤ì§€ ëª»í•œ ê²½ìš° localStorageì—ì„œ ì‹œë„
          if (!token) {
            token = localStorage.getItem('access_token');
          }
          
          // í† í°ì´ ì—†ì–´ë„ ì§„í–‰ (ë¡œê·¸ì¸ ì—†ì´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ê°€ëŠ¥)
          if (!token) {
            console.log('â„¹ï¸ ì¸ì¦ í† í° ì—†ì´ ì§„í–‰ (ê³µê°œ ë°ì´í„° ìˆ˜ì§‘)');
          }
          
          // 2. ì‹¤ì œ APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> APIì—ì„œ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...';
          
          const headers = {
            'Content-Type': 'application/json'
          };
          
          // í† í°ì´ ìˆìœ¼ë©´ í—¤ë”ì— ì¶”ê°€
          if (token) {
            headers['Authorization'] = `Bearer ${token}`;
          }
          
          const fetchResponse = await fetch(`${API_BASE}/api/fetch-real-policies`, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify({ save: true })
          });

          const fetchResult = await fetchResponse.json();

          if (!fetchResult.success) {
            throw new Error(fetchResult.error || 'ë°ì´í„° ìˆ˜ì§‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }

          const policies = fetchResult.data || [];
          
          if (policies.length === 0) {
            alert('âš ï¸ ìˆ˜ì§‘ëœ ì •ì±… ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\n\nAPI ì‘ë‹µì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-download"></i> ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°';
            return;
          }

          // 2. ì§„í–‰ ìƒí™© í‘œì‹œ
          let savedCount = 0;
          let skippedCount = 0;
          const errors = [];

          btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ë°ì´í„° ì €ì¥ ì¤‘... (0/${policies.length})`;

          // 3. ê° ì •ì±…ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ (ì¤‘ë³µ ì²´í¬)
          for (let i = 0; i < policies.length; i++) {
            const policy = policies[i];
            
            try {
              btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ë°ì´í„° ì €ì¥ ì¤‘... (${i + 1}/${policies.length})`;
              
              // í•„ìˆ˜ í•„ë“œ í™•ì¸
              if (!policy.title || !policy.organization || !policy.category) {
                skippedCount++;
                continue;
              }

              // ì¤‘ë³µ ì²´í¬ë¥¼ ìœ„í•´ ê¸°ì¡´ ì •ì±… ì¡°íšŒ (í† í° ì—†ì´ë„ ê°€ëŠ¥)
              let existing = null;
              try {
                const checkResponse = await fetch(`${API_BASE}/api/policy-support?search=${encodeURIComponent(policy.title)}&limit=1`);
                const checkResult = await checkResponse.json();
                if (checkResult.success && checkResult.data) {
                  existing = checkResult.data.find(p => p.title === policy.title);
                }
              } catch (e) {
                console.warn('ì¤‘ë³µ ì²´í¬ ì‹¤íŒ¨:', e);
              }
              
              if (existing) {
                skippedCount++;
                continue;
              }

              // ì •ì±… ì €ì¥ (í† í°ì´ ì—†ì–´ë„ ê°€ëŠ¥í•˜ë„ë¡ ìˆ˜ì •)
              const saveHeaders = {
                'Content-Type': 'application/json'
              };
              
              // í† í°ì´ ìˆìœ¼ë©´ í—¤ë”ì— ì¶”ê°€
              if (token) {
                saveHeaders['Authorization'] = `Bearer ${token}`;
              }

              const saveResponse = await fetch(`${API_BASE}/api/policy-support`, {
                method: 'POST',
                headers: saveHeaders,
                body: JSON.stringify({
                  ...policy,
                  // ê¸°ë³¸ê°’ ì„¤ì •
                  business_type: policy.business_type || ['ìŒì‹ì ', 'ì¹´í˜', 'ì†Œë§¤ì—…', 'ì„œë¹„ìŠ¤ì—…'],
                  target_area: policy.target_area || ['ì „êµ­'],
                  status: policy.status || 'active',
                  is_featured: policy.is_featured || false,
                  tags: policy.tags || []
                })
              });

              // ì‘ë‹µ ìƒíƒœ í™•ì¸
              let saveResult;
              try {
                saveResult = await saveResponse.json();
              } catch (e) {
                // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ
                skippedCount++;
                errors.push(`${policy.title}: ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨`);
                continue;
              }
              
              // 401 ì—ëŸ¬ì¸ ê²½ìš°ì—ë„ ì‘ë‹µ ë‚´ìš© í™•ì¸
              if (saveResponse.status === 401) {
                skippedCount++;
                errors.push(`${policy.title}: ${saveResult.error || 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤'}`);
                continue;
              }
              
              // 200ë²ˆëŒ€ ì„±ê³µ ì‘ë‹µ
              if (saveResponse.ok && saveResult.success) {
                savedCount++;
              } else {
                skippedCount++;
                errors.push(`${policy.title}: ${saveResult.error || 'ì €ì¥ ì‹¤íŒ¨'}`);
              }
              
            } catch (error) {
              skippedCount++;
              errors.push(`${policy.title}: ${error.message}`);
            }
          }

          // 4. ê²°ê³¼ í‘œì‹œ
          let message = `âœ… ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ!\n\n`;
          message += `â€¢ ìƒˆë¡œ ì¶”ê°€: ${savedCount}ê°œ\n`;
          message += `â€¢ ê±´ë„ˆëœ€ (ì¤‘ë³µ/ì˜¤ë¥˜): ${skippedCount}ê°œ\n`;
          message += `â€¢ ì´ ìˆ˜ì§‘: ${policies.length}ê°œ\n`;
          
          if (errors.length > 0 && errors.length <= 5) {
            message += `\nâš ï¸ ì˜¤ë¥˜ ë°œìƒ:\n${errors.slice(0, 5).join('\n')}`;
          } else if (errors.length > 5) {
            message += `\nâš ï¸ ${errors.length}ê°œ ì˜¤ë¥˜ ë°œìƒ (ì½˜ì†” í™•ì¸)`;
            console.error('ì €ì¥ ì˜¤ë¥˜ ëª©ë¡:', errors);
          }

          alert(message);
          
          // 5. ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          loadPolicies();
          loadStatistics();

        } catch (error) {
          console.error('Fetch real policies error:', error);
          alert('âŒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message + '\n\nì½˜ì†”ì—ì„œ ìì„¸í•œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        } finally {
          btn.disabled = false;
          btn.innerHTML = '<i class="fas fa-download"></i> ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°';
        }
      }
    </script>
  </body>
</html>

</html>
